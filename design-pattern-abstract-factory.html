<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.0.preview.7">
<title>抽象工厂模式</title>
<link rel="stylesheet" href="./assets/css/style.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>document.addEventListener('DOMContentLoaded', prettyPrint)</script>
<link rel="stylesheet" href="assets/css/view-example.css">
<script src='assets/js/jquery-2.1.1.min.js'></script>
<script src='assets/js/view-example.js'></script></head>
<body id="_abstract_factory_pattern" class="book toc2 toc-left">
<div id="header">
<h1>抽象工厂模式</h1>
<span id="revnumber">version 2.4.0-SNAPSHOT</span>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_example">1. 示例</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://en.wikipedia.org/wiki/Abstract_factory_pattern">抽象工厂模式</a>提供了一种对拥有
共同产品族的不同工厂进行封装的一种方法. 它体现了一个标准工厂的意图, 即不需要使用代码去确定具体的接口,
也不需要了解隐藏的接口后的实现, 而是适用于一组接口,并使用实现了这些接口的某个系列的实现类作为其实现.</p>
</div>
<div class="paragraph">
<p>举个例子, 我可能有Button, TextField 和 Scrollbar这三个接口. 我可能会用WindowsButton,
MacButton, FlashButton作为Button的实现类. 我可能会用WindowsScrollBar, MacScrollBar
及 FlashScrollBar作为ScrollBar的实现类. 通过使用抽象工厂模式, 使我能一次选择一个窗口系统
(如 Windows, Mac, Flash), 然后每次写到相关的代码时总是引用到这个接口,
而且这个接口的实现类总是和窗口系统相适应(即所有的控件都来自同一个窗口系统).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example">1. 示例</h2>
<div class="sectionbody">
<div class="paragraph">
<p>假设我们希望写个游戏系统. 我们可能会注意到很多游戏都拥有相似的功能和控制.</p>
</div>
<div class="paragraph">
<p>我们决定将这些游戏共有的代码和每个游戏特有的代码分配到不同的类中.</p>
</div>
<div class="paragraph">
<p>首先,我们看一看http://en.wikipedia.org/wiki/Two-Up[Two-up]游戏特有的代码.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class TwoupMessages {
    def welcome = 'Welcome to the twoup game, you start with $1000'
    def done = 'Sorry, you have no money left, goodbye'
}

class TwoupInputConverter {
    def convert(input) { input.toInteger() }
}

class TwoupControl {
    private money = 1000
    private random = new Random()
    private tossWasHead() {
        def next = random.nextInt()
        return next % 2 == 0
    }
    def moreTurns() {
        if (money &gt; 0) {
            println "You have $money, how much would you like to bet?"
            return true
        }

        false
    }
    def play(amount) {
        def coin1 = tossWasHead()
        def coin2 = tossWasHead()
        if (coin1 &amp;&amp; coin2) {
            money += amount
            println 'You win'
        } else if (!coin1 &amp;&amp; !coin2) {
            money -= amount
            println 'You lose'
        } else {
            println 'Draw'
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在,我们看一下猜数字游戏所特有的代码:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class GuessGameMessages {
    def welcome = 'Welcome to the guessing game, my secret number is between 1 and 100'
    def done = 'Correct'
}

class GuessGameInputConverter {
    def convert(input) { input.toInteger() }
}

class GuessGameControl {
    private lower = 1
    private upper = 100
    private guess = new Random().nextInt(upper - lower) + lower
    def moreTurns() {
        def done = (lower == guess || upper == guess)
        if (!done) {
            println "Enter a number between $lower and $upper"
        }

        !done
    }
    def play(nextGuess) {
        if (nextGuess &lt;= guess) {
            lower = [lower, nextGuess].max()
        }
        if (nextGuess &gt;= guess) {
            upper = [upper, nextGuess].min()
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在,写我们的工厂代码(factory code):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def guessFactory = [messages: GuessGameMessages, control: GuessGameControl, converter: GuessGameInputConverter]
def twoupFactory = [messages: TwoupMessages, control: TwoupControl, converter: TwoupInputConverter]

class GameFactory {
    def static factory
    def static getMessages() { return factory.messages.newInstance() }
    def static getControl() { return factory.control.newInstance() }
    def static getConverter() { return factory.converter.newInstance() }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>抽象工厂模式中最重要的部分就是允许选择一类族(an entire family of concrete classes)作为
这些工厂的实现类.</p>
</div>
<div class="paragraph">
<p>抽象工厂模式是这样使用的:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">GameFactory.factory = twoupFactory
def messages = GameFactory.messages
def control = GameFactory.control
def converter = GameFactory.converter
println messages.welcome
def reader = new BufferedReader(new InputStreamReader(System.in))
while (control.moreTurns()) {
    def input = reader.readLine().trim()
    control.play(converter.convert(input))
}
println messages.done</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意第一行配置了我们将会使用哪一类族(family)的游戏实现类.
我们通过第一行代码展示的工厂属性,选择具体使用哪一类族这一过程并不重要.
我们可以使用另一种等价的方式使用这种模式,比如,我们可以询问用户想玩哪一种游戏,
或者使用环境设置来觉得进行哪总游戏等等.</p>
</div>
<div class="paragraph">
<p>按照我们的代码,游戏运行起来会像这样:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Welcome to the twoup game, you start with $1000
You have 1000, how much would you like to bet?
300
Draw
You have 1000, how much would you like to bet?
700
You win
You have 1700, how much would you like to bet?
1700
You lose
Sorry, you have no money left, goodbye</pre>
</div>
</div>
<div class="paragraph">
<p>如果我们将脚本(script)的第一行改为 <code>GameFactory.factory = guessFactory</code>,
那么示例程序运行起来会是这个样子:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Welcome to the guessing game, my secret number is between 1 and 100
Enter a number between 1 and 100
75
Enter a number between 1 and 75
35
Enter a number between 1 and 35
15
Enter a number between 1 and 15
5
Enter a number between 5 and 15
10
Correct</pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2.4.0-SNAPSHOT<br>
Last updated 2014-07-16 00:29:30 CST
</div>
</div>
</body>
</html>