<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.0.preview.7">
<title>Groovy Language Documentation</title>
<link rel="stylesheet" href="./assets/css/style.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>document.addEventListener('DOMContentLoaded', prettyPrint)</script>
<link rel="stylesheet" href="assets/css/view-example.css">
<script src='assets/js/jquery-2.1.1.min.js'></script>
<script src='assets/js/view-example.js'></script></head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Groovy Language Documentation</h1>
<span id="revnumber">version 2.4.0-SNAPSHOT</span>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_introduction">简介</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#_groovy_language_specification">1. Groovy 语言规范</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_syntax">1.1. 语法</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_comments">1.1.1. 注释</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_single_line_comment">单行注释</a></li>
<li><a href="#_multiline_comment">多行注释</a></li>
<li><a href="#_groovydoc_comment">GroovyDoc 注释</a></li>
<li><a href="#_shebang_line">Shebang line</a></li>
</ul>
</li>
<li><a href="#_keywords">1.1.2. 关键字</a></li>
<li><a href="#_identifiers">1.1.3. 标识符</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_normal_identifiers">普通标识符</a></li>
<li><a href="#_quoted_identifiers">引用标识符</a></li>
</ul>
</li>
<li><a href="#all-strings">1.1.4. 字符串</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_single_quoted_string">单引号字符串</a></li>
<li><a href="#_string_concatenation">字符串拼接</a></li>
<li><a href="#_triple_single_quoted_string">三单引号字符串</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_escaping_special_characters">转义特殊字符</a></li>
<li><a href="#_unicode_escape_sequence">Unicode 转义序列</a></li>
</ul>
</li>
<li><a href="#_double_quoted_string">双引号字符串</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_string_interpolation">字符串插值</a></li>
<li><a href="#_special_case_of_interpolating_closure_expressions">特例 插入闭包表达式</a></li>
<li><a href="#_interoperability_with_java">与 Java 交互</a></li>
<li><a href="#_gstring_and_string_hashcodes">GString 和 String 的哈希码</a></li>
</ul>
</li>
<li><a href="#_triple_double_quoted_string">三双引号字符串</a></li>
<li><a href="#_slashy_string">斜线字符串</a></li>
<li><a href="#_dollar_slashy_string">美元斜线字符串</a></li>
<li><a href="#_string_summary_table">字符串总结表</a></li>
<li><a href="#_characters">字符</a></li>
</ul>
</li>
<li><a href="#_numbers">1.1.5. 数值</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_integral_literals">整数</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_alternative_non_base_10_representations">可选的非十进制表示</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#_binary_literal">二进制</a></li>
<li><a href="#_octal_literal">八进制</a></li>
<li><a href="#_hexadecimal_literal">十六进制</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_decimal_literals">浮点数</a></li>
<li><a href="#_underscore_in_literals">Underscore in literals</a></li>
<li><a href="#_number_type_suffixes">Number type suffixes</a></li>
<li><a href="#_math_operations">Math operations</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#integer_division">The case of the division operator</a></li>
<li><a href="#power_operator">The case of the power operator</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_booleans">1.1.6. Booleans</a></li>
<li><a href="#_lists">1.1.7. Lists</a></li>
<li><a href="#_arrays">1.1.8. Arrays</a></li>
<li><a href="#_maps">1.1.9. Maps</a></li>
</ul>
</li>
<li><a href="#groovy-operators">1.2. Operators</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_arithmetic_operators">1.2.1. Arithmetic operators</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_normal_arithmetic_operators">Normal arithmetic operators</a></li>
<li><a href="#_unary_operators">Unary operators</a></li>
<li><a href="#_assignment_arithmetic_operators">Assignment arithmetic operators</a></li>
</ul>
</li>
<li><a href="#_relational_operators">1.2.2. Relational operators</a></li>
<li><a href="#_logical_operators">1.2.3. Logical operators</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_precedence">Precedence</a></li>
<li><a href="#_short_circuiting_for_code_code">Short-circuiting for <code>||</code></a></li>
</ul>
</li>
<li><a href="#_bitwise_operators">1.2.4. Bitwise operators</a></li>
<li><a href="#_conditional_operators">1.2.5. Conditional operators</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_not_operator">Not operator</a></li>
<li><a href="#_ternary_operator">Ternary operator</a></li>
<li><a href="#_elvis_operator">Elvis operator</a></li>
</ul>
</li>
<li><a href="#_object_operators">1.2.6. Object operators</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_safe_navigation_operator">Safe navigation operator</a></li>
<li><a href="#_direct_field_access_operator">Direct field access operator</a></li>
<li><a href="#_method_reference_operator">Method reference operator</a></li>
</ul>
</li>
<li><a href="#_regular_expression_operators">1.2.7. Regular expression operators</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_pattern_operator">Pattern operator</a></li>
<li><a href="#_find_operator">Find operator</a></li>
<li><a href="#_match_operator">Match operator</a></li>
</ul>
</li>
<li><a href="#_other_operators_wip">1.2.8. Other operators (WIP)</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_spread_operator">Spread operator</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_spreading_method_arguments">Spreading method arguments</a></li>
<li><a href="#_spread_list_elements">Spread list elements</a></li>
<li><a href="#_spread_map_elements">Spread map elements</a></li>
</ul>
</li>
<li><a href="#_range_operator">Range operator</a></li>
<li><a href="#_spaceship_operator">Spaceship operator</a></li>
<li><a href="#subscript-operator">Subscript operator</a></li>
<li><a href="#_membership_operator">Membership operator</a></li>
<li><a href="#_identity_operator">Identity operator</a></li>
<li><a href="#_coercion_operator">Coercion operator</a></li>
<li><a href="#_diamond_operator">Diamond operator</a></li>
<li><a href="#_call_operator">Call operator</a></li>
</ul>
</li>
<li><a href="#_operator_precedence_tbd">1.2.9. Operator precedence (TBD)</a></li>
<li><a href="#Operator-Overloading">1.2.10. Operator overloading</a></li>
</ul>
</li>
<li><a href="#_program_structure">1.3. Program structure</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_package_name_tbd">1.3.1. Package name (TBD)</a></li>
<li><a href="#_imports_tbd">1.3.2. Imports (TBD)</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_default_imports_tbd">Default imports (TBD)</a></li>
<li><a href="#_simple_import_tbd">Simple import (TBD)</a></li>
<li><a href="#_star_import_tbd">Star import (TBD)</a></li>
<li><a href="#_static_import_tbd">Static import (TBD)</a></li>
<li><a href="#_static_star_import_tbd">Static star import (TBD)</a></li>
<li><a href="#_import_aliasing_tbd">Import aliasing (TBD)</a></li>
</ul>
</li>
<li><a href="#_scripts_versus_classes_tbd">1.3.3. Scripts versus classes (TBD)</a></li>
<li><a href="#_initializers_tbd">1.3.4. Initializers (TBD)</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_static_initializers_tbd">Static initializers (TBD)</a></li>
<li><a href="#_instance_initializers_tbd">Instance initializers (TBD)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_object_orientation">1.4. Object orientation</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_types_tbd">1.4.1. Types (TBD)</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_primitive_types_tbd">Primitive types (TBD)</a></li>
<li><a href="#_class_tbd">Class (TBD)</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_normal_class_tbd">Normal class (TBD)</a></li>
<li><a href="#_static_class_tbd">Static class (TBD)</a></li>
<li><a href="#_inner_class_tbd">Inner class (TBD)</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#_anonymous_inner_class_tbd">Anonymous inner class (TBD)</a></li>
</ul>
</li>
<li><a href="#_abstract_class_tbd">Abstract class (TBD)</a></li>
</ul>
</li>
<li><a href="#_interface_tbd">Interface (TBD)</a></li>
<li><a href="#_annotation_tbd">Annotation (TBD)</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_closure_annotation_parameters_tbd">Closure annotation parameters (TBD)</a></li>
<li><a href="#_meta_annotations_tbd">Meta-annotations (TBD)</a></li>
<li><a href="#_annotation_placement_tbd">Annotation placement (TBD)</a></li>
</ul>
</li>
<li><a href="#_constructors_tbd">Constructors (TBD)</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_named_argument_constructor_tbd">Named argument constructor (TBD)</a></li>
</ul>
</li>
<li><a href="#_methods_tbd">Methods (TBD)</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_method_definition_tbd">Method definition (TBD)</a></li>
<li><a href="#_named_arguments_tbd">Named arguments (TBD)</a></li>
<li><a href="#_default_arguments_tbd">Default arguments (TBD)</a></li>
<li><a href="#_varargs_tbd">Varargs (TBD)</a></li>
<li><a href="#_method_selection_algorithm_tbd">Method selection algorithm (TBD)</a></li>
<li><a href="#_exception_declaration_tbd">Exception declaration (TBD)</a></li>
</ul>
</li>
<li><a href="#_fields_and_properties_tbd">Fields and properties (TBD)</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_fields_tbd">Fields (TBD)</a></li>
<li><a href="#_properties_tbd">Properties (TBD)</a></li>
</ul>
</li>
<li><a href="#_inheritance_tbd">Inheritance (TBD)</a></li>
<li><a href="#generics">Generics (TBD)</a></li>
</ul>
</li>
<li><a href="#_traits">1.4.2. Traits</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_methods">Methods</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_public_methods">Public methods</a></li>
<li><a href="#_abstract_methods">Abstract methods</a></li>
<li><a href="#_private_methods">Private methods</a></li>
</ul>
</li>
<li><a href="#_the_meaning_of_this">The meaning of this</a></li>
<li><a href="#_interfaces">Interfaces</a></li>
<li><a href="#_properties">Properties</a></li>
<li><a href="#_fields">Fields</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_private_fields">Private fields</a></li>
<li><a href="#_public_fields">Public fields</a></li>
</ul>
</li>
<li><a href="#_composition_of_behaviors">Composition of behaviors</a></li>
<li><a href="#_overriding_default_methods">Overriding default methods</a></li>
<li><a href="#_extending_traits">Extending traits</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_simple_inheritance">Simple inheritance</a></li>
<li><a href="#_multiple_inheritance">Multiple inheritance</a></li>
</ul>
</li>
<li><a href="#_duck_typing_and_traits">Duck typing and traits</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_dynamic_code">Dynamic code</a></li>
<li><a href="#_dynamic_methods_in_a_trait">Dynamic methods in a trait</a></li>
</ul>
</li>
<li><a href="#_multiple_inheritance_conflicts">Multiple inheritance conflicts</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_default_conflict_resolution">Default conflict resolution</a></li>
<li><a href="#_user_conflict_resolution">User conflict resolution</a></li>
</ul>
</li>
<li><a href="#_runtime_implementation_of_traits">Runtime implementation of traits</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_implementing_a_trait_at_runtime">Implementing a trait at runtime</a></li>
<li><a href="#_implementing_multiple_traits_at_once">Implementing multiple traits at once</a></li>
</ul>
</li>
<li><a href="#_chaining_behavior">Chaining behavior</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_semantics_of_super_inside_a_trait">Semantics of super inside a trait</a></li>
</ul>
</li>
<li><a href="#_advanced_features">Advanced features</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_sam_type_coercion">SAM type coercion</a></li>
<li><a href="#_differences_with_java_8_default_methods">Differences with Java 8 default methods</a></li>
</ul>
</li>
<li><a href="#_differences_with_mixins">Differences with mixins</a></li>
<li><a href="#_static_methods_properties_and_fields">Static methods, properties and fields</a></li>
<li><a href="#_inheritance_of_state_gotchas">Inheritance of state gotchas</a></li>
<li><a href="#_limitations">Limitations</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_compatibility_with_ast_transformations">Compatibility with AST transformations</a></li>
<li><a href="#_prefix_and_postfix_operations">Prefix and postfix operations</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_closures_tbd">1.4.3. Closures (TBD)</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_syntax_tbd">Syntax (TBD)</a></li>
<li><a href="#_parameters_tbd">Parameters (TBD)</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_normal_parameters_tbd">Normal parameters (TBD)</a></li>
<li><a href="#_implicit_parameter_tbd">Implicit parameter (TBD)</a></li>
<li><a href="#_default_parameter_tbd">Default parameter (TBD)</a></li>
<li><a href="#_varargs_tbd_2">Varargs (TBD)</a></li>
</ul>
</li>
<li><a href="#_delegation_strategy_tbd">Delegation strategy (TBD)</a></li>
<li><a href="#_closures_in_gstrings_tbd">Closures in GStrings (TBD)</a></li>
<li><a href="#_functional_programming_tbd">Functional programming (TBD)</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_currying_tbd">Currying (TBD)</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#_left_currying_tbd">Left currying (TBD)</a></li>
<li><a href="#_right_currying_tbd">Right currying (TBD)</a></li>
<li><a href="#_index_based_currying_tbd">Index based currying (TBD)</a></li>
</ul>
</li>
<li><a href="#_memoization_tbd">Memoization (TBD)</a></li>
<li><a href="#_composition_tbd">Composition (TBD)</a></li>
<li><a href="#_trampoline_tbd">Trampoline (TBD)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_semantics">1.4.4. Semantics</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_statements">Statements</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_variable_definition">Variable definition</a></li>
<li><a href="#_variable_assignment">Variable assignment</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#_multiple_assignment">Multiple assignment</a></li>
<li><a href="#_overflow_and_underflow">Overflow and Underflow</a></li>
<li><a href="#_object_destructuring_with_multiple_assignment">Object destructuring with multiple assignment</a></li>
</ul>
</li>
<li><a href="#_control_structures_wip">Control structures (WIP)</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#_conditional_structures">Conditional structures</a></li>
<li>
<ul class="sectlevel7">
<li><a href="#_if_else">if / else</a></li>
<li><a href="#_switch_case">switch / case</a></li>
</ul>
</li>
<li><a href="#_looping_structures">Looping structures</a></li>
<li>
<ul class="sectlevel7">
<li><a href="#_classic_for_loop">Classic for loop</a></li>
<li><a href="#_for_in_loop">for in loop</a></li>
<li><a href="#_while_loop">while loop</a></li>
</ul>
</li>
<li><a href="#_exception_handling">Exception handling</a></li>
<li><a href="#_try_catch_finally">try / catch / finally</a></li>
<li><a href="#_multi_catch">Multi-catch</a></li>
</ul>
</li>
<li><a href="#_power_assertion_tbd">Power assertion (TBD)</a></li>
<li><a href="#_labeled_statements_tbd">Labeled statements (TBD)</a></li>
</ul>
</li>
<li><a href="#_expressions_tbd">Expressions (TBD)</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_gpath_expressions_tbd">GPath expressions (TBD)</a></li>
</ul>
</li>
<li><a href="#_promotion_and_coercion_tbd">Promotion and coercion (TBD)</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_number_promotion_tbd">Number promotion (TBD)</a></li>
<li><a href="#_closure_to_type_coercion">Closure to type coercion</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#_assigning_a_closure_to_a_sam_type">Assigning a closure to a SAM type</a></li>
<li><a href="#_calling_a_method_accepting_a_sam_type_with_a_closure">Calling a method accepting a SAM type with a closure</a></li>
<li><a href="#_closure_to_arbitrary_type_coercion">Closure to arbitrary type coercion</a></li>
</ul>
</li>
<li><a href="#_map_to_type_coercion">Map to type coercion</a></li>
<li><a href="#_string_to_enum_coercion">String to enum coercion</a></li>
<li><a href="#_custom_type_coercion">Custom type coercion</a></li>
<li><a href="#_class_literals_vs_variables_and_the_as_operator">Class literals vs variables and the as operator</a></li>
</ul>
</li>
<li><a href="#_optionality_tbd">Optionality (TBD)</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_optional_parentheses_tbd">Optional parentheses (TBD)</a></li>
<li><a href="#_optional_semicolons_tbd">Optional semicolons (TBD)</a></li>
<li><a href="#_optional_return_keyword_tbd">Optional return keyword (TBD)</a></li>
<li><a href="#_optional_public_keyword_tbd">Optional public keyword (TBD)</a></li>
</ul>
</li>
<li><a href="#Groovy-Truth">The Groovy Truth (TBD)</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_customizing_the_truth_with_asboolean_methods_tbd">Customizing the truth with asBoolean() methods (TBD)</a></li>
</ul>
</li>
<li><a href="#_typing_wip">Typing (WIP)</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_optional_typing">Optional typing</a></li>
<li><a href="#static-type-checking">Static type checking</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#_the_code_typechecked_code_annotation">The <code>@TypeChecked</code> annotation</a></li>
<li>
<ul class="sectlevel7">
<li><a href="#_activating_type_checking_at_compile_time">Activating type checking at compile time</a></li>
<li><a href="#_skipping_sections">Skipping sections</a></li>
</ul>
</li>
<li><a href="#_type_checking_assignments">Type checking assignments</a></li>
<li><a href="#_list_and_map_constructors">List and map constructors</a></li>
<li><a href="#_method_resolution">Method resolution</a></li>
<li><a href="#type-inference">Type inference</a></li>
<li>
<ul class="sectlevel7">
<li><a href="#_principles">Principles</a></li>
<li><a href="#_variables_vs_fields_in_type_inference">Variables vs fields in type inference</a></li>
<li><a href="#_collection_literal_type_inference">Collection literal type inference</a></li>
<li><a href="#section-lub">Least upper bound</a></li>
<li><a href="#_instanceof_inference">instanceof inference</a></li>
<li><a href="#section-flow-typing">Flow typing</a></li>
<li><a href="#_advanced_type_inference">Advanced type inference</a></li>
</ul>
</li>
<li><a href="#_closures_and_type_inference">Closures and type inference</a></li>
<li>
<ul class="sectlevel7">
<li><a href="#_return_type_inference">Return type inference</a></li>
<li><a href="#_parameter_type_inference">Parameter type inference</a></li>
<li>
<ul class="sectlevel8">
<li><a href="#_explicit_closure_parameters">Explicit closure parameters</a></li>
<li><a href="#_parameters_inferred_from_single_abstract_method_types">Parameters inferred from single-abstract method types</a></li>
<li><a href="#_the_code_closureparams_code_annotation">The <code>@ClosureParams</code> annotation</a></li>
</ul>
</li>
<li><a href="#__code_delegatesto_code"><code>@DelegatesTo</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_static_compilation_wip">Static compilation (WIP)</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#_dynamic_vs_static">Dynamic vs static</a></li>
<li><a href="#compilestatic-annotation">The <code>@CompileStatic</code> annotation</a></li>
<li><a href="#_key_benefits">Key benefits</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_tools">2. Tools</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_compiling_groovy">2.1. Compiling Groovy</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_groovyc_the_groovy_compiler">2.1.1. groovyc, the Groovy compiler</a></li>
<li><a href="#_ant_task">2.1.2. Ant task</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#ThegroovycAntTask-groovyc"><code>&lt;groovyc&gt;</code></a></li>
<li>
<ul class="sectlevel5">
<li><a href="#ThegroovycAntTask-Description">Description</a></li>
<li><a href="#ThegroovycAntTask-Requiredtaskdef">Required taskdef</a></li>
<li><a href="#ThegroovycAntTask-groovycAttributes">&lt;groovyc&gt; Attributes</a></li>
<li><a href="#ThegroovycAntTask-groovycNestedElements">&lt;groovyc&gt; Nested Elements</a></li>
<li><a href="#ThegroovycAntTask-JointCompilation">Joint Compilation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_maven_integration">2.1.3. Maven integration</a></li>
<li><a href="#_gmaven_and_gmavenplus">2.1.4. GMaven and GMavenPlus</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#section-gmaven">GMaven</a></li>
<li><a href="#section-gmavenplus">GMavenPlus</a></li>
<li><a href="#section-gmaven2">GMaven2</a></li>
</ul>
</li>
<li><a href="#section-groovyeclipse">2.1.5. The Groovy Eclipse Maven plugin</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#Groovy-EclipsecompilerpluginforMaven-Howtousethecompilerplugin---SettingupthePOM">How to use the compiler plugin—Setting up the POM</a></li>
<li><a href="#Groovy-EclipsecompilerpluginforMaven-Settingupthesourcefolders">Setting up the source folders</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#Groovy-EclipsecompilerpluginforMaven-Donothing">Do nothing</a></li>
<li><a href="#Groovy-EclipsecompilerpluginforMaven-Doalmostnothing">Do almost nothing</a></li>
<li><a href="#Groovy-EclipsecompilerpluginforMaven-Usethegroovy-eclipse-compilermojoforconfiguringsourcefolders">Use the <code>groovy-eclipse-compiler</code> mojo for configuring source folders</a></li>
<li><a href="#Groovy-EclipsecompilerpluginforMaven-Usethebuild-helper-maven-plugin">Use the <code>build-helper-maven-plugin</code></a></li>
</ul>
</li>
<li><a href="#Groovy-EclipsecompilerpluginforMaven-Sampleprojectandsourcecode">Sample project and source code</a></li>
<li><a href="#Groovy-EclipsecompilerpluginforMaven-WhyanotherGroovycompilerforMavenWhataboutGMaven">Why another Groovy compiler for Maven? What about GMaven?</a></li>
<li><a href="#Groovy-EclipsecompilerpluginforMaven-ProjectLombok">Project Lombok</a></li>
<li><a href="#Groovy-EclipsecompilerpluginforMaven-Groovy-Eclipseconfiguratorform2Eclipse">Groovy-Eclipse configurator for m2Eclipse</a></li>
<li><a href="#Groovy-EclipsecompilerpluginforMaven-ReleaseBuilds">Release Builds</a></li>
<li><a href="#Groovy-EclipsecompilerpluginforMaven-DevelopmentBuilds">Development Builds</a></li>
<li><a href="#Groovy-EclipsecompilerpluginforMaven-Wheretofindmoreinformationandaskquestions">Where to find more information and ask questions</a></li>
</ul>
</li>
<li><a href="#section-jointcompilation">2.1.6. Joint compilation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_groovysh_the_groovy_shell">3. groovysh, the Groovy shell</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_groovy_groovy_shell">3.1. Groovy : Groovy Shell</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#GroovyShell-Features">3.1.1. Features</a></li>
<li><a href="#GroovyShell-Command-lineOptionsandArguments">3.1.2. Command-line Options and Arguments</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#GroovyShell-ExecuteaCommand">Execute a Command</a></li>
<li><a href="#GroovyShell-EvaluateanExpression">Evaluate an Expression</a></li>
</ul>
</li>
<li><a href="#GroovyShell-EvaluatingExpressions">3.1.3. Evaluating Expressions</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#GroovyShell-SimpleExpressions">Simple Expressions</a></li>
<li><a href="#GroovyShell-EvaluationResult">Evaluation Result</a></li>
<li><a href="#GroovyShell-Multi-lineExpressions">Multi-line Expressions</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#GroovyShell-DefineaClass">Define a Class</a></li>
<li><a href="#GroovyShell-UsetheClass">Use the Class</a></li>
</ul>
</li>
<li><a href="#GroovyShell-Variables">Variables</a></li>
<li><a href="#GroovyShell-Functions">Functions</a></li>
</ul>
</li>
<li><a href="#GroovyShell-Commands">3.1.4. Commands</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#GroovyShell-RecognizedCommands">Recognized Commands</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#GroovyShell-help"><code>help</code></a></li>
<li><a href="#GroovyShell-exit"><code>exit</code></a></li>
<li><a href="#GroovyShell-import"><code>import</code></a></li>
<li><a href="#GroovyShell-display"><code>display</code></a></li>
<li><a href="#GroovyShell-clear"><code>clear</code></a></li>
<li><a href="#GroovyShell-show"><code>show</code></a></li>
<li><a href="#GroovyShell-inspect"><code>inspect</code></a></li>
<li><a href="#GroovyShell-purge"><code>purge</code></a></li>
<li><a href="#GroovyShell-edit"><code>edit</code></a></li>
<li><a href="#GroovyShell-load"><code>load</code></a></li>
<li><a href="#GroovyShell-save"><code>save</code></a></li>
<li><a href="#GroovyShell-record"><code>record</code></a></li>
<li><a href="#GroovyShell-history"><code>history</code></a></li>
<li><a href="#GroovyShell-alias"><code>alias</code></a></li>
<li><a href="#GroovyShell-doc"><code>doc</code></a></li>
<li><a href="#GroovyShell-set"><code>set</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#GroovyShell-Preferences">3.1.5. Preferences</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#GroovyShell-RecognizedPreferences">Recognized Preferences</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#GroovyShell-verbosity"><code>verbosity</code></a></li>
<li><a href="#GroovyShell-show-last-result"><code>show-last-result</code></a></li>
<li><a href="#GroovyShell-sanitize-stack-trace"><code>sanitize-stack-trace</code></a></li>
<li><a href="#GroovyShell-editor"><code>editor</code></a></li>
</ul>
</li>
<li><a href="#GroovyShell-SettingaPreference">Setting a Preference</a></li>
<li><a href="#GroovyShell-ListingPreferences">Listing Preferences</a></li>
<li><a href="#GroovyShell-ClearingPreferencesieResettingtoDefaults">Clearing Preferences (ie. Resetting to Defaults)</a></li>
</ul>
</li>
<li><a href="#GroovyShell-UserProfileScriptsandState">3.1.6. User Profile Scripts and State</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#GroovyShell-ProfileScripts">Profile Scripts</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#GroovyShell-HOMEgroovygroovyshprofile"><code>$HOME/.groovy/groovysh.profile</code></a></li>
<li><a href="#GroovyShell-HOMEgroovygroovyshrc"><code>$HOME/.groovy/groovysh.rc</code></a></li>
</ul>
</li>
<li><a href="#GroovyShell-State">State</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#GroovyShell-HOMEgroovygroovyshhistory"><code>$HOME/.groovy/groovysh.history</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#GroovyShell-register">3.1.7. Custom commands</a></li>
<li><a href="#GroovyShell-ScreenShots">3.1.8. Screen Shots</a></li>
<li><a href="#GroovyShell-Troubleshooting">3.1.9. Troubleshooting</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#GroovyShell-PlatformProblems">Platform Problems</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#GroovyShell-ProblemsloadingtheJLineDLL">Problems loading the JLine DLL</a></li>
<li><a href="#GroovyShell-ProblemswithCygwinonWindows">Problems with Cygwin on Windows</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_groovyconsole_the_groovy_swing_console">3.2. groovyConsole, the Groovy swing console</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#title-heading">3.2.1. Groovy : Groovy Console</a></li>
<li><a href="#GroovyConsole-Basics">3.2.2. Basics</a></li>
<li><a href="#GroovyConsole-Features">3.2.3. Features</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#GroovyConsole-RunningScripts">Running Scripts</a></li>
<li><a href="#GroovyConsole-EditingFiles">Editing Files</a></li>
<li><a href="#GroovyConsole-Historyandresults">History and results</a></li>
<li><a href="#GroovyConsole-Interrupt">Interrupting a script</a></li>
<li><a href="#GroovyConsole-Andmore">And more</a></li>
</ul>
</li>
<li><a href="#GroovyConsole-EmbeddingtheConsole">3.2.4. Embedding the Console</a></li>
<li><a href="#GroovyConsole-Visualizingscriptoutputresults">3.2.5. Visualizing script output results</a></li>
<li><a href="#GroovyConsole-ASTbrowser">3.2.6. AST browser</a></li>
</ul>
</li>
<li><a href="#_groovydoc_the_groovy_java_documentation_generator">3.3. groovydoc, the Groovy &amp; Java documentation generator</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#Groovydoc-CommandLine">3.3.1. The groovydoc command line tool</a></li>
<li><a href="#Groovydoc-Ant">3.3.2. The groovydoc Ant task</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#ThegroovydocAnttask-Requiredtaskdef">Required taskdef</a></li>
<li><a href="#ThegroovydocAnttask-groovydocAttributes">&lt;groovydoc&gt; Attributes</a></li>
<li><a href="#ThegroovydocAnttask-groovydocNestedElements">&lt;groovydoc&gt; Nested Elements</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#ThegroovydocAnttask-link">link</a></li>
<li><a href="#ThegroovydocAnttask-Example1-groovydocAnttask">Example #1 - &lt;groovydoc&gt; Ant task</a></li>
<li><a href="#ThegroovydocAnttask-Example2-ExecutinggroovydocfromGroovy">Example #2 - Executing &lt;groovydoc&gt; from Groovy</a></li>
</ul>
</li>
<li><a href="#_custom_templates">Custom templates</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_custom_groovydoc_class">Custom Groovydoc class</a></li>
<li><a href="#_using_the_custom_groovydoc_task">Using the custom groovydoc task</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ide_integration">3.4. IDE integration</a></li>
</ul>
</li>
<li><a href="#_user_guides">4. User Guides</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_getting_started">4.1. Getting started</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_download">4.1.1. Download</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_stable">Stable</a></li>
<li><a href="#_snapshots">Snapshots</a></li>
</ul>
</li>
<li><a href="#_maven_repository">4.1.2. Maven Repository</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_stable_release">Stable Release</a></li>
<li><a href="#_snapshot_releases">Snapshot Releases</a></li>
</ul>
</li>
<li><a href="#_gvm_the_groovy_environment_manager">4.1.3. GVM (the Groovy enVironment Manager)</a></li>
<li><a href="#_other_ways_to_get_groovy">4.1.4. Other ways to get Groovy</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_installation_on_mac_os_x">Installation on Mac OS X</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_macports">MacPorts</a></li>
<li><a href="#_homebrew">Homebrew</a></li>
</ul>
</li>
<li><a href="#_installation_on_windows">Installation on Windows</a></li>
<li><a href="#_other_distributions">Other Distributions</a></li>
<li><a href="#_source_code">Source Code</a></li>
<li><a href="#_ide_plugin">IDE plugin</a></li>
</ul>
</li>
<li><a href="#_install_binary">4.1.5. Install Binary</a></li>
</ul>
</li>
<li><a href="#_differences_with_java">4.2. Differences with Java</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_default_imports">4.2.1. Default imports</a></li>
<li><a href="#_multi_methods">4.2.2. Multi-methods</a></li>
<li><a href="#_array_initializers">4.2.3. Array initializers</a></li>
<li><a href="#_package_scope_visibility">4.2.4. Package scope visibility</a></li>
<li><a href="#_arm_blocks">4.2.5. ARM blocks</a></li>
<li><a href="#_inner_classes">4.2.6. Inner classes</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_static_inner_classes">Static inner classes</a></li>
<li><a href="#_anonymous_inner_classes">Anonymous Inner Classes</a></li>
<li><a href="#_creating_instances_of_non_static_inner_classes">Creating Instances of Non-Static Inner Classes</a></li>
</ul>
</li>
<li><a href="#_lambdas">4.2.7. Lambdas</a></li>
</ul>
</li>
<li><a href="#_groovy_development_kit_peter_ledbrook">4.3. Groovy Development Kit (Peter Ledbrook)</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_working_with_io_peter_ledbrook">4.3.1. Working with IO (Peter Ledbrook)</a></li>
<li><a href="#_working_with_collections_tbd">4.3.2. Working with collections (TBD)</a></li>
<li><a href="#_handy_utilities">4.3.3. Handy utilities</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_configslurper">ConfigSlurper</a></li>
<li><a href="#_expando">Expando</a></li>
<li><a href="#_observable_list_map_and_set">Observable list, map and set</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_metaprogramming">4.4. Metaprogramming</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_runtime_metaprogramming_tbd">4.4.1. Runtime metaprogramming (TBD)</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_groovyobject_interface_tbd">GroovyObject interface (TBD)</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_invokemethod_tbd">invokeMethod (TBD)</a></li>
<li><a href="#_get_setproperty_tbd">get/setProperty (TBD)</a></li>
<li><a href="#_get_setmetaclass_tbd">get/setMetaClass (TBD)</a></li>
</ul>
</li>
<li><a href="#_get_setattribute_tbd">get/setAttribute (TBD)</a></li>
<li><a href="#_methodmissing">methodMissing</a></li>
<li><a href="#_propertymissing">propertyMissing</a></li>
<li><a href="#_groovyinterceptable_tbd">GroovyInterceptable (TBD)</a></li>
<li><a href="#_categories">Categories</a></li>
<li><a href="#_metaclasses_tbd">Metaclasses (TBD)</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_custom_metaclasses_tbd">Custom metaclasses (TBD)</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#_delegating_metaclass_tbd">Delegating metaclass (TBD)</a></li>
<li><a href="#_magic_package_tbd">Magic package (TBD)</a></li>
</ul>
</li>
<li><a href="#_per_instance_metaclass_tbd">Per instance metaclass (TBD)</a></li>
<li><a href="#metaprogramming_emc">ExpandoMetaClass</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#_methods_2">Methods</a></li>
<li><a href="#_properties_2">Properties</a></li>
<li><a href="#_constructors">Constructors</a></li>
<li><a href="#_static_methods">Static Methods</a></li>
<li><a href="#_borrowing_methods">Borrowing Methods</a></li>
<li><a href="#_dynamic_method_names">Dynamic Method Names</a></li>
<li><a href="#_runtime_discovery">Runtime Discovery</a></li>
<li><a href="#_groovyobject_methods">GroovyObject Methods</a></li>
<li><a href="#_overriding_static_invokemethod">Overriding Static invokeMethod</a></li>
<li><a href="#_extending_interfaces">Extending Interfaces</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_extension_modules">Extension modules</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_extending_existing_classes">Extending existing classes</a></li>
<li><a href="#_instance_methods">Instance methods</a></li>
<li><a href="#_static_methods_2">Static methods</a></li>
<li><a href="#module-descriptor">Module descriptor</a></li>
<li><a href="#_extension_modules_and_classpath">Extension modules and classpath</a></li>
<li><a href="#_compatibility_with_type_checking">Compatibility with type checking</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_compile_time_metaprogramming">4.4.2. Compile-time metaprogramming</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_available_ast_transformations">Available AST transformations</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_code_generation_transformations">Code generation transformations</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#xform-ToString">@groovy.transform.ToString</a></li>
<li><a href="#xform-EqualsAndHashCode">@groovy.transform.EqualsAndHashCode</a></li>
<li><a href="#xform-TupleConstructor">@groovy.transform.TupleConstructor</a></li>
<li><a href="#xform-Canonical">@groovy.transform.Canonical</a></li>
<li><a href="#xform-InheritConstructors">@groovy.transform.InheritConstructors</a></li>
<li><a href="#xform-Category">@groovy.lang.Category</a></li>
<li><a href="#xform-IndexedProperty">@groovy.transform.IndexedProperty</a></li>
<li><a href="#xform-Lazy">@groovy.lang.Lazy</a></li>
<li><a href="#xform-Newify">@groovy.lang.Newify</a></li>
<li><a href="#xform-Sortable">@groovy.lang.Sortable</a></li>
<li><a href="#xform-Builder">@groovy.transform.builder.Builder</a></li>
</ul>
</li>
<li><a href="#_class_design_annotations">Class design annotations</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#xform-Delegate">@groovy.lang.Delegate</a></li>
<li><a href="#xform-Immutable">@groovy.transform.Immutable</a></li>
<li><a href="#xform-Memoized">@groovy.transform.Memoized</a></li>
<li><a href="#xform-Singleton">@groovy.lang.Singleton</a></li>
<li><a href="#xform-Mixin">@groovy.transform.Mixin</a></li>
</ul>
</li>
<li><a href="#_logging_improvements">Logging improvements</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#xform-Log">@groovy.util.logging.Log</a></li>
<li><a href="#xform-Commons">@groovy.util.logging.Commons</a></li>
<li><a href="#xform-Log4j">@groovy.util.logging.Log4j</a></li>
<li><a href="#xform-Log4j2">@groovy.util.logging.Log4j2</a></li>
<li><a href="#xform-Slf4j">@groovy.util.logging.Slf4j</a></li>
</ul>
</li>
<li><a href="#_declarative_concurrency">Declarative concurrency</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#xform-Synchronized">@groovy.transform.Synchronized</a></li>
<li><a href="#xform-WithReadLock">@groovy.transform.WithReadLock and @groovy.transform.WithWriteLock</a></li>
</ul>
</li>
<li><a href="#_easier_cloning_and_externalizing">Easier cloning and externalizing</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#xform-AutoClone">@groovy.transform.AutoClone</a></li>
<li><a href="#xform-AutoExternalize">@groovy.transform.AutoExternalize</a></li>
</ul>
</li>
<li><a href="#_safer_scripting">Safer scripting</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#xform-ThreadInterrupt">@groovy.transform.ThreadInterrupt</a></li>
<li><a href="#xform-TimedInterrupt">@groovy.transform.TimedInterrupt</a></li>
<li><a href="#xform-ConditionalInterrupt">@groovy.transform.ConditionalInterrupt</a></li>
</ul>
</li>
<li><a href="#_compiler_directives">Compiler directives</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#xform-Field">@groovy.transform.Field</a></li>
<li><a href="#xform-PackageScope">@groovy.transform.PackageScope</a></li>
<li><a href="#xform-AnnotationCollector">@groovy.transform.AnnotationCollector</a></li>
<li><a href="#xform-TypeChecked">@groovy.transform.TypeChecked</a></li>
<li><a href="#xform-CompileStatic">@groovy.transform.CompileStatic</a></li>
<li><a href="#xform-CompileDynamic">@groovy.transform.CompileDynamic</a></li>
<li><a href="#xform-DelegatesTo">@groovy.lang.DelegatesTo</a></li>
</ul>
</li>
<li><a href="#_swing_patterns">Swing patterns</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#xform-Bindable">@groovy.beans.Bindable</a></li>
<li><a href="#xform-ListenerList">@groovy.beans.ListenerList</a></li>
<li><a href="#xform-Vetoable">@groovy.beans.Vetoable</a></li>
</ul>
</li>
<li><a href="#_test_assistance">Test assistance</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#xform-NotYetImplemented">@groovy.lang.NotYetImplemented</a></li>
<li><a href="#xform-ASTTest">@groovy.transform.ASTTest</a></li>
</ul>
</li>
<li><a href="#_grape_handling">Grape handling</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#xform-Grab">@groovy.lang.Grab</a></li>
<li><a href="#xform-GrabConfig">@groovy.lang.GrabConfig</a></li>
<li><a href="#xform-GrabExclude">@groovy.lang.GrabExclude</a></li>
<li><a href="#xform-GrabResolver">@groovy.lang.GrabResolver</a></li>
<li><a href="#xform-Grapes">@groovy.lang.Grapes</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#developing-ast-xforms">Developing AST transformations (TBD)</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_compilation_phases_guide_tbd">Compilation phases guide (TBD)</a></li>
<li><a href="#_local_transformations_tbd">Local transformations (TBD)</a></li>
<li><a href="#_global_transformations_tbd">Global transformations (TBD)</a></li>
<li><a href="#_ast_api_guide_tbd">AST API guide (TBD)</a></li>
<li><a href="#_testing_ast_transformations_tbd">Testing AST transformations (TBD)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#section-grape">4.5. Dependency management with Grape</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_quick_start">4.5.1. Quick start</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_add_a_dependency">Add a Dependency</a></li>
<li><a href="#Grape-SpecifyAdditionalRepositories">Specify Additional Repositories</a></li>
<li><a href="#Grape-MavenClassifiers">Maven Classifiers</a></li>
<li><a href="#Grape-ExcludingTransitiveDependencies">Excluding Transitive Dependencies</a></li>
<li><a href="#Grape-JDBCDrivers">JDBC Drivers</a></li>
<li><a href="#Grape-UsingGrapeFromtheGroovyShell">Using Grape From the Groovy Shell</a></li>
<li><a href="#Grape-Proxysettings">Proxy settings</a></li>
<li><a href="#Grape-Logging">Logging</a></li>
</ul>
</li>
<li><a href="#Grape-Detail">4.5.2. Detail</a></li>
<li><a href="#Grape-Usage">4.5.3. Usage</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#Grape-Annotation">Annotation</a></li>
<li><a href="#Grape-MultipleGrapeAnnotations">Multiple Grape Annotations</a></li>
<li><a href="#Grape-Methodcall">Method call</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#Grape-grabHashMapParameters">grab(HashMap) Parameters</a></li>
<li><a href="#Grape-ArgumentsMaparguments">Arguments Map arguments</a></li>
</ul>
</li>
<li><a href="#Grape-CommandLineTool">Command Line Tool</a></li>
<li><a href="#Grape-Advancedconfiguration">Advanced configuration</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#Grape-RepositoryDirectory">Repository Directory</a></li>
<li><a href="#Grape-CustomizeIvysettings">Customize Ivy settings</a></li>
<li><a href="#Grape-AddyourlocalMaven2repository">Add your local Maven2 repository</a></li>
</ul>
</li>
<li><a href="#Grape-MoreExamples">More Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_testing_guide">4.6. Testing Guide</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_introduction_2">4.6.1. Introduction</a></li>
<li><a href="#_language_features">4.6.2. Language Features</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_power_assertions">Power Assertions</a></li>
<li><a href="#_mocking_and_stubbing">Mocking and Stubbing</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_map_coercion">Map Coercion</a></li>
<li><a href="#_closure_coercion">Closure Coercion</a></li>
<li><a href="#_mockfor_and_stubfor">MockFor and StubFor</a></li>
<li><a href="#testing_guide_emc">Expando Meta-Class (EMC)</a></li>
</ul>
</li>
<li><a href="#_gdk_methods">GDK Methods</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_iterable_combinations">Iterable#combinations</a></li>
<li><a href="#_iterable_eachcombination">Iterable#eachCombination</a></li>
</ul>
</li>
<li><a href="#_tool_support">Tool Support</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_test_code_coverage">Test Code Coverage</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_unit_tests_with_junit_3_and_4">4.6.3. Unit Tests with JUnit 3 and 4</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_junit_3">JUnit 3</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_assertion_methods">Assertion Methods</a></li>
<li><a href="#_shouldfail_methods">shouldFail Methods</a></li>
<li><a href="#_notyetimplemented_method">notYetImplemented Method</a></li>
</ul>
</li>
<li><a href="#_junit_4">JUnit 4</a></li>
</ul>
</li>
<li><a href="#_testing_with_spock">4.6.4. Testing with Spock</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_specifications">Specifications</a></li>
<li><a href="#_more_spock">More Spock</a></li>
</ul>
</li>
<li><a href="#_functional_tests_with_geb">4.6.5. Functional Tests with Geb</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_a_geb_script">A Geb Script</a></li>
<li><a href="#_more_geb">More Geb</a></li>
</ul>
</li>
<li><a href="#_other_testing_libraries_and_frameworks">4.6.6. Other Testing Libraries and Frameworks</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_testng">TestNG</a></li>
<li><a href="#_mockito">Mockito</a></li>
<li><a href="#_easymock">EasyMock</a></li>
<li><a href="#_jbehave">JBehave</a></li>
<li><a href="#_jmockit">JMockit</a></li>
<li><a href="#_interacting_with_a_sql_database_tbd">Interacting with a SQL database (TBD)</a></li>
<li><a href="#_processing_xml_tbd">Processing XML (TBD)</a></li>
<li><a href="#_scripting_ant_tasks_tbd">Scripting Ant tasks (TBD)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_template_engines">4.7. Template engines</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_introduction_3">4.7.1. Introduction</a></li>
<li><a href="#_template_framework">4.7.2. Template framework</a></li>
<li><a href="#_simpletemplateengine">4.7.3. SimpleTemplateEngine</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_advanced_usage_note">Advanced Usage Note</a></li>
</ul>
</li>
<li><a href="#_gstringtemplateengine">4.7.4. GStringTemplateEngine</a></li>
<li><a href="#_xmltemplateengine">4.7.5. XmlTemplateEngine</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_other_solutions">Other solutions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_servlet_support_tbd">4.8. Servlet support (TBD)</a></li>
<li><a href="#_integrating_groovy_in_a_java_application">4.9. Integrating Groovy in a Java application</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_groovy_integration_mechanisms">4.9.1. Groovy integration mechanisms</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#integ-eval">Eval</a></li>
<li><a href="#integ-groovyshell">GroovyShell</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_multiple_sources">Multiple sources</a></li>
<li><a href="#_sharing_data_between_a_script_and_the_application">Sharing data between a script and the application</a></li>
<li><a href="#_custom_script_class">Custom script class</a></li>
</ul>
</li>
<li><a href="#groovyclassloader">GroovyClassLoader</a></li>
<li><a href="#_groovyscriptengine">GroovyScriptEngine</a></li>
<li><a href="#_compilationunit">CompilationUnit</a></li>
</ul>
</li>
<li><a href="#_domain_specific_languages">4.9.2. Domain-Specific Languages</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_command_chains">Command chains</a></li>
<li><a href="#_operator_overloading_tbd">Operator overloading (TBD)</a></li>
<li><a href="#_script_base_classes_tbd">Script base classes (TBD)</a></li>
<li><a href="#_adding_properties_to_numbers_tbd">Adding properties to numbers (TBD)</a></li>
<li><a href="#section-delegatesto">@DelegatesTo</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#TheDelegatesToannotation-DSLsmadeeasy">Explaining delegation strategy at compile time</a></li>
<li><a href="#TheDelegatesToannotation-DelegatesTo">@DelegatesTo</a></li>
<li><a href="#TheDelegatesToannotation-DelegatesTomodes">DelegatesTo modes</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#TheDelegatesToannotation-Simpledelegation">Simple delegation</a></li>
<li><a href="#TheDelegatesToannotation-Delegationstrategy">Delegation strategy</a></li>
<li><a href="#TheDelegatesToannotation-Delegatetoparameter">Delegate to parameter</a></li>
<li><a href="#TheDelegatesToannotation-Multipleclosures">Multiple closures</a></li>
<li><a href="#_delegating_to_a_generic_type">Delegating to a generic type</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#compilation-customizers">Compilation customizers</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_introduction_4">Introduction</a></li>
<li><a href="#_import_customizer">Import customizer</a></li>
<li><a href="#_ast_transformation_customizer">AST transformation customizer</a></li>
<li><a href="#_secure_ast_customizer">Secure AST customizer</a></li>
<li><a href="#_source_aware_customizer">Source aware customizer</a></li>
<li><a href="#_customizer_builder">Customizer builder</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#_import_customizer_2">Import customizer</a></li>
<li><a href="#_ast_transformation_customizer_2">AST transformation customizer</a></li>
<li><a href="#_secure_ast_customizer_2">Secure AST customizer</a></li>
<li><a href="#_source_aware_customizer_2">Source aware customizer</a></li>
<li><a href="#_inlining_a_customizer">Inlining a customizer</a></li>
<li><a href="#_multiple_customizers">Multiple customizers</a></li>
</ul>
</li>
<li><a href="#_config_script_flag">Config script flag</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#_static_compilation_by_default">Static compilation by default</a></li>
</ul>
</li>
<li><a href="#_ast_transformations_tbd">AST transformations (TBD)</a></li>
</ul>
</li>
<li><a href="#_custom_type_checking_extensions_tbd">Custom type checking extensions (TBD)</a></li>
<li><a href="#_builders_tbd">Builders (TBD)</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_creating_a_builder_tbd">Creating a builder (TBD)</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#_buildersupport_tbd">BuilderSupport (TBD)</a></li>
<li><a href="#_factorybuildersupport_tbd">FactoryBuilderSupport (TBD)</a></li>
</ul>
</li>
<li><a href="#_existing_builders_tbd">Existing builders (TBD)</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#_markupbuilder_tbd_assigned_to_jnorthr_1july14">MarkupBuilder (TBD) - assigned to JNorthr 1July14</a></li>
<li><a href="#_streamingmarkupbuilder_tbd">StreamingMarkupBuilder (TBD)</a></li>
<li><a href="#_saxbuilder_tbd">SaxBuilder (TBD)</a></li>
<li><a href="#_staxbuilder_tbd">StaxBuilder (TBD)</a></li>
<li><a href="#_dombuilder_tbd">DomBuilder (TBD)</a></li>
<li><a href="#_nodebuilder_tbd">NodeBuilder (TBD)</a></li>
<li><a href="#_jsonbuilder_tbd">JsonBuilder (TBD)</a></li>
<li><a href="#_streamingjsonbuilder_tbd">StreamingJsonBuilder (TBD)</a></li>
<li><a href="#_swingbuilder_tbd">SwingBuilder (TBD)</a></li>
<li><a href="#_antbuilder_tbd">AntBuilder (TBD)</a></li>
<li><a href="#_clibuilder_tbd">CliBuilder (TBD)</a></li>
<li><a href="#_objectgraphbuilder_tbd">ObjectGraphBuilder (TBD)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_creating_swing_uis_tbd">4.10. Creating Swing UIs (TBD)</a></li>
<li><a href="#_security_tbd">4.11. Security (TBD)</a></li>
<li><a href="#_design_patterns_in_groovy">4.12. Design patterns in Groovy</a></li>
<li>
<ul class="sectlevel3">
<li><a href="#_patterns">4.12.1. Patterns</a></li>
<li>
<ul class="sectlevel4">
<li><a href="#_abstract_factory_pattern">Abstract Factory Pattern</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_example">Example</a></li>
</ul>
</li>
<li><a href="#_adapter_pattern">Adapter Pattern</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_delegation_example">Delegation Example</a></li>
<li><a href="#_inheritance_example">Inheritance Example</a></li>
<li><a href="#_adapting_using_closures">Adapting using Closures</a></li>
<li><a href="#_adapting_using_the_expandometaclass">Adapting using the ExpandoMetaClass</a></li>
</ul>
</li>
<li><a href="#_bouncer_pattern">Bouncer Pattern</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_null_checking_example">Null Checking Example</a></li>
<li><a href="#_validation_example">Validation Example</a></li>
</ul>
</li>
<li><a href="#_chain_of_responsibility_pattern">Chain of Responsibility Pattern</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_example_2">Example</a></li>
</ul>
</li>
<li><a href="#_composite_pattern">Composite Pattern</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_example_3">Example</a></li>
</ul>
</li>
<li><a href="#_decorator_pattern">Decorator Pattern</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_traditional_example">Traditional Example</a></li>
<li><a href="#_a_touch_of_dynamic_behaviour">A touch of dynamic behaviour</a></li>
<li><a href="#_runtime_behaviour_embellishment">Runtime behaviour embellishment</a></li>
<li><a href="#_more_dynamic_decorating">More dynamic decorating</a></li>
<li><a href="#_decorating_with_an_interceptor">Decorating with an Interceptor</a></li>
<li><a href="#_decorating_with_java_lang_reflect_proxy">Decorating with java.lang.reflect.Proxy</a></li>
<li><a href="#_decorating_with_spring">Decorating with Spring</a></li>
<li><a href="#_asynchronous_decorators_using_gpars">Asynchronous Decorators using GPars</a></li>
</ul>
</li>
<li><a href="#_delegation_pattern">Delegation Pattern</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_implement_delegation_pattern_using_expandometaclass">Implement Delegation Pattern using ExpandoMetaClass</a></li>
<li><a href="#_implement_delegation_pattern_using_delegate_annotation">Implement Delegation Pattern using @Delegate annotation</a></li>
</ul>
</li>
<li><a href="#_flyweight_pattern">Flyweight Pattern</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_example_4">Example</a></li>
</ul>
</li>
<li><a href="#_iterator_pattern">Iterator Pattern</a></li>
<li><a href="#_loan_my_resource_pattern">Loan my Resource Pattern</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_example_5">Example</a></li>
</ul>
</li>
<li><a href="#_null_object_pattern">Null Object Pattern</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_simple_example">Simple Example</a></li>
<li><a href="#_tree_example">Tree Example</a></li>
</ul>
</li>
<li><a href="#_pimp_my_library_pattern">Pimp my Library Pattern</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_example_6">Example</a></li>
</ul>
</li>
<li><a href="#_proxy_pattern">Proxy Pattern</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_example_7">Example</a></li>
</ul>
</li>
<li><a href="#_singleton_pattern">Singleton Pattern</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_example_the_classic_java_singleton">Example: The Classic Java Singleton</a></li>
<li><a href="#_example_singleton_via_metaprogramming">Example: Singleton via MetaProgramming</a></li>
<li><a href="#_guice_example">Guice Example</a></li>
<li><a href="#_spring_example">Spring Example</a></li>
<li><a href="#_further_information">Further information</a></li>
</ul>
</li>
<li><a href="#_state_pattern">State Pattern</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_example_8">Example</a></li>
<li><a href="#_variation_1_leveraging_interface_oriented_design">Variation 1: Leveraging Interface-Oriented Design</a></li>
<li><a href="#_variation_2_extract_state_pattern_logic">Variation 2: Extract State Pattern Logic</a></li>
<li><a href="#_variation_3_bring_on_the_dsl">Variation 3: Bring on the DSL</a></li>
</ul>
</li>
<li><a href="#_strategy_pattern">Strategy Pattern</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_example_9">Example</a></li>
</ul>
</li>
<li><a href="#_template_method_pattern">Template Method Pattern</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_example_10">Example</a></li>
</ul>
</li>
<li><a href="#_visitor_pattern">Visitor Pattern</a></li>
<li>
<ul class="sectlevel5">
<li><a href="#_simple_example_2">Simple Example</a></li>
<li><a href="#_advanced_example">Advanced Example</a></li>
<li>
<ul class="sectlevel6">
<li><a href="#_why_to_use_this">Why to use this</a></li>
<li><a href="#_what_happens_if_we_add_a_new_type">What happens if we add a new type?</a></li>
<li><a href="#_what_if_we_want_to_have_different_iteration_patterns">What if we want to have different iteration patterns?</a></li>
<li><a href="#_make_it_groovy">Make it Groovy</a></li>
<li><a href="#_summary">Summary</a></li>
</ul>
</li>
<li><a href="#_further_information_2">Further Information</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_references">4.12.2. References</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_acknowledgements">5. Acknowledgements</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_contributors">5.1. Contributors</a></li>
<li><a href="#_license">5.2. License</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<h1 id="_introduction" class="sect0">简介</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Groovy&#8230;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>是一门基于Java虚拟机的灵活的(agile), 动态的(dynamic)语言.</p>
</li>
<li>
<p>构建在强大的Java语言之上, 并添加了来自Python, Ruby, Smalltalk等语言的强大特性(power features).</p>
</li>
<li>
<p>为Java开发者提供了现代最流行的编程语言特性， 而且学习成本几乎为零.</p>
</li>
<li>
<p>提供静态类型检查和静态编译的能力来增强代码的健壮性(robustness)和性能.</p>
</li>
<li>
<p>支持DSL(Domain-Specific Languages, 领域特定语言)和其他简洁的语法使代码变得更容易阅读与维护.</p>
</li>
<li>
<p>拥有强大的原生类型处理, 面向对象能力(OO abilities)和Ant DSL, 使得创建 shell script变得非常简单.</p>
</li>
<li>
<p>在开发 web, GUI, 数据库或者控制台应用时, 通过减少脚手架代码(scaffolding code)来提高开发人员的生产力.</p>
</li>
<li>
<p>支持单元测试(unit testing)和 对象模拟(mocking), 简化了测试.</p>
</li>
<li>
<p>无缝集成所有已存在的Java类和类库.</p>
</li>
<li>
<p>直接编译为Java字节码(Java bytecode), 因此能在任何使用Java的地方使用.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_groovy_language_specification">1. Groovy 语言规范</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_syntax">1.1. 语法</h3>
<div class="paragraph">
<p>这个章节主要涵盖 Groovy 编程语言的语法(syntax). Groovy 的语法(grammar)派生自(derives from)
Java 的语法, 但是针对 Groovy 的具体结构做了增强, 并允许一定的简化.</p>
</div>
<div class="sect3">
<h4 id="_comments">1.1.1. 注释</h4>
<div class="sect4">
<h5 id="_single_line_comment">单行注释</h5>
<div class="paragraph">
<p>单行注释由 <code>//</code> 开始, 允许出现在一行的任意位置. <code>//</code> 之后换行符之前的字符都被认为是注释的一部分.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">// 一个标准的单行注释
println "hello" // 直到行尾的注释</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_multiline_comment">多行注释</h5>
<div class="paragraph">
<p>多行注释以 <code>/*</code> 开始, 可以出现在一行的任意位置. <code>/*</code> 之后的字符会被认为是注释的一部分,
包括换行符, 直到第一个 <code>*/</code> 元素. 因此多行注释可以放在语句之后, 甚至语句之间.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">/* 一个典型的多行注释
   占 2 行 */
println "hello" /* 一个在语句之后的
                   多行注释 */
println 1 /* one */ + 2 /* two */</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_groovydoc_comment">GroovyDoc 注释</h5>
<div class="paragraph">
<p>与多行注释类似, GroovyDoc 也是多行的, 但以 <code>/**</code> 开始, 以 <code>*/</code> 结束.
首行注释之后的行可以以可选的 <code>*</code> 号开始. 这些注释关联于:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>类型定义(类, 接口, 枚举, 注解)</p>
</li>
<li>
<p>字段和属性定义</p>
</li>
<li>
<p>方法定义</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>对以上元素, 即使没有 GroovyDoc 编译器也不会抱怨, 但应优先考虑使用该注释.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">/**
 * 一个类定义
 */
class Person {
    /** 姓名 */
    String name

    /**
     * 为特定的人创建一个问候方法.
     *
     * @param otherPerson 待问候的人
     * @return 问候信息
     */
    String greet(String otherPerson) {
       "Hello ${otherPerson}"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>GroovyDoc 遵循 JavaDoc 的约定(conventions), 因此你可以使用 JavaDoc 中的标签(tags).</p>
</div>
</div>
<div class="sect4">
<h5 id="_shebang_line">Shebang line</h5>
<div class="paragraph">
<p>单行注释之外还有一个特殊的行注释, 在 Unix 系统下通常称为 <em>shebang line</em>, 它允许脚本直接
从命令行启动, 前提是已安装了 Groovy 并且 <code>groovy</code> 命令包含在 <code>PATH</code> 环境变量中.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">#!/usr/bin/env groovy
println "Hello from the shebang line"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<code>#</code> 字符必须是文件的第一个字符, 任何缩进都会导致一个编译错误.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_keywords">1.1.2. 关键字</h4>
<div class="paragraph">
<p>下表列出了 Groovy 中的所有关键字:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 1. 关键字</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">as</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">assert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">break</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">catch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">const</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">continue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">def</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">do</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">else</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">extends</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">finally</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">for</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">goto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implements</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">import</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instanceof</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">interface</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">new</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">return</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">super</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">switch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">this</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">throw</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">throws</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">try</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">while</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_identifiers">1.1.3. 标识符</h4>
<div class="sect4">
<h5 id="_normal_identifiers">普通标识符</h5>
<div class="paragraph">
<p>标识符(identifiers)以字母, 美元符号($)或者下划线开始. 不能以数字开始.</p>
</div>
<div class="paragraph">
<p>字母的取值范围如下:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>a</em> 到 <em>z</em> (小写的 ascii 字母)</p>
</li>
<li>
<p><em>A</em> 到 <em>Z</em> (大写的 ascii 字母)</p>
</li>
<li>
<p><em>\u00C0</em> 到 <em>\u00D6</em></p>
</li>
<li>
<p><em>\u00D8</em> 到 <em>\u00F6</em></p>
</li>
<li>
<p><em>\u00F8</em> 到 <em>\u00FF</em></p>
</li>
<li>
<p><em>\u0100</em> 到 <em>\uFFFE</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>之后的字符可以包含字母或者数字.</p>
</div>
<div class="paragraph">
<p>以下是一些有效标识符示例(变量名):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def name
def item3
def with_underscore
def $dollarStart</code></pre>
</div>
</div>
<div class="paragraph">
<p>但是以下的标识符是无效的:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def 3tier
def a+b
def a#b</code></pre>
</div>
</div>
<div class="paragraph">
<p>点号之后的所有关键字也是无效的标识符:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">foo.as
foo.assert
foo.break
foo.case
foo.catch</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_quoted_identifiers">引用标识符</h5>
<div class="paragraph">
<p>引用标识符(quoted identifiers)位于点表达式(dotted expression)的点号之后.
例如, 表达式 <code>person.name</code> 的 <code>name</code> 部分可以像 <code>person."name"</code> 或者 <code>person.'name'</code> 那样添加引号.
这相当有趣, 当某些标识符包含 Java 语言规范(Java Language Specification)所禁止的非法字符时,
在 Groovy 中通过添加引号是被允许的. 如 破择号(dash), 空格, 感叹号等.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def map = [:]

map."an identifier with a space and double quotes" = "ALLOWED"
map.'with-dash-signs-and-single-quotes' = "ALLOWED"

assert map."an identifier with a space and double quotes" == "ALLOWED"
assert map.'with-dash-signs-and-single-quotes' == "ALLOWED"</code></pre>
</div>
</div>
<div class="paragraph">
<p>我们将会在<a href="#all-strings">之后的字符串章节</a>中看到, Groovy 提供了不同的 字符串字面量(literals).
点号之后所有类型的字符串都是允许的.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">map.'single quote'
map."double quote"
map.'''triple single quote'''
map."""triple double quote"""
map./slashy string/
map.$/dollar slashy string/$</code></pre>
</div>
</div>
<div class="paragraph">
<p>普通字符串和 Groovy 的 GStrings(interpolated strings, 插值字符串)是有区别的,
对于后者, 在判断(evaluating)整个标识符时插值会被插入到最终的字符串中:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def firstname = "Homer"
map."Simson-${firstname}" = "Homer Simson"

assert map.'Simson-Homer' == "Homer Simson"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="all-strings">1.1.4. 字符串</h4>
<div class="paragraph">
<p>文本也即字符串, 以字符链的形式表示.
Groovy 允许你实例化 <code>java.lang.String</code> 和 GStrings (<code>groovy.lang.GString</code>)对象, GStrings
在其他语言中称为 <em>插值字符串</em>.</p>
</div>
<div class="sect4">
<h5 id="_single_quoted_string">单引号字符串</h5>
<div class="paragraph">
<p>单引号字符串即由单引号包围的一系列字符:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def firstname = "Homer"
map."Simson-${firstname}" = "Homer Simson"

assert map.'Simson-Homer' == "Homer Simson"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
单引号字符串是 <code>java.lang.String</code>, 不支持插值.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_string_concatenation">字符串拼接</h5>
<div class="paragraph">
<p>Groovy 中的所有字符串都可以用 <code>+</code> 操作符来拼接(concatenation):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert 'ab' == 'a' + 'b'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_triple_single_quoted_string">三单引号字符串</h5>
<div class="paragraph">
<p>三单引号字符串即由单引号包围的一系列字符:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">'a single quoted string'</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
三单引号字符串是 <code>java.lang.String</code>, 不支持插值.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>三单引号字符串是多行的.
你可以用换行符分隔字符串内容, 而不用把字符串分割为多部分, 不用拼接字符串或者转义换行符.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def aMultilineString = '''line one
line two
line three'''</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果代码包含缩进, 如在类或者方法的主体(body)部分, 则字符串也会包含这些缩进的空白字符(whitespace).
可以通过 Groovy 开发工具(Development Kit) 中的 <code>String#stripIndent()</code> 方法来移除这些缩进,
通过 <code>String#stripMargin()</code> 方法, 传入一个分界字符(delimiter character)参数, 来指定要从字符串中移除的字符.</p>
</div>
<div class="paragraph">
<p>当创建如下的字符串:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def startingAndEndingWithANewline = '''
line one
line two
line three
'''</code></pre>
</div>
</div>
<div class="paragraph">
<p>你会发现结果字符串的第一个字符是一个换行符. 可以用反斜杠(backslash)转义换行符来移除该字符:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def strippedFirstNewline = '''\
line one
line two
line three
'''

assert !strippedFirstNewline.startsWith('\n')</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_escaping_special_characters">转义特殊字符</h6>
<div class="paragraph">
<p>可以用反斜杠来转义单引号以避免终止(terminating)字符串字面量:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">'an escaped single quote: \' needs a backslash'</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以用两个反斜杠来转义转义符本身:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">'an escaped escape character: \\ needs a double backslash'</code></pre>
</div>
</div>
<div class="paragraph">
<p>一些特殊字符也使用反斜杠当做转义符:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 33%;">
<col style="width: 66%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">转义序列</th>
<th class="tableblock halign-left valign-top">字符</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>\t</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">水平制表</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>\b</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">退格</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>\n</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">换行</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>\r</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">回车</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>\f</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">换页</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>\\</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">反斜杠字符 <em>\</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>\</em>'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">单引号字符 (单引号或三单引号字符串中使用)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>\"</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">双引号字符 (双引号或三双引号字符串中使用)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_unicode_escape_sequence">Unicode 转义序列</h6>
<div class="paragraph">
<p>那些没有出现在你键盘上的字符, 可以使用 unicode 转义序列来表示: 一个反斜杠, 之后是一个 <em>u</em>,
然后是4个十六进制数字.</p>
</div>
<div class="paragraph">
<p>例如, 欧元货币符号可以这样表示:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">'The Euro currency symbol: \u20AC'</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_double_quoted_string">双引号字符串</h5>
<div class="paragraph">
<p>双引号字符串即由双引号包围的一系列字符:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">"a double quoted string"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
在没有插入表达式(interpolated expression)的情况下双引号字符串为 <code>java.lang.String</code>;
如果有, 则为 <code>groovy.lang.GString</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
可以使用反斜杠字符来转义双引号, 如: <code>"A double quote: \""</code>.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_string_interpolation">字符串插值</h6>
<div class="paragraph">
<p>任何 Groovy 表达式都可以插入到所有的字符串字面量中, 除了单引号和三单引号字符串.
插值即把字符串中的占位符用其在对字符串求值(evaluation)中的值来替代的操作.
占位符表达式由 <code>${}</code> 包围, 对点表达式可以以 <code>$</code> 开头.
当 GString 传入到一个以 String 为参数的方法时, 占位符中的表达式会通过调用 <code>toString()</code> 方法
将其值转换为对应的字符串表示.</p>
</div>
<div class="paragraph">
<p>这里, 我们有一个带有占位符的字符串, 该占位符引用了一个本地变量:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def name = 'Guillaume' // a plain string
def greeting = "Hello ${name}"

assert greeting.toString() == 'Hello Guillaume'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy 中的任何表达式都是有效的, 在这个例子中我们可以看到其带有一个算术表达式:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def sum = "The sum of 2 and 3 equals ${2 + 3}"
assert sum.toString() == 'The sum of 2 and 3 equals 5'</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<code>${}</code> 占位符中不仅仅允许表达式, 语句(statements)也是允许的, 但一个语句的值单纯(is just)为 <code>null</code>.
所以, 如果多个语句被插入到占位符中, 最后一个应该返回一个有意义的值.
例如, <code>"The sum of 1 and 2 is equal to ${def a = 1; def b = 2; a + b}"</code> 是支持的同时也能
如预期的工作, 但坚持在 GString 占位符中使用简单的表达式是一个好习惯.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>除了 <code>${}</code> 占位符, 对于点表达式我们也可以使用一个单独的 <code>$</code> 符号作为其前缀:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def person = [name: 'Guillaume', age: 36]
assert "$person.name is $person.age years old" == 'Guillaume is 36 years old'</code></pre>
</div>
</div>
<div class="paragraph">
<p>但是只有形式如 <code>a.b</code>, <code>a.b.c</code> 之类的是有效的, 表达式中含有括号如方法调用, 花括号如闭包,
算术操作符等都是无效的. 以下变量定义为一个数字:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def number = 3.14</code></pre>
</div>
</div>
<div class="paragraph">
<p>下面的语句会抛出 <code>groovy.lang.MissingPropertyException</code> 异常, 因为 Groovy 认为你
试图访问 number 的 <code>toString</code> 属性, 但是它是不存在的.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">shouldFail(MissingPropertyException) {
    println "$number.toString()"
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
可以认为 <code>"$number.toString()"</code> 被语法分析器(parser) 解释为 <code>"${number.toString}()"</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>如果你想在 GString 中转义 <code>$</code> 或者 <code>${}</code> 占位符, 让它们能显示而不会进行插值, 你只需要用
<code>\</code> 反斜杠字符来转义美元符号:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert '${name}' == "\${name}"</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_special_case_of_interpolating_closure_expressions">特例 插入闭包表达式</h6>
<div class="paragraph">
<p>到目前为止, 我们看到可以在 <code>${}</code> 占位符中放入任意的表达式, 但闭包是个特例并且有着特别的表示法.
当占位符包含一个箭头, <code>${-&gt;}</code>, 该表达式即是一个闭包表达式&#8201;&#8212;&#8201;你可以认为它是一个前面带有美元符号的闭包.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def sParameterLessClosure = "1 + 2 == ${-&gt; 3}" <i class="conum" data-value="1"></i><b>(1)</b>
assert sParameterLessClosure == '1 + 2 == 3'

def sOneParamClosure = "1 + 2 == ${ w -&gt; w &lt;&lt; 3}" <i class="conum" data-value="2"></i><b>(2)</b>
assert sOneParamClosure == '1 + 2 == 3'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>该闭包是一个无参闭包, 不接受参数.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>这里, 闭包接受一个 <code>java.io.StringWriter</code> 参数, 可以用 <code>&lt;&lt;</code> 左移操纵符来给它添加内容.
两种情况中, 占位符都是嵌入式闭包(embedded closures).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>以这种方式定义插入的表达式显得更加冗长(verbose), 但与单纯的(mere)表达式相比, 闭包有一个
有趣的特性: 惰性求值(lazy evaluation).</p>
</div>
<div class="paragraph">
<p>让我们考虑下面的例子:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def number = 1 <i class="conum" data-value="1"></i><b>(1)</b>
def eagerGString = "value == ${number}"
def lazyGString = "value == ${ -&gt; number }"

assert eagerGString == "value == 1" <i class="conum" data-value="2"></i><b>(2)</b>
assert lazyGString ==  "value == 1" <i class="conum" data-value="3"></i><b>(3)</b>

number = 2 <i class="conum" data-value="4"></i><b>(4)</b>
assert eagerGString == "value == 1" <i class="conum" data-value="5"></i><b>(5)</b>
assert lazyGString ==  "value == 2" <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>我们定义了一个 <code>number</code> 变量, 值为 <code>1</code>, 然后我们它插入到2个 GStrings 中,
<code>eagerGString</code> 中作为表达式, <code>lazyGString</code> 中作为闭包.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>对 <code>eagerGString</code> 我们预期结果字符串包含有 1.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>lazyGString</code> 类似.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>然后我们改变该变量, 为其赋一个新值.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>对于单纯的(plain)插入表达式, 其值实际上是绑定到了 GString 创建时的值.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>但是对闭包表达式, 每次强制(coercion)把 GString 转换为 String 的时候都会调用闭包,
其结果是生成一个包含有新值的新字符串.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
一个嵌入式闭包表达式接受超过1个参数将会在运行时抛出(generate)异常, 只有0或者1个参数的闭包是允许的.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_interoperability_with_java">与 Java 交互</h6>
<div class="paragraph">
<p>当一个方法(不管是在 Java 还是在 Groovy 中实现)期望(expects)一个 <code>java.lang.String</code>,
但我们传入一个 <code>groovy.lang.GString</code> 实例时, GString 的 <code>toString()</code> 方法会自动, 透明地被调用.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">String takeString(String message) {         <i class="conum" data-value="4"></i><b>(4)</b>
    assert message instanceof String        <i class="conum" data-value="5"></i><b>(5)</b>
    return message
}

def message = "The message is ${'hello'}"   <i class="conum" data-value="1"></i><b>(1)</b>
assert message instanceof GString           <i class="conum" data-value="2"></i><b>(2)</b>

def result = takeString(message)            <i class="conum" data-value="3"></i><b>(3)</b>
assert result instanceof String
assert result == 'The message is hello'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>我们创建了一个 GString 变量.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>我们仔细检查它是一个 GString 实例.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>然后我们把这个 GString 传入到接受 String 作为参数的方法.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>takeString()</code> 方法的签名明确声明(says)它唯一的参数是一个 String.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>我们进一步核实该参数确实是个 String 而不是 GString.</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_gstring_and_string_hashcodes">GString 和 String 的哈希码</h6>
<div class="paragraph">
<p>尽管插值字符串可以用来代替普通 Java 字符串, 但它们与普通字符串在某一方面还是有区别的:
即它们的哈希码(hashCodes)是不一样的. 普通 Java 字符串是不可变的, 然而 GString 的结果字符串
表示是可变的, 取决于它的插入值. 即使结果字符串相同, GString 和 String 还是有不同的哈希码.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert "one: ${1}".hashCode() != "one: 1".hashCode()</code></pre>
</div>
</div>
<div class="paragraph">
<p>GString 和 Strings 有着不一样的哈希码值, 所以应该避免把 GString 当做 Map 的键来用,
尤其是在检索关联值(associated value)时应该使用 String 而不是 GString.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def key = "a"
def m = ["${key}": "letter ${key}"]     <i class="conum" data-value="1"></i><b>(1)</b>

assert m["a"] == null                   <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>创建一个 map, 带有初始键值对(initial pair), 键为一个 GString.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>当我们视图获取该 String 键所对应的值时, 会发现无法找到, 由于 String 和 GString 有着
不同的哈希码值.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_triple_double_quoted_string">三双引号字符串</h5>
<div class="paragraph">
<p>三双引号字符串类似(behave like)双引号字符串, 只是它们是多行的, 这点可类比三单引号字符串.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def name = 'Groovy'
def template = """
    Dear Mr ${name},

    You're the winner of the lottery!

    Yours sincerly,

    Dave
"""

assert template.toString().contains('Groovy')</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
在三双引号字符串中, 双引号跟单引号都不需要转义.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_slashy_string">斜线字符串</h5>
<div class="paragraph">
<p>除了通常的引号字符串, Groovy 还提供了 斜线字符串(slashy strings), 其使用 <code>/</code> 作为定界符.
斜线字符串在定义正则表达式或者模式(patterns)时特别有用的, 因为不需要对反斜杠进行转义.</p>
</div>
<div class="paragraph">
<p>斜线字符串的示例:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def fooPattern = /.*foo.*/
assert fooPattern == '.*foo.*'</code></pre>
</div>
</div>
<div class="paragraph">
<p>只有斜线需要用反斜杠来转义:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def escapeSlash = /The character \/ is a forward slash/
assert escapeSlash == 'The character / is a forward slash'</code></pre>
</div>
</div>
<div class="paragraph">
<p>斜线字符串是多行的:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def multilineSlashy = /one
    two
    three/

assert multilineSlashy.contains('\n')</code></pre>
</div>
</div>
<div class="paragraph">
<p>斜线字符串也可以插值(如, GString):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def color = 'blue'
def interpolatedSlashy = /a ${color} car/

assert interpolatedSlashy == 'a blue car'</code></pre>
</div>
</div>
<div class="paragraph">
<p>有几个陷阱需要注意.</p>
</div>
<div class="paragraph">
<p>不能用两个斜线来表示空(斜线)字符串, 因为它被 Groovy 语法分析器当做一个行注释来理解.
这是为什么下面的断言实际上会导致一个编译错误, 因为它看起来像一个没结束(non-terminated)的语句.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert '' == //</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_dollar_slashy_string">美元斜线字符串</h5>
<div class="paragraph">
<p>美元斜线字符串(dollar slashy string)是以 <code>$/</code> 开始, 以 <code>/$</code> 结束的多行 GStrings.
转义字符为美元符号, 可以用来转义另一美元符号或者正斜杠.
但是美元符号跟正斜杠都可以不用转义, 除了像 GString 占位符那样的字符串序列需要对美元符号进行转义,
以及像美元斜线字符串关闭标签那样的字符序列进行转义.</p>
</div>
<div class="paragraph">
<p>请看下面的例子:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def name = "Guillaume"
def date = "April, 1st"

def dollarSlashy = $/
    Hello $name,
    today we're ${date}.

    $ dollar sign
    $$ escaped dollar sign
    \ backslash
    / forward slash
    $/ escaped forward slash
    $/$ escaped dollar slashy string delimiter
/$

assert [
    'Guillaume',
    'April, 1st',
    '$ dollar sign',
    '$ escaped dollar sign',
    '\\ backslash',
    '/ forward slash',
        '$/ escaped forward slash',
        '/$ escaped dollar slashy string delimiter'

        ].each { dollarSlashy.contains(it) }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_string_summary_table">字符串总结表</h5>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">语法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">插值</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">多行</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">转义符</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">单引号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'&#8230;'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="icon-check-empty"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="icon-check-empty"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">三单引号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'''&#8230;'''</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="icon-check-empty"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="icon-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">双引号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"&#8230;"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="icon-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="icon-check-empty"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">三双引号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"""&#8230;"""</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="icon-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="icon-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">斜线</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/&#8230;/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="icon-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="icon-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">美元斜线</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$/&#8230;/$</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="icon-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="icon-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_characters">字符</h5>
<div class="paragraph">
<p>与 Java 不同, Groovy 没有明确的字符字面量.
但是, 你可以通过 3 种不同的方式明确的将 Groovy 字符串转换为字符:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">char c1 = 'A' <i class="conum" data-value="1"></i><b>(1)</b>
assert c1 instanceof Character

def c2 = 'B' as char <i class="conum" data-value="2"></i><b>(2)</b>
assert c2 instanceof Character

def c3 = (char)'C' <i class="conum" data-value="3"></i><b>(3)</b>
assert c3 instanceof Character</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>声明变量时明确指定其类型为 <code>char</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>使用 <code>as</code> 操作符强制类型转换(type coercion).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>使用 <code>(char)</code> 强制类型转换.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
当字符存储在变量中时, 做法(option) <em class="conum">1</em> 比较好(interesting),
而其他两种做法(<em class="conum">2</em> 和 <em class="conum">3</em>), 在必须传入一个
字符参数以调用方法时比较好.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_numbers">1.1.5. 数值</h4>
<div class="paragraph">
<p>Groovy 支持不同类型的整型字面量(integral literals)和浮点型字面量(decimal literals),
依靠 Java 中通用的(usual) <code>Number</code> 类型.</p>
</div>
<div class="sect4">
<h5 id="_integral_literals">整数</h5>
<div class="paragraph">
<p>整数类型与 Java 中的一样:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>byte</code></p>
</li>
<li>
<p><code>char</code></p>
</li>
<li>
<p><code>short</code></p>
</li>
<li>
<p><code>int</code></p>
</li>
<li>
<p><code>long</code></p>
</li>
<li>
<p><code>java.lang.BigInteger</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>可以用下面的声明来创建这些整型数字:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">// 原生类型(primitive types)
byte  b = 1
char  c = 2
short s = 3
int   i = 4
long  l = 5

// 无限精度(infinite precision)
BigInteger bi =  6</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果使用 <code>def</code> 关键字来声明可选类型(optional type), 那么整数的类型将会发生变化:
它会采用取值范围包含该整数的类型.</p>
</div>
<div class="paragraph">
<p>对正数而言:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def a = 1
assert a instanceof Integer

// Integer.MAX_VALUE
def b = 2147483647
assert b instanceof Integer

// Integer.MAX_VALUE + 1
def c = 2147483648
assert c instanceof Long

// Long.MAX_VALUE
def d = 9223372036854775807
assert d instanceof Long

// Long.MAX_VALUE + 1
def e = 9223372036854775808
assert e instanceof BigInteger</code></pre>
</div>
</div>
<div class="paragraph">
<p>对负数也是一样的:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def na = -1
assert na instanceof Integer

// Integer.MIN_VALUE
def nb = -2147483648
assert nb instanceof Integer

// Integer.MIN_VALUE - 1
def nc = -2147483649
assert nc instanceof Long

// Long.MIN_VALUE
def nd = -9223372036854775808
assert nd instanceof Long

// Long.MIN_VALUE - 1
def ne = -9223372036854775809
assert ne instanceof BigInteger</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_alternative_non_base_10_representations">可选的非十进制表示</h6>
<div class="sect6">
<h7 id="_binary_literal">二进制</h7>
<div class="paragraph">
<p>在 Java 6 及之前版本, 以及在 Groovy 中, 数字可以以 十进制, 八进制, 十六进制 表示,
在 Java 7 及 Groovy 2 中, 可以附加 <code>0b</code> 前缀来使用二进制:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">int xInt = 0b10101111
assert xInt == 175

short xShort = 0b11001001
assert xShort == 201 as short

byte xByte = 0b11
assert xByte == 3 as byte

long xLong = 0b101101101101
assert xLong == 2925l

BigInteger xBigInteger = 0b111100100001
assert xBigInteger == 3873g

int xNegativeInt = -0b10101111
assert xNegativeInt == -175</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_octal_literal">八进制</h7>
<div class="paragraph">
<p>八进制数字是以 <code>0</code> 为前缀, 之后跟上八进制数字(digits), 这样典型的格式来定义的(specified).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">int xInt = 077
assert xInt == 63

short xShort = 011
assert xShort == 9 as short

byte xByte = 032
assert xByte == 26 as byte

long xLong = 0246
assert xLong == 166l

BigInteger xBigInteger = 01111
assert xBigInteger == 585g

int xNegativeInt = -077
assert xNegativeInt == -63</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_hexadecimal_literal">十六进制</h7>
<div class="paragraph">
<p>十六进制数值是以 <code>0x</code> 为前缀, 之后跟上十六进制数字, 这样典型的格式来定义的.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">int xInt = 0x77
assert xInt == 119

short xShort = 0xaa
assert xShort == 170 as short

byte xByte = 0x3a
assert xByte == 58 as byte

long xLong = 0xffff
assert xLong == 65535l

BigInteger xBigInteger = 0xaaaa
assert xBigInteger == 43690g

Double xDouble = new Double('0x1.0p0')
assert xDouble == 1.0d

int xNegativeInt = -0x77
assert xNegativeInt == -119</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_decimal_literals">浮点数</h5>
<div class="paragraph">
<p>浮点数类型与 Java 中的一样:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>float</code></p>
</li>
<li>
<p><code>double</code></p>
</li>
<li>
<p><code>java.lang.BigDecimal</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>可以用下面的声明来创建这些浮点型数字:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">// primitive types
float  f = 1.234
double d = 2.345

// infinite precision
BigDecimal bd =  3.456</code></pre>
</div>
</div>
<div class="paragraph">
<p>浮点数可以用指数表示, (格式为)表示指数的 <code>e</code> 或 <code>E</code> 字母, 之后是一个可选的正负号,
和一个代表指数的整数:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert 1e3  ==  1_000.0
assert 2E4  == 20_000.0
assert 3e+1 ==     30.0
assert 4E-2 ==      0.04
assert 5e-1 ==      0.5</code></pre>
</div>
</div>
<div class="paragraph">
<p>为了方便(conveniently)浮点数精确计算, Groovy 选择 <code>java.lang.BigDecimal</code> 作为它的
浮点数类型. 此外, <code>float</code> 和 <code>double</code> 都是支持的, 但是需要明确的类型声明, 强制类型转换
或者添加后缀. 尽管 <code>BigDecimal</code> 是浮点数的默认类型, 在接受 <code>float</code> 或者 <code>double</code>
为参数的方法或闭包中, 浮点数字面量也是能被接受的.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
浮点数不能用二进制, 八进制, 十六进制表示法来表示.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_underscore_in_literals">Underscore in literals</h5>
<div class="paragraph">
<p>When writing long literal numbers, it’s harder on the eye to figure out how some numbers are grouped together, for example with groups of thousands, of words, etc. By allowing you to place underscore in number literals, it’s easier to spot those groups:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">long creditCardNumber = 1234_5678_9012_3456L
long socialSecurityNumbers = 999_99_9999L
double monetaryAmount = 12_345_132.12
long hexBytes = 0xFF_EC_DE_5E
long hexWords = 0xFFEC_DE5E
long maxLong = 0x7fff_ffff_ffff_ffffL
long alsoMaxLong = 9_223_372_036_854_775_807L
long bytes = 0b11010010_01101001_10010100_10010010</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_number_type_suffixes">Number type suffixes</h5>
<div class="paragraph">
<p>We can force a number (including binary, octals and hexadecimals) to have a specific type by giving a suffix (see table bellow), either uppercase or lowercase.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 33%;">
<col style="width: 66%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Suffix</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>G</code> or <code>g</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>L</code> or <code>l</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>I</code> or <code>i</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>G</code> or <code>g</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D</code> or <code>d</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>F</code> or <code>f</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert 42I == new Integer('42')
assert 42i == new Integer('42') // lowercase i more readable
assert 123L == new Long("123") // uppercase L more readable
assert 2147483648 == new Long('2147483648') // Long type used, value too large for an Integer
assert 456G == new BigInteger('456')
assert 456g == new BigInteger('456')
assert 123.45 == new BigDecimal('123.45') // default BigDecimal type used
assert 1.200065D == new Double('1.200065')
assert 1.234F == new Float('1.234')
assert 1.23E23D == new Double('1.23E23')
assert 0b1111L.class == Long // binary
assert 0xFFi.class == Integer // hexadecimal
assert 034G.class == BigInteger // octal</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_math_operations">Math operations</h5>
<div class="paragraph">
<p>Although <a href="#_operators">operators</a> are covered later on, it&#8217;s important to discuss the behavior of math operations
and what their resulting types are.</p>
</div>
<div class="paragraph">
<p>Division and power binary operations aside (covered below),</p>
</div>
<div class="ulist">
<ul>
<li>
<p>binary operations between <code>byte</code>, <code>char</code>, <code>short</code> and <code>int</code> result in <code>int</code></p>
</li>
<li>
<p>binary operations involving <code>long</code> with <code>byte</code>, <code>char</code>, <code>short</code> and <code>int</code> result in <code>long</code></p>
</li>
<li>
<p>binary operations involving <code>BigInteger</code> and any other integral type result in <code>BigInteger</code></p>
</li>
<li>
<p>binary operations between <code>float</code>, <code>double</code> and <code>BigDecimal</code> result in <code>double</code></p>
</li>
<li>
<p>binary operations between two <code>BigDecimal</code> result in <code>BigDecimal</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following table summarizes those rules:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">byte</th>
<th class="tableblock halign-left valign-top">char</th>
<th class="tableblock halign-left valign-top">short</th>
<th class="tableblock halign-left valign-top">int</th>
<th class="tableblock halign-left valign-top">long</th>
<th class="tableblock halign-left valign-top">BigInteger</th>
<th class="tableblock halign-left valign-top">float</th>
<th class="tableblock halign-left valign-top">double</th>
<th class="tableblock halign-left valign-top">BigDecimal</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>byte</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>char</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>short</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>int</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>long</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>BigInteger</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>float</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>double</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>BigDecimal</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Thanks Groovy&#8217;s operator overloading, the usual arithmetic operators work as well with <code>BigInteger</code> and <code>BigDecimal</code>,
unlike in Java where you have to use explict methods for operating on those numbers.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="integer_division">The case of the division operator</h6>
<div class="paragraph">
<p>The division operators <code>/</code> (and <code>/=</code> for division and assignment) produce a <code>double</code> result
if either operand is a <code>float</code> or <code>double</code>, and a <code>BigDecimal</code> result otherwise
(when both operands are any combination of an integral type <code>short</code>, <code>char</code>, <code>byte</code>, <code>int</code>, <code>long</code>,
<code>BigInteger</code> or <code>BigDecimal</code>).</p>
</div>
<div class="paragraph">
<p><code>BigDecimal</code> division is performed with the <code>divide()</code> method if the division is exact
(ie. yielding a result that can be represented within the bounds of the same precision and scale),
or using a <code>MathContext</code> with a <a href="http://docs.oracle.com/javase/7/docs/api/java/math/BigDecimal.html#precision()">precision</a>
of the maximum of the two operands&#8217; precision plus an extra precision of 10,
and a <a href="http://docs.oracle.com/javase/7/docs/api/java/math/BigDecimal.html#scale()">scale</a>
of the maximum of 10 and the maximum of the operands&#8217; scale.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
For integer division like in Java, you should use the <code>intdiv()</code> method,
as Groovy doesn&#8217;t provide a dedicated integer division operator symbol.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="power_operator">The case of the power operator</h6>
<div class="paragraph">
<p>The power operation is represented by the <code>**</code> operator, with two parameters: the base and the exponent.
The result of the power operation depends on its operands, and the result of the operation
(in particular if the result can be represented as an integral value).</p>
</div>
<div class="paragraph">
<p>The following rules are used by Groovy&#8217;s power operation to determine the resulting type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the exponent is a decimal value</p>
<div class="ulist">
<ul>
<li>
<p>if the result can be represented as an <code>Integer</code>, then return an <code>Integer</code></p>
</li>
<li>
<p>else if the result can be represented as a <code>Long</code>, then return a <code>Long</code></p>
</li>
<li>
<p>otherwise return a <code>Double</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>If the exponent is an integral value</p>
<div class="ulist">
<ul>
<li>
<p>if the exponent is strictly negative, then return an <code>Integer</code>, <code>Long</code> or <code>Double</code> if the result value fits in that type</p>
</li>
<li>
<p>if the exponent is positive or zero</p>
<div class="ulist">
<ul>
<li>
<p>if the base is a <code>BigDecimal</code>, then return a <code>BigDecimal</code> result value</p>
</li>
<li>
<p>if the base is a <code>BigInteger</code>, then return a <code>BigInteger</code> result value</p>
</li>
<li>
<p>if the base is an <code>Integer</code>, then return an <code>Integer</code> if the result value fits in it, otherwise a <code>BigInteger</code></p>
</li>
<li>
<p>if the base is a <code>Long</code>, then return a <code>Long</code> if the result value fits in it, otherwise a <code>BigInteger</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>We can illustrate those rules with a few examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">// base and exponent are ints and the result can be represented by an Integer
assert    2    **   3    instanceof Integer    //  8
assert   10    **   9    instanceof Integer    //  1_000_000_000

// the base is a long, so fit the result in a Long
// (although it could have fit in an Integer)
assert    5L   **   2    instanceof Long       //  25

// the result can't be represented as an Integer or Long, so return a BigInteger
assert  100    **  10    instanceof BigInteger //  10e20
assert 1234    ** 123    instanceof BigInteger //  170515806212727042875...

// the base is a BigDecimal and the exponent a negative int
// but the result can be represented as an Integer
assert    0.5  **  -2    instanceof Integer    //  4

// the base is an int, and the exponent a negative float
// but again, the result can be represented as an Integer
assert    1    **  -0.3f instanceof Integer    //  1

// the base is an int, and the exponent a negative int
// but the result will be calculated as a Double
// (both base and exponent are actually converted to doubles)
assert   10    **  -1    instanceof Double     //  0.1

// the base is a BigDecimal, and the exponent is an int, so return a BigDecimal
assert    1.2  **  10    instanceof BigDecimal //  6.1917364224

// the base is a float or double, and the exponent is an int
// but the result can only be represented as a Double value
assert    3.4f **   5    instanceof Double     //  454.35430372146965
assert    5.6d **   2    instanceof Double     //  31.359999999999996

// the exponent is a decimal value
// and the result can only be represented as a Double value
assert    7.8  **   1.9  instanceof Double     //  49.542708423868476
assert    2    **   0.1f instanceof Double     //  1.0717734636432956</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_booleans">1.1.6. Booleans</h4>
<div class="paragraph">
<p>Boolean is a special data type that is used to represent truth values: <code>true</code> and <code>false</code>.
Use this data type for simple flags that track true/false <a href="#_conditional_operators">conditions</a>.</p>
</div>
<div class="paragraph">
<p>Boolean values can be stored in variables, assigned into fields, just like any other data type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def myBooleanVariable = true
boolean untypedBooleanVar = false
booleanField = true</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>true</code> and <code>false</code> are the only two primitive boolean values.
But more complex boolean expressions can be represented using <a href="#_bitwise_and_logical_operators">logical operators</a>.</p>
</div>
<div class="paragraph">
<p>In addition, Groovy has <a href="#_the_groovy_truth">special rules</a> (often referred to as <em>Groovy Truth</em>)
for coercing non-boolean objects to a boolean value.</p>
</div>
</div>
<div class="sect3">
<h4 id="_lists">1.1.7. Lists</h4>
<div class="paragraph">
<p>Groovy uses a comma-separated list of values, surrounded by square brackets, to denote lists.
Groovy lists are plain JDK <code>java.util.List</code>, as Groovy doesn&#8217;t define its own collection classes.
The concrete list implementation used when defining list literals are <code>java.util.ArrayList</code> by default,
unless you decide to specify otherwise, as we shall see later on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def numbers = [1, 2, 3]         <i class="conum" data-value="1"></i><b>(1)</b>

assert numbers instanceof List  <i class="conum" data-value="2"></i><b>(2)</b>
assert numbers.size() == 3      <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We define a list numbers delimited by commas and surrounded by square brackets, and we assign that list into a variable</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The list is an instance of Java&#8217;s <code>java.util+List</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The size of the list can be queried with the <code>size()</code> method, and shows our list contains 3 elements</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the above example, we used a homogeneous list, but you can also create lists containing values of heterogeneous types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def heterogeneous = [1, "a", true]  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Our list here contains a number, a string and a boolean value</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We mentioned that by default, list literals are actually instances of <code>java.util.ArrayList</code>,
but it is possible to use a different backing type for our lists,
thanks to using type coercion with the <code>as</code> operator, or with explicit type declaration for your variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def arrayList = [1, 2, 3]
assert arrayList instanceof java.util.ArrayList

def linkedList = [2, 3, 4] as LinkedList    <i class="conum" data-value="1"></i><b>(1)</b>
assert linkedList instanceof java.util.LinkedList

LinkedList otherLinked = [3, 4, 5]          <i class="conum" data-value="2"></i><b>(2)</b>
assert otherLinked instanceof java.util.LinkedList</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We use coercion with the <code>as</code> operator to explicitly request a <code>java.util.LinkedList</code> implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We can say that the variable holding the list literal is of type <code>java.util.LinkedList</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can access elements of the list with the <code>[]</code> subscript operator (both for reading and setting values)
with positive indices or negative indices to access elements from the end of the list, as well as with ranges,
and use the <code>&lt;&lt;</code> leftShift operator to append elements to a list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def letters = ['a', 'b', 'c', 'd']

assert letters[0] == 'a'     <i class="conum" data-value="1"></i><b>(1)</b>
assert letters[1] == 'b'

assert letters[-1] == 'd'    <i class="conum" data-value="2"></i><b>(2)</b>
assert letters[-2] == 'c'

letters[2] = 'C'             <i class="conum" data-value="3"></i><b>(3)</b>
assert letters[2] == 'C'

letters &lt;&lt; 'e'               <i class="conum" data-value="4"></i><b>(4)</b>
assert letters[ 4] == 'e'
assert letters[-1] == 'e'

assert letters[1, 3] == ['b', 'd']         <i class="conum" data-value="5"></i><b>(5)</b>
assert letters[2..4] == ['C', 'd', 'e']    <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access the first element of the list (zeroth-based counting)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Access the last element of the list with a negative index: -1 is the first element from the end of the list</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use an assignment to set a new value for the third element of the list</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use the <code>&lt;&lt;</code> leftShift operator to append an element at the end of the list</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Access two elements at once, returning a new list containing those two elements</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Use a range to access a range of values from the list, from a start to an end element position</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As lists can be heterogeneous in nature, lists can also contain other lists to create multi-dimensional lists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def multi = [[0, 1], [2, 3]]     <i class="conum" data-value="1"></i><b>(1)</b>
assert multi[1][0] == 2          <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define a list of list of numbers</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Access the second element of the top-most list, and the first element of the inner list</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_arrays">1.1.8. Arrays</h4>
<div class="paragraph">
<p>Groovy reuses the list notation for arrays, but to make such literals arrays,
you need to explicitely define the type of the array through coercion or type declaration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">String[] arrStr = ['Ananas', 'Banana', 'Kiwi']  <i class="conum" data-value="1"></i><b>(1)</b>

assert arrStr instanceof String[]    <i class="conum" data-value="2"></i><b>(2)</b>
assert !(arrStr instanceof List)     <i class="conum" data-value="3"></i><b>(3)</b>

def numArr = [1, 2, 3] as int[]      <i class="conum" data-value="4"></i><b>(4)</b>

assert numArr instanceof int[]       <i class="conum" data-value="5"></i><b>(5)</b>
assert numArr.size() == 3</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define an array of strings using explicit variable type declaration</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Assert that we created an array of strings</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create an array of ints with the <code>as</code> operator</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Assert that we created an array of primitive ints</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also create multi-dimensional arrays:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def matrix3 = new Integer[3][3]         <i class="conum" data-value="1"></i><b>(1)</b>
assert matrix3.size() == 3

Integer[][] matrix2                     <i class="conum" data-value="2"></i><b>(2)</b>
matrix2 = [[1, 2], [3, 4]]
assert matrix2 instanceof Integer[][]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can define the bounds of a new array</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Or declare an array without specifying its bounds</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Access to elements of an array follows the same notation as for lists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">String[] names = ['Cédric', 'Guillaume', 'Jochen', 'Paul']
assert names[0] == 'Cédric'     <i class="conum" data-value="1"></i><b>(1)</b>

names[2] = 'Blackdrag'          <i class="conum" data-value="2"></i><b>(2)</b>
assert names[2] == 'Blackdrag'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Retrieve the first element of the array</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the value of the third element of the array to a new value</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Java&#8217;s array initializer notation is not supported by Groovy,
as the curly braces can be misinterpreted with the notation of Groovy closures.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_maps">1.1.9. Maps</h4>
<div class="paragraph">
<p>Sometimes called dictionaries or associative arrays in other languages, Groovy features maps.
Maps associate keys to values, separating keys and values with colons, and each key/value pairs with commas,
and the whole keys and values surrounded by square brackets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def colors = [red: '#FF0000', green: '#00FF00', blue: '#0000FF']   <i class="conum" data-value="1"></i><b>(1)</b>

assert colors['red'] == '#FF0000'    <i class="conum" data-value="2"></i><b>(2)</b>
assert colors.green  == '#00FF00'    <i class="conum" data-value="3"></i><b>(3)</b>

colors['pink'] = '#FF00FF'           <i class="conum" data-value="4"></i><b>(4)</b>
colors.yellow  = '#FFFF00'           <i class="conum" data-value="5"></i><b>(5)</b>

assert colors.pink == '#FF00FF'
assert colors['yellow'] == '#FFFF00'

assert colors instanceof java.util.LinkedHashMap</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We define a map of string color names, associated with their hexadecimal-coded html colors</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We use the subscript notation to check the content associated with the <code>red</code> key</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We can also use the property notation to assert the color green&#8217;s hexadecimal representation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Similarily, we can use the subscript notation to add a new key/value pair</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Or the property notation, to add the <code>yellow</code> color</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
When using names for the keys, we actually define string keys in the map.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Groovy creates maps that are actually instances of <code>java.util.LinkedHashMap</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you try to access a key which is not present in the map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert colors.unknown == null</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will retrieve a <code>null</code> result.</p>
</div>
<div class="paragraph">
<p>In the examples above, we used string keys, but you can also use values of other types as keys:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def numbers = [1: 'one', 2: 'two']

assert numbers[1] == 'one'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we used numbers as keys, as numbers can unambiguously be recognized as numbers,
so Groovy will not create a string key like in our previous examples.
But consider the case you want to pass a variable in lieu of the key, to have the value of that variable become the key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def key = 'name'
def person = [key: 'Guillaume']      <i class="conum" data-value="1"></i><b>(1)</b>

assert !person.containsKey('name')   <i class="conum" data-value="2"></i><b>(2)</b>
assert person.containsKey('key')     <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>key</code> associated with the <code>'Guillaume&#8217;</code> name will actually be the <code>"key"</code> string, not the value associated with the <code>key</code> variable</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The map doesn&#8217;t contain the <code>'name&#8217;</code> key</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Instead, the map contains a <code>'key&#8217;</code> key</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
You can also pass quoted strings as well as keys: <code>["name": "Guillaume"]</code>.
This is mandatory if your key string isn&#8217;t a valid identifier,
for example if you wanted to create a string key containing a hash like in: <code>["street-name": "Main street"]</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you need to pass variable values as keys in your map definitions, you must surround the variable or expression with parentheses:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">person = [(key): 'Guillaume']        <i class="conum" data-value="1"></i><b>(1)</b>

assert person.containsKey('name')    <i class="conum" data-value="2"></i><b>(2)</b>
assert !person.containsKey('key')    <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This time, we surround the <code>key</code> variable with parentheses, to instruct the parser we are passing a variable rather than defining a string key</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The map does contain the <code>name</code> key</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>But the map doesn&#8217;t contain the <code>key</code> key as before</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="groovy-operators">1.2. Operators</h3>
<div class="paragraph">
<p>This chapter covers the operators of the Groovy programming language.</p>
</div>
<div class="sect3">
<h4 id="_arithmetic_operators">1.2.1. Arithmetic operators</h4>
<div class="paragraph">
<p>Groovy supports the usual familiar arithmetic operators you find in mathematics and in other programming languages like Java.
All the Java arithmetic operators are supported. Let&#8217;s go through them in the following examples.</p>
</div>
<div class="sect4">
<h5 id="_normal_arithmetic_operators">Normal arithmetic operators</h5>
<div class="paragraph">
<p>The following binary arithmetic operators are available in Groovy:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">addition</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">substraction</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">multiplication</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">division</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use <code>intdiv()</code> for integer division, and see the section about <a href="core-syntax.html#integer_division">the integer division</a> for more information on the return type of the division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">modulo</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>**</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">power</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See the section about <a href="core-syntax.html#power_operator">the power operation</a> for more information on the return type of the operation.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here are a few examples of usage of those operators:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert  1  + 2 == 3
assert  4  - 3 == 1
assert  3  * 5 == 15
assert  3  / 2 == 1.5
assert 10  % 3 == 1
assert  2 ** 3 == 8</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_unary_operators">Unary operators</h5>
<div class="paragraph">
<p>The <code>+</code> and <code>-</code> operators are also available as unary operators:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert +3 == 3
assert -4 == 0 - 4

assert -(-1) == 1  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note the usage of parentheses to surround an expression to apply the unary minus to that surrounded expression.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In terms of unary arithmetics operators, the <code>+</code>+ (increment) and <code>--</code> (decrement) operators are available,
both in prefix and postfix notation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def a = 2
def b = a++ * 3             <i class="conum" data-value="1"></i><b>(1)</b>

assert a == 3 &amp;&amp; b == 6

def c = 3
def d = c-- * 2             <i class="conum" data-value="2"></i><b>(2)</b>

assert c == 2 &amp;&amp; d == 6

def e = 1
def f = ++e + 3             <i class="conum" data-value="3"></i><b>(3)</b>

assert e == 2 &amp;&amp; f == 5

def g = 4
def h = --g + 1             <i class="conum" data-value="4"></i><b>(4)</b>

assert g == 3 &amp;&amp; h == 4</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The postfix increment will increment <code>a</code> after the expression has been evaluated and assigned into <code>b</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The postfix decrement will decrement <code>c</code> after the expression has been evaluated and assigned into <code>d</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The prefix increment will increment <code>e</code> before the expression is evaluated and assigned into <code>f</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The prefix decrement will decrement <code>g</code> before the expression is evaluated and assigned into <code>h</code></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_assignment_arithmetic_operators">Assignment arithmetic operators</h5>
<div class="paragraph">
<p>From the binary arithmetic operators we have seen above, certain of them are also available in an assignment form:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>+=</code></p>
</li>
<li>
<p><code>-=</code></p>
</li>
<li>
<p><code>*=</code></p>
</li>
<li>
<p><code>/=</code></p>
</li>
<li>
<p><code>%=</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s see them in action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def a = 4
a += 3

assert a == 7

def b = 5
b -= 3

assert b == 2

def c = 5
c *= 3

assert c == 15

def d = 10
d /= 2

assert d == 5

def e = 10
e %= 3

assert e == 1</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_relational_operators">1.2.2. Relational operators</h4>
<div class="paragraph">
<p>Relational operators allow comparisons between objects, to know if two objects are the same or different,
or if one is greater or lower than or equal to the other.</p>
</div>
<div class="paragraph">
<p>The following operators are available:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>==</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">equal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>!=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">different</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">less than</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">less than or equal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">greater than</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">greater than or equal</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These operators into action in simple number comparisons:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert 1 + 2 == 3
assert 3 != 4

assert -2 &lt; 3
assert 2 &lt;= 2
assert 3 &lt;= 4

assert 5 &gt; 1
assert 5 &gt;= -2</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_logical_operators">1.2.3. Logical operators</h4>
<div class="paragraph">
<p>Groovy offers three logical operators for boolean expressions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&amp;&amp;</code>: logical "and"</p>
</li>
<li>
<p><code>||</code>: logical "or"</p>
</li>
<li>
<p><code>!</code>: logical "not"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s illustrate them with the following examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert !false           <i class="conum" data-value="1"></i><b>(1)</b>
assert true &amp;&amp; true     <i class="conum" data-value="2"></i><b>(2)</b>
assert true || false    <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>"not" false is true</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>true "and" true is true</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>true "or" false is true</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_precedence">Precedence</h5>
<div class="paragraph">
<p>The logical "not" has a higher priority than the logical "and".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert !false &amp;&amp; true    <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here, the assertion is true, because "not" has a higher precedence than "and", otherwise, the assertion would have failed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The logical "and" has a higher priority than the logical "or".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert false || true &amp;&amp; true    <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here, the assertion is true, because "and" has a higher precedence than "or", otherwise, the assertion would have failed</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_short_circuiting_for_code_code">Short-circuiting for <code>||</code></h5>
<div class="paragraph">
<p>The logical "or" operator is supporting short-circuiting: if the left operand is true, it won&#8217;t evaluate the right operand.
The right operand will be evaluated only if the left operand is false.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">called = false

boolean somethingTrueOrFalse(boolean b) {  <i class="conum" data-value="1"></i><b>(1)</b>
    called = true
    return b
}

assert true || somethingTrueOrFalse(false)
assert !called                              <i class="conum" data-value="2"></i><b>(2)</b>

assert false || somethingTrueOrFalse(true)
assert called                               <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We create a function that returns its boolean argument, but it sets the <code>called</code> flag</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In the first case, we confirm that the function is not called, as <code>||</code> short-circuits the evaluation of the right operand.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>In the second case, the right operand is called, as indicated by the fact our flag is now true</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bitwise_operators">1.2.4. Bitwise operators</h4>
<div class="paragraph">
<p>Groovy offers 4 bitwise operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&amp;</code>: bitwise "and"</p>
</li>
<li>
<p><code>|</code>: bitwise "or"</p>
</li>
<li>
<p><code>^</code>: bitwise "xor" (exclusive "or")</p>
</li>
<li>
<p><code>~</code>: bitwise negation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Bitwise operators can be applied on a <code>byte</code> or an <code>int</code> and return an <code>int</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">int a = 0b00101010
assert a==42
int b = 0b00001000
assert b==8
assert (a &amp; a) == a                     <i class="conum" data-value="1"></i><b>(1)</b>
assert (a &amp; b) == b                     <i class="conum" data-value="2"></i><b>(2)</b>
assert (a | a) == a                     <i class="conum" data-value="3"></i><b>(3)</b>
assert (a | b) == a                     <i class="conum" data-value="4"></i><b>(4)</b>

int mask = 0b11111111                   <i class="conum" data-value="5"></i><b>(5)</b>
assert ((a ^ a) &amp; mask) == 0b00000000   <i class="conum" data-value="6"></i><b>(6)</b>
assert ((a ^ b) &amp; mask) == 0b00100010   <i class="conum" data-value="7"></i><b>(7)</b>
assert ((~a) &amp; mask)    == 0b11010101   <i class="conum" data-value="8"></i><b>(8)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>bitwise and</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>bitwise and returns common bits</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>bitwise or</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>bitwise or returns all <em>1</em> bits</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>setting a mask to check only the last 8 bits</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>bitwise exclusive or on self returns 0</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>bitwise exclusive or</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>bitwise negation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It&#8217;s worth noting that the internal representation of primitive types follow the <a href="http://docs.oracle.com/javase/specs/jls/se8/html/jls-4.html">Java Language Specification</a>. In particular,
primitive types are signed, meaning that for a bitwise negation, it is always good to use a mask to retrieve only the necessary bits.</p>
</div>
<div class="paragraph">
<p>In Groovy, bitwise operators have the particularity of being <a href="#Operator-Overloading">overloadable</a>, meaning that you can define the behavior of those operators for any kind of object.</p>
</div>
</div>
<div class="sect3">
<h4 id="_conditional_operators">1.2.5. Conditional operators</h4>
<div class="sect4">
<h5 id="_not_operator">Not operator</h5>
<div class="paragraph">
<p>The "not" operator is represented with an exclamation mark (<code>!</code>) and inverts the result of the underlying boolean expression. In
particular, it is possible to combine the <code>not</code> operator with the <a href="#Groovy-Truth">Groovy truth</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert (!true)    == false                      <i class="conum" data-value="1"></i><b>(1)</b>
assert (!'foo')   == false                      <i class="conum" data-value="2"></i><b>(2)</b>
assert (!'')      == true                       <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the negation of <code>true</code> is <code>false</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><em>foo</em> is a non empty string, evaluating to <code>true</code>, so negation returns <code>false</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>'' is an empty string, evaluating to <code>false</code>, so negation returns <code>true</code></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_ternary_operator">Ternary operator</h5>
<div class="paragraph">
<p>The ternary operator is a shortcut expression that is equivalent to an if/else branch assigning some value to a variable.</p>
</div>
<div class="paragraph">
<p>Instead of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">if (string!=null &amp;&amp; string.length()&gt;0) {
    result = 'Found'
} else {
    result = 'Not found'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">result = (string!=null &amp;&amp; string.length()&gt;0)?'Found':'Not found'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The ternary operator is also compatible with the <a href="#Groovy-Truth">Groovy truth</a>, so you can make it even simpler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">result = string?'Found':'Not found'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_elvis_operator">Elvis operator</h5>
<div class="paragraph">
<p>The "Elvis operator" is a shortening of the ternary operator. One instance of where this is handy is for returning
a <em>sensible default</em> value if an expression resolves to <code>false</code> or <code>null</code>. A simple example might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">displayName = user.name ? user.name : 'Anonymous'   <i class="conum" data-value="1"></i><b>(1)</b>
displayName = user.name ?: 'Anonymous'              <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>with the ternary operator, you have to repeat the value you want to assign</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>with the Elvis operator, the value which is tested is used if it is not <code>false</code> or <code>null</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Usage of the Elvis operator reduces the verbosity of your code and reduces the risks of errors in case of refactorings,
by removing the need to duplicate the expression which is tested in both the condition and the positive return value.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_object_operators">1.2.6. Object operators</h4>
<div class="sect4">
<h5 id="_safe_navigation_operator">Safe navigation operator</h5>
<div class="paragraph">
<p>The Safe Navigation operator is used to avoid a <code>NullPointerException</code>. Typically when you have a reference to an object
you might need to verify that it is not <code>null</code> before accessing methods or properties of the object. To avoid this, the safe
navigation operator will simply return <code>null</code> instead of throwing an exception, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def person = Person.find { it.id == 123 }           <i class="conum" data-value="1"></i><b>(1)</b>
def name = person?.name                             <i class="conum" data-value="2"></i><b>(2)</b>
assert name == null                                 <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>find</code> will return a <code>null</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>use of the null-safe operator prevents from a <code>NullPointerException</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>result is <code>null</code></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_direct_field_access_operator">Direct field access operator</h5>
<div class="paragraph">
<p>Normally in Groovy, when you write code like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class User {
    public final String name                               <i class="conum" data-value="1"></i><b>(1)</b>
    User(String name) { this.name = name}
    String getName() { "Name: $name" }                     <i class="conum" data-value="2"></i><b>(2)</b>
}
def user = new User('Bob')
assert user.name == 'Name: Bob'                            <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>public field <code>name</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>a getter for <code>name</code> that returns a custom string</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>calls the getter</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>user.name</code> call triggers a call to the property of the same name, that is to say, here, to the getter for <code>name</code>. If
you want to retrieve the field instead of calling the getter, you can use the direct field access operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert user.@name == 'Bob'                                 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>use of <code>.@</code> forces usage of the field instead of the getter</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_method_reference_operator">Method reference operator</h5>
<div class="paragraph">
<p>The method reference operator (<code>.&amp;</code>) call be used to store a reference to a method in a variable, in order to call it
later:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def str = 'example of method reference'            <i class="conum" data-value="1"></i><b>(1)</b>
def fun = str.&amp;toUpperCase                         <i class="conum" data-value="2"></i><b>(2)</b>
def upper = fun()                                  <i class="conum" data-value="3"></i><b>(3)</b>
assert upper == str.toUpperCase()                  <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>str</code> variable contains a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we store a reference to the <code>toUpperCase</code> method on the <code>str</code> instance inside a variable named <code>fun</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>fun</code> can be called like a regular method</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>we can check that the result is the same as if we had called it directly on <code>str</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are multiple advantages in using method references. First of all, the type of such a method reference is
a <code>groovy.lang.Closure</code>, so it can be used in any place a closure would be used. In particular, it is suitable to
convert an existing method for the needs of the strategy pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def transform(List elements, Closure action) {                                      <i class="conum" data-value="1"></i><b>(1)</b>
    def result = []
    elements.each {
        result &lt;&lt; action(it)
    }
    result
}
String describe(Person p) {                                                         <i class="conum" data-value="2"></i><b>(2)</b>
    "$p.name is $p.age"
}
def action = this.&amp;describe                                                         <i class="conum" data-value="3"></i><b>(3)</b>
def list = [new Person(name:'Bob', age:42), new Person(name:'Julia',age:35)]        <i class="conum" data-value="4"></i><b>(4)</b>
assert transform(list, action) == ['Bob is 42', 'Julia is 35']                      <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>transform</code> method takes each element of the list and calls the <code>action</code> closure on them, returning a new list</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we define a function that takes a <code>Person</code> a returns a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>we create a method reference on that function</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>we create the list of elements we want to collect the descriptors</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the method reference can be used where a <code>Closure</code> was expected</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Method references are bound by the receiver and a method name. Arguments are resolved at runtime, meaning that if you have
multiple methods with the same name, the syntax is not different, only resolution of the appropriate method to be called
will be done at runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def doSomething(String str) { str.toUpperCase() }                                   <i class="conum" data-value="1"></i><b>(1)</b>
def doSomething(Integer x) { 2*x }                                                  <i class="conum" data-value="2"></i><b>(2)</b>
def reference = this.&amp;doSomething                                                   <i class="conum" data-value="3"></i><b>(3)</b>
assert reference('foo') == 'FOO'                                                    <i class="conum" data-value="4"></i><b>(4)</b>
assert reference(123)   == 246                                                      <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>define an overloaded <code>doSomething</code> method accepting a <code>String</code> as an argument</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>define an overloaded <code>doSomething</code> method accepting an <code>Integer</code> as an argument</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>create a single method reference on <code>doSomething</code>, without specifying argument types</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>using the method reference with a <code>String</code> calls the <code>String</code> version of <code>doSomething</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>using the method reference with an <code>Integer</code> calls the <code>Integer</code> version of <code>doSomething</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_regular_expression_operators">1.2.7. Regular expression operators</h4>
<div class="sect4">
<h5 id="_pattern_operator">Pattern operator</h5>
<div class="paragraph">
<p>The pattern operator (<code>~</code>) provides a simple way to create a <code>java.util.regex.Pattern</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def p = ~/foo/
assert p instanceof Pattern</code></pre>
</div>
</div>
<div class="paragraph">
<p>while in general, you find the pattern operator with an expression in a slashy-string, it can be used with any kind of
<code>String</code> in Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">p = ~'foo'                                                                              <i class="conum" data-value="1"></i><b>(1)</b>
p = ~'foo'                                                                              <i class="conum" data-value="2"></i><b>(2)</b>
p = ~$/dollar/slashy $ string/$                                                         <i class="conum" data-value="3"></i><b>(3)</b>
p = ~"${pattern}"                                                                       <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>using single quote strings</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>using double quotes strings</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the dollar-slashy string lets you use slashes and the dollar sign without having to escape them</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>you can also use a GString!</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_find_operator">Find operator</h5>
<div class="paragraph">
<p>Alternatively to building a pattern, you can directly use the find operator <code>=~</code> to build a <code>java.util.regex.Matcher</code>
instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def text = "some text to match"
def m = text =~ /match/                                                                 <i class="conum" data-value="1"></i><b>(1)</b>
assert m instanceof Matcher                                                             <i class="conum" data-value="2"></i><b>(2)</b>
if (!m) {                                                                               <i class="conum" data-value="3"></i><b>(3)</b>
    throw new RuntimeException("Oops, text not found!")
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>~=</code> creates a matcher against the <code>text</code> variable, using the pattern on the right hand side</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the return type of <code>~=</code> is a <code>Matcher</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>equivalent to calling <code>if (!m.find())</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since a <code>Matcher</code> coerces to a <code>boolean</code> by calling its <code>find</code> method, the <code>=~</code> operator is consistent with the simple
use of Perl&#8217;s <code>=~</code> operator, when it appears as a predicate (in <code>if</code>, <code>while</code>, etc.).</p>
</div>
</div>
<div class="sect4">
<h5 id="_match_operator">Match operator</h5>
<div class="paragraph">
<p>The match operator (<code>==~</code>) is a slight variation of the find operator, that does not return a <code>Matcher</code> but a boolean
and requires a strict match of the input string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">m = text ==~ /match/                                                                    <i class="conum" data-value="1"></i><b>(1)</b>
assert m instanceof Boolean                                                             <i class="conum" data-value="2"></i><b>(2)</b>
if (m) {                                                                                <i class="conum" data-value="3"></i><b>(3)</b>
    throw new RuntimeException("Should not reach that point!")
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>~==</code> matches the subject with the regular expression, but match must be strict</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the return type of <code>~==</code> is therefore a <code>boolean</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>equivalent to calling <code>if (text ==~ /match/)</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_other_operators_wip">1.2.8. Other operators (WIP)</h4>
<div class="sect4">
<h5 id="_spread_operator">Spread operator</h5>
<div class="paragraph">
<p>The Spread Operator (<code>*.</code>) is used to invoke an action on all items of an aggregate object. It is equivalent to calling the action on each item
and collecting the result into a list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Car {
    String make
    String model
}
def cars = [
       new Car(make:'Peugeot', model:'508'),
       new Car(make:'Renault', model:'Clio')]                                    <i class="conum" data-value="1"></i><b>(1)</b>
def makes = cars*.make                                                           <i class="conum" data-value="2"></i><b>(2)</b>
assert makes == ['Peugeot', 'Renault']                                           <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>build a list of <code>Car</code> items. The list is an aggregate of objects.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>call the spread operator on the list, accessing the <code>make</code> property of each item</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>returns a list of strings corresponding to the collection of <code>make</code> items</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The spread operator is null-safe, meaning that if an element of the collection is null, it will return null instead of throwing a <code>NullPointerException</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">cars = [
   new Car(make:'Peugeot', model:'508'),
   null,                                                                         <i class="conum" data-value="1"></i><b>(1)</b>
   new Car(make:'Renault', model:'Clio')]
assert cars*.make == ['Peugeot', null, 'Renault']                                <i class="conum" data-value="2"></i><b>(2)</b>
assert null*.make == null                                                        <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>build a list for which of of the elements is <code>null</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>using the spread operator will <strong>not</strong> throw a <code>NullPointerException</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the receiver might also be null, in which case the return value is <code>null</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The spread operator can be used on any class which implements the <code>Iterable</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Component {
    Long id
    String name
}
class CompositeObject implements Iterable&lt;Component&gt; {
    def components = [
        new Component(id:1, name: 'Foo'),
        new Component(id:2, name:'Bar')]

    @Override
    Iterator&lt;Component&gt; iterator() {
        components.iterator()
    }
}
def composite = new CompositeObject()
assert composite*.id == [1,2]
assert composite*.name == ['Foo','Bar']</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_spreading_method_arguments">Spreading method arguments</h6>
<div class="paragraph">
<p>There may be situations when the arguments of a method call can be found in a list that you need to adapt to the method
arguments. In such situations, you can use the spread operator to call the method. For example, imagine you have the
following method signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">int function(int x, int y, int z) {
    x*y+z
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>then if you have the following list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def args = [4,5,6]</code></pre>
</div>
</div>
<div class="paragraph">
<p>you can call the method without having to define intermediate variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert function(*args) == 26</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is even possible to mix normal arguments with spread ones:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">args = [4]
assert function(*args,5,6) == 26</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_spread_list_elements">Spread list elements</h6>
<div class="paragraph">
<p>When used inside a list literal, the spread operator acts as if the spread element contents were inlined into the list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def items = [4,5]                      <i class="conum" data-value="1"></i><b>(1)</b>
def list = [1,2,3,*items,6]            <i class="conum" data-value="2"></i><b>(2)</b>
assert list == [1,2,3,4,5,6]           <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>items</code> is a list</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we want to insert the contents of the <code>items</code> list directly into <code>list</code> without having to call <code>addAll</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the contents of <code>items</code> has been inlined into <code>list</code></td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_spread_map_elements">Spread map elements</h6>
<div class="paragraph">
<p>The spread map operator works in a similar manner as the spread list operator, but for maps. It allows you to inline
the contents of a map into another map literal, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def m1 = [c: 3, d: 4]                 <i class="conum" data-value="1"></i><b>(1)</b>
def map = [a:1, b:2, *:m1]            <i class="conum" data-value="2"></i><b>(2)</b>
assert map == [a:1, b:2, c:3, d:4]    <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>m1</code> is the map that we want to inline</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we use the <code>*:m1</code> notation to spread the contents of <code>m1</code> into <code>map</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>map</code> contains all the elements of <code>m1</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The position of the spread map operator is relevant, like illustrated in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def m1 = [c: 3, d: 4]                 <i class="conum" data-value="1"></i><b>(1)</b>
def map = [a:1, b:2, *:m1, d: 8]      <i class="conum" data-value="2"></i><b>(2)</b>
assert map == [a:1, b:2, c:3, d:8]    <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>m1</code> is the map that we want to inline</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we use the <code>*:m1</code> notation to spread the contents of <code>m1</code> into <code>map</code>, but redefine the key <code>d</code> <strong>after</strong> spreading</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>map</code> contains all the expected keys, but <code>d</code> was redefined</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_range_operator">Range operator</h5>
<div class="paragraph">
<p>Groovy supports the concept of ranges and provides a notation (<code>..</code>) to create ranges of objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def range = 0..5                                    <i class="conum" data-value="1"></i><b>(1)</b>
assert (0..5).collect() == [0, 1, 2, 3, 4, 5]       <i class="conum" data-value="2"></i><b>(2)</b>
assert (0..&lt;5).collect() == [0, 1, 2, 3, 4]         <i class="conum" data-value="3"></i><b>(3)</b>
assert (0..5) instanceof List                       <i class="conum" data-value="4"></i><b>(4)</b>
assert (0..5).size() == 6                           <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a simple range of integers, stored into a local variable</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>an <code>IntRange</code>, with inclusive bounds</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>an <code>IntRange</code>, with exclusive upper bound</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>a <code>groovy.lang.Range</code> implements the <code>List</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>meaning that you can call the <code>size</code> method on it</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ranges implementation is lightweight, meaning that only the lower and upper bounds are stored. You can create a range
from any <code>Comparable</code> object. For example, you can create a range of characters this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert ('a'..'d').collect() == ['a','b','c','d']</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_spaceship_operator">Spaceship operator</h5>
<div class="paragraph">
<p>The spaceship operator (<code>&lt;=&gt;</code>) delegates to the <code>compareTo</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert (1 &lt;=&gt; 1) == 0
assert (1 &lt;=&gt; 2) == -1
assert (2 &lt;=&gt; 1) == 1
assert ('a' &lt;=&gt; 'z') == -1</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="subscript-operator">Subscript operator</h5>
<div class="paragraph">
<p>The subscript operator is a short hand notation for <code>getAt</code> or <code>putAt</code>, depending on whether you find it on
the left hand side or the right hand side of an assignment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def list = [0,1,2,3,4]
assert list[2] == 2                         <i class="conum" data-value="1"></i><b>(1)</b>
list[2] = 4                                 <i class="conum" data-value="2"></i><b>(2)</b>
assert list[0..2] == [0,1,4]                <i class="conum" data-value="3"></i><b>(3)</b>
list[0..2] = [6,6,6]                        <i class="conum" data-value="4"></i><b>(4)</b>
assert list == [6,6,6,3,4]                  <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>[2]</code> can be used instead of <code>getAt(2)</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>if on left hand side of an assignment, will call <code>putAt</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>getAt</code> also supports ranges</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>so does <code>putAt</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the list is mutated</td>
</tr>
</table>
</div>
<div id="custom-subscript-operator" class="paragraph">
<p>The subscript operator, in combination with a custom implementation of <code>getAt</code>/<code>putAt</code> is a convenient way for destructuring
objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class User {
    Long id
    String name
    def getAt(int i) {                                                  <i class="conum" data-value="1"></i><b>(1)</b>
        switch (i) {
            case 0: return id
            case 1: return name
        }
        throw new IllegalArgumentException("No such element $i")
    }
    void putAt(int i, def value) {                                      <i class="conum" data-value="2"></i><b>(2)</b>
        switch (i) {
            case 0: id = value; return
            case 1: name = value; return
        }
        throw new IllegalArgumentException("No such element $i")
    }
}
def user = new User(id: 1, name: 'Alex')                                <i class="conum" data-value="3"></i><b>(3)</b>
assert user[0] == 1                                                     <i class="conum" data-value="4"></i><b>(4)</b>
assert user[1] == 'Alex'                                                <i class="conum" data-value="5"></i><b>(5)</b>
user[1] = 'Bob'                                                         <i class="conum" data-value="6"></i><b>(6)</b>
assert user.name == 'Bob'                                               <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>User</code> class defines a custom <code>getAt</code> implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>User</code> class defines a custom <code>putAt</code> implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>create a sample user</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>using the subscript operator with index 0 allows retrieving the user id</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>using the subscript operator with index 1 allows retrieving the user name</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>we can use the subscript operator to write to a property thanks to the delegation to <code>putAt</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>and check that it&#8217;s really the property <code>name</code> which was changed</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_membership_operator">Membership operator</h5>
<div class="paragraph">
<p>The membership operator (<code>in</code>) is equivalent to calling the <code>isCase</code> method. In the context of a <code>List</code>, it is equivalent
to calling <code>contains</code>, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def list = ['Grace','Rob','Emmy']
assert ('Emmy' in list)                     <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>equivalent to calling <code>list.contains('Emmy')</code> or <code>list.isCase('Emmy')</code></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_identity_operator">Identity operator</h5>
<div class="paragraph">
<p>In Groovy, using <code>==</code> to test equality is different from using the same operator in Java. In Groovy, it is calling <code>equals</code>.
If you want to compare reference equality, you should use <code>is</code> like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def list1 = ['Groovy 1.8','Groovy 2.0','Groovy 2.3']        <i class="conum" data-value="1"></i><b>(1)</b>
def list2 = ['Groovy 1.8','Groovy 2.0','Groovy 2.3']        <i class="conum" data-value="2"></i><b>(2)</b>
assert list1 == list2                                       <i class="conum" data-value="3"></i><b>(3)</b>
assert !list1.is(list2)                                     <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a list of strings</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create another list of strings containing the same elements</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>using <code>==</code>, we test object equality</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>but using <code>is</code>, we can check that references are distinct</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_coercion_operator">Coercion operator</h5>
<div class="paragraph">
<p>The coercion operator (<code>as</code>) is a variant of casting. Coercion converts object from one type to another <strong>without</strong> them
being compatible for assignement. Let&#8217;s take an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Integer x = 123
String s = (String) x                                   <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Integer</code> is not assignable to a <code>String</code>, so it will produce a <code>ClassCastException</code> at runtime</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This can be fixed by using <em>coercion</em> instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Integer x = 123
String s = x as String                                  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Integer</code> is not assignable to a <code>String</code>, but use of <code>as</code> will <em>coerce</em> it to a <code>String</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When an object is coerced into another, unless the target type is the same as the source type, coercion will return a
<strong>new</strong> object. The rules of coercion differ depending on the source and target types, and coercion may fail if no conversion
rules are found. Custom conversion rules may be implemented thanks to the <code>asType</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Identifiable {
    String name
}
class User {
    Long id
    String name
    def asType(Class target) {                                              <i class="conum" data-value="1"></i><b>(1)</b>
        if (target==Identifiable) {
            return new Identifiable(name: name)
        }
        throw new ClassCastException("User cannot be coerced into $target")
    }
}
def u = new User(name: 'Xavier')                                            <i class="conum" data-value="2"></i><b>(2)</b>
def p = u as Identifiable                                                   <i class="conum" data-value="3"></i><b>(3)</b>
assert p instanceof Identifiable                                            <i class="conum" data-value="4"></i><b>(4)</b>
assert !(p instanceof User)                                                 <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>User</code> class defines a custom conversion rule from <code>User</code> to <code>Identifiable</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we create an instance of <code>User</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>we coerce the <code>User</code> instance into an <code>Identifiable</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the target is an instance of <code>Identifiable</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the target is not an instance of <code>User</code> anymore</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_diamond_operator">Diamond operator</h5>
<div class="paragraph">
<p>The diamond operator (<code>&lt;&gt;</code>) is a syntactic sugar only operator added to support compatibility with the operator of the
same name in Java 7. It is used to indicate that generic types should be inferred from the declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">List&lt;String&gt; strings = new LinkedList&lt;&gt;()</code></pre>
</div>
</div>
<div class="paragraph">
<p>In dynamic Groovy, this is totally unused. In statically type checked Groovy, it is also optional since the Groovy
type checker performs type inference whether this operator is present or not.</p>
</div>
</div>
<div class="sect4">
<h5 id="_call_operator">Call operator</h5>
<div class="paragraph">
<p>The call operator <code>()</code> is used to call a method named <code>call</code> implicitly. For any object which defines a <code>call</code> method,
 you can omit the <code>.call</code> part and use the call operator instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class MyCallable {
    int call(int x) {           <i class="conum" data-value="1"></i><b>(1)</b>
        2*x
    }
}

def mc = new MyCallable()
assert mc.call(2) == 4          <i class="conum" data-value="2"></i><b>(2)</b>
assert mc(2) == 4               <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>MyCallable</code> defines a method named <code>call</code>. Note that it doesn&#8217;t need to implement <code>java.util.concurrent.Callable</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we can call the method using the classic method call syntax</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>or we can omit <code>.call</code> thanks to the call operator</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_operator_precedence_tbd">1.2.9. Operator precedence (TBD)</h4>

</div>
<div class="sect3">
<h4 id="Operator-Overloading">1.2.10. Operator overloading</h4>
<div class="paragraph">
<p>Groovy allows you to overload the various operators so that they can be used with your own classes. Consider this simple
class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Bucket {
    int size

    Bucket(int size) { this.size = size }

    Bucket plus(Bucket other) {                     <i class="conum" data-value="1"></i><b>(1)</b>
        return new Bucket(this.size + other.size)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Bucket</code> implements a special method called <code>plus()</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Just by implementing the <code>plus()</code> method, the <code>Bucket</code> class can now be used with the <code>+</code> operator like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def b1 = new Bucket(4)
def b2 = new Bucket(11)
assert (b1 + b2).size == 15                         <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The two <code>Bucket</code> objects can be added together with the <code>+</code> operator</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All (non-comparator) Groovy operators have a corresponding method that you can implement in your own classes. The only
requirements are that your method is public, has the correct name, and has the correct number of arguments. The argument
types depend on what types you want to support on the right hand side of the operator. For example, you could support
the statement</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert (b1 + 11).size == 15</code></pre>
</div>
</div>
<div class="paragraph">
<p>by implementing the <code>plus()</code> method with this signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Bucket plus(int capacity) {
    return new Bucket(this.size + capacity)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is a complete list of the operators and their corresponding methods:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.plus(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a[b]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.getAt(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.minus(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a[b] = c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.putAt(b, c)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.multiply(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.leftShift(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.div(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.rightShift(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.mod(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>++</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.next()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>**</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.power(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.previous()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.or(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.positive()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.and(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.negative()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>^</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.xor(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.bitwiseNegative()</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_program_structure">1.3. Program structure</h3>
<div class="paragraph">
<p>This chapter covers the program structure of the Groovy programming language.</p>
</div>
<div class="sect3">
<h4 id="_package_name_tbd">1.3.1. Package name (TBD)</h4>

</div>
<div class="sect3">
<h4 id="_imports_tbd">1.3.2. Imports (TBD)</h4>
<div class="sect4">
<h5 id="_default_imports_tbd">Default imports (TBD)</h5>

</div>
<div class="sect4">
<h5 id="_simple_import_tbd">Simple import (TBD)</h5>

</div>
<div class="sect4">
<h5 id="_star_import_tbd">Star import (TBD)</h5>

</div>
<div class="sect4">
<h5 id="_static_import_tbd">Static import (TBD)</h5>

</div>
<div class="sect4">
<h5 id="_static_star_import_tbd">Static star import (TBD)</h5>

</div>
<div class="sect4">
<h5 id="_import_aliasing_tbd">Import aliasing (TBD)</h5>

</div>
</div>
<div class="sect3">
<h4 id="_scripts_versus_classes_tbd">1.3.3. Scripts versus classes (TBD)</h4>

</div>
<div class="sect3">
<h4 id="_initializers_tbd">1.3.4. Initializers (TBD)</h4>
<div class="sect4">
<h5 id="_static_initializers_tbd">Static initializers (TBD)</h5>

</div>
<div class="sect4">
<h5 id="_instance_initializers_tbd">Instance initializers (TBD)</h5>

</div>
</div>
</div>
<div class="sect2">
<h3 id="_object_orientation">1.4. Object orientation</h3>
<div class="paragraph">
<p>This chapter covers the object orientation of the Groovy programming language.</p>
</div>
<div class="sect3">
<h4 id="_types_tbd">1.4.1. Types (TBD)</h4>
<div class="sect4">
<h5 id="_primitive_types_tbd">Primitive types (TBD)</h5>

</div>
<div class="sect4">
<h5 id="_class_tbd">Class (TBD)</h5>
<div class="sect5">
<h6 id="_normal_class_tbd">Normal class (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_static_class_tbd">Static class (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_inner_class_tbd">Inner class (TBD)</h6>
<div class="sect6">
<h7 id="_anonymous_inner_class_tbd">Anonymous inner class (TBD)</h7>

</div>
</div>
<div class="sect5">
<h6 id="_abstract_class_tbd">Abstract class (TBD)</h6>

</div>
</div>
<div class="sect4">
<h5 id="_interface_tbd">Interface (TBD)</h5>

</div>
<div class="sect4">
<h5 id="_annotation_tbd">Annotation (TBD)</h5>
<div class="sect5">
<h6 id="_closure_annotation_parameters_tbd">Closure annotation parameters (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_meta_annotations_tbd">Meta-annotations (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_annotation_placement_tbd">Annotation placement (TBD)</h6>

</div>
</div>
<div class="sect4">
<h5 id="_constructors_tbd">Constructors (TBD)</h5>
<div class="sect5">
<h6 id="_named_argument_constructor_tbd">Named argument constructor (TBD)</h6>

</div>
</div>
<div class="sect4">
<h5 id="_methods_tbd">Methods (TBD)</h5>
<div class="sect5">
<h6 id="_method_definition_tbd">Method definition (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_named_arguments_tbd">Named arguments (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_default_arguments_tbd">Default arguments (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_varargs_tbd">Varargs (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_method_selection_algorithm_tbd">Method selection algorithm (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_exception_declaration_tbd">Exception declaration (TBD)</h6>

</div>
</div>
<div class="sect4">
<h5 id="_fields_and_properties_tbd">Fields and properties (TBD)</h5>
<div class="sect5">
<h6 id="_fields_tbd">Fields (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_properties_tbd">Properties (TBD)</h6>

</div>
</div>
<div class="sect4">
<h5 id="_inheritance_tbd">Inheritance (TBD)</h5>

</div>
<div class="sect4">
<h5 id="generics">Generics (TBD)</h5>

</div>
</div>
<div class="sect3">
<h4 id="_traits">1.4.2. Traits</h4>
<div class="paragraph">
<p>Traits are a a structural construct of the language which allow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>composition of behaviors</p>
</li>
<li>
<p>runtime implementation of interfaces</p>
</li>
<li>
<p>behavior overriding</p>
</li>
<li>
<p>compatibility with static type checking/compilation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>They can be seen as <strong>interfaces</strong> carrying both <strong>default implementations</strong> and <strong>state</strong>. A trait is defined using the
<code>trait</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait FlyingAbility {                           <i class="conum" data-value="1"></i><b>(1)</b>
        String fly() { "I'm flying!" }          <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declaration of a trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>declaration of a method inside a trait</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then it can be used like a normal interface using the <code>implements</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Bird implements FlyingAbility {}          <i class="conum" data-value="1"></i><b>(1)</b>
def b = new Bird()                              <i class="conum" data-value="2"></i><b>(2)</b>
assert b.fly() == "I'm flying!"                 <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Adds the trait <code>FlyingAbility</code> to the <code>Bird</code> class capabilities</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>instantiate a new <code>Bird</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the <code>Bird</code> class automatically gets the behavior of the <code>FlyingAbility</code> trait</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Traits allow a wide range of capabilities, from simple composition to testing, which are described throughfully in this section.</p>
</div>
<div class="sect4">
<h5 id="_methods">Methods</h5>
<div class="sect5">
<h6 id="_public_methods">Public methods</h6>
<div class="paragraph">
<p>Declaring a method in a trait can be done like any regular method in a class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait FlyingAbility {                           <i class="conum" data-value="1"></i><b>(1)</b>
        String fly() { "I'm flying!" }          <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declaration of a trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>declaration of a method inside a trait</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_abstract_methods">Abstract methods</h6>
<div class="paragraph">
<p>In addition, traits may declare <em>abstract</em> methods too, which therefore need to be implemented in the class implementing the trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait Greetable {
    abstract String name()                              <i class="conum" data-value="1"></i><b>(1)</b>
    String greeting() { "Hello, ${name()}!" }           <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>implementing class will have to declare the <code>name</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>can be mixed with a concrete method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then the trait can be used like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Person implements Greetable {                     <i class="conum" data-value="1"></i><b>(1)</b>
    String name() { 'Bob' }                             <i class="conum" data-value="2"></i><b>(2)</b>
}

def p = new Person()
assert p.greeting() == 'Hello, Bob!'                    <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>implement the trait <code>Greetable</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>since <code>name</code> was abstract, it is required to implement it</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>then <code>greeting</code> can be called</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_private_methods">Private methods</h6>
<div class="paragraph">
<p>Traits may also define private methods. Those methods will not appear in the trait contract interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait Greeter {
    private String greetingMessage() {                      <i class="conum" data-value="1"></i><b>(1)</b>
        'Hello from a private method!'
    }
    String greet() {
        def m = greetingMessage()                           <i class="conum" data-value="2"></i><b>(2)</b>
        println m
        m
    }
}
class GreetingMachine implements Greeter {}                 <i class="conum" data-value="3"></i><b>(3)</b>
def g = new GreetingMachine()
assert g.greet() == "Hello from a private method!"          <i class="conum" data-value="4"></i><b>(4)</b>
try {
    assert g.greetingMessage()                              <i class="conum" data-value="5"></i><b>(5)</b>
} catch (MissingMethodException e) {
    println "greetingMessage is private in trait"
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>define a private method <code>greetingMessage</code> in the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the public <code>greet</code> message calls <code>greetingMessage</code> by default</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>create a class implementing the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>greet</code> can be called</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>but not <code>greetingMessage</code></td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
Traits only support <code>public</code> and <code>private</code> methods. Neither <code>protected</code> nor <code>package private</code> scopes are
supported.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_the_meaning_of_this">The meaning of this</h5>
<div class="paragraph">
<p><code>this</code> represents the implementing instance. Think of a trait as a superclass. This means that when you write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait Introspector {
    def whoAmI() { this }
}
class Foo implements Introspector {}
def foo = new Foo()</code></pre>
</div>
</div>
<div class="paragraph">
<p>then calling:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">foo.whoAmI()</code></pre>
</div>
</div>
<div class="paragraph">
<p>will return the same instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert foo.whoAmI().is(foo)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_interfaces">Interfaces</h5>
<div class="paragraph">
<p>Traits may implement interfaces, in which case the interfaces are declared using the <code>implements</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">interface Named {                                       <i class="conum" data-value="1"></i><b>(1)</b>
    String name()
}
trait Greetable implements Named {                      <i class="conum" data-value="2"></i><b>(2)</b>
    String greeting() { "Hello, ${name()}!" }
}
class Person implements Greetable {                     <i class="conum" data-value="3"></i><b>(3)</b>
    String name() { 'Bob' }                             <i class="conum" data-value="4"></i><b>(4)</b>
}

def p = new Person()
assert p.greeting() == 'Hello, Bob!'                    <i class="conum" data-value="5"></i><b>(5)</b>
assert p instanceof Named                               <i class="conum" data-value="6"></i><b>(6)</b>
assert p instanceof Greetable                           <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declaration of a normal interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>add <code>Named</code> to the list of implemented interfaces</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>declare a class that implements the <code>Greetable</code> trait</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>implement the missing <code>greet</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the <code>greeting</code> implementation comes from the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>make sure <code>Person</code> implements the <code>Named</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>make sure <code>Person</code> implements the <code>Greetable</code> trait</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_properties">Properties</h5>
<div class="paragraph">
<p>A trait may define properties, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait Named {
    String name                             <i class="conum" data-value="1"></i><b>(1)</b>
}
class Person implements Named {}            <i class="conum" data-value="2"></i><b>(2)</b>
def p = new Person(name: 'Bob')             <i class="conum" data-value="3"></i><b>(3)</b>
assert p.name == 'Bob'                      <i class="conum" data-value="4"></i><b>(4)</b>
assert p.getName() == 'Bob'                 <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declare a property <code>name</code> inside a trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>declare a class which implements the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the property is automatically made visible</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>it can be accessed using the regular property accessor</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>or using the regular getter syntax</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_fields">Fields</h5>
<div class="sect5">
<h6 id="_private_fields">Private fields</h6>
<div class="paragraph">
<p>Since traits allow the use of private methods, it can also be interesting to use private fields to store state. Traits
will let you do that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait Counter {
    private int count = 0                   <i class="conum" data-value="1"></i><b>(1)</b>
    int count() { count += 1; count }       <i class="conum" data-value="2"></i><b>(2)</b>
}
class Foo implements Counter {}             <i class="conum" data-value="3"></i><b>(3)</b>
def f = new Foo()
assert f.count() == 1                       <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
This is a major difference with <a href="http://docs.oracle.com/javase/tutorial/java/IandI/defaultmethods.html">Java 8 virtual extension methods</a>. While virtual extension methods
do not carry state, traits can. Also interesting traits in Groovy are supported starting with Java 6, but their implementation do not rely on virtual extension methods. This
means that even if a trait can be seen from a Java class as a regular interface, this interface will <strong>not</strong> have default methods, only abstract ones.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_public_fields">Public fields</h6>
<div class="paragraph">
<p>Public fields work the same way as private fields, but in order to avoid the <a href="http://en.wikipedia.org/wiki/Multiple_inheritance#The_diamond_problem">diamond problem</a>,
field names are remapped in the implementing class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait Named {
    public String name                      <i class="conum" data-value="1"></i><b>(1)</b>
}
class Person implements Named {}            <i class="conum" data-value="2"></i><b>(2)</b>
def p = new Person()                        <i class="conum" data-value="3"></i><b>(3)</b>
p.Named__name = 'Bob'                       <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declare a public <strong>field</strong> inside the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>declare a class implementing the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>create an instance of that class</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the public field is available, but renamed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The name of the field depends on the fully qualified name of the trait. All dots (<code>.</code>) in package are replaced with an underscore (<code>_</code>), and the final name includes a double underscore.
So if the type of the field is <code>String</code>, the name of the package is <code>my.package</code>, the name of the trait is <code>Foo</code> and the name of the field is <code>bar</code>,
in the implementing class, the public field will appear as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">String my_package_Foo__bar</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
While traits support public fields, it is not recommanded to use them and considered as a bad practice.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_composition_of_behaviors">Composition of behaviors</h5>
<div class="paragraph">
<p>Traits can be used to implement multiple inheritance in a controlled way, avoiding the diamond issue. For example, we
can have the following traits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait FlyingAbility {                           <i class="conum" data-value="1"></i><b>(1)</b>
        String fly() { "I'm flying!" }          <i class="conum" data-value="2"></i><b>(2)</b>
}
trait SpeakingAbility {
    String speak() { "I'm speaking!" }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And a class implementing both traits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Duck implements FlyingAbility, SpeakingAbility {} <i class="conum" data-value="1"></i><b>(1)</b>

def d = new Duck()                                      <i class="conum" data-value="2"></i><b>(2)</b>
assert d.fly() == "I'm flying!"                         <i class="conum" data-value="3"></i><b>(3)</b>
assert d.speak() == "I'm speaking!"                     <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Duck</code> class implements both <code>FlyingAbility</code> and <code>SpeakingAbility</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>creates a new instance of <code>Duck</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>we can call the method <code>fly</code> from <code>FlyingAbility</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>but also the method <code>speak</code> from <code>SpeakingAbility</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Traits encourage the reuse of capabilities among objects, and the creation of new classes by the composition of existing behavior.</p>
</div>
</div>
<div class="sect4">
<h5 id="_overriding_default_methods">Overriding default methods</h5>
<div class="paragraph">
<p>Traits provide default implementations for methods, but it is possible to override them in the implementing class. For example, we
can slightly change the example above, by having a duck which quacks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Duck implements FlyingAbility, SpeakingAbility {
    String quack() { "Quack!" }                         <i class="conum" data-value="1"></i><b>(1)</b>
    String speak() { quack() }                          <i class="conum" data-value="2"></i><b>(2)</b>
}

def d = new Duck()
assert d.fly() == "I'm flying!"                         <i class="conum" data-value="3"></i><b>(3)</b>
assert d.quack() == "Quack!"                            <i class="conum" data-value="4"></i><b>(4)</b>
assert d.speak() == "Quack!"                            <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>define a method specific to <code>Duck</code>, named <code>quack</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>override the default implementation of <code>speak</code> so that we use <code>quack</code> instead</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the duck is still flying, from the default implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>quack</code> comes from the <code>Duck</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>speak</code> no longer uses the default implementation from <code>SpeakingAbility</code></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_extending_traits">Extending traits</h5>
<div class="sect5">
<h6 id="_simple_inheritance">Simple inheritance</h6>
<div class="paragraph">
<p>Traits may extend another trait, in which case you must use the <code>extends</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait Named {
    String name                                     <i class="conum" data-value="1"></i><b>(1)</b>
}
trait Polite extends Named {                        <i class="conum" data-value="2"></i><b>(2)</b>
    String introduce() { "Hello, I am $name" }      <i class="conum" data-value="3"></i><b>(3)</b>
}
class Person implements Polite {}
def p = new Person(name: 'Alice')                   <i class="conum" data-value="4"></i><b>(4)</b>
assert p.introduce() == 'Hello, I am Alice'         <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Named</code> trait defines a single <code>name</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>Polite</code> trait <strong>extends</strong> the <code>Named</code> trait</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>Polite</code> adds a new method which has access to the <code>name</code> property of the super-trait</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the <code>name</code> property is visible from the <code>Person</code> class implementing <code>Polite</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>as is the <code>introduce</code> method</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_multiple_inheritance">Multiple inheritance</h6>
<div class="paragraph">
<p>Alternatively, a trait may extend multiple traits. In that case, all super traits must be declared in the <code>implements</code>
clause:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait WithId {                                      <i class="conum" data-value="1"></i><b>(1)</b>
    Long id
}
trait WithName {                                    <i class="conum" data-value="2"></i><b>(2)</b>
    String name
}
trait Identified implements WithId, WithName {}     <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>WithId</code> trait defines the <code>id</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>WithName</code> trait defines the <code>name</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>Identified</code> is a trait which inherits both <code>WithId</code> and <code>WithName</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_duck_typing_and_traits">Duck typing and traits</h5>
<div class="sect5">
<h6 id="_dynamic_code">Dynamic code</h6>
<div class="paragraph">
<p>Traits can call any dynamic code, like a normal Groovy class. This means that you can, in the body of a method, call
methods which are supposed to exist in an implementing class, without having to explicitly declare them in an interface.
This means that traits are fully compatible with duck typing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait SpeakingDuck {
    String speak() { quack() }                      <i class="conum" data-value="1"></i><b>(1)</b>
}
class Duck implements SpeakingDuck {
    String methodMissing(String name, args) {
        "${name.capitalize()}!"                     <i class="conum" data-value="2"></i><b>(2)</b>
    }
}
def d = new Duck()
assert d.speak() == 'Quack!'                        <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>SpeakingDuck</code> expects the <code>quack</code> method to be defined</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>Duck</code> class does implement the method using <em>methodMissing</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>calling the <code>speak</code> method triggers a call to <code>quack</code> which is handled by <code>methodMissing</code></td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_dynamic_methods_in_a_trait">Dynamic methods in a trait</h6>
<div class="paragraph">
<p>It is also possible for a trait to implement MOP methods like <code>methodMissing</code> or <code>propertyMissing</code>, in which case implementing classes
will inherit the behavior from the trait, like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait DynamicObject {                               <i class="conum" data-value="1"></i><b>(1)</b>
    private Map props = [:]
    def methodMissing(String name, args) {
        name.toUpperCase()
    }
    def propertyMissing(String prop) {
        props['prop']
    }
    void setProperty(String prop, Object value) {
        props['prop'] = value
    }
}

class Dynamic implements DynamicObject {
    String existingProperty = 'ok'                  <i class="conum" data-value="2"></i><b>(2)</b>
    String existingMethod() { 'ok' }                <i class="conum" data-value="3"></i><b>(3)</b>
}
def d = new Dynamic()
assert d.existingProperty == 'ok'                   <i class="conum" data-value="4"></i><b>(4)</b>
assert d.foo == null                                <i class="conum" data-value="5"></i><b>(5)</b>
d.foo = 'bar'                                       <i class="conum" data-value="6"></i><b>(6)</b>
assert d.foo == 'bar'                               <i class="conum" data-value="7"></i><b>(7)</b>
assert d.existingMethod() == 'ok'                   <i class="conum" data-value="8"></i><b>(8)</b>
assert d.someMethod() == 'SOMEMETHOD'               <i class="conum" data-value="9"></i><b>(9)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a trait implementing several MOP methods</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>Dynamic</code> class defines a property</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the <code>Dynamic</code> class defines a method</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>calling an existing property will call the method from <code>Dynamic</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>calling an non-existing property will call the method from the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>will call <code>setProperty</code> defined on the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>will call <code>getProperty</code> defined on the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>calling an existing method on <code>Dynamic</code></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>but calling a non existing method thanks to the trait <code>methodMissing</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_multiple_inheritance_conflicts">Multiple inheritance conflicts</h5>
<div class="sect5">
<h6 id="_default_conflict_resolution">Default conflict resolution</h6>
<div class="paragraph">
<p>It is possible for a class to implement multiple traits. If some trait defines a method with the same signature as a
method in another trait, we have a conflict:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait A {
    String exec() { 'A' }               <i class="conum" data-value="1"></i><b>(1)</b>
}
trait B {
    String exec() { 'B' }               <i class="conum" data-value="2"></i><b>(2)</b>
}
class C implements A,B {}               <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>trait <code>A</code> defines a method named <code>exec</code> returning a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>trait <code>B</code> defines the very same method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>class <code>C</code> implements both traits</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this case, the default behavior is that methods from the <strong>last declared trait</strong> wins. Here, <code>B</code> is declared after <code>A</code>
so the method from <code>B</code> will be picked up:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def c = new C()
assert c.exec() == 'B'</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_user_conflict_resolution">User conflict resolution</h6>
<div class="paragraph">
<p>In case this behavior is not the one you want, you can explicitly choose which method to call using the <code>Trait.super.foo</code> syntax.
In the example above, we can force to choose the method from trait A, by writing this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class C implements A,B {
    String exec() { A.super.exec() }    <i class="conum" data-value="1"></i><b>(1)</b>
}
def c = new C()
assert c.exec() == 'A'                  <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>explicit call of <code>exec</code> from the trait <code>A</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>calls the version from <code>A</code> instead of using the default resolution, which would be the one from <code>B</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_runtime_implementation_of_traits">Runtime implementation of traits</h5>
<div class="sect5">
<h6 id="_implementing_a_trait_at_runtime">Implementing a trait at runtime</h6>
<div class="paragraph">
<p>Groovy also supports implementing traits dynamically at runtime. It allows you to "decorate" an existing object using a
trait. As an example, let&#8217;s start with this trait and the following class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait Extra {
    String extra() { "I'm an extra method" }            <i class="conum" data-value="1"></i><b>(1)</b>
}
class Something {                                       <i class="conum" data-value="2"></i><b>(2)</b>
    String doSomething() { 'Something' }                <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Extra</code> trait defines an <code>extra</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>Something</code> class does <strong>not</strong> implement the <code>Extra</code> trait</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>Something</code> only defines a method <code>doSomething</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then if we do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def s = new Something()
s.extra()</code></pre>
</div>
</div>
<div class="paragraph">
<p>the call to extra would fail because <code>Something</code> is not implementing <code>Extra</code>. It is possible to do it at runtime with
the following syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def s = new Something() as Extra                        <i class="conum" data-value="1"></i><b>(1)</b>
s.extra()                                               <i class="conum" data-value="2"></i><b>(2)</b>
s.doSomething()                                         <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>use of the <strong>as</strong> keyword to coerce an object to a trait <strong>at runtime</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>then <code>extra</code> can be called on the object</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and <code>doSomething</code> is still callable</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="icon-important" title="Important"></i>
</td>
<td class="content">
When coercing an object to a trait, the result of the operation is not the same instance. It is guaranteed
that the coerced object will implement both the trait <strong>and</strong> the interfaces that the original object implements, but
the result will <strong>not</strong> be an instance of the original class.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_implementing_multiple_traits_at_once">Implementing multiple traits at once</h6>
<div class="paragraph">
<p>Should you need to implement several traits at once, you can use the <code>withTraits</code> method instead of the <code>as</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait A { void methodFromA() {} }
trait B { void methodFromB() {} }

class C {}

def c = new C()
c.methodFromA()                     <i class="conum" data-value="1"></i><b>(1)</b>
c.methodFromB()                     <i class="conum" data-value="2"></i><b>(2)</b>
def d = c.withTraits A, B           <i class="conum" data-value="3"></i><b>(3)</b>
d.methodFromA()                     <i class="conum" data-value="4"></i><b>(4)</b>
d.methodFromB()                     <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>call to <code>methodFromA</code> will fail because <code>C</code> doesn&#8217;t implement <code>A</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>call to <code>methodFromB</code> will fail because <code>C</code> doesn&#8217;t implement <code>B</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>withTrait</code> will wrap <code>c</code> into something which implements <code>A</code> and <code>B</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>methodFromA</code> will now pass because <code>d</code> implements <code>A</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>methodFromB</code> will now pass because <code>d</code> also implements <code>B</code></td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="icon-important" title="Important"></i>
</td>
<td class="content">
When coercing an object to multiple traits, the result of the operation is not the same instance. It is guaranteed
that the coerced object will implement both the traits <strong>and</strong> the interfaces that the original object implements, but
the result will <strong>not</strong> be an instance of the original class.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_chaining_behavior">Chaining behavior</h5>
<div class="paragraph">
<p>Groovy supports the concept of <em>stackable traits</em>. The idea is to delegate from one trait to the other if the current trait
is not capable of handling a message. To illustrate this, let&#8217;s imagine a message handler interface like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">interface MessageHandler {
    void on(String message, Map payload)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can compose a message handler by applying small behaviors. For example, let&#8217;s define a default handler in the
form of a trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait DefaultHandler implements MessageHandler {
    void on(String message, Map payload) {
        println "Received $message with payload $payload"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then any class can inherit the behavior of the default handler by implementing the trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class SimpleHandler implements DefaultHandler {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now what if you want to log all messages, in addition to the default handler? One option is to write this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class SimpleHandlerWithLogging implements DefaultHandler {
    void on(String message, Map payload) {                                  <i class="conum" data-value="1"></i><b>(1)</b>
        println "Seeing $message with payload $payload"                     <i class="conum" data-value="2"></i><b>(2)</b>
        DefaultHandler.super.on(message, payload)                           <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>explicitly implement the <code>on</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>perform logging</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>continue by delegating to the <code>DefaultHandler</code> trait</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This works but this approach has drawbacks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the logging logic is bound to a "concrete" handler</p>
</li>
<li>
<p>we have an explicit reference to <code>DefaultHandler</code> in the <code>on</code> method, meaning that if we happen to change the trait that our class implements, code will be broken</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As an alternative, we can write another trait which responsability is limited to logging:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait LoggingHandler implements MessageHandler {                            <i class="conum" data-value="1"></i><b>(1)</b>
    void on(String message, Map payload) {
        println "Seeing $message with payload $payload"                     <i class="conum" data-value="2"></i><b>(2)</b>
        super.on(message, payload)                                          <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the logging handler is itself a handler</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>prints the message it receives</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>then <code>super</code> makes it delegate the call to the next trait in the chain</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then our class can be rewritten as this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class HandlerWithLogger implements DefaultHandler, LoggingHandler {}
def loggingHandler = new HandlerWithLogger()
loggingHandler.on('test logging', [:])</code></pre>
</div>
</div>
<div class="paragraph">
<p>which will print:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Seeing test logging with payload [:]
Received test logging with payload [:]</pre>
</div>
</div>
<div class="paragraph">
<p>As the priority rules imply that <code>LoggerHandler</code> wins because it is declared last, then a call to <code>on</code> will use
the implementation from <code>LoggingHandler</code>. But the latter has a call to <code>super</code>, which means the next trait in the
chain. Here, the next trait is <code>DefaultHandler</code> so <strong>both</strong> will be called:</p>
</div>
<div class="paragraph">
<p>The interest of this approach becomes more evident if we add a third handler, which is responsible for handling messages
that start with <code>say</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait SayHandler implements MessageHandler {
    void on(String message, Map payload) {
        if (message.startsWith("say")) {                                    <i class="conum" data-value="1"></i><b>(1)</b>
            println "I say ${message - 'say'}!"
        } else {
            super.on(message, payload)                                      <i class="conum" data-value="2"></i><b>(2)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a handler specific precondition</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>if the precondition is not meant, pass the message to the next handler in the chain</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then our final handler looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Handler implements DefaultHandler, SayHandler, LoggingHandler {}
def h = new Handler()
h.on('foo', [:])
h.on('sayHello', [:])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which means:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>messages will first go through the logging handler</p>
</li>
<li>
<p>the logging handler calls <code>super</code> which will delegate to the next handler, which is the <code>SayHandler</code></p>
</li>
<li>
<p>if the message starts with <code>say</code>, then the hanlder consumes the message</p>
</li>
<li>
<p>if not, the <code>say</code> handler delegates to the next handler in the chain</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This approach is very powerful because it allows you to write handlers that do not know each other and yet let you
combine them in the order you want. For example, if we execute the code, it will print:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Seeing foo with payload [:]
Received foo with payload [:]
Seeing sayHello with payload [:]
I say Hello!</pre>
</div>
</div>
<div class="paragraph">
<p>but if we move the logging handler to be the second one in the chain, the output is different:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class AlternateHandler implements DefaultHandler, LoggingHandler, SayHandler {}
h = new AlternateHandler()
h.on('foo', [:])
h.on('sayHello', [:])</code></pre>
</div>
</div>
<div class="paragraph">
<p>prints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Seeing foo with payload [:]
Received foo with payload [:]
I say Hello!</pre>
</div>
</div>
<div class="paragraph">
<p>The reason is that now, since the <code>SayHandler</code> consumes the message without calling <code>super</code>, the logging handler is
not called anymore.</p>
</div>
<div class="sect5">
<h6 id="_semantics_of_super_inside_a_trait">Semantics of super inside a trait</h6>
<div class="paragraph">
<p>If a class implements multiple traits and that a call to an unqualified <code>super</code> is found, then:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>if the class implements another trait, the call delegates to the next trait in the chain</p>
</li>
<li>
<p>if there isn&#8217;t any trait left in the chain, <code>super</code> refers to the super class of the implementing class (<em>this</em>)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, it is possible to decorate final classes thanks to this behavior:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait Filtering {                                       <i class="conum" data-value="1"></i><b>(1)</b>
    StringBuilder append(String str) {                  <i class="conum" data-value="2"></i><b>(2)</b>
        def subst = str.replace('o','')                 <i class="conum" data-value="3"></i><b>(3)</b>
        super.append(subst)                             <i class="conum" data-value="4"></i><b>(4)</b>
    }
    String toString() { super.toString() }              <i class="conum" data-value="5"></i><b>(5)</b>
}
def sb = new StringBuilder().withTraits Filtering       <i class="conum" data-value="6"></i><b>(6)</b>
sb.append('Groovy')
assert sb.toString() == 'Grvy'                          <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>define a trait named <code>Filtering</code>, supposed to be applied on a <code>StringBuilder</code> at runtime</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>redefine the <code>append</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>remove all 'o&#8217;s from the string</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>then delegate to <code>super</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>in case <code>toString</code> is called, delegate to <code>super.toString</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>runtime implementation of the <code>Filtering</code> trait on a <code>StringBuilder</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>the string which has been appended no longer contains the letter <code>o</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this example, when <code>super.append</code> is encountered, there is no other trait implemented by the target object, so the
method which is called is the original <code>append</code> method, that is to say the one from <code>StringBuilder</code>. The same trick
is used for <code>toString</code>, so that the string representation of the proxy object which is generated delegates to the
<code>toString</code> of the <code>StringBuilder</code> instance.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_advanced_features">Advanced features</h5>
<div class="sect5">
<h6 id="_sam_type_coercion">SAM type coercion</h6>
<div class="paragraph">
<p>If a trait defines a single abstract method, it is candidate for SAM type coercion. For example, imagine the following
trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait Greeter {
    String greet() { "Hello $name" }        <i class="conum" data-value="1"></i><b>(1)</b>
    abstract String getName()               <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>greet</code> method is not abstract and calls the abstract method <code>getName</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>getName</code> is an abstract method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since <code>getName</code> is the <em>single abstract method</em> in the <code>Greeter</code> trait, you can write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Greeter greeter = { 'Alice' }               <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the closure "becomes" the implementation of the <code>getName</code> single abstract method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>or even:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">void greet(Greeter g) { println g.greet() } <i class="conum" data-value="1"></i><b>(1)</b>
greet { 'Alice' }                           <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the greet method accepts the SAM type Greeter as parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we can call it directly with a closure</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_differences_with_java_8_default_methods">Differences with Java 8 default methods</h6>
<div class="paragraph">
<p>In Java 8, interfaces can have default implementations of methods. If a class implements an interface and does not provide
an implementation for a default method, then the implementation from the interface is chosen. Traits behave the same but
with a major difference: the implementation from the trait is <strong>always</strong> used if the class declares the trait in its interface
list <strong>and</strong> that it doesn&#8217;t provide an implementation.</p>
</div>
<div class="paragraph">
<p>This feature can be used to compose behaviors in an very precise way, in case you want to override the behavior of an
already implemented method.</p>
</div>
<div class="paragraph">
<p>To illustrate the concept, let&#8217;s start with this simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.CompileStatic
import org.codehaus.groovy.control.CompilerConfiguration
import org.codehaus.groovy.control.customizers.ASTTransformationCustomizer
import org.codehaus.groovy.control.customizers.ImportCustomizer

class SomeTest extends GroovyTestCase {
    def config
    def shell

    void setup() {
        config = new CompilerConfiguration()
        shell = new GroovyShell(config)
    }
    void testSomething() {
        assert shell.evaluate('1+1') == 2
    }
    void otherTest() { /* ... */ }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we create a simple test case which uses two properties (<em>config</em> and <em>shell</em>) and uses those in
multiple test methods. Now imagine that you want to test the same, but with another distinct compiler configuration.
One option is to create a subclass of <code>SomeTest</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class AnotherTest extends SomeTest {
    void setup() {
        config = new CompilerConfiguration()
        config.addCompilationCustomizers( ... )
        shell = new GroovyShell(config)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It works, but what if you have actually multiple test classes, and that you want to test the new configuration for all
those test classes? Then you would have to create a distinct subclass for each test class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class YetAnotherTest extends SomeTest {
    void setup() {
        config = new CompilerConfiguration()
        config.addCompilationCustomizers( ... )
        shell = new GroovyShell(config)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then what you see is that the <code>setup</code> method of both tests is the same. The idea, then, is to create a trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait MyTestSupport {
    void setup() {
        config = new CompilerConfiguration()
        config.addCompilationCustomizers( new ASTTransformationCustomizer(CompileStatic) )
        shell = new GroovyShell(config)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then use it in the subclasses:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class AnotherTest extends SomeTest implements MyTestSupport {}
class YetAnotherTest extends SomeTest2 implements MyTestSupport {}
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>It would allow us to dramatically reduce the boilerplate code, and reduces the risk of forgetting to change the setup
code in case we decide to change it. Even if <code>setup</code> is already implemented in the super class, since the test class declares
the trait in its interface list, the behavior will be borrowed from the trait implementation!</p>
</div>
<div class="paragraph">
<p>This feature is in particular useful when you don&#8217;t have access to the super class source code. It can be used to
mock methods or force a particular implementation of a method in a subclass. It lets you refactor your code to keep
the overriden logic in a single trait and inherit a new behavior just by implementing it. The alternative, of course,
is to override the method in <strong>every</strong> place you would have used the new code.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="icon-important" title="Important"></i>
</td>
<td class="content">
It&#8217;s worth noting that if you use runtime traits, the methods from the trait are <strong>always</strong> preferred to those of the proxied
object:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Person {
    String name                                         <i class="conum" data-value="1"></i><b>(1)</b>
}
trait Bob {
    String getName() { 'Bob' }                          <i class="conum" data-value="2"></i><b>(2)</b>
}

def p = new Person(name: 'Alice')
assert p.name == 'Alice'                                <i class="conum" data-value="3"></i><b>(3)</b>
def p2 = p as Bob                                       <i class="conum" data-value="4"></i><b>(4)</b>
assert p2.name == 'Bob'                                 <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Person</code> class defines a <code>name</code> property which results in a <code>getName</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>Bob</code> is a trait which defines <code>getName</code> as returning <code>Bob</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the default object will return <em>Alice</em></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>p2</code> coerces <code>p</code> into <code>Bob</code> at runtime</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>getName</code> returns <em>Bob</em> because <code>getName</code> is taken from the <strong>trait</strong></td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="icon-important" title="Important"></i>
</td>
<td class="content">
Again, don&#8217;t forget that dynamic trait coercion returns a distinct object which only implements the original
interfaces, as well as the traits.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_differences_with_mixins">Differences with mixins</h5>
<div class="paragraph">
<p>There are several conceptual differences with mixins, as they are available in Groovy. Note that we are talking about
runtime mixins, not the @Mixin annotation which is deprecated in favour of traits.</p>
</div>
<div class="paragraph">
<p>First of all, methods defined in a trait are visible in bytecode:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>internally, the trait is represented as an interface (without default methods) and several helper classes</p>
</li>
<li>
<p>this means that an object implementing a trait effectively implements an <em>interface</em></p>
</li>
<li>
<p>those methods are visible from Java</p>
</li>
<li>
<p>they are compatible with type checking and static compilation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Methods added through a mixin are, on the contrary, only visible at runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class A { String methodFromA() { 'A' } }        <i class="conum" data-value="1"></i><b>(1)</b>
class B { String methodFromB() { 'B' } }        <i class="conum" data-value="2"></i><b>(2)</b>
A.metaClass.mixin B                             <i class="conum" data-value="3"></i><b>(3)</b>
def o = new A()
assert o.methodFromA() == 'A'                   <i class="conum" data-value="4"></i><b>(4)</b>
assert o.methodFromB() == 'B'                   <i class="conum" data-value="5"></i><b>(5)</b>
assert o instanceof A                           <i class="conum" data-value="6"></i><b>(6)</b>
assert !(o instanceof B)                        <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>class <code>A</code> defines <code>methodFromA</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>class <code>B</code> defines <code>methodFromB</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>mixin B into A</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>we can call <code>methodFromA</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>we can also call <code>methodFromB</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>the object is an instance of <code>A</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>but it&#8217;s <strong>not</strong> an instanceof <code>B</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The last point is actually a very important and illustrates a place where mixins have an advantage over traits: the instances
are <strong>not</strong> modified, so if you mixin some class into another, there isn&#8217;t a third class generated, and methods which respond to
A will continue responding to A even if mixed in.</p>
</div>
</div>
<div class="sect4">
<h5 id="_static_methods_properties_and_fields">Static methods, properties and fields</h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
The following instructions are subject to caution. Static member support is work in progress and still experimental. The
information below is valid for 2.4.0-SNAPSHOT only.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible to define static methods in a trait, but it comes with numerous limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>traits with static methods cannot be compiled statically or type checked. All static methods/properties/field are accessed dynamically (it&#8217;s a limitation from the JVM).</p>
</li>
<li>
<p>the trait is interpreted as a <em>template</em> for the implementing class, which means that each implementing class will get its own static methods/properties/methods. So a
static member declared on a trait doesn&#8217;t belong to the <code>Trait</code>, but to it&#8217;s implementing class.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s start with a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait TestHelper {
    public static boolean CALLED = false        <i class="conum" data-value="1"></i><b>(1)</b>
    static void init() {                        <i class="conum" data-value="2"></i><b>(2)</b>
        CALLED = true                           <i class="conum" data-value="3"></i><b>(3)</b>
    }
}
class Foo implements TestHelper {}
Foo.init()                                      <i class="conum" data-value="4"></i><b>(4)</b>
assert Foo.TestHelper__CALLED                   <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the static field is declared in the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>a static method is also declared in the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the static field is updated <em>within</em> the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>a static method <em>init</em> is made available to the implementing class</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the static field is <em>remapped</em> to avoid the diamond issue</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As usual, it is not recommanded to use public fields. Anyway, should you want this, you must understand that the following code would fail:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Foo.CALLED = true</code></pre>
</div>
</div>
<div class="paragraph">
<p>because there is <em>no</em> static field <em>CALLED</em> defined on the trait itself. Likewise, if you have two distinct implementing classes, each one gets a distinct static field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Bar implements TestHelper {}              <i class="conum" data-value="1"></i><b>(1)</b>
class Baz implements TestHelper {}              <i class="conum" data-value="2"></i><b>(2)</b>
Bar.init()                                      <i class="conum" data-value="3"></i><b>(3)</b>
assert Bar.TestHelper__CALLED                   <i class="conum" data-value="4"></i><b>(4)</b>
assert !Baz.TestHelper__CALLED                  <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>class <code>Bar</code> implements the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>class <code>Baz</code> also implements the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>init</code> is only called on <code>Bar</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the static field <code>CALLED</code> on <code>Bar</code> is updated</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>but the static field <code>CALLED</code> on <code>Baz</code> is not, because it is <strong>distinct</strong></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_inheritance_of_state_gotchas">Inheritance of state gotchas</h5>
<div class="paragraph">
<p>We have seen that traits are stateful. It is possible for a trait to define fields or properties, but when a class implements a trait, it gets those fields/properties on
a per-trait basis. So consider the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait IntCouple {
    int x = 1
    int y = 2
    int sum() { x+y }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The trait defines two properties, <code>x</code> and <code>y</code>, as well as a <code>sum</code> method. Now let&#8217;s create a class which implements the trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class BaseElem implements IntCouple {
    int f() { sum() }
}
def base = new BaseElem()
assert base.f() == 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result of calling <code>f</code> is <code>3</code>, because <code>f</code> delegates to <code>sum</code> in the trait, which has state. But what if we write this instead?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Elem implements IntCouple {
    int x = 3                                       <i class="conum" data-value="1"></i><b>(1)</b>
    int y = 4                                       <i class="conum" data-value="2"></i><b>(2)</b>
    int f() { sum() }                               <i class="conum" data-value="3"></i><b>(3)</b>
}
def elem = new Elem()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Override property <code>x</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Override property <code>y</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call <code>sum</code> from trait</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you call <code>elem.f()</code>, what is the expected output? Actually it is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert elem.f() == 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The reason is that the <code>sum</code> method accesses the <em>fields</em> of the trait. So it is using the <code>x</code> and <code>y</code> values defined
in the trait. If you want to use the values from the implementing class, then you need to derefencence fields by using
getters and setters, like in this last example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait IntCouple {
    int x = 1
    int y = 2
    int sum() { getX()+getY() }
}

class Elem implements IntCouple {
    int x = 3
    int y = 4
    int f() { sum() }
}
def elem = new Elem()
assert elem.f() == 7</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_limitations">Limitations</h5>
<div class="sect5">
<h6 id="_compatibility_with_ast_transformations">Compatibility with AST transformations</h6>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="icon-caution" title="Caution"></i>
</td>
<td class="content">
Traits are not officially compatible with AST transformations. Some of them, like <code>@CompileStatic</code> will be applied
on the trait itself (not on implementing classes), while others will apply on both the implementing class and the trait.
There is absolutely no guarantee that an AST transformation will run on a trait as it does on a regular class, so use it
at your own risk!
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_prefix_and_postfix_operations">Prefix and postfix operations</h6>
<div class="paragraph">
<p>Within traits, prefix and postfix operations are not allowed if they update a field of the trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">trait Counting {
    int x
    void inc() {
        x++                             <i class="conum" data-value="1"></i><b>(1)</b>
    }
    void dec() {
        --x                             <i class="conum" data-value="2"></i><b>(2)</b>
    }
}
class Counter implements Counting {}
def c = new Counter()
c.inc()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>x</code> is defined within the trait, postfix increment is not allowed</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>x</code> is defined within the trait, prefix decrement is not allowed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A workaround is to use the <code>+=</code> operator instead.
:leveloffset: 0</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_closures_tbd">1.4.3. Closures (TBD)</h4>
<div class="paragraph">
<p>This chapter covers Groovy Closures.</p>
</div>
<div class="sect4">
<h5 id="_syntax_tbd">Syntax (TBD)</h5>

</div>
<div class="sect4">
<h5 id="_parameters_tbd">Parameters (TBD)</h5>
<div class="sect5">
<h6 id="_normal_parameters_tbd">Normal parameters (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_implicit_parameter_tbd">Implicit parameter (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_default_parameter_tbd">Default parameter (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_varargs_tbd_2">Varargs (TBD)</h6>

</div>
</div>
<div class="sect4">
<h5 id="_delegation_strategy_tbd">Delegation strategy (TBD)</h5>

</div>
<div class="sect4">
<h5 id="_closures_in_gstrings_tbd">Closures in GStrings (TBD)</h5>

</div>
<div class="sect4">
<h5 id="_functional_programming_tbd">Functional programming (TBD)</h5>
<div class="sect5">
<h6 id="_currying_tbd">Currying (TBD)</h6>
<div class="sect6">
<h7 id="_left_currying_tbd">Left currying (TBD)</h7>

</div>
<div class="sect6">
<h7 id="_right_currying_tbd">Right currying (TBD)</h7>

</div>
<div class="sect6">
<h7 id="_index_based_currying_tbd">Index based currying (TBD)</h7>

</div>
</div>
<div class="sect5">
<h6 id="_memoization_tbd">Memoization (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_composition_tbd">Composition (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_trampoline_tbd">Trampoline (TBD)</h6>

</div>
</div>
</div>
<div class="sect3">
<h4 id="_semantics">1.4.4. Semantics</h4>
<div class="paragraph">
<p>This chapter covers the semantics of the Groovy programming language.</p>
</div>
<div class="sect4">
<h5 id="_statements">Statements</h5>
<div class="sect5">
<h6 id="_variable_definition">Variable definition</h6>
<div class="paragraph">
<p>Variables can be defined using either their type (like <code>String</code>) or by using the keyword <code>def</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">String x
def o</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>def</code> is a replacement for a type name. In variable definitions it is used to indicate that you don&#8217;t care about the type. In variable definitions it is mandatory to either provide a type name explicitly or to use "def" in replacement. This is needed to the make variable definitions detectable for the Groovy parser.</p>
</div>
<div class="paragraph">
<p>You can think of <code>def</code> as an alias of <code>Object</code> and you will understand it in an instant.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Variable definition types can be refined by using generics, like in <code>List&lt;String&gt; names</code>.
To learn more about the generics support, please read the <a href="#generics">generics section</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_variable_assignment">Variable assignment</h6>
<div class="paragraph">
<p>You can assign values to variables for later use. Try the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">x = 1
println x

x = new java.util.Date()
println x

x = -3.1499392
println x

x = false
println x

x = "Hi"
println x</code></pre>
</div>
</div>
<div class="sect6">
<h7 id="_multiple_assignment">Multiple assignment</h7>
<div class="paragraph">
<p>Groovy supports multiple assignment, i.e. where multiple variables can be assigned at once, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def (a, b, c) = [10, 20, 'foo']
assert a == 10 &amp;&amp; b == 20 &amp;&amp; c == 'foo'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can provide types as part of the declaration if you wish:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def (int i, String j) = [10, 'foo']
assert i == 10 &amp;&amp; j == 'foo'</code></pre>
</div>
</div>
<div class="paragraph">
<p>As well as used when declaring variables it also applies to existing variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def nums = [1, 3, 5]
def a, b, c
(a, b, c) = nums
assert a == 1 &amp;&amp; b == 3 &amp;&amp; c == 5</code></pre>
</div>
</div>
<div class="paragraph">
<p>The syntax works for arrays as well as lists, as well as methods that return either of these:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def (_, month, year) = "18th June 2009".split()
assert "In $month of $year" == 'In June of 2009'</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_overflow_and_underflow">Overflow and Underflow</h7>
<div class="paragraph">
<p>If the left hand side has too many variables, excess ones are filled with null&#8217;s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def (a, b, c) = [1, 2]
assert a == 1 &amp;&amp; b == 2 &amp;&amp; c == null</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the right hand side has too many variables, the extra ones are ignored:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def (a, b) = [1, 2, 3]
assert a == 1 &amp;&amp; b == 2</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_object_destructuring_with_multiple_assignment">Object destructuring with multiple assignment</h7>
<div class="paragraph">
<p>In the section describing the various <a href="#groovy-operators">Groovy operators</a>,
the case of the <a href="#subscript-operator">subscript operator</a> has been covered,
explaining how you can override the <code>getAt()</code>/<code>putAt()</code> method.</p>
</div>
<div class="paragraph">
<p>With this technique, we can combine multiple assignments and the subscript operator methods to implement <em>object destructuring</em>.</p>
</div>
<div class="paragraph">
<p>Consider the following immutable <code>Coordinates</code> class, containing a pair of longitude and latitude doubles,
and notice our implementation of the <code>getAt()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Immutable
class Coordinates {
    double latitude
    double longitude

    double getAt(int idx) {
        if (idx == 0) latitude
        else if (idx == 1) longitude
        else throw new Exception("Wrong coordinate index, use 0 or 1")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s instantiate this class and destructure its longitude and latitude:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def coordinates = new Coordinates(latitude: 43.23, longitude: 3.67) <i class="conum" data-value="1"></i><b>(1)</b>

def (la, lo) = coordinates                                          <i class="conum" data-value="2"></i><b>(2)</b>

assert la == 43.23                                                  <i class="conum" data-value="3"></i><b>(3)</b>
assert lo == 3.67</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>we create an instance of the <code>Coordinates</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>then, we use a multiple assignment to get the individual longitude and latitude values</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and we can finally assert their values.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_control_structures_wip">Control structures (WIP)</h6>
<div class="sect6">
<h7 id="_conditional_structures">Conditional structures</h7>
<div class="sect7">
<h8 id="_if_else">if / else</h8>
<div class="paragraph">
<p>Groovy supports the usual if - else syntax from Java</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def x = false
def y = false

if ( !x ) {
    x = true
}

assert x == true

if ( x ) {
    x = false
} else {
    y = true
}

assert x == y</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy also supports the normal Java "nested" if then else if syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">if ( ... ) {
    ...
} else if (...) {
    ...
} else {
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect7">
<h8 id="_switch_case">switch / case</h8>
<div class="paragraph">
<p>The switch statement in Groovy is backwards compatible with Java code; so you can fall through cases sharing the same code for multiple matches.</p>
</div>
<div class="paragraph">
<p>One difference though is that the Groovy switch statement can handle any kind of switch value and different kinds of matching can be performed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def x = 1.23
def result = ""

switch ( x ) {
    case "foo":
        result = "found foo"
        // lets fall through

    case "bar":
        result += "bar"

    case [4, 5, 6, 'inList']:
        result = "list"
        break

    case 12..30:
        result = "range"
        break

    case Integer:
        result = "integer"
        break

    case Number:
        result = "number"
        break

    case ~/fo*/: // toString() representation of x matches the pattern?
        result = "foo regex"
        break

    case { it &lt; 0 }: // or { x &lt; 0 }
        result = "negative"
        break

    default:
        result = "default"
}

assert result == "number"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Switch supports the following kinds of comparisons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Class case values matches if the switch value is an instance of the class</p>
</li>
<li>
<p>Regular expression case values match if the <code>toString()</code> representation of the switch value matches the regex</p>
</li>
<li>
<p>Collection case values match if the switch value is contained in the collection. This also includes ranges (since they are Lists)</p>
</li>
<li>
<p>Closure case values match if the calling the closure returns a result which is true according to the <a href="#Groovy-Truth">Groovy truth</a></p>
</li>
<li>
<p>If none of the above are used then the case value matches if the case value equals the switch value</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<code>default</code> must go at the end of the switch/case. While in Java the default can be placed anywhere in the switch/case, the default in Groovy is used more as an else than assigning a default case.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
when using a closure case value, the default <code>it</code> parameter is actually the switch value (in our example, variable <code>x</code>)
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_looping_structures">Looping structures</h7>
<div class="sect7">
<h8 id="_classic_for_loop">Classic for loop</h8>
<div class="paragraph">
<p>Groovy supports the standard Java / C for loop:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">String message = ''
for (int i = 0; i &lt; 5; i++) {
    message += 'Hi '
}
assert message == 'Hi Hi Hi Hi Hi '</code></pre>
</div>
</div>
</div>
<div class="sect7">
<h8 id="_for_in_loop">for in loop</h8>
<div class="paragraph">
<p>The for loop in Groovy is much simpler and works with any kind of array, collection, Map, etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">// iterate over a range
def x = 0
for ( i in 0..9 ) {
    x += i
}
assert x == 45

// iterate over a list
x = 0
for ( i in [0, 1, 2, 3, 4] ) {
    x += i
}
assert x == 10

// iterate over an array
def array = (0..4).toArray()
x = 0
for ( i in array ) {
    x += i
}
assert x == 10

// iterate over a map
def map = ['abc':1, 'def':2, 'xyz':3]
x = 0
for ( e in map ) {
    x += e.value
}
assert x == 6

// iterate over values in a map
x = 0
for ( v in map.values() ) {
    x += v
}
assert x == 6

// iterate over the characters in a string
def text = "abc"
def list = []
for (c in text) {
    list.add(c)
}
assert list == ["a", "b", "c"]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Groovy also supports the Java colon variation with colons: <code>for (char c : text) {}</code>,
where the type of the variable is mandatory.
</td>
</tr>
</table>
</div>
</div>
<div class="sect7">
<h8 id="_while_loop">while loop</h8>
<div class="paragraph">
<p>Groovy supports the usual while {&#8230;} loops like Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def x = 0
def y = 5

while ( y-- &gt; 0 ) {
    x++
}

assert x == 5</code></pre>
</div>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_exception_handling">Exception handling</h7>
<div class="paragraph">
<p>Exception handling is the same as Java.</p>
</div>
</div>
<div class="sect6">
<h7 id="_try_catch_finally">try / catch / finally</h7>
<div class="paragraph">
<p>You can specify a complete <code>try-catch-finally</code>, a <code>try-catch</code>, or a <code>try-finally</code> set of blocks.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Braces are required around each block&#8217;s body.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">try {
    'moo'.toLong()   // this will generate an exception
    assert false     // asserting that this point should never be reached
} catch ( e ) {
    assert e in NumberFormatException
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can put code within a <em>finally</em> clause following a matching <em>try</em> clause, so that regardless of whether the code in the <em>try</em> clause throws an exception, the code in the finally clause will always execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def z
try {
    def i = 7, j = 0
    try {
        def k = i / j
        assert false        //never reached due to Exception in previous line
    } finally {
        z = 'reached here'  //always executed even if Exception thrown
    }
} catch ( e ) {
    assert e in ArithmeticException
    assert z == 'reached here'
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_multi_catch">Multi-catch</h7>
<div class="paragraph">
<p>With the multi catch block (since Groovy 2.0), we&#8217;re able to define several exceptions to be catch and treated by the same catch block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">try {
    /* ... */
} catch ( IOException | NullPointerException e ) {
    /* one block to handle 2 exceptions */
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_power_assertion_tbd">Power assertion (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_labeled_statements_tbd">Labeled statements (TBD)</h6>

</div>
</div>
<div class="sect4">
<h5 id="_expressions_tbd">Expressions (TBD)</h5>
<div class="sect5">
<h6 id="_gpath_expressions_tbd">GPath expressions (TBD)</h6>

</div>
</div>
<div class="sect4">
<h5 id="_promotion_and_coercion_tbd">Promotion and coercion (TBD)</h5>
<div class="sect5">
<h6 id="_number_promotion_tbd">Number promotion (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_closure_to_type_coercion">Closure to type coercion</h6>
<div class="sect6">
<h7 id="_assigning_a_closure_to_a_sam_type">Assigning a closure to a SAM type</h7>
<div class="paragraph">
<p>A SAM type is a type which defines a single abstract method. This includes:</p>
</div>
<div class="listingblock">
<div class="title">Functional interfaces</div>
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">interface Predicate&lt;T&gt; {
    boolean accept(T obj)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Abstract classes with single abstract method</div>
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">abstract class Greeter {
    abstract String getName()
    void greet() {
        println "Hello, $name"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any closure can be converted into a SAM type using the <code>as</code> operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Predicate filter = { it.contains 'G' } as Predicate
assert filter.accept('Groovy') == true

Greeter greeter = { 'Groovy' } as Greeter
greeter.greet()</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, the <code>as Type</code> expression is optional since Groovy 2.2.0. You can omit it and simply write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Predicate filter = { it.contains 'G' }
assert filter.accept('Groovy') == true

Greeter greeter = { 'Groovy' }
greeter.greet()</code></pre>
</div>
</div>
<div class="paragraph">
<p>which means you are also allowed to use method pointers, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">boolean doFilter(String s) { s.contains('G') }

Predicate filter = this.&amp;doFilter
assert filter.accept('Groovy') == true

Greeter greeter = GroovySystem.&amp;getVersion
greeter.greet()</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_calling_a_method_accepting_a_sam_type_with_a_closure">Calling a method accepting a SAM type with a closure</h7>
<div class="paragraph">
<p>The second and probably more important use case for closure to SAM type coercion is calling a method which accepts
a SAM type. Imagine the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">public &lt;T&gt; List&lt;T&gt; filter(List&lt;T&gt; source, Predicate&lt;T&gt; predicate) {
    source.findAll { predicate.accept(it) }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can call it with a closure, without having to create an explicit implementation of the interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert filter(['Java','Groovy'], { it.contains 'G'} as Predicate) == ['Groovy']</code></pre>
</div>
</div>
<div class="paragraph">
<p>But since Groovy 2.2.0, you are also able to omit the explicit coercion and call the method as if it used a closure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert filter(['Java','Groovy']) { it.contains 'G'} == ['Groovy']</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, this has the advantage of letting you use the closure syntax for method calls, that is to say put the
closure outside of the parenthesis, improving the readability of your code.</p>
</div>
</div>
<div class="sect6">
<h7 id="_closure_to_arbitrary_type_coercion">Closure to arbitrary type coercion</h7>
<div class="paragraph">
<p>In addition to SAM types, a closure can be coerced to any type and in particular interfaces. Let&#8217;s define the
following interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">interface FooBar {
    int foo()
    void bar()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can coerce a closure into the interface using the <code>as</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def impl = { println 'ok'; 123 } as FooBar</code></pre>
</div>
</div>
<div class="paragraph">
<p>This produces a class for which all methods are implemented using the closure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert impl.foo() == 123
impl.bar()</code></pre>
</div>
</div>
<div class="paragraph">
<p>But it is also possible to coerce a closure to any class. For example, we can replace the <code>interface</code> that we defined
with <code>class</code> without changing the assertions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class FooBar {
    int foo() { 1 }
    void bar() { println 'bar' }
}

def impl = { println 'ok'; 123 } as FooBar

assert impl.foo() == 123
impl.bar()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_map_to_type_coercion">Map to type coercion</h6>
<div class="paragraph">
<p>Usually using a single closure to implement an interface or a class with multiple methods is not the way to go. As an
alternative, Groovy allows you to coerce a map into an interface or a class. In that case, keys of the map are
interpreted as method names, while the values are the method implementation. The following example illustrates the
coercion of a map into an <code>Iterator</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def map
map = [
  i: 10,
  hasNext: { map.i &gt; 0 },
  next: { map.i-- },
]
def iter = map as Iterator</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course this is a rather contrived example, but illustrates the concept. You only need to implement those methods
that are actually called, but if a method is called that doesn&#8217;t exist in the map a <code>MissingMethodException</code> or an
<code>UnsupportedOperationException</code> is thrown, depending on the arguments passed to the call,
as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">interface X {
    void f()
    void g(int n)
    void h(String s, int n)
}

x = [ f: {println "f called"} ] as X
x.f() // method exists
x.g() // MissingMethodException here
x.g(5) // UnsupportedOperationException here</code></pre>
</div>
</div>
<div class="paragraph">
<p>The type of the exception depends on the call itself:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MissingMethodException</code> if the arguments of the call do not match those from the interface/class</p>
</li>
<li>
<p><code>UnsupportedOperationException</code> if the arguments of the call match one of the overloaded methods of the interface/class</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_string_to_enum_coercion">String to enum coercion</h6>
<div class="paragraph">
<p>Groovy allows transparent <code>String</code> (or <code>GString</code>) to enum values coercion. Imagine you define the following enum:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">enum State {
    up,
    down
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>then you can assign a string to the enum without having to use an explicit <code>as</code> coercion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">State st = 'up'
assert st == State.up</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to use a <code>GString</code> as the value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def val = "up"
State st = "${val}"
assert st == State.up</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, this would throw a runtime error (<code>IllegalArgumentException</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">State st = 'not an enum value'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that it is also possible to use implicit coercion in switch statements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">State switchState(State st) {
    switch (st) {
        case 'up':
            return State.down // explicit constant
        case 'down':
            return 'up' // implicit coercion for return types
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>in particular, see how the <code>case</code> use string constants. But if you call a method that uses an enum with a <code>String</code>
argument, you still have to use an explicit <code>as</code> coercion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert switchState('up' as State) == State.down
assert switchState(State.down) == State.up</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_custom_type_coercion">Custom type coercion</h6>
<div class="paragraph">
<p>It is possible for a class to define custom coercion strategies by implementing the <code>asType</code> method. Custom coercion
is invoked using the <code>as</code> operator and is never implicit. As an example,
imagine you defined two classes, <code>Polar</code> and <code>Cartesian</code>, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Polar {
    double r
    double phi
}
class Cartesian {
   double x
   double y
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And that you want to convert from polar coordinates to cartesian coordinates. One way of doing this is to define
the <code>asType</code> method in the <code>Polar</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def asType(Class target) {
    if (Cartesian==target) {
        return new Cartesian(x: r*cos(phi), y: r*sin(phi))
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>which allows you to use the <code>as</code> coercion operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def sigma = 1E-16
def polar = new Polar(r:1.0,phi:PI/2)
def cartesian = polar as Cartesian
assert abs(cartesian.x-sigma) &lt; sigma</code></pre>
</div>
</div>
<div class="paragraph">
<p>Putting it all together, the <code>Polar</code> class looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Polar {
    double r
    double phi
    def asType(Class target) {
        if (Cartesian==target) {
            return new Cartesian(x: r*cos(phi), y: r*sin(phi))
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>but it is also possible to define <code>asType</code> outside of the <code>Polar</code> class, which can be practical if you want to define
custom coercion strategies for "closed" classes or classes for which you don&#8217;t own the source code, for example using
a metaclass:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Polar.metaClass.asType = { Class target -&gt;
    if (Cartesian==target) {
        return new Cartesian(x: r*cos(phi), y: r*sin(phi))
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_class_literals_vs_variables_and_the_as_operator">Class literals vs variables and the as operator</h6>
<div class="paragraph">
<p>Using the <code>as</code> keyword is only possible if you have a static reference to a class, like in the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">interface Greeter {
    void greet()
}
def greeter = { println 'Hello, Groovy!' } as Greeter // Greeter is known statically
greeter.greet()</code></pre>
</div>
</div>
<div class="paragraph">
<p>But what if you get the class by reflection, for example by calling <code>Class.forName</code>?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Class clazz = Class.forName('Greeter')</code></pre>
</div>
</div>
<div class="paragraph">
<p>Trying to use the reference to the class with the <code>as</code> keyword would fail:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">greeter = { println 'Hello, Groovy!' } as clazz
// throws:
// unable to resolve class clazz
// @ line 9, column 40.
//   greeter = { println 'Hello, Groovy!' } as clazz</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is failing because the <code>as</code> keyword only works with class literals. Instead, you need to call the <code>asType</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">greeter = { println 'Hello, Groovy!' }.asType(clazz)
greeter.greet()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_optionality_tbd">Optionality (TBD)</h5>
<div class="sect5">
<h6 id="_optional_parentheses_tbd">Optional parentheses (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_optional_semicolons_tbd">Optional semicolons (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_optional_return_keyword_tbd">Optional return keyword (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_optional_public_keyword_tbd">Optional public keyword (TBD)</h6>

</div>
</div>
<div class="sect4">
<h5 id="Groovy-Truth">The Groovy Truth (TBD)</h5>
<div class="sect5">
<h6 id="_customizing_the_truth_with_asboolean_methods_tbd">Customizing the truth with asBoolean() methods (TBD)</h6>

</div>
</div>
<div class="sect4">
<h5 id="_typing_wip">Typing (WIP)</h5>
<div class="sect5">
<h6 id="_optional_typing">Optional typing</h6>
<div class="paragraph">
<p>Optional typing is the idea that a program can work even if you don&#8217;t put an explicit type on a variable. Being a dynamic
language, Groovy naturally implements that feature, for example when you declare a variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">String aString = 'foo'                      <i class="conum" data-value="1"></i><b>(1)</b>
assert aString.toUpperCase()                <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>foo</code> is declared using an explicit type, <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we can call the <code>toUpperCase</code> method on a <code>String</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Groovy will let you write this instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def aString = 'foo'                         <i class="conum" data-value="1"></i><b>(1)</b>
assert aString.toUpperCase()                <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>foo</code> is declared using <code>def</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we can still call the <code>toUpperCase</code> method, because the type of <code>aString</code> is resolved at runtime</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So it doesn&#8217;t matter that you use an explicit type here. It is in particular interesting when you combine this feature
with <a href="#typechecking">static type checking</a>, because the type checker performs type inference.</p>
</div>
<div class="paragraph">
<p>Likewise, Groovy doesn&#8217;t make it mandatory to declare the types of a parameter in a method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">String concat(String a, String b) {
    a+b
}
assert concat('foo','bar') == 'foobar'</code></pre>
</div>
</div>
<div class="paragraph">
<p>can be rewritten using <code>def</code> as both return type and parameter types, in order to take advantage of duck typing, as
illustrated in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def concat(def a, def b) {                              <i class="conum" data-value="1"></i><b>(1)</b>
    a+b
}
assert concat('foo','bar') == 'foobar'                  <i class="conum" data-value="2"></i><b>(2)</b>
assert concat(1,2) == 3                                 <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>both the return type and the parameter types use <code>def</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>it makes it possible to use the method with <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>but also with <code>int`s since the `plus</code> method is defined</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Using the <code>def</code> keyword here is recommanded to describe the intent of a method which is supposed to work on any
type, but technically, we could use <code>Object</code> instead and the result would be the same: <code>def</code> is, in Groovy, strictly
equivalent to using <code>Object</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Eventually, the type can be removed altogether from both the return type and the descriptor. But if you want to remove
it from the return type, you then need to add an explicit modifier for the method, so that the compiler can make a difference
between a method declaration and a method call, like illustrated in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">private concat(a,b) {                                   <i class="conum" data-value="1"></i><b>(1)</b>
    a+b
}
assert concat('foo','bar') == 'foobar'                  <i class="conum" data-value="2"></i><b>(2)</b>
assert concat(1,2) == 3                                 <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>if we want to omit the return type, an explicit modifier has to be set.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>it is still possible to use the method with <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and also with `int`s</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Omitting types is in general considered a bad practice in method parameters or method return types for public APIs.
While using <code>def</code> in a local variable is not really a problem because the visibility of the variable is limited to the
method itself, while set on a method parameter, <code>def</code> will be converted to <code>Object</code> in the method signature, making it
difficult for users to know which is the expected type of the arguments. This means that you should limit this to cases
where you are explicitly relying on duck typing.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="static-type-checking">Static type checking</h6>
<div class="paragraph">
<p>By default, Groovy performs minimal type checking at compile time. Since it is primarily a dynamic language,
most checks that a static compiler would normally do aren&#8217;t possible at compile time. A method added via runtime
metaprogramming might alter a class or object&#8217;s runtime behavior. Let&#8217;s illustrate why in the
following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Person {                                                          <i class="conum" data-value="1"></i><b>(1)</b>
    String firstName
    String lastName
}
def p = new Person(firstName: 'Raymond', lastName: 'Devos')             <i class="conum" data-value="2"></i><b>(2)</b>
assert p.formattedName == 'Raymond Devos'                               <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Person</code> class only defines two properties, <code>firstName</code> and <code>lastName</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we can create an instance of Person</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and call a method named <code>formattedName</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is quite common in dynamic languages for code such as the above example not to throw any error. How can this be?
In Java, this would typically fail at compile time. However, in Groovy, it will not fail at compile time, and if coded
correctly, will also not fail at runtime. In fact, to make this work at runtime, <strong>one</strong> possibility is to rely on
runtime metaprogramming. So just adding this line after the declaration of the <code>Person</code> class is enough:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Person.metaClass.getFormattedName = { "$delegate.firstName $delegate.lastName" }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This means that in general, in Groovy, you can&#8217;t make any assumption about the type of an object beyond its declaration
type, and even if you know it, you can&#8217;t determine at compile time what method will be called, or which property will
be retrieved, and this is <strong>perfectly fine</strong>. This is how dynamic languages work, and it has a lot of interest.</p>
</div>
<div class="paragraph">
<p>However, if your program doesn&#8217;t rely on dynamic features and that you come from the static world (in particular, from
a Java mindset), not catching such "errors" at compile time can be surprising. As we have seen in the previous example,
the compiler cannot be sure this is an error. To make it aware that it is, you have to explicitly instruct the compiler
that you are switching to a type checked mode. This can be done by annotating a class or a method with <code>@groovy.lang.TypeChecked</code>.</p>
</div>
<div class="paragraph">
<p>When type checking is activated, the compiler performs much more work:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>type inference is activated, meaning that even if you use <code>def</code> on a local variable for example, the type checker will be
able to infer the type of the variable from the assignments</p>
</li>
<li>
<p>method calls are resolved at compile time, meaning that if a method is not declared on a class, the compiler will throw an error</p>
</li>
<li>
<p>in general, all the compile time errors that you are used to find in a static language will appear: method not found, property not found,
incompatible types for method calls, number precision errors, &#8230;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this section, we will describe the behavior of the type checker in various situations and explain the limits of using
<code>@TypeChecked</code> on your code.</p>
</div>
<div class="sect6">
<h7 id="_the_code_typechecked_code_annotation">The <code>@TypeChecked</code> annotation</h7>
<div class="sect7">
<h8 id="_activating_type_checking_at_compile_time">Activating type checking at compile time</h8>
<div class="paragraph">
<p>The <code>groovy.lang.TypeChecked</code> annotation enabled type checking. It can be placed on a class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@groovy.transform.TypeChecked
class Calculator {
    int sum(int x, int y) { x+y }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or on a method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Calculator {
    @groovy.transform.TypeChecked
    int sum(int x, int y) { x+y }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the first case, all methods, properties, fields, inner classes, &#8230; of the annotated class will be type checked, whereas
in the second case, only the method and potential closures or anonymous inner classes that it contains will be type checked.</p>
</div>
</div>
<div class="sect7">
<h8 id="_skipping_sections">Skipping sections</h8>
<div class="paragraph">
<p>The scope of type checking can be restricted. For example, if a class is type checked, you can instruct the type checker
to skip a method by annotating it with <code>@TypeChecked(TypeCheckingMode.SKIP)</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.TypeChecked
import groovy.transform.TypeCheckingMode

@TypeChecked                                        <i class="conum" data-value="1"></i><b>(1)</b>
class GreetingService {
    String greeting() {                             <i class="conum" data-value="2"></i><b>(2)</b>
        doGreet()
    }

    @TypeChecked(TypeCheckingMode.SKIP)             <i class="conum" data-value="3"></i><b>(3)</b>
    private String doGreet() {
        def b = new SentenceBuilder()
        b.Hello.my.name.is.John                     <i class="conum" data-value="4"></i><b>(4)</b>
        b
    }
}
def s = new GreetingService()
assert s.greeting() == 'Hello my name is John'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>GreetingService</code> class is marked as type checked</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>so the <code>greeting</code> method is automatically type checked</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>but <code>doGreet</code> is marked with <code>SKIP</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the type checker doesn&#8217;t complain about missing properties here</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the previous example, <code>SentenceBuilder</code> relies on dynamic code. There&#8217;s no real <code>Hello</code> method or property, so the
type checker would normally complain and compilation would fail. Since the method that uses the builder is marked with
<code>TypeCheckingMode.SKIP</code>, type checking is <em>skipped</em> for this method, so the code will compile, even if the rest of the
class is type checked.</p>
</div>
<div class="paragraph">
<p>The following sections describe the semantics of type checking in Groovy.</p>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_type_checking_assignments">Type checking assignments</h7>
<div class="paragraph">
<p>An object <code>o</code> of type <code>A</code> can be assigned to a variable of type <code>T</code> if and only if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>T</code> equals <code>A</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Date now = new Date()</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is one of <code>String</code>, <code>boolean</code>, <code>Boolean</code> or <code>Class</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">String s = new Date() // implicit call to toString
Boolean boxed = 'some string'       // Groovy truth
boolean prim = 'some string'        // Groovy truth
Class clazz = 'java.lang.String'    // class coercion</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>o</code> is null and <code>T</code> is not a primitive type</p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">String s = null         // passes
int i = null            // fails</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is an array and <code>A</code> is an array and the component type of <code>A</code> is assignable to the component type of <code>B</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">int[] i = new int[4]        // passes
int[] i = new String[4]     // fails</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is an array and <code>A</code> is a list and the component type of <code>A</code> is assignable to the component type of <code>B</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">int[] i = [1,2,3]               // passes
int[] i = [1,2, new Date()]     // fails</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is a superclass of <code>A</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">AbstractList list = new ArrayList()     // passes
LinkedList list = new ArrayList()       // fails</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is an interface implemented by <code>A</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">List list = new ArrayList()             // passes
RandomAccess list = new LinkedList()    // fails</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> or <code>A</code> are a primitive type and their boxed types are assignable</p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">int i = 0
Integer bi = 1
int x = new Integer(123)
double d = new Float(5f)</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> extends <code>groovy.lang.Closure</code> and <code>A</code> is a SAM-type (single abstract method type)</p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Runnable r = { println 'Hello' }
interface SAMType {
    int doSomething()
}
SAMType sam = { 123 }
assert sam.doSomething() == 123
abstract class AbstractSAM {
    int calc() { 2* value() }
    abstract int value()
}
AbstractSAM c = { 123 }
assert c.calc() == 246</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> and <code>A</code> derive from <code>java.lang.Number</code> and conform to the following table</p>
</li>
</ul>
</div>
<table id="number-assignment" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 2. Number types (java.lang.XXX)</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">T</th>
<th class="tableblock halign-left valign-top">A</th>
<th class="tableblock halign-left valign-top">Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any but BigDecimal or BigInteger</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Double d1 = 4d
Double d2 = 4f
Double d3 = 4l
Double d4 = 4i
Double d5 = (short) 4
Double d6 = (byte) 4</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type but BigDecimal, BigInteger or Double</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Float f1 = 4f
Float f2 = 4l
Float f3 = 4i
Float f4 = (short) 4
Float f5 = (byte) 4</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type but BigDecimal, BigInteger, Double or Float</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Long l1 = 4l
Long l2 = 4i
Long l3 = (short) 4
Long l4 = (byte) 4</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type but BigDecimal, BigInteger, Double, Float or Long</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Integer i1 = 4i
Integer i2 = (short) 4
Integer i3 = (byte) 4</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Short</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type but BigDecimal, BigInteger, Double, Float, Long or Integer</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Short s1 = (short) 4
Short s2 = (byte) 4</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Byte</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Byte b1 = (byte) 4</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="_list_and_map_constructors">List and map constructors</h7>
<div class="paragraph">
<p>In addition to the assignment rules above, if an assignment is deemed invalid, in type checked mode, a <em>list</em> literal or a <em>map</em> literal <code>A</code> can be assigned
to a variable of type <code>T</code> if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the assignment is a variable declaration and <code>A</code> is a list literal and <code>T</code> has a constructor whose parameters match the types of the elements in the list literal</p>
</li>
<li>
<p>the assignment is a variable declaration and <code>A</code> is a map literal and <code>T</code> has a no-arg constructor and a property for each of the map keys</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, instead of writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@groovy.transform.TupleConstructor
class Person {
    String firstName
    String lastName
}
Person classic = new Person('Ada','Lovelace')</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use a "list constructor":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Person list = ['Ada','Lovelace']</code></pre>
</div>
</div>
<div class="paragraph">
<p>or a "map constructor":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Person map = [firstName:'Ada', lastName:'Lovelace']</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use a map constructor, additional checks are done on the keys of the map to check if a property of the same name
is defined. For example, the following will fail at compile time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@groovy.transform.TupleConstructor
class Person {
    String firstName
    String lastName
}
Person map = [firstName:'Ada', lastName:'Lovelace', age: 24]     <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The type checker will throw an error <code>No such property: age for class: Person</code> at compile time</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_method_resolution">Method resolution</h7>
<div class="paragraph">
<p>In type checked mode, methods are resolved at compile time. Resolution works by name and arguments. The return type is
irrelevant to method selection. Types of arguments are matched against the types of the parameters following those rules:</p>
</div>
<div class="paragraph">
<p>An argument <code>o</code> of type <code>A</code> can be used for a parameter of type <code>T</code> if and only if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>T</code> equals <code>A</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">int sum(int x, int y) {
    x+y
}
assert sum(3,4) == 7</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is a <code>String</code> and <code>A</code> is a <code>GString</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">String format(String str) {
    "Result: $str"
}
assert format("${3+4}") == "Result: 7"</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>o</code> is null and <code>T</code> is not a primitive type</p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">String format(int value) {
    "Result: $value"
}
assert format(7) == "Result: 7"
format(null)           // fails</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is an array and <code>A</code> is an array and the component type of <code>A</code> is assignable to the component type of <code>B</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">String format(String[] values) {
    "Result: ${values.join(' ')}"
}
assert format(['a','b'] as String[]) == "Result: a b"
format([1,2] as int[])              // fails</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is a superclass of <code>A</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">String format(AbstractList list) {
    list.join(',')
}
format(new ArrayList())              // passes
String format(LinkedList list) {
    list.join(',')
}
format(new ArrayList())              // fails</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is an interface implemented by <code>A</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">String format(List list) {
    list.join(',')
}
format(new ArrayList())                  // passes
String format(RandomAccess list) {
    'foo'
}
format(new LinkedList())                 // fails</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> or <code>A</code> are a primitive type and their boxed types are assignable</p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">int sum(int x, Integer y) {
    x+y
}
assert sum(3, new Integer(4)) == 7
assert sum(new Integer(3), 4) == 7
assert sum(new Integer(3), new Integer(4)) == 7
assert sum(new Integer(3), 4) == 7</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> extends <code>groovy.lang.Closure</code> and <code>A</code> is a SAM-type (single abstract method type)</p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">interface SAMType {
    int doSomething()
}
int twice(SAMType sam) { 2*sam.doSomething() }
assert twice { 123 } == 246
abstract class AbstractSAM {
    int calc() { 2* value() }
    abstract int value()
}
int eightTimes(AbstractSAM sam) { 4*sam.calc() }
assert eightTimes { 123 } == 984</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> and <code>A</code> derive from <code>java.lang.Number</code> and conform to the same rules as <a href="#number-assignment">assignment of numbers</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a method with the appropriate name and arguments is not found at compile time, an error is thrown. The difference with "normal" Groovy is
illustrated in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class MyService {
    void doSomething() {
        printLine 'Do something'            <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>printLine</code> is an error, but since we&#8217;re in a dynamic mode, the error is not caught at compile time</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example above shows a class that Groovy will be able to compile. However, if you try to create an instance of <code>MyService</code> and call the
<code>doSomething</code> method, then it will fail <strong>at runtime</strong>, because <code>printLine</code> doesn&#8217;t exist. Of course, we already showed how Groovy could make
this a perfectly valid call, for example by catching <code>MethodMissingException</code> or implementing a custom meta-class, but if you know you&#8217;re
not in such a case, <code>@TypeChecked</code> comes handy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class MyService {
    void doSomething() {
        printLine 'Do something'            <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>printLine</code> is this time a compile-time error</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Just adding <code>@TypeChecked</code> will trigger compile time method resolution. The type checker will try to find a method <code>printLine</code> accepting
a <code>String</code> on the <code>MyService</code> class, but cannot find one. It will fail compilation with the following message:</p>
</div>
<div class="paragraph">
<p><code>Cannot find matching method MyService#printLine(java.lang.String)</code></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="icon-important" title="Important"></i>
</td>
<td class="content">
It is important to understand the logic behind the type checker: it is a compile-time check, so by definition, the type checker
is not aware of any kind of <strong>runtime</strong> metaprogramming that you do. This means that code which is perfectly valid without <code>@TypeChecked</code> will
<strong>not</strong> compile anymore if you activate type checking. This is in particular true if you think of duck typing:<br>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Duck {
    void quack() {              <i class="conum" data-value="1"></i><b>(1)</b>
        println 'Quack!'
    }
}
class QuackingBird {
    void quack() {              <i class="conum" data-value="2"></i><b>(2)</b>
        println 'Quack!'
    }
}
@groovy.transform.TypeChecked
void accept(quacker) {
    quacker.quack()             <i class="conum" data-value="3"></i><b>(3)</b>
}
accept(new Duck())              <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>we define a <code>Duck</code> class which defines a <code>quack</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we define another <code>QuackingBird</code> class which also defines a <code>quack</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>quacker</code> is loosely typed, so since the method is <code>@TypeChecked</code>, we will obtain a compile-time error</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>even if in non type-checked Groovy, this would have passed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are possible workarounds, like introducing an interface, but basically, by activating type checking, you gain type safety
but you loose some features of the language. Hopefully, Groovy introduces some features like flow typing to reduce the gap between
type-checked and non type-checked Groovy.</p>
</div>
</div>
</div>
</div>
<div class="sect6">
<h7 id="type-inference">Type inference</h7>
<div class="sect7">
<h8 id="_principles">Principles</h8>
<div class="paragraph">
<p>When code is annotated with <code>@TypeChecked</code>, the compiler performs type inference. It doesn&#8217;t simply rely on static types, but also uses various
techniques to infer the types of variables, return types, literals, &#8230; so that the code remains as clean as possible even if you activate the
type checker.</p>
</div>
<div class="paragraph">
<p>The simplest example is infering the type of a variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def message = 'Welcome to Groovy!'              <i class="conum" data-value="1"></i><b>(1)</b>
println message.toUpperCase()                   <i class="conum" data-value="2"></i><b>(2)</b>
println message.upper() // compile time error   <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a variable is declared using the <code>def</code> keyword</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>calling <code>toUpperCase</code> is allowed by the type checker</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>calling <code>upper</code> will fail at compile time</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The reason the call to <code>toUpperCase</code> works is because the type of <code>message</code> was <em>inferred</em> as being a <code>String</code>.</p>
</div>
</div>
<div class="sect7">
<h8 id="_variables_vs_fields_in_type_inference">Variables vs fields in type inference</h8>
<div class="paragraph">
<p>It is worth noting that although the compiler performs type inference on local variables, it does <strong>not</strong> perform any kind
of type inference on fields, always falling back to the <strong>declared type</strong> of a field. To illustrate this, let&#8217;s take a
look at this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class SomeClass {
    def someUntypedField                                                                <i class="conum" data-value="1"></i><b>(1)</b>
    String someTypedField                                                               <i class="conum" data-value="2"></i><b>(2)</b>

    void someMethod() {
        someUntypedField = '123'                                                        <i class="conum" data-value="3"></i><b>(3)</b>
        someUntypedField = someUntypedField.toUpperCase()  // compile-time error        <i class="conum" data-value="4"></i><b>(4)</b>
    }

    void someSafeMethod() {
        someTypedField = '123'                                                          <i class="conum" data-value="5"></i><b>(5)</b>
        someTypedField = someTypedField.toUpperCase()                                   <i class="conum" data-value="6"></i><b>(6)</b>
    }

    void someMethodUsingLocalVariable() {
        def localVariable = '123'                                                       <i class="conum" data-value="7"></i><b>(7)</b>
        someUntypedField = localVariable.toUpperCase()                                  <i class="conum" data-value="8"></i><b>(8)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>someUntypedField</code> uses <code>def</code> as a declaration type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>someTypedField</code> uses <code>String</code> as a declaration type</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>we can assign <strong>anything</strong> to <code>someUntypedField</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>yet calling <code>toUpperCase</code> fails at compile time because the field is not typed properly</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>we can assign a <code>String</code> to a field of type <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>and this time <code>toUpperCase</code> is allowed</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>if we assign a <code>String</code> to a local variable</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>then calling <code>toUpperCase</code> is allowed on the local variable</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Why such a difference? The reason is <em>thread safety</em>. At compile time, we can&#8217;t make <strong>any</strong> guarantee about the type of
a field. Any thread can access any field at any time and between the moment a field is assigned a variable of some
type in a method and the time is is used the line after, another thread may have changed the contents of the field. This
is not the case for local variables: we know if they "escape" or not, so we can make sure that the type of a variable is
constant (or not) over time. Note that even if a field is final, the JVM makes no guarantee about it, so the type checker
doesn&#8217;t behave differently if a field is final or not.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
This is one of the reasons why we recommend to use <strong>typed</strong> fields. While using <code>def</code> for local variables is perfectly
fine thanks to type inference, this is not the case for fields, which also belong to the public API of a class, hence the
type is important.
</td>
</tr>
</table>
</div>
</div>
<div class="sect7">
<h8 id="_collection_literal_type_inference">Collection literal type inference</h8>
<div class="paragraph">
<p>Groovy provides a syntax for various type literals. There are three native collection literals in Groovy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>lists, using the <code>[]</code> literal</p>
</li>
<li>
<p>maps, using the <code>[:]</code> literal</p>
</li>
<li>
<p>ranges, using the <code>(..,..)</code> literal</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The inferred type of a literal depends on the elements of the literal, as illustrated in the following table:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Literal</th>
<th class="tableblock halign-left valign-top">Inferred type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def list = []</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>java.util.List</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def list = ['foo','bar']</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>java.util.List&lt;String&gt;</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def list = ["${foo}","${bar}"]</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>java.util.List&lt;GString&gt;</code> be careful, a <code>GString</code> is <strong>not</strong> a <code>String</code>!</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def map = [:]</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>java.util.LinkedHashMap</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def map1 = [someKey: 'someValue']
def map2 = ['someKey': 'someValue']</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>java.util.LinkedHashMap&lt;String,String&gt;</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def map1 = [someKey: 'someValue']
def map2 = ['someKey': 'someValue']</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>java.util.LinkedHashMap&lt;GString,String&gt;</code> be careful, the key is a <code>GString</code>!</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def intRange = (0..10)</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>groovy.lang.IntRange</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def charRange = ('a'..'z')</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>groovy.lang.Range&lt;String&gt;</code> : uses the type of the bounds to infer the component type of the range</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As you can see, with the noticeable exception of the <code>IntRange</code>, the inferred type makes use of generics types to describe
the contents of a collection. In case the collection contains elements of different types, the type checker still performs
type inference of the components, but uses the notion of <a href="#section-lub">least upper bound</a>.</p>
</div>
</div>
<div class="sect7">
<h8 id="section-lub">Least upper bound</h8>
<div class="paragraph">
<p>In Groovy, the <em>least upper bound</em> of two types <code>A</code> and <code>B</code> is defined as a type which:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>superclass corresponds to the common super class of <code>A</code> and <code>B</code></p>
</li>
<li>
<p>interfaces correspond to the interfaces implemented by both <code>A</code> and <code>B</code></p>
</li>
<li>
<p>if <code>A</code> or <code>B</code> is a primitive type and that <code>A</code> isn&#8217;t equal to <code>B</code>, the least upper bound of <code>A</code> and <code>B</code> is the least
upper bound of their wrapper types</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>A</code> and <code>B</code> only have one (1) interface in common and that their common superclass is <code>Object</code>, then the LUB of both
is the common interface.</p>
</div>
<div class="paragraph">
<p>The least upper bound represents the minimal type to which both <code>A</code> and <code>B</code> can be assigned. So for example, if <code>A</code> and <code>B</code>
are both <code>String</code>, then the LUB (least upper bound) of both is also <code>String</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Top {}
class Bottom1 extends Top {}
class Bottom2 extends Top {}

assert leastUpperBound(String, String) == String                    <i class="conum" data-value="1"></i><b>(1)</b>
assert leastUpperBound(ArrayList, LinkedList) == AbstractList       <i class="conum" data-value="2"></i><b>(2)</b>
assert leastUpperBound(ArrayList, List) == List                     <i class="conum" data-value="3"></i><b>(3)</b>
assert leastUpperBound(List, List) == List                          <i class="conum" data-value="4"></i><b>(4)</b>
assert leastUpperBound(Bottom1, Bottom2) == Top                     <i class="conum" data-value="5"></i><b>(5)</b>
assert leastUpperBound(List, Serializable) == Object                <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the LUB of <code>String</code> and <code>String</code> is <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the LUB of <code>ArrayList</code> and <code>LinkedList</code> is their common super type, <code>AbstractList</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the LUB of <code>ArrayList</code> and <code>List</code> is their only common interface, <code>List</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the LUB of two identical interfaces is the interface itself</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the LUB of <code>Bottom1</code> and <code>Bottom2</code> is their superclass <code>Top</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>the LUB of two types which have nothing in common is <code>Object</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In those examples, the LUB is always representable as a normal, JVM supported, type. But Groovy internally represents the LUB
as a type which can be more complex, and that you wouldn&#8217;t be able to use to define a variable for example. To illustrate this,
let&#8217;s continue with this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">interface Foo {}
class Top {}
class Bottom extends Top implements Serializable, Foo {}
class SerializableFooImpl implements Serializable, Foo {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>What is the least upper bound of <code>Bottom</code> and <code>SerializableFooImpl</code>? They don&#8217;t have a common super class (apart from <code>Object</code>),
but they do share 2 interfaces (<code>Serializable</code> and <code>Foo</code>), so their least upper bound is a type which represents the union of
two interfaces (<code>Serializable</code> and <code>Foo</code>). This type cannot be defined in the source code, yet Groovy knows about it.</p>
</div>
<div class="paragraph">
<p>In the context of collection type inference (and generic type inference in general), this becomes handy, because the type of the
components is inferred as the least upper bound. We can illustrate why this is important in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">interface Greeter { void greet() }                  <i class="conum" data-value="1"></i><b>(1)</b>
interface Salute { void salute() }                  <i class="conum" data-value="2"></i><b>(2)</b>

class A implements Greeter, Salute {                <i class="conum" data-value="3"></i><b>(3)</b>
    void greet() { println "Hello, I'm A!" }
    void salute() { println "Bye from A!" }
}
class B implements Greeter, Salute {                <i class="conum" data-value="4"></i><b>(4)</b>
    void greet() { println "Hello, I'm B!" }
    void salute() { println "Bye from B!" }
    void exit() { println 'No way!' }               <i class="conum" data-value="5"></i><b>(5)</b>
}
def list = [new A(), new B()]                       <i class="conum" data-value="6"></i><b>(6)</b>
list.each {
    it.greet()                                      <i class="conum" data-value="7"></i><b>(7)</b>
    it.salute()                                     <i class="conum" data-value="8"></i><b>(8)</b>
    it.exit()                                       <i class="conum" data-value="9"></i><b>(9)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Greeter</code> interface defines a single method, <code>greet</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>Salute</code>  interface defines a single method, <code>salute</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>class <code>A</code> implements both <code>Greeter</code> and <code>Salute</code> but there&#8217;s no explicit interface extending both</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>same for <code>B</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>but <code>B</code> defines an additional <code>exit</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>the type of <code>list</code> is inferred as "list of the LUB of <code>A</code> and <code>B</code>"</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>so it is possible to call <code>greet</code> which is defined on both <code>A</code> and <code>B</code> through the <code>Greeter</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>and it is possible to call <code>salut</code> which is defined on both <code>A</code> and <code>B</code> through the <code>Salut</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>yet calling <code>exit</code> is a compile time error because it doesn&#8217;t belong to the LUB of <code>A</code> and <code>B</code> (only defined in <code>B</code>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The error message will look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Static type checking] - Cannot find matching method Greeter or Salute#exit()</pre>
</div>
</div>
<div class="paragraph">
<p>which indicates that the <code>exit</code> method is neither defines on <code>Greeter</code> nor <code>Salute</code>, which are the two interfaces defined
in the least upper bound of <code>A</code> and <code>B</code>.</p>
</div>
</div>
<div class="sect7">
<h8 id="_instanceof_inference">instanceof inference</h8>
<div class="paragraph">
<p>In normal, non type checked, Groovy, you can write things like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Greeter {
    String greeting() { 'Hello' }
}

void doSomething(def o) {
    if (o instanceof Greeter) {     <i class="conum" data-value="1"></i><b>(1)</b>
        println o.greeting()        <i class="conum" data-value="2"></i><b>(2)</b>
    }
}

doSomething(new Greeter())</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>guard the method call with an <code>instanceof</code> check</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>make the call</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The method call works because of dynamic dispatch (the method is selected at runtime). The equivalent code in Java would
require to cast <code>o</code> to a <code>Greeter</code> before calling the <code>greeting</code> method, because methods are selected at compile time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">if (o instanceof Greeter) {
    System.out.println(((Greeter)o).greeting());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, in Groovy, even if you add <code>@TypeChecked</code> (and thus activate type checking) on the <code>doSomething</code> method, the
cast is <strong>not</strong> necessary. The compiler embeds <em>instanceof</em> inference that makes the cast optional.</p>
</div>
</div>
<div class="sect7">
<h8 id="section-flow-typing">Flow typing</h8>
<div class="paragraph">
<p>Flow typing is an important concept of Groovy in type checked mode and an extension of type inference. The idea is that
the compiler is capable of infering the type of variables in the flow of the code, not just at initialization:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@groovy.transform.TypeChecked
void flowTyping() {
    def o = 'foo'                       <i class="conum" data-value="1"></i><b>(1)</b>
    o = o.toUpperCase()                 <i class="conum" data-value="2"></i><b>(2)</b>
    o = 9d                              <i class="conum" data-value="3"></i><b>(3)</b>
    o = Math.sqrt(o)                    <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>first, <code>o</code> is declared using <code>def</code> and assigned a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the compiler inferred that <code>o</code> is a <code>String</code>, so calling <code>toUpperCase</code> is allowed</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>o</code> is reassigned with a <code>double</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>calling <code>Math.sqrt</code> passes compilation because the compiler knows that at this point, <code>o</code> is a <code>double</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So the type checker is <em>aware</em> of the fact that the concrete type of a variable is different over time. In particular,
if you replace the last assignment with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">o = 9d
o = o.toUpperCase()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The type checker will now fail at compile time, because it knows that <code>o</code> is a <code>double</code> when <code>toUpperCase</code> is called,
so it&#8217;s a type error.</p>
</div>
<div class="paragraph">
<p>It is important to understand that it is not the fact of declaring a variable with <code>def</code> that triggers type inference.
Flow typing works for <strong>any</strong> variable of any type. Declaring a variable with an explicit type only constraints what you
can assign to a variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@groovy.transform.TypeChecked
void flowTypingWithExplicitType() {
    List list = ['a','b','c']           <i class="conum" data-value="1"></i><b>(1)</b>
    list = list*.toUpperCase()          <i class="conum" data-value="2"></i><b>(2)</b>
    list = 'foo'                        <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>list</code> is declared as an unchecked <code>List</code> and assigned a list literal of `String`s</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>this line passes compilation because of flow typing: the type checker knows that <code>list</code> is at this point a <code>List&lt;String&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>but you can&#8217;t assign a <code>String</code> to a <code>List</code> so this is a type checking error</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also note that even if the variable is declared <strong>without</strong> generics information, the type checker knows what is
the component type. Therefore, such code would fail compilation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@groovy.transform.TypeChecked
void flowTypingWithExplicitType() {
    List list = ['a','b','c']           <i class="conum" data-value="1"></i><b>(1)</b>
    list.add(1)                         <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>list</code> is inferred as <code>List&lt;String&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>so adding an <code>int</code> to a <code>List&lt;String&gt;</code> is a compile-time error</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Fixing this requires adding an explicit generic type to the declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@groovy.transform.TypeChecked
void flowTypingWithExplicitType() {
    List&lt;? extends Serializable&gt; list = []                      <i class="conum" data-value="1"></i><b>(1)</b>
    list.addAll(['a','b','c'])                                  <i class="conum" data-value="2"></i><b>(2)</b>
    list.add(1)                                                 <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>list</code> declared as <code>List&lt;? extends Serializable&gt;</code> and initialized with an empty list</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>elements added to the list conform to the declaration type of the list</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>so adding an <code>int</code> to a <code>List&lt;? extends Serializable&gt;</code> is allowed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Flow typing has been introduced to reduce the difference in semantics between classic and static Groovy. In particular,
consider the behavior of this code in Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="java language-java">public Integer compute(String str) {
    return str.length();
}
public String compute(Object o) {
    return "Nope";
}
// ...
Object string = "Some string";          <i class="conum" data-value="1"></i><b>(1)</b>
Object result = compute(string);        <i class="conum" data-value="2"></i><b>(2)</b>
System.out.println(result);             <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>o</code> is declared as an <code>Object</code> and assigned a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we call the <code>compute</code> method with <code>o</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and print the result</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In Java, this code will output <code>0</code>, because method selection is done at compile time and based on the <strong>declared</strong> types.
So even if <code>o</code> is a <code>String</code> at runtime, it is still the <code>Object</code> version which is called, because <code>o</code> has been declared
as an <code>Object</code>. To be short, in Java, declared types are most important, be it variable types, parameter types or return
types.</p>
</div>
<div class="paragraph">
<p>In Groovy, we could write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">int compute(String string) { string.length() }
String compute(Object o) { "Nope" }
Object o = 'string'
def result = compute(o)
println result</code></pre>
</div>
</div>
<div class="paragraph">
<p>But this time, it will return <code>6</code>, because the method which is chosen is chosen <strong>at runtime</strong>, based on the <em>actual</em>
argument types. So at runtime, <code>o</code> is a <code>String</code> so the <code>String</code> variant is used. Note that this behavior has nothing
to do with type checking, it&#8217;s the way Groovy works in general: dynamic dispatch.</p>
</div>
<div class="paragraph">
<p>In type checked Groovy, we want to make sure the type checker selects the same method <strong>at compile time</strong>, that the runtime
would choose. It is not possible in general, due to the semantics of the language, but we can make things better with flow
typing. With flow typing, <code>o</code> is <em>inferred</em> as a <code>String</code> when the <code>compute</code> method is called, so the version which takes
a <code>String</code> and returns an <code>int</code> is chosen. This means that we can infer the return type of the method to be an <code>int</code>, and
not a <code>String</code>. This is important for subsequent calls and type safety.</p>
</div>
<div class="paragraph">
<p>So in type checked Groovy, flow typing is a very important concept, which also implies that if <code>@TypeChecked</code> is applied,
methods are selected based on the <em>inferred types</em> of the arguments, not on the declared types. This doesn&#8217;t ensure 100%
type safety, because the type checker <em>may</em> select a wrong method, but it ensures the closest semantics to dynamic Groovy.</p>
</div>
</div>
<div class="sect7">
<h8 id="_advanced_type_inference">Advanced type inference</h8>
<div class="paragraph">
<p>A combination of <a href="#section-flow-typing">flow typing</a> and <a href="#section-lub">least upper bound inference</a> is used to perform
advanced type inference and ensure type safety in multiple situations. In particular, program control structures are
likely to alter the inferred type of a variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Top {
   void methodFromTop() {}
}
class Bottom extends Top {
   void methodFromBottom() {}
}
def o
if (someCondition) {
    o = new Top()                               <i class="conum" data-value="1"></i><b>(1)</b>
} else {
    o = new Bottom()                            <i class="conum" data-value="2"></i><b>(2)</b>
}
o.methodFromTop()                               <i class="conum" data-value="3"></i><b>(3)</b>
o.methodFromBottom()  // compilation error      <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>if <code>someCondition</code> is true, <code>o</code> is assigned a <code>Top</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>if <code>someCondition</code> is false, <code>o</code> is assigned a <code>Bottom</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>calling <code>methodFromTop</code> is safe</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>but calling <code>methodFromBottom</code> is not, so it&#8217;s a compile time error</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the type checker visits an <code>if/else</code> control structure, it checks all variables which are assigned in <code>if/else</code> branches
and computes the <a href="#section-lub">least upper bound</a> of all assignments. This type is the type of the inferred variable
after the <code>if/else</code> block, so in this example, <code>o</code> is assigned a <code>Top</code> in the <code>if</code> branch and a <code>Bottom</code> in the <code>else</code>
branch. The <a href="#section-lub">LUB</a> of those is a <code>Top</code>, so after the conditional branches, the compiler infers <code>o</code> as being
a <code>Top</code>. Calling <code>methodFromTop</code> will therefore be allowed, but not <code>methodFromBottom</code>.</p>
</div>
<div class="paragraph">
<p>The same reasoning exists with closures and in particular closure shared variables. A closure shared variable is a variable
which is defined outside of a closure, but used inside a closure, as in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def text = 'Hello, world!'                          <i class="conum" data-value="1"></i><b>(1)</b>
def closure = {
    println text                                    <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a variable named <code>text</code> is declared</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>text</code> is used from inside a closure. It is a <em>closure shared variable</em>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Groovy allows developers to use those variables without requiring them to be final. This means that a closure shared
variable can be reassigned inside a closure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">String result
doSomething { String it -&gt;
    result = "Result: $it"
}
result = result?.toUpperCase()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The problem is that a closure is an independent block of code that can be executed (or not) at <strong>any</strong> time. In particular,
<code>doSomething</code> may be asynchronous, for example. This means that the body of a closure doesn&#8217;t belong to the main control
flow. For that reason, the type checker also computes, for each closure shared variable, the <a href="#section-lub">LUB</a> of all
assignments of the variable, and will use that <code>LUB</code> as the inferred type outside of the scope of the closure, like in
this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Top {
   void methodFromTop() {}
}
class Bottom extends Top {
   void methodFromBottom() {}
}
def o = new Top()                               <i class="conum" data-value="1"></i><b>(1)</b>
Thread.start {
    o = new Bottom()                            <i class="conum" data-value="2"></i><b>(2)</b>
}
o.methodFromTop()                               <i class="conum" data-value="3"></i><b>(3)</b>
o.methodFromBottom()  // compilation error      <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a closure-shared variable is first assigned a <code>Top</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>inside the closure, it is assigned a <code>Bottom</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>methodFromTop</code> is allowed</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>methodFromBottom</code> is a compilation error</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here, it is clear that when <code>methodFromBottom</code> is called, there&#8217;s no guarantee, at compile-time or runtime that the
type of <code>o</code> will <em>effectively</em> be a <code>Bottom</code>. There are chances that it will be, but we can&#8217;t make sure, because it&#8217;s
asynchronous. So the type checker will only allow calls on the <a href="#section-lub">least upper bound</a>, which is here a <code>Top</code>.</p>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_closures_and_type_inference">Closures and type inference</h7>
<div class="paragraph">
<p>The type checker performs special inference on closures, resulting on additional checks on one side and improved fluency
on the other side.</p>
</div>
<div class="sect7">
<h8 id="_return_type_inference">Return type inference</h8>
<div class="paragraph">
<p>The first thing that the type checker is capable of doing is infering the <em>return type</em> of a closure. This is simply
 illustrated in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@groovy.transform.TypeChecked
int testClosureReturnTypeInference(String arg) {
    def cl = { "Arg: $arg" }                                <i class="conum" data-value="1"></i><b>(1)</b>
    def val = cl()                                          <i class="conum" data-value="2"></i><b>(2)</b>

    val.length()                                            <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a closure is defined, and it returns a string (more precisely a <code>GString</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we call the closure and assign the result to a variable</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the type checker inferred that the closure would return a string, so calling <code>length()</code> is allowed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see, unlike a method which declares its return type explicitly, there&#8217;s no need to declare the return type
of a closure: its type is inferred from the body of the closure.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Closures vs methods</div>
<div class="paragraph">
<p>It&#8217;s worth noting that return type inference is only applicable to closures. While the type checker could do the
same on a method, it is in practice not desirable: <em>in general</em>, methods can be overriden and it is not statically
possible to make sure that the method which is called is not an overriden version. So flow typing would actually
think that a method returns something, while in reality, it could return something else, like illustrated in the
following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@TypeChecked
class A {
    def compute() { 'some string' }             <i class="conum" data-value="1"></i><b>(1)</b>
    def computeFully() {
        compute().toUpperCase()                 <i class="conum" data-value="2"></i><b>(2)</b>
    }
}
@TypeChecked
class B extends A {
    def compute() { 123 }                       <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>class <code>A</code> defines a method <code>compute</code> which effectively returns a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>this will fail compilation because the return type of <code>compute</code> is <code>def</code>(aka <code>Object</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>class <code>B</code> extends <code>A</code> and redefines <code>compute</code>, this type returning an <code>int</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see, if the type checker relied on the inferred return type of a method, with <a href="#section-flow-typing">flow typing</a>,
the type checker could determine that it is ok to call <code>toUpperCase</code>. It is in fact an <strong>error</strong>, because a subclass can
override <code>compute</code> and return a different object. Here, <code>B#compute</code> returns an <code>int</code>, so someone calling <code>computeFully</code>
on an instance of <code>B</code> would see a runtime error. The compiler prevents this from happening by using the declared return
type of methods instead of the inferred return type.</p>
</div>
<div class="paragraph">
<p>For consistency, this behavior is the same for <strong>every</strong> method, even if they are static or final.</p>
</div>
</div>
</div>
</div>
<div class="sect7">
<h8 id="_parameter_type_inference">Parameter type inference</h8>
<div class="paragraph">
<p>In addition to the return type, it is possible for a closure to infer its parameter types from the context. There are
two ways for the compiler to infer the parameter types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>through <em>implicit SAM type coercion</em></p>
</li>
<li>
<p>through API metadata</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To illustrate this, lets start with an example that will fail compilation due to the inability for the type checker
to infer the parameter types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Person {
    String name
    int age
}

void inviteIf(Person p, Closure&lt;Boolean&gt; predicate) {           <i class="conum" data-value="1"></i><b>(1)</b>
    if (predicate.call(p)) {
        // send invite
        // ...
    }
}

@groovy.transform.TypeChecked
void failCompilation() {
    Person p = new Person(name: 'Gerard', age: 55)
    inviteIf(p) {                                               <i class="conum" data-value="2"></i><b>(2)</b>
        it.age &gt;= 18 // No such property: age                   <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>inviteIf</code> method accepts a <code>Person</code> and a <code>Closure</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we call it with a <code>Person</code> and a <code>Closure</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>yet <code>it</code> is not statically known as being a <code>Person</code> and compilation fails</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this example, the closure body contains <code>it.age</code>. With dynamic, not type checked code, this would work, because the
type of <code>it</code> would be a <code>Person</code> at runtime. Unfortunately, at compile-time, there&#8217;s no way to know what is the type
of <code>it</code>, just by reading the signature of <code>inviteIf</code>.</p>
</div>
<div class="sect8">
<h9 id="_explicit_closure_parameters">Explicit closure parameters</h9>
<div class="paragraph">
<p>To be short, the type checker doesn&#8217;t have enough contextual information on the <code>inviteIf</code> method to determine statically
the type of <code>it</code>. This means that the method call needs to be rewritten like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">inviteIf(p) { Person it -&gt;                                  <i class="conum" data-value="1"></i><b>(1)</b>
    it.age &gt;= 18
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the type of <code>it</code> needs to be declared explicitly</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By explicitly declaring the type of the <code>it</code> variable, you can workaround the problem and make this code statically
checked.</p>
</div>
</div>
<div class="sect8">
<h9 id="_parameters_inferred_from_single_abstract_method_types">Parameters inferred from single-abstract method types</h9>
<div class="paragraph">
<p>For an API or framework designer, there are two ways to make this more elegant for users, so that they don&#8217;t have to
declare an explicit type for the closure parameters. The first one, and easiest, is to replace the closure with a
SAM type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">interface Predicate&lt;On&gt; { boolean apply(On e) }                 <i class="conum" data-value="1"></i><b>(1)</b>

void inviteIf(Person p, Predicate&lt;Person&gt; predicate) {          <i class="conum" data-value="2"></i><b>(2)</b>
    if (predicate.apply(p)) {
        // send invite
        // ...
    }
}

@groovy.transform.TypeChecked
void passesCompilation() {
    Person p = new Person(name: 'Gerard', age: 55)

    inviteIf(p) {                                               <i class="conum" data-value="3"></i><b>(3)</b>
        it.age &gt;= 18                                            <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declare a <code>SAM</code> interface with an <code>apply</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>inviteIf</code> now uses a <code>Predicate&lt;Person&gt;</code> instead of a <code>Closure&lt;Boolean&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>there&#8217;s no need to declare the type of the <code>it</code> variable anymore</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>it.age</code> compiles properly, the type of <code>it</code> is inferred from the <code>Predicate#apply</code> method signature</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
By using this technique, we leverage the <em>automatic coercion of closures to SAM types</em> feature of Groovy. The
question whether you should use a <em>SAM type</em> or a <em>Closure</em> really depends on what you need to do. In a lot of cases,
using a SAM interface is enough, especially if you consider functional interfaces as they are found in Java 8. However,
closures provide features that are not accessible to functional interfaces. In particular, closures can have a delegate,
and owner and can be manipulated as objects (for example, cloned, serialized, curried, &#8230;) before being called. They can
also support multiple signatures (polymorphism). So if you need that kind of manipulation, it is preferable to switch to
the most advanced type inference annotations which are described below.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The original issue that needs to be solved when it comes to closure parameter type inference, that is to say, statically
determining the types of the arguments of a closure <em>without</em> having to have them explicitly declared, is that the Groovy
type system inherits the Java type system, which is insufficient to describe the types of the arguments.</p>
</div>
</div>
<div class="sect8">
<h9 id="_the_code_closureparams_code_annotation">The <code>@ClosureParams</code> annotation</h9>
<div class="paragraph">
<p>Groovy provides an annotation, <code>@ClosureParams</code> which is aimed at completing type information. This annotation is primarily
aimed at framework and API developers who want to extend the capabilities of the type checker by providing type inference
metadata. This is important if your library makes use of closures and that you want the maximum level of tooling support
too.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s illustrate this by fixing the original example, introducing the <code>@ClosureParams</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.stc.ClosureParams
import groovy.transform.stc.FirstParam
void inviteIf(Person p, @ClosureParams(FirstParam) Closure&lt;Boolean&gt; predicate) {        <i class="conum" data-value="1"></i><b>(1)</b>
    if (predicate.call(p)) {
        // send invite
        // ...
    }
}
inviteIf(p) {                                                                       <i class="conum" data-value="2"></i><b>(2)</b>
    it.age &gt;= 18
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the closure parameter is annotated with <code>@ClosureParams</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>it&#8217;s not necessary to use an explicit type for <code>it</code>, which is inferred</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>@ClosureParams</code> annotation minimally accepts one argument, which is named a <em>type hint</em>. A type hint is a class which
is reponsible for completing type information at compile time for the closure. In this example, the type hint being used
is <code>groovy.transform.stc.FirstParam</code> which indicated to the type checker that the closure will accept one parameter
whose type is the type of the first parameter of the method. In this case, the first parameter of the method is <code>Person</code>,
so it indicates to the type checker that the first parameter of the closure is in fact a <code>Person</code>.</p>
</div>
<div class="paragraph">
<p>The second argument is optional and named <em>options</em>. It&#8217;s semantics depends on the <em>type hint</em> class. Groovy comes with
various bundled type hints, illustrated in the table below:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 3. Predefined type hints</caption>
<colgroup>
<col style="width: 16%;">
<col style="width: 16%;">
<col style="width: 66%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type hint</th>
<th class="tableblock halign-left valign-top">Polymorphic?</th>
<th class="tableblock halign-left valign-top">Description and examples</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>FirstParam</code><br>
<code>SecondParam</code><br>
<code>ThirdParam</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The first (resp. second, third) parameter type of the method<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.stc.FirstParam
void doSomething(String str, @ClosureParams(FirstParam) Closure c) {
    c(str)
}
doSomething('foo') { println it.toUpperCase() }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.stc.SecondParam
void withHash(String str, int seed, @ClosureParams(SecondParam) Closure c) {
    c(31*str.hashCode()+seed)
}
withHash('foo', (int)System.currentTimeMillis()) {
    int mod = it%2
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.stc.ThirdParam
String format(String prefix, String postfix, String o, @ClosureParams(ThirdParam) Closure c) {
    "$prefix${c(o)}$postfix"
}
assert format('foo', 'bar', 'baz') {
    it.toUpperCase()
} == 'fooBAZbar'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>FirstParam.FirstGenericType</code><br>
<code>SecondParam.FirstGenericType</code><br>
<code>ThirdParam.FirstGenericType</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The first generic type of the first (resp. second, third) parameter of the method<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.stc.FirstParam
public &lt;T&gt; void doSomething(List&lt;T&gt; strings, @ClosureParams(FirstParam.FirstGenericType) Closure c) {
    strings.each {
        c(it)
    }
}
doSomething(['foo','bar']) { println it.toUpperCase() }
doSomething([1,2,3]) { println(2*it) }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Variants for <code>SecondGenericType</code> and <code>ThirdGenericType</code> exist for all <code>FirstParam</code>, <code>SecondParam</code> and <code>ThirdParam</code>
type hints.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>SimpleType</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>A type hint for which the type of closure parameters comes from the options string.<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.stc.SimpleType
public void doSomething(@ClosureParams(value=SimpleType,options=['java.lang.String','int']) Closure c) {
    c('foo',3)
}
doSomething { str, len -&gt;
    assert str.length() == len
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This type hint supports a <strong>single</strong> signature and each of the parameter is specified as a value of the <em>options</em> array
using a fully-qualified type name or a primitive type.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>MapEntryOrKeyValue</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>A dedicated type hint for closures that either work on a <code>Map.Entry</code> single parameter, or two parameters corresponding
to the key and the value.<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.stc.MapEntryOrKeyValue
public &lt;K,V&gt; void doSomething(Map&lt;K,V&gt; map, @ClosureParams(MapEntryOrKeyValue) Closure c) {
    // ...
}
doSomething([a: 'A']) { k,v -&gt;
    assert k.toUpperCase() == v.toUpperCase()
}
doSomething([abc: 3]) { e -&gt;
    assert e.key.length() == e.value
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This type hint <strong>requires</strong> that the first argument is a <code>Map</code> type, and infers the closure parameter types from the map
actual key/value types.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>FromAbstractTypeMethods</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Infers closure parameter types from the abstract method of some type. A signature is inferred for <strong>each</strong> abstract method.<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.stc.FromAbstractTypeMethods
abstract class Foo {
    abstract void firstSignature(int x, int y)
    abstract void secondSignature(String str)
}
void doSomething(@ClosureParams(value=FromAbstractTypeMethods, options=["Foo"]) Closure cl) {
    // ...
}
doSomething { a, b -&gt; a+b }
doSomething { s -&gt; s.toUpperCase() }</code></pre>
</div>
</div>
<div class="paragraph">
<p>If there are multiple signatures like in the example above, the type checker will <strong>only</strong> be able to infer the types of
the arguments if the arity of each method is different. In the example above, <code>firstSignature</code> takes 2 arguments and
<code>secondSignature</code> takes 1 argument, so the type checker can infer the argument types based on the number of arguments.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>FromString</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Infers the closure parameter typs from the <code>options</code> argument. The <code>options</code> argument consists of an array of comma-separated
non-primitive types. Each element of the array corresponds to a single signature, and each comma in an element separate
parameters of the signature. In short, this is the most generic type hint, and each string of the <code>options</code> map is <strong>parsed</strong>
as if it was a signature literal. While being very powerful, this type hint must be avoided if you can because it increases
the compilation times due to the necessity of parsing the type signatures.</p>
</div>
<div class="paragraph">
<p>A single signature for a closure accepting a <code>String</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.stc.FromString
void doSomething(@ClosureParams(value=FromString, options=["String","String,Integer"]) Closure cl) {
    // ...
}
doSomething { s -&gt; s.toUpperCase() }
doSomething { s,i -&gt; s.toUpperCase()*i }</code></pre>
</div>
</div>
<div class="paragraph">
<p>A polymorphic closure, accepting either a <code>String</code> or a <code>String, Integer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.stc.FromString
void doSomething(@ClosureParams(value=FromString, options=["String","String,Integer"]) Closure cl) {
    // ...
}
doSomething { s -&gt; s.toUpperCase() }
doSomething { s,i -&gt; s.toUpperCase()*i }</code></pre>
</div>
</div>
<div class="paragraph">
<p>A polymorphic closure, accepting either a <code>T</code> or a pair <code>T,T</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.stc.FromString
public &lt;T&gt; void doSomething(T e, @ClosureParams(value=FromString, options=["T","T,T"]) Closure cl) {
    // ...
}
doSomething('foo') { s -&gt; s.toUpperCase() }
doSomething('foo') { s1,s2 -&gt; assert s1.toUpperCase() == s2.toUpperCase() }</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Even though you use <code>FirstParam</code>, <code>SecondParam</code> or <code>ThirdParam</code> as a type hint, it doesn&#8217;t stricly mean that the
argument which will be passed to the closure <strong>will</strong> be the first (resp. second, third) argument of the method call. It
only means that the <strong>type</strong> of the parameter of the closure will be the <strong>same</strong> as the type of the first (resp.  second,
 third) argument of the method call.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In short, the lack of the <code>@ClosureParams</code> annotation on a method accepting a <code>Closure</code> will <strong>not</strong> fail compilation. If
 present (and it can be present in Java sources as well as Groovy sources), then the type checker has <strong>more</strong> information
 and can perform additional type inference. This makes this feature particularily interesting for framework developers.</p>
</div>
</div>
</div>
<div class="sect7">
<h8 id="__code_delegatesto_code"><code>@DelegatesTo</code></h8>
<div class="paragraph">
<p>The <code>@DelegatesTo</code> annotation is used by the type checker to infer the type of the delegate. It allows the API designer
to instruct the compiler what is the type of the delegate and the delegation strategy. The <code>@DelegatesTo</code> annotation is
discussed in a <a href="core-domain-specific-languages.html#section-delegatesto">specific section</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_static_compilation_wip">Static compilation (WIP)</h6>
<div class="sect6">
<h7 id="_dynamic_vs_static">Dynamic vs static</h7>
<div class="paragraph">
<p>In the <a href="#typechecking">type checking section</a>, we have seen that Groovy provides optional type checking thanks to the
<code>@TypeChecked</code> annotation. The type checker runs at compile time and performs a static analysis of dynamic code. The
program will behave exactly the same whether type checking has been enabled or not. This means that the <code>@TypeChecked</code>
annotation is neutral with regards to the semantics of a program. Even though it may be necessary to add type information
in the sources so that the program is considered type safe, in the end, the semantics of the program are the same.</p>
</div>
<div class="paragraph">
<p>While this may sound fine, there is actually one issue with this: type checking of dynamic code, done at compile time, is
by definition only correct if no runtime specific behavior occurs. For example, the following program passes type checking:</p>
</div>
<div id="typechecked-defeated" class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Computer {
    int compute(String str) {
        str.length()
    }
    String compute(int x) {
        String.valueOf(x)
    }
}

@groovy.transform.TypeChecked
void test() {
    def computer = new Computer()
    computer.with {
        assert compute(compute('foobar')) =='6'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two <code>compute</code> methods. One accepts a <code>String</code> and returns an <code>int</code>, the other accepts an <code>int</code> and returns
a <code>String</code>. If you compile this, it is considered type safe: the inner <code>compute('foobar')</code> call will return an <code>int</code>,
and calling <code>compute</code> on this <code>int</code> will in turn return a <code>String</code>.</p>
</div>
<div class="paragraph">
<p>Now, before calling <code>test()</code>, consider adding the following line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Computer.metaClass.compute = { String str -&gt; new Date() }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using runtime metaprogramming, we&#8217;re actually modifying the behavior of the <code>compute(String)</code> method, so that instead of
returning the length of the provided argument, it will return a <code>Date</code>. If you execute the program, it will fail at
runtime. Since this line can be added from anywhere, in any thread, there&#8217;s absolutely no way for the type checker to
statically make sure that no such thing happens. In short, the type checker is vulnerable to monkey patching. This is
just one example, but this illustrates the concept that doing static analysis of a dynamic program is inherently wrong.</p>
</div>
<div class="paragraph">
<p>The Groovy language provides an alternative annotation to <code>@TypeChecked</code> which will actually make sure that the methods
which are inferred as being called <strong>will</strong> effectively be called at runtime. This annotation turns the Groovy compiler
into a <strong>static compiler</strong>, where all method calls are resolved at compile time <strong>and</strong> the generated bytecode makes sure
that this happens: the annotation is <code>@groovy.transform.CompileStatic</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="compilestatic-annotation">The <code>@CompileStatic</code> annotation</h7>
<div class="paragraph">
<p>The <code>@CompileStatic</code> annotation can be added anywhere the <code>@TypeChecked</code> annotation can be used, that is to say on
a class or a method. It is not necessary to add both <code>@TypeChecked</code> and <code>@CompileStatic</code>, as <code>@CompileStatic</code> performs
everything <code>@TypeChecked</code> does, but in addition triggers static compilation.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take the <a href="#typechecked-defeated">example which failed</a>, but this time let&#8217;s replace the <code>@TypeChecked</code> annotation
with <code>@CompileStatic</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Computer {
    int compute(String str) {
        str.length()
    }
    String compute(int x) {
        String.valueOf(x)
    }
}

@groovy.transform.CompileStatic
void test() {
    def computer = new Computer()
    computer.with {
        assert compute(compute('foobar')) =='6'
    }
}
Computer.metaClass.compute = { String str -&gt; new Date() }
run()</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the <strong>only</strong> difference. If we execute this program, this time, there is no runtime error. The <code>test</code> method
became immune to monkey patching, because the <code>compute</code> methods which are called in its body are linked at compile
time, so even if the metaclass of <code>Computer</code> changes, the program still behaves <strong>as expected by the type checker</strong>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_key_benefits">Key benefits</h7>
<div class="paragraph">
<p>There are several benefits of using <code>@CompileStatic</code> on your code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>type safety</p>
</li>
<li>
<p>immunity to <a href="#compilestatic-annotation">monkey patching</a></p>
</li>
<li>
<p>performance improvements</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The performance improvements depend on the kind of program you are executing. It it is I/O bound, the difference between
statically compiled code and dynamic code is barely noticeable. On highly CPU intensive code, since the bytecode which
is generated is very close, if not equal, to the one that Java would produce for an equivalent program, the performance
is greatly improved.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Using the <em>invokedynamic</em> version of Groovy, which is accessible to people using JDK 7 and above, the performance
of the dynamic code should be very close to the performance of statically compiled code. Sometimes, it can even be faster!
There is only one way to determine which version you should choose: measuring. The reason is that depending on your program
<strong>and</strong> the JVM that you use, the performance can be significantly different. In particular, the <em>invokedynamic</em> version of
Groovy is very sensitive to the JVM version in use.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tools">2. Tools</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_compiling_groovy">2.1. Compiling Groovy</h3>
<div class="sect3">
<h4 id="_groovyc_the_groovy_compiler">2.1.1. groovyc, the Groovy compiler</h4>
<div class="paragraph">
<p><code>groovyc</code> is the Groovy compiler command line tool. It allows you to compile Groovy sources into bytecode. It plays
the same role as <code>javac</code> in the Java world. The easiest way to compile a Groovy script or class is to run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovyc MyClass.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>This will produce a <code>MyClass.class</code> file (as well as other .class files depending on the contents of the source). <code>groovyc</code> supports
a number of command line switches:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Short version</th>
<th class="tableblock halign-left valign-top">Long version</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--basescript</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base class name for scripts (must derive from Script)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-cp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-classpath, --classpath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the compilation classpath. Must be the first
argument.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc -cp lib/dep.jar MyClass.groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--sourcepath*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory where to find source files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc -sourcepath src script.groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--temp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temporary directory for the compiler</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--encoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encoding of the source files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc -encoding utf-8 script.groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--help</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays help for the command line groovyc tool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc --help</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-v</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the compiler version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc -v</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--exception</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the stack trace in case of compilation error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc -e script.groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-j</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--jointCompilation*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables joint compilation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc -j A.groovy B.java</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sourcepath</code> is not used anymore. Specifying this parameter will have no effect on compilation.</p>
</li>
<li>
<p>for a full description of joint compilation, see <a href="#section-jointcompilation">the joint compilation section</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ant_task">2.1.2. Ant task</h4>
<div class="sect4">
<h5 id="ThegroovycAntTask-groovyc"><code>&lt;groovyc&gt;</code></h5>
<div class="sect5">
<h6 id="ThegroovycAntTask-Description">Description</h6>
<div class="paragraph">
<p>Compiles Groovy source files and, if joint compilation option is used, Java source files.</p>
</div>
</div>
<div class="sect5">
<h6 id="ThegroovycAntTask-Requiredtaskdef">Required taskdef</h6>
<div class="paragraph">
<p>Assuming <code>groovy-all-VERSION.jar</code> is in <em>my.classpath</em> you will need to
declare this task at some point in the <code>build.xml</code> prior to the <code>groovyc</code>
task being invoked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="xml language-xml">&lt;taskdef name="groovyc"
         classname="org.codehaus.groovy.ant.Groovyc"
         classpathref="my.classpath"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="ThegroovycAntTask-groovycAttributes">&lt;groovyc&gt; Attributes</h6>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configscript</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the configuration file used to customize the compilation configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">srcdir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of the Groovy (and possibly Java) source files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">destdir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location to store the class files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">classpath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The classpath to use.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">classpathref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The classpath to use given as a path references.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sourcepath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sourcepath to use.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sourcepathref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sourcepath to use given as a path reference.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">encoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encoding of source files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">verbose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asks the compiler for verbose output; defaults to no.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeAntRuntime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include the Ant run-time libraries in the
classpath; defaults to yes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeJavaRuntime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include the default run-time libraries
from the executing VM in the classpath; defaults to no.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fork</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to execute groovyc using a spawned instance of the JVM;
defaults to no.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">memoryInitialSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The initial size of the memory for the underlying
VM, if using fork mode; ignored otherwise. Defaults to the standard VM
memory setting. (Examples: 83886080, 81920k, or 80m)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">memoryMaximumSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum size of the memory for the underlying
VM, if using fork mode; ignored otherwise. Defaults to the standard VM
memory setting. (Examples: 83886080, 81920k, or 80m)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">failonerror</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether compilation errors will fail the build;
defaults to true.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listfiles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether the source files to be compiled will be
listed; defaults to no.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stacktrace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if true each compile error message will contain a
stacktrace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">indy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable compilation with the &#8220;invoke dynamic&#8221; support when using
Groovy 2.0 and beyond and running on JDK 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scriptBaseClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the base class for Groovy scripts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubdir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the stub directory into which the Java source stub files should be generated.
The directory need not exist and will not be deleted automatically - though its contents
will be cleared unless <em>keepStubs</em> is true. Ignored when forked.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">keepStubs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the keepStubs flag. Defaults to false. Set to true for debugging.
Ignored when forked.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">forceLookupUnnamedFiles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Groovyc Ant task is frequently used in the context of a build system
that knows the complete list of source files to be compiled. In such a
context, it is wasteful for the Groovy compiler to go searching the
classpath when looking for source files and hence by default the
Groovyc Ant task calls the compiler in a special mode with such searching
turned off. If you wish the compiler to search for source files then
you need to set this flag to true. Defaults to false.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="xml language-xml">&lt;groovyc srcdir="src" destdir="target/classes"&gt;
&lt;/groovyc&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="ThegroovycAntTask-groovycNestedElements">&lt;groovyc&gt; Nested Elements</h6>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">element</th>
<th class="tableblock halign-left valign-top">kind</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Replaces Attribute</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">javac</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javac task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jointCompilationOptions</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">src</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a path structure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes (unless srcdir is used)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srcdir</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">classpath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a path structure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">classpath</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>For path structures see for example
<a href="http://ant.apache.org/manual/using.html#path">http://ant.apache.org/manual/using.html#path</a></p>
</li>
<li>
<p>For usages of the javac task see
<a href="http://ant.apache.org/manual/CoreTasks/javac.html">http://ant.apache.org/manual/CoreTasks/javac.html</a></p>
</li>
<li>
<p>The nested javac task behaves more or less as documented for the
top-level <code>javac</code> task. <code>srcdir</code>, <code>destdir</code>, <code>classpath</code>, <code>encoding</code> for the
nested <code>javac</code> task are taken from the enclosing <code>groovyc</code> task. If these
attributes are specified then they are added, they do not replace. In
fact, you should not attempt to overwrite the destination. Other
attributes and nested elements are unaffected, for example <code>fork</code>,
<code>memoryMaximumSize</code>, etc. may be used freely.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="ThegroovycAntTask-JointCompilation">Joint Compilation</h6>
<div class="paragraph">
<p>Joint compilation is enabled by using an embedded <code>javac</code> element, as shown in
the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="xml language-xml">&lt;groovyc srcdir="${testSourceDirectory}" destdir="${testClassesDirectory}"&gt;
  &lt;classpath&gt;
    &lt;pathelement path="${mainClassesDirectory}"/&gt;
    &lt;pathelement path="${testClassesDirectory}"/&gt;
    &lt;path refid="testPath"/&gt;
  &lt;/classpath&gt;
  &lt;javac source="1.7" target="1.7" debug="on" /&gt;
&lt;/groovyc&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is rare to specify <code>srcdir</code> and <code>destdir</code>, the nested <code>javac</code> task is provided with the <code>srcdir</code>
and <code>destdir</code> values from the enclosing <code>groovyc</code> task, and it is invariable
the right thing to do just to leave this as is.
To restate: the <code>javac</code> task gets the <code>srcdir</code>, <code>destdir</code> and <code>classpath</code> from
the enclosing <code>groovyc</code> task.</p>
</div>
<div class="paragraph">
<p>More details about joint compilation can be found in the <a href="#section-jointcompilation">joint compilation</a> section.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_maven_integration">2.1.3. Maven integration</h4>
<div class="paragraph">
<p>There are several approaches to compiling Groovy code in your Maven
projects. <a href="#section-gmaven">GMaven</a> is the
most flexible and feature rich, but it has some difficulties with joint
Java-Groovy projects and it is no longer under active development. The
<a href="#section-groovyeclipse">Groovy-Eclipse compiler plugin for Maven</a> sidesteps the joint compilation issues. Read
<a href="#Groovy-EclipsecompilerpluginforMaven-WhyanotherGroovycompilerforMavenWhataboutGMaven">this</a>
for a deeper discussion of the benefits and disadvantages of the two
approaches.</p>
</div>
<div class="paragraph">
<p>A third approach is to use Maven’s Ant plugin to compile a groovy
project. Note that the Ant plugin is bound to the compile and
test-compile phases of the build in the example below. It will be
invoked during these phases and the contained tasks will be carried out
which runs the Groovy compiler over the source and test directories. The
resulting Java classes will coexist with and be treated like any
standard Java classes compiled from Java source and will appear no
different to the JRE, or the JUnit runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="xml language-xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;com.mycomp.MyGroovy&lt;/groupId&gt;
    &lt;artifactId&gt;MyGroovy&lt;/artifactId&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;Maven Example building a Groovy project&lt;/name&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;3.8.1&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
            &lt;artifactId&gt;groovy-all&lt;/artifactId&gt;
            &lt;version&gt;2.1.6&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;compile&lt;/id&gt;
                        &lt;phase&gt;compile&lt;/phase&gt;
                        &lt;configuration&gt;
                            &lt;tasks&gt;
                                &lt;mkdir dir="${basedir}/src/main/groovy"/&gt;
                                &lt;taskdef name="groovyc"
                                    classname="org.codehaus.groovy.ant.Groovyc"&gt;
                                    &lt;classpath refid="maven.compile.classpath"/&gt;
                                &lt;/taskdef&gt;
                                &lt;mkdir dir="${project.build.outputDirectory}"/&gt;
                                &lt;groovyc destdir="${project.build.outputDirectory}"
                                    srcdir="${basedir}/src/main/groovy/" listfiles="true"&gt;
                                    &lt;classpath refid="maven.compile.classpath"/&gt;
                                &lt;/groovyc&gt;
                            &lt;/tasks&gt;
                        &lt;/configuration&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;run&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                    &lt;execution&gt;
                        &lt;id&gt;test-compile&lt;/id&gt;
                        &lt;phase&gt;test-compile&lt;/phase&gt;
                        &lt;configuration&gt;
                            &lt;tasks&gt;
                                &lt;mkdir dir="${basedir}/src/test/groovy"/&gt;
                                &lt;taskdef name="groovyc"
                                    classname="org.codehaus.groovy.ant.Groovyc"&gt;
                                    &lt;classpath refid="maven.test.classpath"/&gt;
                                &lt;/taskdef&gt;
                                &lt;mkdir dir="${project.build.testOutputDirectory}"/&gt;
                                &lt;groovyc destdir="${project.build.testOutputDirectory}"
                                    srcdir="${basedir}/src/test/groovy/" listfiles="true"&gt;
                                    &lt;classpath refid="maven.test.classpath"/&gt;
                                &lt;/groovyc&gt;
                            &lt;/tasks&gt;
                        &lt;/configuration&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;run&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This assumes you have a Maven project setup with <code>groovy</code> subfolders
as peers to the java src and test subfolders. You can use the <code>java</code>/<code>jar</code>
archetype to set this up then rename the java folders to groovy or keep
the java folders and just create groovy peer folders. There exists, also
a groovy plugin which has not been tested or used in production. After
defining the build section as in the above example, you can invoke the
typical Maven build phases normally. For example, <code>mvn test</code> will
execute the test phase, compiling Groovy source and Groovy test source
and finally executing the unit tests. If you run <code>mvn jar</code> it will
execute the jar phase bundling up all of your compiled production
classes into a jar after all of the unit tests pass. For more detail on
Maven build phases consult the Maven2 documentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_gmaven_and_gmavenplus">2.1.4. GMaven and GMavenPlus</h4>
<div class="sect4">
<h5 id="section-gmaven">GMaven</h5>
<div class="paragraph">
<p>GMaven is a separate project and documentation for <a href="http://docs.codehaus.org/display/GMAVEN">GMaven</a> can
be found <a href="http://docs.codehaus.org/display/GMAVEN">here</a>.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="xml language-xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.codehaus.gmaven.runtime&lt;/groupId&gt;
        &lt;artifactId&gt;gmaven-runtime-default&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;

&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.codehaus.gmaven&lt;/groupId&gt;
            &lt;artifactId&gt;gmaven-plugin&lt;/artifactId&gt;
            &lt;executions&gt;
                &lt;execution&gt;
                    &lt;goals&gt;
                        &lt;goal&gt;generateStubs&lt;/goal&gt;
                        &lt;goal&gt;compile&lt;/goal&gt;
                        &lt;goal&gt;generateTestStubs&lt;/goal&gt;
                        &lt;goal&gt;testCompile&lt;/goal&gt;
                    &lt;/goals&gt;
                &lt;/execution&gt;
            &lt;/executions&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Important:</strong></p>
</div>
<div class="paragraph">
<p>You should be aware that GMaven is <strong>not supported anymore</strong> and has problems with <a href="#section-jointcompilation">joint compilation</a>.
Should you need joint compilation, we advise that you use the <a href="#section-groovyeclipse">Groovy Eclipse maven plugin</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="section-gmavenplus">GMavenPlus</h5>
<div class="paragraph">
<p><a href="https://github.com/groovy/GMavenPlus">GMavenPlus</a> is a rewrite of <a href="#section-gmaven">GMaven</a> which is in active development. It does not support all the features
of <a href="#section-gmaven">GMaven</a> but supports newer versions of Groovy, invokedynamic, as well as joint compilation, through stubs (which
means it has the same potential issues as <a href="#section-gmaven">GMaven</a>). The main advantage over its predecessor is that
it compiles with recent versions of the compiler and supports choosing what version of Groovy is used.</p>
</div>
</div>
<div class="sect4">
<h5 id="section-gmaven2">GMaven2</h5>
<div class="paragraph">
<p>See <a href="http://groovy.github.io/gmaven/">GMaven 2</a></p>
</div>
<div class="paragraph">
<p>Unlike the name seems to indicate, <a href="http://groovy.github.io/gmaven/">GMaven 2</a> is not aimed at replacing
<a href="#section-gmaven">GMaven</a>. In fact, it&#8217;s a rewrite of the scripting features of the GMaven plugin. Interestingly,
it supports the missing features of <a href="#section-gmavenplus">GMavenPlus</a>, that is to say:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Script execution</p>
</li>
<li>
<p>Command-line shell access</p>
</li>
<li>
<p>GUI console access</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So it may be used as a complement to <a href="#section-groovyeclipse">the Groovy Eclipse plugin</a> or <a href="#section-gmavenplus">GMavenPlus</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="section-groovyeclipse">2.1.5. The Groovy Eclipse Maven plugin</h4>
<div class="paragraph">
<p>Groovy-Eclipse provides a compiler plugin for Maven. Using the compiler
plugin, it is possible to compile your maven projects using the
Groovy-Eclipse compiler.</p>
</div>
<div class="paragraph">
<p>The most recent version of the Groovy-Eclipse-Compiler plugin for maven
is 2.8.0-01.2.9.0-01-SNAPSHOT is now available from
<a href="http://nexus.codehaus.org/snapshots/">http://nexus.codehaus.org/snapshots/</a> .The most recent version of the
groovy-eclipse-batch artifact is 2.1.5-03 (for Groovy 2.1) and 2.0.7-03
(for Groovy 2.0). They are both available from maven central. </p>
</div>
<div class="sect4">
<h5 id="Groovy-EclipsecompilerpluginforMaven-Howtousethecompilerplugin---SettingupthePOM">How to use the compiler plugin—Setting up the POM</h5>
<div class="paragraph">
<p>In your plugin section, you must change the compiler used by the
<a href="http://maven.apache.org/plugins/maven-compiler-plugin/">maven-compiler-plugin</a>.
Like the <a href="http://ant.apache.org/manual/Tasks/javac.html">javac ant task</a>,
the maven-compiler-plugin does not actually compile, but rather
delegates the compilation to a different artifact (in our case, the
<code>groovy-eclipse-batch</code> artifact):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="xml language-xml">&lt;build&gt;
...
&lt;plugins&gt;
  &lt;plugin&gt;
    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
    &lt;!-- 2.8.0-01 and later require maven-compiler-plugin 3.0 or higher --&gt;
    &lt;version&gt;3.0&lt;/version&gt;
    &lt;configuration&gt;
      &lt;compilerId&gt;groovy-eclipse-compiler&lt;/compilerId&gt;
      &lt;!-- set verbose to be true if you want lots of uninteresting messages --&gt;
      &lt;!-- &lt;verbose&gt;true&lt;/verbose&gt; --&gt;
    &lt;/configuration&gt;
    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
        &lt;artifactId&gt;groovy-eclipse-compiler&lt;/artifactId&gt;
        &lt;version&gt;2.8.0-01&lt;/version&gt;
      &lt;/dependency&gt;
      &lt;!-- for 2.8.0-01 and later you must have an explicit dependency on groovy-eclipse-batch --&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
        &lt;artifactId&gt;groovy-eclipse-batch&lt;/artifactId&gt;
        &lt;version&gt;2.1.5-03&lt;/version&gt;
        &lt;!-- or choose a different compiler version --&gt;
        &lt;!-- &lt;version&gt;1.8.6-01&lt;/version&gt; --&gt;
        &lt;!-- &lt;version&gt;1.7.10-06&lt;/version&gt; --&gt;
&lt;/dependency&gt;
 &lt;/dependencies&gt;
  &lt;/plugin&gt;
  ...
&lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will allow Groovy files to be compiled. The groovy-eclipse-compiler
recognizes all settings supported by the
<a href="http://maven.apache.org/plugins/maven-compiler-plugin/">maven-compiler-plugin</a>.</p>
</div>
<div class="paragraph">
<p>Remember that you still need to specify a groovy artifact as a build
dependency in addition to the <code>maven-compiler-plugin</code> dependency.  The
groovy dependency version should match the compiler version.  Something
like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="xml language-xml">&lt;dependencies&gt;
  ...
  &lt;dependency&gt;
    &lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
    &lt;artifactId&gt;groovy-all&lt;/artifactId&gt;
    &lt;version&gt;1.8.6&lt;/version&gt;
  &lt;/dependency&gt;
  ...
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the groovy-eclipse-compiler and groovy-eclipse-batch artifacts
are available in Maven-central, so there is no need to explicitly
declare any extra repositories.</p>
</div>
</div>
<div class="sect4">
<h5 id="Groovy-EclipsecompilerpluginforMaven-Settingupthesourcefolders">Setting up the source folders</h5>
<div class="paragraph">
<p>There are several ways to set up your maven project to recognize Groovy
source files</p>
</div>
<div class="sect5">
<h6 id="Groovy-EclipsecompilerpluginforMaven-Donothing">Do nothing</h6>
<div class="paragraph">
<p>The simplest way to set up your source folders is to do nothing at all:
add all of your Groovy files to <code>src/main/java</code> and <code>src/test/java</code>.
This requires absolutely no extra configuration and is easy to
implement. However, this is not a standard maven approach to setting up
your project. If you require a more standard maven approach, then it is
possible to put your Groovy files in <code>src/main/groovy</code> and
<code>src/test/groovy</code> and you Java files in <code>src/main/java</code> and
<code>src/test/java</code>. There are several ways of doing this.</p>
</div>
</div>
<div class="sect5">
<h6 id="Groovy-EclipsecompilerpluginforMaven-Doalmostnothing">Do almost nothing</h6>
<div class="paragraph">
<p>If there is <em>at least one</em> file (Java or not) in <code>src/main/java</code>, then
all files in <code>src/main/groovy</code> will be found. If, however,
<code>src/main/java</code> is empty, then <code>src/main/groovy</code> will be ignored. You
can get around this by placing an empty file in <code>src/main/java</code> just so
that <code>src/main/groovy</code> will be recognized. The same is true for
<code>src/test/java</code> and <code>src/test/groovy</code>. This is actually a workaround for
<a href="http://jira.codehaus.org/browse/GRECLIPSE-1221">GRECLIPSE-1221</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="Groovy-EclipsecompilerpluginforMaven-Usethegroovy-eclipse-compilermojoforconfiguringsourcefolders">Use the <code>groovy-eclipse-compiler</code> mojo for configuring source folders</h6>
<div class="paragraph">
<p>(You only need this approach if your project has an empty
<code>src/main/java</code> or <code>src/test/java</code>.)</p>
</div>
<div class="paragraph">
<p>If your project has no Java files and you don’t want to add an empty
file in <code>src/main/java</code>, then you can configure source files by
referencing the groovy-eclipse-compiler mojo. Just add this to the
<code>plugins</code> section of your pom:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="xml language-xml">&lt;build&gt;
  ...
  &lt;plugin&gt;
    &lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
    &lt;artifactId&gt;groovy-eclipse-compiler&lt;/artifactId&gt;
    &lt;version&gt;2.8.0-01&lt;/version&gt;
    &lt;extensions&gt;true&lt;/extensions&gt;
  &lt;/plugin&gt;
  ...
&lt;/build&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;extensions&gt;true&lt;/extensions&gt;</code> section is important because this
redefines the default lifecycle of your project so that an extra phase
is added. This phase has an extra goal attached to it that adds the two
Groovy source folders.</p>
</div>
</div>
<div class="sect5">
<h6 id="Groovy-EclipsecompilerpluginforMaven-Usethebuild-helper-maven-plugin">Use the <code>build-helper-maven-plugin</code></h6>
<div class="paragraph">
<p>(You only need this approach if your project has an empty
<code>src/main/java</code> or <code>src/test/java</code>.)</p>
</div>
<div class="paragraph">
<p>The <code>build-helper-maven-plugin</code> allows you to do things like adding
extra source folders to your project without needing to redefine the
default lifecycle. You need to add this configuration to your build
plugin section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="xml language-xml">&lt;build&gt;
  ...
  &lt;plugin&gt;
    &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
    &lt;artifactId&gt;build-helper-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;1.5&lt;/version&gt;
    &lt;executions&gt;
      &lt;execution&gt;
        &lt;id&gt;add-source&lt;/id&gt;
        &lt;phase&gt;generate-sources&lt;/phase&gt;
        &lt;goals&gt;
          &lt;goal&gt;add-source&lt;/goal&gt;
        &lt;/goals&gt;
        &lt;configuration&gt;
          &lt;sources&gt;
            &lt;source&gt;src/main/groovy&lt;/source&gt;
          &lt;/sources&gt;
        &lt;/configuration&gt;
      &lt;/execution&gt;
      &lt;execution&gt;
        &lt;id&gt;add-test-source&lt;/id&gt;
        &lt;phase&gt;generate-test-sources&lt;/phase&gt;
        &lt;goals&gt;
          &lt;goal&gt;add-test-source&lt;/goal&gt;
        &lt;/goals&gt;
        &lt;configuration&gt;
          &lt;sources&gt;
            &lt;source&gt;src/test/groovy&lt;/source&gt;
          &lt;/sources&gt;
        &lt;/configuration&gt;
      &lt;/execution&gt;
    &lt;/executions&gt;
  &lt;/plugin&gt;
  ...
&lt;/build&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The benefit of using this approach is that you do not need to make any
changes to the default lifecycle. The downside is, of course, that you
need 31 lines of configuration to do this!</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Groovy-EclipsecompilerpluginforMaven-Sampleprojectandsourcecode">Sample project and source code</h5>
<div class="paragraph">
<p>There is an archetype available for this project. You can use it through
a command like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="xml language-xml">mvn archetype:generate \
    -DarchetypeGroupId=org.codehaus.groovy \
    -DarchetypeArtifactId=groovy-eclipse-quickstart \
    -DarchetypeVersion=2.5.2-01 \
    -DgroupId=foo \
    -DartifactId=bar \
    -Dversion=1 \
    -DinteractiveMode=false \
    -DarchetypeRepository=https://nexus.codehaus.org/content/repositories/snapshots/</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>(This archetype is not actively maintained.)</em></p>
</div>
<div class="paragraph">
<p>A
<a href="https://svn.codehaus.org/groovy/eclipse/trunk/extras/groovy-eclipse-maven-tests">sample
project</a> using the compiler plugin as well as the source code for the
plugin itself are available from the
<a href="https://github.com/groovy/groovy-eclipse/">github repository</a>:</p>
</div>
<div class="paragraph">
<p>The full URL to the maven projects
is:https://github.com/groovy/groovy-eclipse/tree/master/extrasThere are
several projects in the repository:groovy-eclipse-compiler : the
compiler plugin itself (an m2eclipse
project).groovy-eclipse-batch-builder : a set of ant scripts and
configuration files used to build the groovy-eclipse-batch artifact.
This artifact is an amalgamation of all jars required for compiling
Groovy and Java code in Eclipse, including ecj (the Eclipse compiler for
Java), the non-UI components of Groovy-Eclipse, the Groovy jars, and
various required Eclipse bundles.groovy-eclipse-maven-tests : a sample
project that uses the compiler plugin (an m2eclipse
project).org.codehaus.groovy.m2eclipse : an Eclipse plugin that provides
integration between Groovy-Eclipse and m2eclipse (the Maven tooling for
Eclipse).Feature org.codehaus.groovy.m2eclipse : an Eclipse feature that
is required for building and releasing the org.codehaus.groovy.m2eclipse
plugin.</p>
</div>
<div class="paragraph">
<p>The sample project and archetype is not maintained as well as we would
like. Some community help with this would be greatly appreciated. Please
see <a href="http://jira.codehaus.org/browse/GRECLIPSE-1285">GRECLIPSE-1285</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="Groovy-EclipsecompilerpluginforMaven-WhyanotherGroovycompilerforMavenWhataboutGMaven">Why another Groovy compiler for Maven? What about GMaven?</h5>
<div class="paragraph">
<p>GMaven 2.0 and later no longer supports compilation.  You can read more
about this on the <a href="http://groovy.github.io/gmaven/">GMaven 2 project
page</a>. <a href="#section-gmaven">GMaven 1.x</a> is now deprecated.</p>
</div>
<div class="paragraph">
<p>GMaven 1.x had limitations over the groovy-eclipse-compiler and for the
following reasons GMaven 2.0 compilation is no longer supported:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The compiler plugin does not require the creation of Java stubs so
that your Groovy files can compile against Java files. This will prevent
some arcane compile errors from appearing.</p>
</li>
<li>
<p>The Groovy-Eclipse compiler is the same inside Eclipse and inside
Maven, and so configuration across the two platforms can be simplified.</p>
</li>
<li>
<p>The compiler plugin is a
<a href="http://maven.apache.org/plugins/maven-compiler-plugin/non-javac-compilers.html">standard
compiler plugin</a> for Maven. It therefore follows all allows all the same
standard configuration that the Javac compiler plugin uses. This makes
it simpler to introduce Groovy into an existing Maven project. All you
need to do is change the compiler plugin that the pom references.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There are still some reasons to use GMaven:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>GroovyDoc tool is not supported because the compiler plugin does not
produce stubs.</p>
</li>
<li>
<p>Groovy Mojos are not supported.</p>
</li>
<li>
<p>Groovy scripts cannot be executed in your poms.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Whether or not the Groovy-Eclipse compiler plugin for Maven is
appropriate for your project will depend on your requirements.</p>
</div>
</div>
<div class="sect4">
<h5 id="Groovy-EclipsecompilerpluginforMaven-ProjectLombok">Project Lombok</h5>
<div class="paragraph">
<p><a href="http://projectlombok.org/">Project Lombok</a> is compatible with the
groovy-eclipse-compiler.  There is some extra configuration that you
need to do.  The lombok jar needs to be added to <em>both the build and
compile dependencies sections</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="xml language-xml">&lt;dependency&gt;
  &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
  &lt;artifactId&gt;lombok&lt;/artifactId&gt;
  &lt;version&gt;0.10.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, the following configuration needs to be added to the
maven-compiler-plugin configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="xml language-xml">&lt;configuration&gt;
  &lt;compilerId&gt;groovy-eclipse-compiler&lt;/compilerId&gt;
  &lt;verbose&gt;true&lt;/verbose&gt;
  &lt;compilerArguments&gt;
    &lt;javaAgentClass&gt;lombok.core.Agent&lt;/javaAgentClass&gt;
  &lt;/compilerArguments&gt;
  &lt;fork&gt;true&lt;/fork&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Groovy-EclipsecompilerpluginforMaven-Groovy-Eclipseconfiguratorform2Eclipse">Groovy-Eclipse configurator for m2Eclipse</h5>
<div class="paragraph">
<p>If you are going to be working with your maven project inside of
Eclipse, it is strongly recommended that you use
<a href="http://eclipse.org/m2e">m2eclipse</a>. And to use your Groovy projects with
m2eclipse, you will need to install the Groovy-Eclipse configurator for
m2eclipse. This feature is available any of the Groovy-Eclipse update
sites (e.g., nightly, milestone, or release). Just go to your Eclipse
update manager and add the Groovy-Eclipse update sites (if you haven’t
done so already). Select the <em>Groovy-Eclipse M2E integration</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="Groovy-EclipsecompilerpluginforMaven-ReleaseBuilds">Release Builds</h5>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eclipse level</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Release update site</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.2 (Juno)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://dist.springsource.org/release/GRECLIPSE/e4.2">http://dist.springsource.org/release/GRECLIPSE/e4.2</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.7 (Indigo)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://dist.springsource.org/release/GRECLIPSE/e3.7">http://dist.springsource.org/release/GRECLIPSE/e3.7</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="Groovy-EclipsecompilerpluginforMaven-DevelopmentBuilds">Development Builds</h5>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eclipse level</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Development update site</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.2 (Juno)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://dist.springsource.org/snapshot/GRECLIPSE/e4.2">http://dist.springsource.org/snapshot/GRECLIPSE/e4.2</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.7 (Indigo)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://dist.springsource.org/snapshot/GRECLIPSE/e3.7">http://dist.springsource.org/snapshot/GRECLIPSE/e3.7</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The Groovy-Eclipse configurator for m2eclipse is not compatible with
AspectJ or Scala.  So you cannot use a joint AspectJ/Scala/Groovy
project in Eclipse. These languages must be separated into separate
sub-projects.</p>
</div>
</div>
<div class="sect4">
<h5 id="Groovy-EclipsecompilerpluginforMaven-Wheretofindmoreinformationandaskquestions">Where to find more information and ask questions</h5>
<div class="paragraph">
<p>Please ask all questions on the Groovy-Eclipse mailing list. Any bugs or
feature enhancements should go on Groovy-Eclipse’s jira.</p>
</div>
<div class="paragraph">
<p>The compiler plugin was originally described
<a href="http://contraptionsforprogramming.blogspot.com/2010/09/where-are-all-my-stubs.html">here</a>
and
<a href="http://contraptionsforprogramming.blogspot.com/2010/10/more-on-groovy-eclipse-and-maven.html">here</a>,
but these posts are no longer updated and this page will always contain
the more recent information.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="section-jointcompilation">2.1.6. Joint compilation</h4>
<div class="paragraph">
<p>Joint compilation means that the Groovy compiler will parse the
Groovy source files, create stubs for all of them, invoke the Java
compiler to compile the stubs along with Java sources, and then continue
compilation in the normal Groovy compiler way. This allows mixing of
Java and Groovy files without constraint.</p>
</div>
<div class="paragraph">
<p>Joint compilation can be enabled using the <code>-j</code> flag with the command-line compiler,
or using using a nested tag and all the attributes and further nested tags as required
for the Ant task.</p>
</div>
<div class="paragraph">
<p>It is important to know that if you don&#8217;t enable joint compilation and try to compile
Java source files with the Groovy compiler, the Java source files will be compiled as
if they were Groovy sources. In some situations, this might work since most of the Java
syntax is compatible with Groovy, but semantics would be different.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_groovysh_the_groovy_shell">3. groovysh, the Groovy shell</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_groovy_groovy_shell">3.1. Groovy : Groovy Shell</h3>
<div class="paragraph">
<p>The Groovy Shell, aka. <code>groovysh</code> is a command-line application which
allows easy access to evaluate Groovy expressions, define classes and
run simple experiments.</p>
</div>
<div class="sect3">
<h4 id="GroovyShell-Features">3.1.1. Features</h4>
<div class="ulist">
<ul>
<li>
<p>No need for <code>go</code> command to execute buffer.</p>
</li>
<li>
<p>Rich cross-platform edit-line editing, history and completion thanks
to <a href="http://jline.sf.net">JLine</a>.</p>
</li>
<li>
<p>ANSI colors (prompt, exception traces, etc).</p>
</li>
<li>
<p>Simple, yet robust, command system with online help, user alias
support and more.</p>
</li>
<li>
<p>User profile support</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="GroovyShell-Command-lineOptionsandArguments">3.1.2. Command-line Options and Arguments</h4>
<div class="paragraph">
<p>The shell supports several options to control verbosity, ANSI coloring
and other features.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">./bin/groovysh --help
usage: groovysh [options] [...]
  -C, --color[=FLAG]         Enable or disable use of ANSI colors
  -D, --define=NAME=VALUE    Define a system property
  -T, --terminal=TYPE        Specify the terminal TYPE to use
  -V, --version              Display the version
  -d, --debug                Enable debug output
  -h, --help                 Display this help message
  -q, --quiet                Suppress superfluous output
  -v, --verbose              Enable verbose output</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to options, commands or expressions can be given on the
command-line which will invoke the shell in non-interactive mode. The
commands or expressions will be evaluated and the shell will exit. If no
additional arguments are given the shell will startup interactively.</p>
</div>
<div class="sect4">
<h5 id="GroovyShell-ExecuteaCommand">Execute a Command</h5>
<div class="listingblock">
<div class="content">
<pre>./bin/groovysh 'show preferences'
No preferences are set</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-EvaluateanExpression">Evaluate an Expression</h5>
<div class="listingblock">
<div class="content">
<pre>./bin/groovysh 'System.properties.each { k, v -&gt; println("$k = $v") }'
java.runtime.name = Java(TM) 2 Runtime Environment, Standard Edition
sun.boot.library.path = /System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Libraries
java.vm.version = 1.5.0_07-87
awt.nativeDoubleBuffering = true
gopherProxySet = false
...</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="GroovyShell-EvaluatingExpressions">3.1.3. Evaluating Expressions</h4>
<div class="sect4">
<h5 id="GroovyShell-SimpleExpressions">Simple Expressions</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">println "Hello"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-EvaluationResult">Evaluation Result</h5>
<div class="paragraph">
<p>When a complete expression is found, it is compiled and evaluated. The
result of the evaluation is stored into the _ variable.</p>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-Multi-lineExpressions">Multi-line Expressions</h5>
<div class="paragraph">
<p>Multi-line/complex expressions (like closure or class definitions) may
be defined over several lines. When the shell detects that it has a
complete expression it will compile and evaluate it.</p>
</div>
<div class="sect5">
<h6 id="GroovyShell-DefineaClass">Define a Class</h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Foo {
    def bar() {
        println "baz"
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-UsetheClass">Use the Class</h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">foo = new Foo()
foo.bar()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-Variables">Variables</h5>
<div class="paragraph">
<p>Shell variables are <strong>all</strong> untyped (ie. no <code>def</code> or other type
information).</p>
</div>
<div class="paragraph">
<p>This <strong>will</strong> set a shell variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">foo = "bar"</code></pre>
</div>
</div>
<div class="paragraph">
<p>But, this will evaluate a local variable and will <strong>not</strong> be saved to the
shell’s environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def foo = "bar"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-Functions">Functions</h5>
<div class="paragraph">
<p>Functions can be defined in the shell, and will be saved for later use.</p>
</div>
<div class="paragraph">
<p>Defining a function is easy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">groovy:000&gt; def hello(name) {
groovy:001&gt; println("Hello $name")
groovy:002&gt; }</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then using it is as one might expect:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">hello("Jason")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Internally the shell creates a closure to encapsulate the function and
then binds the closure to a variable. So variables and functions share
the same namespace.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="GroovyShell-Commands">3.1.4. Commands</h4>
<div class="paragraph">
<p>The shell has a number of different commands, which provide rich access
to the shell’s environment.</p>
</div>
<div class="paragraph">
<p>Commands all have a <em>name</em> and a <em>shortcut</em> (which is something like
<code>\h</code>). Commands may also have some predefined system <em>aliases</em>. Users
may also create their own aliases.</p>
</div>
<div class="sect4">
<h5 id="GroovyShell-RecognizedCommands">Recognized Commands</h5>
<div class="sect5">
<h6 id="GroovyShell-help"><code>help</code></h6>
<div class="paragraph">
<p>Display the list of commands (and aliases) or the help text for specific
command.</p>
</div>
<div id="GroovyShell-TheCommandList" class="paragraph">
<p>The Command List</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; help

For information about Groovy, visit:
    http://groovy.codehaus.org

Available commands:
  help      (\h ) Display this help message
  ?         (\? ) Alias to: help
  exit      (\x ) Exit the shell
  quit      (\q ) Alias to: exit
  import    (\i ) Import a class into the namespace
  display   (\d ) Display the current buffer
  clear     (\c ) Clear the buffer and reset the prompt counter.
  show      (\S ) Show variables, classes or imports
  inspect   (\n ) Inspect a variable or the last result with the GUI object browser
  purge     (\p ) Purge variables, classes, imports or preferences
  edit      (\e ) Edit the current buffer
  load      (\l ) Load a file or URL into the buffer
  .         (\. ) Alias to: load
  save      (\s ) Save the current buffer to a file
  record    (\r ) Record the current session to a file
  history   (\H ) Display, manage and recall edit-line history
  alias     (\a ) Create an alias
  set       (\= ) Set (or list) preferences
  register  (\rc) Registers a new command with the shell
  doc       (\D ) Opens a browser window displaying the doc for the argument

For help on a specific command type:
    help &lt;command&gt;</pre>
</div>
</div>
<div id="GroovyShell-HelpforaCommand" class="paragraph">
<p>Help for a Command</p>
</div>
<div class="paragraph">
<p>While in the interactive shell, you can ask for help for any command to
get more details about its syntax or function. Here is an example of
what happens when you ask for help for the <code>help</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; help help

usage: help [&lt;command&gt;]

Display the list of commands or the help text for &lt;command&gt;.</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-exit"><code>exit</code></h6>
<div class="paragraph">
<p>Exit the shell.</p>
</div>
<div class="paragraph">
<p>This is the <strong>only</strong> way to exit the shell. Well, you can still <code>CTRL-C</code>,
but the shell will complain about an abnormal shutdown of the JVM.</p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-import"><code>import</code></h6>
<div class="paragraph">
<p>Add a custom import which will be included for all shell evaluations.</p>
</div>
<div class="paragraph">
<p>This command can be given at any time to add new imports.</p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-display"><code>display</code></h6>
<div class="paragraph">
<p>Display the contents of the current buffer.</p>
</div>
<div class="paragraph">
<p>This only displays the buffer of an incomplete expression. Once the
expression is complete, the buffer is rest. The prompt will update to
show the size of the current buffer as well.</p>
</div>
<div id="GroovyShell-Example" class="paragraph">
<p>Example</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; class Foo {
groovy:001&gt; def bar
groovy:002&gt; def baz() {
groovy:003&gt; display
 001&gt; class Foo {
 002&gt; def bar
 003&gt; def baz() {</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-clear"><code>clear</code></h6>
<div class="paragraph">
<p>Clears the current buffer, resetting the prompt counter to 000. Can be used to recover from compilation errors.</p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-show"><code>show</code></h6>
<div class="paragraph">
<p>Show variables, classes or preferences or imports.</p>
</div>
<div id="GroovyShell-showvariables" class="paragraph">
<p><code>show variables</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; show variables
Variables:
  _ = true</pre>
</div>
</div>
<div id="GroovyShell-showclasses" class="paragraph">
<p><code>show classes</code></p>
</div>
<div id="GroovyShell-showimports" class="paragraph">
<p><code>show imports</code></p>
</div>
<div id="GroovyShell-showpreferences" class="paragraph">
<p><code>show preferences</code></p>
</div>
<div id="GroovyShell-showall" class="paragraph">
<p><code>show all</code></p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-inspect"><code>inspect</code></h6>
<div class="paragraph">
<p>Opens the GUI object browser to inspect a variable or the result of the
last evaluation.</p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-purge"><code>purge</code></h6>
<div class="paragraph">
<p>Purges objects from the shell.</p>
</div>
<div id="GroovyShell-purgevariables" class="paragraph">
<p><code>purge variables</code></p>
</div>
<div id="GroovyShell-purgeclasses" class="paragraph">
<p><code>purge classes</code></p>
</div>
<div id="GroovyShell-purgeimports" class="paragraph">
<p><code>purge imports</code></p>
</div>
<div id="GroovyShell-purgepreferences" class="paragraph">
<p><code>purge preferences</code></p>
</div>
<div id="GroovyShell-purgeall" class="paragraph">
<p><code>purge all</code></p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-edit"><code>edit</code></h6>
<div class="paragraph">
<p>Edit the current buffer in an external editor.</p>
</div>
<div class="paragraph">
<p>Currently only works on UNIX systems which have the <code>EDITOR</code> environment
variable set, or have configured the <code>editor</code> preference.</p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-load"><code>load</code></h6>
<div class="paragraph">
<p>Load one or more files (or urls) into the buffer.</p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-save"><code>save</code></h6>
<div class="paragraph">
<p>Saves the buffer’s contents to a file.</p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-record"><code>record</code></h6>
<div class="paragraph">
<p>Record the current session to a file.</p>
</div>
<div id="GroovyShell-recordstart" class="paragraph">
<p><code>record start</code></p>
</div>
<div id="GroovyShell-recordstop" class="paragraph">
<p><code>record stop</code></p>
</div>
<div id="GroovyShell-recordstatus" class="paragraph">
<p><code>record status</code></p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-history"><code>history</code></h6>
<div class="paragraph">
<p>Display, manage and recall edit-line history.</p>
</div>
<div id="GroovyShell-historyshow" class="paragraph">
<p><code>history show</code></p>
</div>
<div id="GroovyShell-historyrecall" class="paragraph">
<p><code>history recall</code></p>
</div>
<div id="GroovyShell-historyflush" class="paragraph">
<p><code>history flush</code></p>
</div>
<div id="GroovyShell-historyclear" class="paragraph">
<p><code>history clear</code></p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-alias"><code>alias</code></h6>
<div class="paragraph">
<p>Create an alias.</p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-doc"><code>doc</code></h6>
<div class="paragraph">
<p>Opens a browser with documentation for the provided class. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>doc java.net.URL</pre>
</div>
</div>
<div class="paragraph">
<p>will open two windows (or tabs, depending on your browser):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>one for the JDK documentation</p>
</li>
<li>
<p>one for the GDK documentation</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-set"><code>set</code></h6>
<div class="paragraph">
<p>Set or list preferences.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="GroovyShell-Preferences">3.1.5. Preferences</h4>
<div class="paragraph">
<p>Some of aspects of <code>groovysh</code> behaviors can be customized by setting
preferences. Preferences are set using the <code>set</code> command or the <code>\=</code>
shortcut.</p>
</div>
<div class="sect4">
<h5 id="GroovyShell-RecognizedPreferences">Recognized Preferences</h5>
<div class="sect5">
<h6 id="GroovyShell-verbosity"><code>verbosity</code></h6>
<div class="paragraph">
<p>Set the shell’s verbosity level. Expected to be one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DEBUG</code></p>
</li>
<li>
<p><code>VERBOSE</code></p>
</li>
<li>
<p><code>INFO</code></p>
</li>
<li>
<p><code>QUIET</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Default is <code>INFO</code>.</p>
</div>
<div class="paragraph">
<p>If this preference is set to an invalid value, then the previous setting
will be used, or if there is none, then the preference is removed and
the default is used.</p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-show-last-result"><code>show-last-result</code></h6>
<div class="paragraph">
<p>Show the last result after an execution.</p>
</div>
<div class="paragraph">
<p>Default is <code>true</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-sanitize-stack-trace"><code>sanitize-stack-trace</code></h6>
<div class="paragraph">
<p>Sanitize (trim-down/filter) stack traces.</p>
</div>
<div class="paragraph">
<p>Default is <code>true</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-editor"><code>editor</code></h6>
<div class="paragraph">
<p>Configures the editor used by the <code>edit</code> command.</p>
</div>
<div class="paragraph">
<p>Default is the value of the system environment variable <code>EDITOR</code>.</p>
</div>
<div class="paragraph">
<p>Mac OS XTo use TextEdit, the default text editor on Mac OS X, configure:
set editor /Applications/TextEdit.app/Contents/MacOS/TextEdit</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-SettingaPreference">Setting a Preference</h5>
<div class="listingblock">
<div class="content">
<pre>set verbosity DEBUG</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-ListingPreferences">Listing Preferences</h5>
<div class="paragraph">
<p>To list the current <em>set</em> preferences (and their values):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>show preferences</pre>
</div>
</div>
<div class="paragraph">
<p>LimitationAt the moment, there is no way to list all of the
known/available preferences to be set.</p>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-ClearingPreferencesieResettingtoDefaults">Clearing Preferences (ie. Resetting to Defaults)</h5>
<div class="listingblock">
<div class="content">
<pre>purge preferences</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="GroovyShell-UserProfileScriptsandState">3.1.6. User Profile Scripts and State</h4>
<div class="sect4">
<h5 id="GroovyShell-ProfileScripts">Profile Scripts</h5>
<div class="sect5">
<h6 id="GroovyShell-HOMEgroovygroovyshprofile"><code>$HOME/.groovy/groovysh.profile</code></h6>
<div class="paragraph">
<p>This script, if it exists, is loaded when the shell starts up.</p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-HOMEgroovygroovyshrc"><code>$HOME/.groovy/groovysh.rc</code></h6>
<div class="paragraph">
<p>This script, if it exists, is loaded when the shell enters interactive
mode.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-State">State</h5>
<div class="sect5">
<h6 id="GroovyShell-HOMEgroovygroovyshhistory"><code>$HOME/.groovy/groovysh.history</code></h6>
<div class="paragraph">
<p>Edit-line history is stored in this file.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="GroovyShell-register">3.1.7. Custom commands</h4>
<div class="paragraph">
<p>The <code>register</code> command allows you to register custom commands in the shell. For example, writing the following
will register the <code>Stats</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>register Stats</pre>
</div>
</div>
<div class="paragraph">
<p>where the <code>Stats</code> class is a class extending the <code>org.codehaus.groovy.tools.shell.CommandSupport</code> class. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import org.codehaus.groovy.tools.shell.CommandSupport
import org.codehaus.groovy.tools.shell.Groovysh

class Stats extends CommandSupport {
    protected Stats(final Groovysh shell) {
        super(shell, 'stats', 'T')
    }

    public Object execute(List args) {
        println "Free memory: ${Runtime.runtime.freeMemory()}"
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the command can be called using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; stats
stats
Free memory: 139474880
groovy:000&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the command class must be found on classpath: you cannot define a new command from within the shell.</p>
</div>
</div>
<div class="sect3">
<h4 id="GroovyShell-ScreenShots">3.1.8. Screen Shots</h4>
<div class="paragraph">
<p>These shots have been taken over the development of the new shell, so
some of the content might look slightly different. Also, note the yellow
colors here are the shell’s <em>bold</em> color, so the colors might look
different depending on how the enclosing shell has its colors setup.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/img/groovysh3.jpg" alt="image" title="groovysh3.jpg"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/img/groovysh2.jpg" alt="image" title="groovysh2.jpg"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/img/groovysh4.jpg" alt="image" title="groovysh4.jpg"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="GroovyShell-Troubleshooting">3.1.9. Troubleshooting</h4>
<div class="paragraph">
<p>Please <a href="http://jira.codehaus.org/browse/GROOVY">report</a> any problems you
run into. Please be sure to mark the JIRA issue with the <code>Groovysh</code>
component.</p>
</div>
<div class="sect4">
<h5 id="GroovyShell-PlatformProblems">Platform Problems</h5>
<div class="sect5">
<h6 id="GroovyShell-ProblemsloadingtheJLineDLL">Problems loading the JLine DLL</h6>
<div class="paragraph">
<p>On Windows, <a href="http://jline.sf.net">JLine</a> (which is used for the fancy
shell input/history/completion fluff), uses a <strong>tiny</strong> DLL file to trick
the <strong>evil</strong> Windows faux-shell (<code>CMD.EXE</code> or <code>COMMAND.COM</code>) into
providing Java with unbuffered input. In some rare cases, this might
fail to load or initialize.</p>
</div>
<div class="paragraph">
<p>One solution is to disable the frills and use the unsupported terminal
instance. You can do that on the command-line using the <code>--terminal</code>
flag and set it to one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>none</code></p>
</li>
<li>
<p><code>false</code></p>
</li>
<li>
<p><code>off</code></p>
</li>
<li>
<p><code>jline.UnsupportedTerminal</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>groovysh --terminal=none</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-ProblemswithCygwinonWindows">Problems with Cygwin on Windows</h6>
<div class="paragraph">
<p>as
Some people have issues when running groovysh with cygwin. If you have
troubles, the following may help:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>stty -icanon min 1 -echo
groovysh --terminal=unix
stty icanon echo</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_groovyconsole_the_groovy_swing_console">3.2. groovyConsole, the Groovy swing console</h3>
<div class="sect3">
<h4 id="title-heading">3.2.1. Groovy : Groovy Console</h4>
<div class="paragraph">
<p>The Groovy Swing Console allows a user to enter and run Groovy scripts.
This page documents the features of this user interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="GroovyConsole-Basics">3.2.2. Basics</h4>
<div class="paragraph">
<p><span class="image"><img src="assets/img/GroovyConsole.gif" alt="image"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Groovy Console is launched via <code>groovyConsole</code> or
<code>groovyConsole.bat</code>, both located in <code>$GROOVY_HOME/bin</code></p>
</li>
<li>
<p>The Console has an input area and an output area.</p>
</li>
<li>
<p>You type a Groovy script in the input area.</p>
</li>
<li>
<p>When you select <code>Run</code> from the <code>Actions</code> menu, the console
compiles the script and runs it.</p>
</li>
<li>
<p>Anything that would normally be printed on <code>System.out</code> is printed in
the output area.</p>
</li>
<li>
<p>If the script returns a non-null result, that result is printed.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="GroovyConsole-Features">3.2.3. Features</h4>
<div class="sect4">
<h5 id="GroovyConsole-RunningScripts">Running Scripts</h5>
<div class="paragraph">
<p>There are several shortcuts that you can use to run scripts or code snippets:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Ctrl+Enter</code> and <code>Ctrl+R</code> are both shortcut keys for <code>Run Script</code>.</p>
</li>
<li>
<p>If you highight just part of the text in the input area, then Groovy
runs just that text.</p>
</li>
<li>
<p>The result of a script is the the value of the last expression
executed.</p>
</li>
<li>
<p>You can turn the System.out capture on and off by selecting <code>Capture
System.out</code> from the <code>Actions</code> menu</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="GroovyConsole-EditingFiles">Editing Files</h5>
<div class="paragraph">
<p>You can open any text file, edit it, run it (as a Groovy Script) and
then save it again when you are finished.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select <code>File &gt; Open</code> (shortcut key <code>ctrl+O</code>) to open a file</p>
</li>
<li>
<p>Select <code>File &gt; Save</code> (shortcut key <code>ctrl+S</code>) to save a file</p>
</li>
<li>
<p>Select <code>File &gt; New File</code> (shortcut key <code>ctrl+Q</code>) to start again with a
blank input area</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="GroovyConsole-Historyandresults">History and results</h5>
<div class="ulist">
<ul>
<li>
<p>You can pop-up a gui inspector on the last (non-null) result by
selecting <code>Inspect Last</code> from the <code>Actions</code> menu. The inspector is a
convenient way to view lists and maps.</p>
</li>
<li>
<p>The console remembers the last ten script runs. You can scroll back
and forth through the history by selecting <code>Next</code> and <code>Previous</code>
from the <code>Edit</code> menu. <code>Ctrl-N</code> and <code>ctrl-P</code> are convenient shortcut keys.</p>
</li>
<li>
<p>The last (non-null) result is bound to a variable named <code>_</code> (an
underscore).</p>
</li>
<li>
<p>The last result (null and non-null) for every run in the history is
bound into a list variable named <code>__</code> (two underscores). The result of
the last run is <code>__[-1]</code>, the result of the second to last run is
<code>__[-2]</code> and so forth.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="GroovyConsole-Interrupt">Interrupting a script</h5>
<div class="paragraph">
<p>The Groovy console is a very handy tool to develop scripts. Often, you will
find yourself running a script multiple times until it works the way you want
it to. However, what if your code takes too long to finish or worse, creates
an infinite loop? Interrupting script execution can be acheived by clicking
the <code>interrupt</code> button on the small dialog box that pops up when a script
is executing or through the <code>interrupt</code> icon in the tool bar.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/img/gconsole-toolbar.png" alt="Toolbar"></span></p>
</div>
<div class="paragraph">
<p>However, this may not be sufficient to interrupt a script: clicking the button
will interrupt the execution thread, but if your code doesn&#8217;t handle the interrupt
flag, the script is likely to keep running without you being able to effectively
stop it. To avoid that, you have to make sure that the <code>Script &gt; Allow interruption</code>
menu item is flagged. This will automatically apply an AST transformation to your
script which will take care of checking the interrupt flag (<code>@ThreadInterrupt</code>).
This way, you guarantee that the script can be interrupted even if you don&#8217;t explicitly
handle interruption, at the cost of extra execution time.</p>
</div>
</div>
<div class="sect4">
<h5 id="GroovyConsole-Andmore">And more</h5>
<div class="ulist">
<ul>
<li>
<p>You can change the font size by selecting <code>Smaller Font</code> or <code>Larger
Font</code> from the <code>Actions menu</code></p>
</li>
<li>
<p>The console can be run as an Applet thanks to <code>groovy.ui.ConsoleApplet</code></p>
</li>
<li>
<p>Code is auto indented when you hit return</p>
</li>
<li>
<p>You can drag’n drop a Groovy script over the text area to open a file</p>
</li>
<li>
<p>You can modify the classpath with which the script in the console is
being run by adding a new JAR or a directory to the classpath from the
<code>Script</code> menu</p>
</li>
<li>
<p>Error hyperlinking from the output area when a compilation error is
expected or when an exception is thrown</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="GroovyConsole-EmbeddingtheConsole">3.2.4. Embedding the Console</h4>
<div class="paragraph">
<p>To embed a Swing console in your application, simply create the Console
object,<br>
 load some variables, and then launch it. The console can be embedded in
either Java or Groovy code.<br>
 The Java code for this is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="java language-java">import groovy.ui.Console;

    ...

    Console console = new Console();
    console.setVariable("var1", getValueOfVar1());
    console.setVariable("var2", getValueOfVar2());
    console.run();

    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the console is launched, you can use the variable values in Groovy
code.</p>
</div>
<div class="paragraph">
<p>An example of how to embed either the GroovyConsole or GroovyShell in a
Spring Web application can be found at
<a href="http://groovy.codehaus.org/Embedding+a+Groovy+Console+in+a+Java+Server+Application">Embedding
a Groovy Console in a Java Server Application</a></p>
</div>
</div>
<div class="sect3">
<h4 id="GroovyConsole-Visualizingscriptoutputresults">3.2.5. Visualizing script output results</h4>
<div class="paragraph">
<p>You can customize the way script output results are visualized. Let’s
see how we can customize this. For example, viewing a map result would
show something like this:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/img/gconsole-sc-without-visu.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>What you see here is the usual textual representation of a Map. But,
what if we enabled custom visualization of certain results? The Swing
console allows you to do just that. First of all, you have to ensure
that the visualization option is ticked: <code>View -&gt; Visualize Script
Results</code> — for the record, all settings of the Groovy Console are stored
and remembered thanks to the Preference API. There are a few result
visualizations built-in: if the script returns a <code>java.awt.Image</code>, a
<code>javax.swing.Icon</code>, or a <code>java.awt.Component</code> with no parent, the object is
displayed instead of its <code>toString()</code> representation. Otherwise,
everything else is still just represented as text. Now, create the
following Groovy script in <code>~/.groovy/OutputTransforms.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import javax.swing.*

transforms &lt;&lt; { result -&gt;
    if (result instanceof Map) {
        def table = new JTable(
            result.collect{ k, v -&gt;
                [k, v?.inspect()] as Object[]
            } as Object[][],
            ['Key', 'Value'] as Object[])
        table.preferredViewportSize = table.preferredSize
        return new JScrollPane(table)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Groovy Swing console will execute that script on startup, injecting
a transforms list in the binding of the script, so that you can add your
own script results representations. In our case, we transform the Map
into a nice-looking Swing JTable. And we’re now able to visualize maps
in a friendly and attractive fashion, as the screenshot below shows:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/img/gconsole-sc-with-visu.png" alt="image"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="GroovyConsole-ASTbrowser">3.2.6. AST browser</h4>
<div class="paragraph">
<p>Groovy Console can visualize the AST (Abstract Syntax Tree) representing
the currently edited script, as shown by the screenshot below. This is
particularly handy when you want to develop AST transformations.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/img/astbrowser.png" alt="AST Browser"></span></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_groovydoc_the_groovy_java_documentation_generator">3.3. groovydoc, the Groovy &amp; Java documentation generator</h3>
<div class="paragraph">
<p>GroovyDoc is a tool responsible for generating documentation from your code. It acts like the Javadoc tool in the
Java world but is capable of handling both <code>groovy</code> and <code>java</code> files. The distribution comes with two ways of generating
documentation: from <a href="#Groovydoc-CommandLine">command line</a> or from <a href="#Groovydoc-Ant">Apache Ant</a>. Other build tools
like Maven or Gradle also offer wrappers for Groovydoc.</p>
</div>
<div class="sect3">
<h4 id="Groovydoc-CommandLine">3.3.1. The groovydoc command line tool</h4>
<div class="paragraph">
<p>The <code>groovydoc</code> command line can be invoked to generate groovydocs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovydoc [options] [packagenames] [sourcefiles]</pre>
</div>
</div>
<div class="paragraph">
<p>where options must be picked from the following table:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 22%;">
<col style="width: 22%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Short version</th>
<th class="tableblock halign-left valign-top">Long version</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-windowtitle &lt;text&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browser window title for the documentation</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-author</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include @author paragraphs (currently not used)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-charset &lt;charset&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Charset for cross-platform viewing of generated documentation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-classpath, -cp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--classpath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify where to find the class files - must be
first argument</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--destdir &lt;dir&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination directory for output files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--debug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable debug output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-doctitle &lt;html&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include title for the overview page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-exclude &lt;pkglist&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify a list of packages to exclude
(separated by colons for all operating systems)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-fileEncoding &lt;charset&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Charset for generated documentation files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-footer &lt;html&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include footer text for each page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-header &lt;html&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include header text for each page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-help</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--help</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display help message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-nomainforscripts</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Don&#8217;t include the implicit <em>public static void
main</em> method for scripts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-noscripts</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Don&#8217;t process Groovy Scripts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-overview &lt;file&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read overview documentation from HTML file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-package</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show package/protected/public classes and members</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-private</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show all classes and members</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-protected</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show protected/public classes and members (default)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-public</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show only public classes and members</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-quiet</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suppress superfluous output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-sourcepath &lt;pathlist&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify where to find source files (dirs
separated by platform path separator)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-stylesheetfile &lt;path&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File to change style of the generated documentation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-verbose</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable verbose output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display the version</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Groovydoc-Ant">3.3.2. The groovydoc Ant task</h4>
<div class="paragraph">
<p>The <code>groovydoc</code> Ant task allows generating groovydocs from an Ant build.</p>
</div>
<div class="sect4">
<h5 id="ThegroovydocAnttask-Requiredtaskdef">Required taskdef</h5>
<div class="paragraph">
<p>Assuming <code>groovy-all-2.4.0-SNAPSHOT.jar</code> is in <em>my.classpath</em> you will need to
declare this task at some point in the build.xml prior to the groovydoc
task being invoked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="xml language-xml">&lt;taskdef name         = "groovydoc"
         classname    = "org.codehaus.groovy.ant.Groovydoc"
         classpathref = "my.classpath"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ThegroovydocAnttask-groovydocAttributes">&lt;groovydoc&gt; Attributes</h5>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">private</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show all classes and members (i.e. including private ones) if
set to &#8220;true&#8221;.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">destdir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location to store the class files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sourcepath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sourcepath to use.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">packagenames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated list of package files (with terminating
wildcard).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">use</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create class and package usage pages.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">windowtitle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browser window title for the documentation (text).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">doctitle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include title for the package index(first) page (html-code).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include header text for each page (html-code).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">footer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include footer text for each page (html-code).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">overview</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read overview documentation from HTML file.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="ThegroovydocAnttask-groovydocNestedElements">&lt;groovydoc&gt; Nested Elements</h5>
<div class="sect5">
<h6 id="ThegroovydocAnttask-link">link</h6>
<div class="paragraph">
<p>Create link to groovydoc/javadoc output at the given URL.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">href</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base URL of external site</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">packages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated list of package prefixes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="ThegroovydocAnttask-Example1-groovydocAnttask">Example #1 - &lt;groovydoc&gt; Ant task</h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="xml language-xml">&lt;taskdef name           = "groovydoc"
         classname      = "org.codehaus.groovy.ant.Groovydoc"
         classpathref   = "path_to_groovy_all"/&gt;

&lt;groovydoc destdir      = "${docsDirectory}/gapi"
           sourcepath   = "${mainSourceDirectory}"
           packagenames = "**.*"
           use          = "true"
           windowtitle  = "${title}"
           doctitle     = "${title}"
           header       = "${title}"
           footer       = "${docFooter}"
           overview     = "src/main/overview.html"
           private      = "false"&gt;
        &lt;link packages="java.,org.xml.,javax.,org.xml." href="http://download.oracle.com/javase/6/docs/api"/&gt;
        &lt;link packages="org.apache.tools.ant."          href="http://evgeny-goldin.org/javadoc/ant/api"/&gt;
        &lt;link packages="org.junit.,junit.framework."    href="http://kentbeck.github.com/junit/javadoc/latest"/&gt;
        &lt;link packages="groovy.,org.codehaus.groovy."   href="http://groovy.codehaus.org/api/"/&gt;
        &lt;link packages="org.codehaus.gmaven."           href="http://evgeny-goldin.org/javadoc/gmaven"/&gt;
&lt;/groovydoc&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="ThegroovydocAnttask-Example2-ExecutinggroovydocfromGroovy">Example #2 - Executing &lt;groovydoc&gt; from Groovy</h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def ant = new AntBuilder()
ant.taskdef(name: "groovydoc", classname: "org.codehaus.groovy.ant.Groovydoc")
ant.groovydoc(
    destdir      : "${docsDirectory}/gapi",
    sourcepath   : "${mainSourceDirectory}",
    packagenames : "**.*",
    use          : "true",
    windowtitle  : "${title}",
    doctitle     : "${title}",
    header       : "${title}",
    footer       : "${docFooter}",
    overview     : "src/main/overview.html",
    private      : "false") {
        link(packages:"java.,org.xml.,javax.,org.xml.",href:"http://download.oracle.com/javase/6/docs/api")
        link(packages:"groovy.,org.codehaus.groovy.",  href:"http://groovy.codehaus.org/api")
        link(packages:"org.apache.tools.ant.",         href:"http://evgeny-goldin.org/javadoc/ant/api")
        link(packages:"org.junit.,junit.framework.",   href:"http://kentbeck.github.com/junit/javadoc/latest")
        link(packages:"org.codehaus.gmaven.",          href:"http://evgeny-goldin.org/javadoc/gmaven")
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_custom_templates">Custom templates</h5>
<div class="paragraph">
<p>The <code>groovydoc</code> Ant task supports custom templates, but it requires two steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A custom groovydoc class</p>
</li>
<li>
<p>A new groovydoc task definition</p>
</li>
</ol>
</div>
<div class="sect5">
<h6 id="_custom_groovydoc_class">Custom Groovydoc class</h6>
<div class="paragraph">
<p>The first step requires you to extend the <code>Groovydoc</code> class, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="java language-java">package org.codehaus.groovy.tools.groovydoc;

import org.codehaus.groovy.ant.Groovydoc;

/**
 * Overrides GroovyDoc's default class template - for testing purpose only.
 *
 * @author Andre Steingress
 */
public class CustomGroovyDoc extends Groovydoc {

    @Override
    protected String[] getClassTemplates() {
        return new String[]{"org/codehaus/groovy/tools/groovydoc/testfiles/classDocName.html"};
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can override the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getClassTemplates</code> for class-level templates</p>
</li>
<li>
<p><code>getPackageTemplates</code> for package-level templates</p>
</li>
<li>
<p><code>getDocTemplates</code> for top-level templates</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find the list of default templates in the <code>org.codehaus.groovy.tools.groovydoc.gstringTemplates.GroovyDocTemplateInfo</code>
class.</p>
</div>
</div>
<div class="sect5">
<h6 id="_using_the_custom_groovydoc_task">Using the custom groovydoc task</h6>
<div class="paragraph">
<p>Once you&#8217;ve written the class, using it is just a matter of redefining the <code>groovydoc</code> task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="xml language-xml">&lt;taskdef name           = "groovydoc"
         classname      = "org.codehaus.groovy.ant.CustomGroovyDoc"
         classpathref   = "path_to_groovy_all"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that template customization is provided as is. APIs are subject to change, so you must consider this as a
fragile feature.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ide_integration">3.4. IDE integration</h3>
<div class="paragraph">
<p>The Groovy language is supported by lots of IDEs and text editors.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Editor</th>
<th class="tableblock halign-left valign-top">Support level</th>
<th class="tableblock halign-left valign-top">Syntax highlighting</th>
<th class="tableblock halign-left valign-top">Code completion</th>
<th class="tableblock halign-left valign-top">Refactoring</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.ultraedit.com/">UltraEdit</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em class="icon-star"></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text based</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://groovy.codehaus.org/Eclipse+Plugin">Groovy Eclipse</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em class="icon-star"></em> <em class="icon-star"></em> <em class="icon-star"></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.jetbrains.com/idea/features/groovy.html">IntelliJ IDEA</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em class="icon-star"></em> <em class="icon-star"></em> <em class="icon-star"></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/features/groovy/">Netbeans</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em class="icon-star"></em> <em class="icon-star"></em> <em class="icon-star"></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://grails.org/products/ggts">Groovy and Grails Toolsuite</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em class="icon-star"></em> <em class="icon-star"></em> <em class="icon-star"></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://groovy.codehaus.org/Emacs+Groovy+Mode">Emacs Groovy Mode</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em class="icon-star"></em> <em class="icon-star"></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Brackets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/textmate/groovy.tmbundle">TextMate</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em class="icon-star"></em> <em class="icon-star"></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Snippets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.vim.org/">vim</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em class="icon-star"></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_guides">4. User Guides</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_getting_started">4.1. Getting started</h3>
<div class="sect3">
<h4 id="_download">4.1.1. Download</h4>
<div class="paragraph">
<p>In this download area, you will be able to download the distribution (binary and source), the Windows installer and the documentation for <strong>Groovy</strong>.</p>
</div>
<div class="paragraph">
<p>For a quick and effortless start on Mac OSX, Linux or Cygwin, you can use <a href="http://gvmtool.net">GVM</a> (the Groovy enVironment Manager) to download and configure any <strong>Groovy</strong> version of your choice. Basic <a href="#gvm-the-groovy-environment-manager">instructions</a> can be found below.</p>
</div>
<div class="sect4">
<h5 id="_stable">Stable</h5>
<div class="ulist">
<ul>
<li>
<p><strong>Download zip</strong>: <a href="http://dist.groovy.codehaus.org/distributions/groovy-binary-2.4.0-SNAPSHOT.zip"><strong>Binary Release</strong></a> | <a href="http://dist.groovy.codehaus.org/distributions/groovy-src-2.4.0-SNAPSHOT.zip">Source Release</a></p>
</li>
<li>
<p><strong>Download documentation</strong>: <a href="http://dist.groovy.codehaus.org/distributions/groovy-docs-2.4.0-SNAPSHOT.zip"><strong>JavaDoc and zipped online documentation</strong></a></p>
</li>
<li>
<p><strong>Combined binary / source / documentation bundle</strong>: <a href="http://dist.groovy.codehaus.org/distributions/groovy-sdk-2.4.0-SNAPSHOT.zip"><strong>Distribution bundle</strong></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can learn more about this version in the <a href="http://groovy.codehaus.org/Groovy+2.4+release+notes">release notes</a> or in the <a href="http://jira.codehaus.org/secure/ReleaseNote.jspa?projectId=10242&amp;version=19074">JIRA release notes</a>.</p>
</div>
<div class="paragraph">
<p>If you plan on using invokedynamic support, <a href="invokedynamic-support.html">read those notes</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_snapshots">Snapshots</h5>
<div class="paragraph">
<p>For those who want to test the very latest versions of Groovy and live on the bleeding edge, you can use our <a href="http://snapshots.repository.codehaus.org/org/codehaus/groovy/groovy-all/">snapshot builds</a>. As soon as a build succeeds on our continuous integration server a snapshot is deployed to Codehaus&#8217; snapshot repository.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_maven_repository">4.1.2. Maven Repository</h4>
<div class="paragraph">
<p>If you wish to embed Groovy in your application, you may just prefer to point to your favourite maven repositories or the <a href="http://repository.codehaus.org/org/codehaus/groovy">codehaus maven repository</a>.</p>
</div>
<div class="sect4">
<h5 id="_stable_release">Stable Release</h5>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Gradle</th>
<th class="tableblock halign-left valign-top">Maven</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'org.codehaus.groovy:groovy:2.4.0-SNAPSHOT&#8217;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
&lt;artifactId&gt;groovy&lt;/artifactId&gt;
&lt;version&gt;2.4.0-SNAPSHOT&lt;/version&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Just the core of groovy without the modules (see below). Treats Antlr, ASM, etc. as standard dependencies. Only useful if you happen to also use the same versions of these jars yourself as it will save you having two copies of these jars.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'org.codehaus.groovy:groovy-$module:2.4.0-SNAPSHOT&#8217;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
&lt;artifactId&gt;groovy-$module&lt;/artifactId&gt;
&lt;version&gt;2.4.0-SNAPSHOT&lt;/version&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"$module" stands for the different optional groovy modules "ant", "bsf", "console", "docgenerator", "groovydoc", "groovysh", "jmx", "json", "jsr223", "servlet", "sql", "swing", "test", "testng" and "xml". Example: &lt;artifactId&gt;groovy-sql&lt;/artifactId&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'org.codehaus.groovy:groovy-all:2.4.0-SNAPSHOT&#8217;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
&lt;artifactId&gt;groovy-all&lt;/artifactId&gt;
&lt;version&gt;2.4.0-SNAPSHOT&lt;/version&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The core plus all the modules. Also includes jar versions of Antlr, ASM, Commons-CLI and Retrotranslator runtime. Allows you or your other dependencies (e.g. Hibernate) to use other versions of these jars. Optional dependencies are marked as optional. You may need to include some of the optional dependencies to use some features of Groovy, e.g. AntBuilder, GroovyMBeans, etc.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To use the <a href="invokedynamic-support.html">InvokeDynamic</a> version of the jars just append ':indy&#8217; for Gradle or &lt;classifier&gt;indy&lt;/classifier&gt; for Maven.</p>
</div>
</div>
<div class="sect4">
<h5 id="_snapshot_releases">Snapshot Releases</h5>
<div class="paragraph">
<p>In addition to the stable and milestone releases you can find intermediate SNAPSHOT releases at the <a href="http://snapshots.repository.codehaus.org/org/codehaus/groovy">codehaus snapshot maven repository</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gvm_the_groovy_environment_manager">4.1.3. GVM (the Groovy enVironment Manager)</h4>
<div class="paragraph">
<p>This tool makes installing Groovy on any Bash platform (Mac OSX, Linux, Cygwin, Solaris or FreeBSD) very easy.</p>
</div>
<div class="paragraph">
<p>Simply open a new terminal and enter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="shell language-shell">$ curl -s get.gvmtool.net | bash</code></pre>
</div>
</div>
<div class="paragraph">
<p>Follow the instructions on-screen to complete installation.</p>
</div>
<div class="paragraph">
<p>Open a new terminal or type the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="shell language-shell">$ source "$HOME/.gvm/bin/gvm-init.sh"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then install the latest stable Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="shell language-shell">$ gvm install groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>After installation is complete and you&#8217;ve made it your default version, test it with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="shell language-shell">$ groovy -version</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s all there is to it!</p>
</div>
</div>
<div class="sect3">
<h4 id="_other_ways_to_get_groovy">4.1.4. Other ways to get Groovy</h4>
<div class="sect4">
<h5 id="_installation_on_mac_os_x">Installation on Mac OS X</h5>
<div class="sect5">
<h6 id="_macports">MacPorts</h6>
<div class="paragraph">
<p>If you&#8217;re on MacOS and have <a href="http://www.macports.org">MacPorts</a> installed, you can run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="shell language-shell">sudo port install groovy</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_homebrew">Homebrew</h6>
<div class="paragraph">
<p>If you&#8217;re on MacOS and have <a href="http://mxcl.github.com/homebrew">Homebrew</a> installed, you can run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="shell language-shell">brew install groovy</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_installation_on_windows">Installation on Windows</h5>
<div class="paragraph">
<p>If you&#8217;re on Windows, you can also use the <a href="TODO-Windows+NSIS-Installer">NSIS Windows installer</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_other_distributions">Other Distributions</h5>
<div class="paragraph">
<p>You may download other distributions of Groovy from <a href="http://dist.codehaus.org/groovy/distributions/">this site</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_source_code">Source Code</h5>
<div class="paragraph">
<p>If you prefer to live on the bleeding edge, you can also grab the <a href="https://github.com/groovy/groovy-core">source code from GitHub</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ide_plugin">IDE plugin</h5>
<div class="paragraph">
<p>If you are an IDE user, you can just grab the latest <a href="tools/tools-ide.html">IDE plugin</a> and follow the plugin installation instructions.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_install_binary">4.1.5. Install Binary</h4>
<div class="paragraph">
<p>These instructions describe how to install a binary distribution of <strong>Groovy</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, <a href="#download-groovy">Download</a> a binary distribution of Groovy and unpack it into some file on your local file system.</p>
</li>
<li>
<p>Set your <code>GROOVY_HOME</code> environment variable to the directory you unpacked the distribution.</p>
</li>
<li>
<p>Add <code>GROOVY_HOME/bin</code> to your <code>PATH</code> environment variable.</p>
</li>
<li>
<p>Set your <code>JAVA_HOME</code> environment variable to point to your JDK. On OS X this is <code>/Library/Java/Home</code>, on other unixes its often <code>/usr/java</code> etc. If you&#8217;ve already installed tools like Ant or Maven you&#8217;ve probably already done this step.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You should now have Groovy installed properly. You can test this by typing the following in a command shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="shell language-shell">groovysh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which should create an interactive groovy shell where you can type Groovy statements. Or to run the <a href="tools/tools-groovyconsole.html">Swing interactive console</a> type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="shell language-shell">groovyConsole</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run a specific Groovy script type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="shell language-shell">groovy SomeScript</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_differences_with_java">4.2. Differences with Java</h3>
<div class="paragraph">
<p>Groovy tries to be as natural as possible for Java developers. We’ve
tried to follow the principle of least surprise when designing Groovy,
particularly for developers learning Groovy who’ve come from a Java
background.</p>
</div>
<div class="paragraph">
<p>Here we list all the major differences between Java and Groovy.</p>
</div>
<div class="sect3">
<h4 id="_default_imports">4.2.1. Default imports</h4>
<div class="paragraph">
<p>All these packages and classes are imported by default, i.e. you do not
have to use an explicit <code>import</code> statement to use them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>java.io.*</p>
</li>
<li>
<p>java.lang.*</p>
</li>
<li>
<p>java.math.BigDecimal</p>
</li>
<li>
<p>java.math.BigInteger</p>
</li>
<li>
<p>java.net.*</p>
</li>
<li>
<p>java.util.*</p>
</li>
<li>
<p>groovy.lang.*</p>
</li>
<li>
<p>groovy.util.*</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_multi_methods">4.2.2. Multi-methods</h4>
<div class="paragraph">
<p>In Groovy, the methods which will be invoked are chosen at runtime. This is called runtime dispatch or multi-methods. It
means that the method will be chosen based on the types of the arguments at runtime. In Java, this is the opposite: methods
are chosen at compile time, based on the declared types.</p>
</div>
<div class="paragraph">
<p>The following code, written as Java code, can be compiled in both Java and Groovy, but it will behave differently:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="java language-java">int method(String arg) {
    return 1;
}
int method(Object arg) {
    return 2;
}
Object o = "Object";
int result = method(o);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Java, you would have:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="java language-java">assertEquals(2, result);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Whereas in Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="java language-java">assertEquals(1, result);</code></pre>
</div>
</div>
<div class="paragraph">
<p>That is because Java will use the static information type, which is that <code>o</code> is declared as an <code>Object</code>, whereas
Groovy will choose at runtime, when the method is actually called. Since it is called with a <code>String</code>, then the
<code>String</code> version is called.</p>
</div>
</div>
<div class="sect3">
<h4 id="_array_initializers">4.2.3. Array initializers</h4>
<div class="paragraph">
<p>In Groovy, the <code>{ ... }</code> block is reserved for closures. That means that you cannot create array literals with this
syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">int[] array = { 1, 2, 3}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You actually have to use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">int[] array = [1,2,3]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_package_scope_visibility">4.2.4. Package scope visibility</h4>
<div class="paragraph">
<p>In Groovy, omitting a modifier on a field doesn&#8217;t result in a package-private field like in Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Person {
    String name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead, it is used to create a <em>property</em>, that is to say a <em>private field</em>, an associated <em>getter</em> and an associated
_setter.</p>
</div>
<div class="paragraph">
<p>It is possible to create a package-private field by annotating it with <code>@PackageScope</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Person {
    @PackageScope String name
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arm_blocks">4.2.5. ARM blocks</h4>
<div class="paragraph">
<p>ARM (Automatic Resource Management) block from Java 7 are not supported in Groovy. Instead, Groovy provides various
methods relying on closures, which have the same effect while being more idiomatic. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="java language-java">Path file = Paths.get("/path/to/file");
Charset charset = Charset.forName("UTF-8");
try (BufferedReader reader = Files.newBufferedReader(file, charset)) {
    String line;
    while ((line = reader.readLine()) != null) {
        System.out.println(line);
    }

} catch (IOException e) {
    e.printStackTrace();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>can be written like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">new File('/path/to/file').eachLine('UTF-8') {
   println it
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or, if you want a version closer to Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">new File('/path/to/file').withReader('UTF-8') { reader -&gt;
   reader.eachLine {
       println it
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_inner_classes">4.2.6. Inner classes</h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
The implementation of anonymous inner classes and nested classes follows the Java lead, but
you should not take out the Java Language Spec and keep shaking the head
about things that are different. The implementation done looks much like
what we do for <code>groovy.lang.Closure</code>, with some benefits and some
differences. Accessing private fields and methods for example can become
a problem, but on the other hand local variables don’t have to be final.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_static_inner_classes">Static inner classes</h5>
<div class="paragraph">
<p>Here’s an example of static inner class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class A {
    static class B {}
}

new A.B()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The usage of static inner classes is the best supported one. If you
absolutely need an inner class, you should make it a static one.</p>
</div>
</div>
<div class="sect4">
<h5 id="_anonymous_inner_classes">Anonymous Inner Classes</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">boolean called = false

Timer timer = new Timer()
timer.schedule(new TimerTask() {
    void run() {
        called = true
    }
}, 0)
sleep 100

assert called</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_creating_instances_of_non_static_inner_classes">Creating Instances of Non-Static Inner Classes</h5>
<div class="paragraph">
<p>In Java you can do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="java language-java">public class Y {
    public class X {}
    public X foo() {
        return new X();
    }
    public static X createX(Y y) {
        return y.new X();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy doesn&#8217;t support the <code>y.new X()</code> syntax. Instead, you have to write <code>new X(y)</code>, like in the code below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">public class Y {
    public class X {}
    public X foo() {
        return new X()
    }
    public static X createX(Y y) {
        return new X(y)
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
Caution though, Groovy supports calling methods with one
parameter without giving an argument. The parameter will then have the
value null. Basically the same rules apply to calling a constructor.
There is a danger that you will write new X() instead of new X(this) for
example. Since this might also be the regular way we have not yet found
a good way to prevent this problem.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lambdas">4.2.7. Lambdas</h4>
<div class="paragraph">
<p>Java 8 supports lambdas and method references:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Runnable run = () -&gt; System.out.println("Run");
list.forEach(System.out::println);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Java 8 lambdas can be more or less considered as anonymous inner classes. Groovy doesn&#8217;t support that syntax, but has closures
instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Runnable run = { println 'run' }
list.each { println it } // or list.each(this.&amp;println)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_groovy_development_kit_peter_ledbrook">4.3. Groovy Development Kit (Peter Ledbrook)</h3>
<div class="sect3">
<h4 id="_working_with_io_peter_ledbrook">4.3.1. Working with IO (Peter Ledbrook)</h4>

</div>
<div class="sect3">
<h4 id="_working_with_collections_tbd">4.3.2. Working with collections (TBD)</h4>

</div>
<div class="sect3">
<h4 id="_handy_utilities">4.3.3. Handy utilities</h4>
<div class="sect4">
<h5 id="_configslurper">ConfigSlurper</h5>
<div class="paragraph">
<p><code>ConfigSlurper</code> is a utility class for reading configuration files defined in the form of Groovy scripts. Like it is
the case with Java <code>*.properties</code> files, <code>ConfigSlurper</code> allows a dot notation. But in addition, it allows for Closure scoped
configuration values and arbitrary object types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def config = new ConfigSlurper().parse('''
    app.date = new Date()  <i class="conum" data-value="1"></i><b>(1)</b>
    app.age  = 42
    app {                  <i class="conum" data-value="2"></i><b>(2)</b>
        name = "Test${42}"
    }
''')

assert config.app.date instanceof Date
assert config.app.age == 42
assert config.app.name == 'Test42'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Usage of the dot notation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Usage of Closure scopes as an alternative to the dot notation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As can be seen in the above example, the <code>parse</code> method can be used to retrieve <code>groovy.util.ConfigObject</code> instances. The
<code>ConfigObject</code> is a specialized <code>java.util.Map</code> implementation that either returns the configured value or a new <code>ConfigObject</code>
instance but never <code>null</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def config = new ConfigSlurper().parse('''
    app.date = new Date()
    app.age  = 42
    app.name = "Test${42}"
''')

assert config.test != null   <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>config.test</code> has not been specified yet it returns a <code>ConfigObject</code> when being called.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the case of a dot being part of a configuration variable name, it can be escaped by using single or double quotes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def config = new ConfigSlurper().parse('''
    app."person.age"  = 42
''')

assert config.app."person.age" == 42</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, <code>ConfigSlurper</code> comes with support for <code>environments</code>. The <code>environments</code> method can be used to hand over
a Closure instance that itself may consist of a several sections. Let&#8217;s say we wanted to create a particular configuration
value for the development environment. When creating the <code>ConfigSlurper</code> instance we can use the <code>ConfigSlurper(String)</code>
constructor to specify the target environment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def config = new ConfigSlurper('development').parse('''
  environments {
       development {
           app.port = 8080
       }

       test {
           app.port = 8082
       }

       production {
           app.port = 80
       }
  }
''')

assert config.app.port == 8080</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
The <code>ConfigSlurper</code> environments aren&#8217;t restricted to any particular environment names. It solely depends on the
<code>ConfigSlurper</code> client code what value are supported and interpreted accordingly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>environments</code> method is built-in but the <code>registerConditionalBlock</code> method can be used to register other method names
in addition to the <code>environments</code> name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def slurper = new ConfigSlurper()
slurper.registerConditionalBlock('myProject', 'developers')   <i class="conum" data-value="1"></i><b>(1)</b>

def config = slurper.parse('''
  sendMail = true

  myProject {
       developers {
           sendMail = false
       }
  }
''')

assert !config.sendMail</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Once the new block is registered <code>ConfigSlurper</code> can parse it.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For Java integration purposes the <code>toProperties</code> method can be used to convert the <code>ConfigObject</code> to a <code>java.util.Properties</code>
object that might be stored to a <code>*.properties</code> text file. Be aware though that the configuration values are converted to
<code>String</code> instances during adding them to the newly created <code>Properties</code> instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def config = new ConfigSlurper().parse('''
    app.date = new Date()
    app.age  = 42
    app {
        name = "Test${42}"
    }
''')

def properties = config.toProperties()

assert properties."app.date" instanceof String
assert properties."app.age" == '42'
assert properties."app.name" == 'Test42'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_expando">Expando</h5>
<div class="paragraph">
<p>The <code>Expando</code> class can be used to create a dynamically expandable object. Despite its name it does not use the
<code>ExpandoMetaClass</code> underneath. Each <code>Expando</code> object represents a standalone, dynamically-crafted instance that can be
extended with properties (or methods) at runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def expando = new Expando()
expando.name = 'John'

assert expando.name == 'John'</code></pre>
</div>
</div>
<div class="paragraph">
<p>A special case occurs when a dynamic property registers a <code>Closure</code> code block. Once being registered it can be invoked
as it would be done with a method call.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def expando = new Expando()
expando.toString = { -&gt; 'John' }
expando.say = { String s -&gt; "John says: ${s}" }

assert expando as String == 'John'
assert expando.say('Hi') == 'John says: Hi'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_observable_list_map_and_set">Observable list, map and set</h5>
<div class="paragraph">
<p>Groovy comes with observable lists, maps and sets. Each of these collections trigger <code>java.beans.PropertyChangeEvent</code> events when elements
are added, removed or changed. Note that a <code>PropertyChangeEvent</code> is not only signaling that a certain event has
 occurred, moreover, it holds information on the property name and the old/new value a certain property has been changed to.</p>
</div>
<div class="paragraph">
<p>Depending on the type of change that has happened, observable collections might fire more specialized <code>PropertyChangeEvent</code>
 types. For example, adding an element to an observable list fires an <code>ObservableList.ElementAddedEvent</code> event.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def event                                       <i class="conum" data-value="1"></i><b>(1)</b>
def listener = {
    if (it instanceof ObservableList.ElementEvent)  {  <i class="conum" data-value="2"></i><b>(2)</b>
        event = it
    }
} as PropertyChangeListener


def observable = [1, 2, 3] as ObservableList    <i class="conum" data-value="3"></i><b>(3)</b>
observable.addPropertyChangeListener(listener)  <i class="conum" data-value="4"></i><b>(4)</b>

observable.add 42                               <i class="conum" data-value="5"></i><b>(5)</b>

assert event instanceof ObservableList.ElementAddedEvent

def elementAddedEvent = event as ObservableList.ElementAddedEvent
assert elementAddedEvent.changeType == ObservableList.ChangeType.ADDED
assert elementAddedEvent.index == 3
assert elementAddedEvent.oldValue == null
assert elementAddedEvent.newValue == 42</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declares a <code>PropertyChangeEventListener</code> that is capturing the fired events</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>ObservableList.ElementEvent</code> and its descendant types are relevant for this listener</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Registers the listener</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Creates an <code>ObservableList</code> from the given list</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Triggers an <code>ObservableList.ElementAddedEvent</code> event</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Be aware that adding an element in fact causes two events to be triggered. The first is of type <code>ObservableList.ElementAddedEvent</code>,
the second is a plain <code>PropertyChangeEvent</code> that informs listeners about the change of property <code>size</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>ObservableList.ElementClearedEvent</code> event type is another interesting one. Whenever multiple
 elements are removed, for example when calling <code>clear()</code>, it holds the elements being removed from the list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def event
def listener = {
    if (it instanceof ObservableList.ElementEvent)  {
        event = it
    }
} as PropertyChangeListener


def observable = [1, 2, 3] as ObservableList
observable.addPropertyChangeListener(listener)

observable.clear()

assert event instanceof ObservableList.ElementClearedEvent

def elementClearedEvent = event as ObservableList.ElementClearedEvent
assert elementClearedEvent.values == [1, 2, 3]
assert observable.size() == 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get an overview of all the supported event types the reader is encouraged to have a look at the JavaDoc documentation
or the source code of the observable collection in use.</p>
</div>
<div class="paragraph">
<p><code>ObservableMap</code> and <code>ObservableSet</code> come with the same concepts as we have seen for <code>ObservableList</code> in this section.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_metaprogramming">4.4. Metaprogramming</h3>
<div class="paragraph">
<p>The Groovy language supports two flavors of metaprogramming: runtime metaprogramming and compile-time metaprogramming.
The first one allows altering the class model and the behavior of a program at runtime, while the second only occurs
at compile-time. Both have pros and cons, that we will detail in this section.</p>
</div>
<div class="sect3">
<h4 id="_runtime_metaprogramming_tbd">4.4.1. Runtime metaprogramming (TBD)</h4>
<div class="sect4">
<h5 id="_groovyobject_interface_tbd">GroovyObject interface (TBD)</h5>
<div class="sect5">
<h6 id="_invokemethod_tbd">invokeMethod (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_get_setproperty_tbd">get/setProperty (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_get_setmetaclass_tbd">get/setMetaClass (TBD)</h6>

</div>
</div>
<div class="sect4">
<h5 id="_get_setattribute_tbd">get/setAttribute (TBD)</h5>

</div>
<div class="sect4">
<h5 id="_methodmissing">methodMissing</h5>
<div class="paragraph">
<p>Groovy supports the concept of <code>methodMissing</code>. This method differs from <code>invokeMethod</code> in that it
is only invoked in the case of a failed method dispatch, when no method can be found for the given name and/or the
given arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Foo {
   def methodMissing(String name, def args) {
        return "this is me"
   }
}

assert new Foo().someUnknownMethod(42l) == 'this is me'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Typically when using <code>methodMissing</code> the code will react in some way that makes it possible for the next time the same
method is called, that it goes through the regular Groovy method dispatch logic.</p>
</div>
<div class="paragraph">
<p>For example consider dynamic finders in GORM. These are implemented in terms of <code>methodMissing</code>. The code resembles
something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class GORM {
   def dynamicMethods = [...] // an array of dynamic methods that use regex
   def methodMissing(String name, args) {
       def method = dynamicMethods.find { it.match(name) }
       if(method) {
          GORM.metaClass."$name" = { Object[] varArgs -&gt;
             method.invoke(delegate, name, varArgs)
          }
          return method.invoke(delegate,name, args)
       }
       else throw new MissingMethodException(name, delegate, args)
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how, if we find a method to invoke then we dynamically register a new method on the fly using <code>ExpandoMetaClass</code>.
This is so that the next time the same method is called it is more efficient. This way <code>methodMissing</code> doesn&#8217;t have
the overhead of <code>invokeMethod</code> <em>and</em> is not expensive for the second call.</p>
</div>
</div>
<div class="sect4">
<h5 id="_propertymissing">propertyMissing</h5>
<div class="paragraph">
<p>Groovy supports the concept of <code>propertyMissing</code> for intercepting otherwise failing property resolution attempts. In the
case of a getter method, <code>propertyMissing</code> takes a single String argument resembling the property name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Foo {
   def propertyMissing(String name) { name }
}

assert new Foo().boo == 'boo'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>propertyMissing(String)</code> method is only called when no getter method for the given property can be found by the Groovy
runtime.</p>
</div>
<div class="paragraph">
<p>For a setter methods a second <code>propertyMissing</code> definition can be added that takes an additional value argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Foo {
   def storage = [:]
   def propertyMissing(String name, value) { storage[name] = value }
   def propertyMissing(String name) { storage[name] }
}

def f = new Foo()
f.foo = "bar"

assert f.foo == "bar"</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with <code>methodMissing</code> it is best practice to dynamically register new properties at runtime to improve the overall lookup
performance.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<code>methodMissing</code> and <code>propertyMissing</code> that deal with static methods and properties can be added via
the <a href="core-metaprogramming.html#metaprogramming_emc">ExpandoMetaClass</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_groovyinterceptable_tbd">GroovyInterceptable (TBD)</h5>

</div>
<div class="sect4">
<h5 id="_categories">Categories</h5>
<div class="paragraph">
<p>There are situations where it is useful if a class <em>not</em> under control had additional methods. In order to enable this
capability, Groovy implements a feature borrowed from Objective-C, called <em>Categories</em>.</p>
</div>
<div class="paragraph">
<p>Categories are implemented with so-called <em>category classes</em>. A category class is special in that it needs to meet certain
pre-defined rules for defining extension methods.</p>
</div>
<div class="paragraph">
<p>There are a few categories that are included in the system for adding functionality to classes that make them more
usable within the Groovy environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://groovy.codehaus.org/api/groovy/time/TimeCategory.html">groovy.time.TimeCategory</a></p>
</li>
<li>
<p><a href="http://groovy.codehaus.org/api/groovy/servlet/ServletCategory.html">groovy.servlet.ServletCategory</a></p>
</li>
<li>
<p><a href="http://groovy.codehaus.org/api/groovy/xml/dom/DOMCategory.html">groovy.xml.dom.DOMCategory</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Category classes aren&#8217;t enabled by default. To use the methods defined in a category class it is necessary to apply
the scoped <code>use</code> method that is provided by the GDK and available from inside every Groovy object instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">use(TimeCategory)  {
    println 1.minute.from.now       <i class="conum" data-value="1"></i><b>(1)</b>
    println 10.hours.ago

    def someDate = new Date()       <i class="conum" data-value="2"></i><b>(2)</b>
    println someDate - 3.months
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>TimeCategory</code> adds methods to <code>Integer</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>TimeCategory</code> adds methods to <code>Date</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>use</code> method takes the category class as its first parameter and a closure code block as second parameter. Inside the
<code>Closure</code> access to the category methods is available. As can be seen in the example above even JDK classes
like <code>java.lang.Integer</code> or <code>java.util.Date</code> can be enriched with user-defined methods.</p>
</div>
<div class="paragraph">
<p>A category needs not to be directly exposed to the user code, the following will also do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class JPACategory{
  // Let's enhance JPA EntityManager without getting into the JSR committee
  static void persistAll(EntityManager em , Object[] entities) { //add an interface to save all
    entities?.each { em.persist(it) }
  }
}

def transactionContext = {
  EntityManager em, Closure c -&gt;
  def tx = em.transaction
  try {
    tx.begin()
    use(JPACategory) {
      c()
    }
    tx.commit()
  } catch (e) {
    tx.rollback()
  } finally {
    //cleanup your resource here
  }
}

// user code, they always forget to close resource in exception, some even forget to commit, let's not rely on them.
EntityManager em; //probably injected
transactionContext (em) {
 em.persistAll(obj1, obj2, obj3)
 // let's do some logics here to make the example sensible
 em.persistAll(obj2, obj4, obj6)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we have a look at the <code>groovy.time.TimeCategory</code> class we see that the extension methods are all declared as <code>static</code>
methods. In fact, this is one of the requirements that must be met by category classes for its methods to be successfully added to
a class inside the <code>use</code> code block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">public class TimeCategory {

    public static Date plus(final Date date, final BaseDuration duration) {
        return duration.plus(date);
    }

    public static Date minus(final Date date, final BaseDuration duration) {
        final Calendar cal = Calendar.getInstance();

        cal.setTime(date);
        cal.add(Calendar.YEAR, -duration.getYears());
        cal.add(Calendar.MONTH, -duration.getMonths());
        cal.add(Calendar.DAY_OF_YEAR, -duration.getDays());
        cal.add(Calendar.HOUR_OF_DAY, -duration.getHours());
        cal.add(Calendar.MINUTE, -duration.getMinutes());
        cal.add(Calendar.SECOND, -duration.getSeconds());
        cal.add(Calendar.MILLISECOND, -duration.getMillis());

        return cal.getTime();
    }

    // ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another requirement is the first argument of the static method must define the type the method is attached to once being activated. The
other arguments are the normal arguments the method will take as parameters.</p>
</div>
<div class="paragraph">
<p>Because of the parameter and static method convention, category method definitions may be a bit less intuitive than
normal method definitions. As an alternative Groovy comes with a <code>@Category</code> annotation that transforms annotated classes
into category classes at compile-time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Distance {
    def number
    String toString() { "${number}m" }
}

@Category(Number)
class NumberCategory {
    Distance getMeters() {
        new Distance(number: this)
    }
}

use (NumberCategory)  {
    assert 42.meters.toString() == '42m'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Applying the <code>@Category</code> annotation has the advantage of being able to use instance methods without the target type as a
first parameter. The target type class is given as an argument to the annotation instead.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
There is a distinct section on <code>@Category</code> in the <a href="core-metaprogramming.html#xform-Category">compile-time metaprogramming section</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_metaclasses_tbd">Metaclasses (TBD)</h5>
<div class="sect5">
<h6 id="_custom_metaclasses_tbd">Custom metaclasses (TBD)</h6>
<div class="sect6">
<h7 id="_delegating_metaclass_tbd">Delegating metaclass (TBD)</h7>

</div>
<div class="sect6">
<h7 id="_magic_package_tbd">Magic package (TBD)</h7>

</div>
</div>
<div class="sect5">
<h6 id="_per_instance_metaclass_tbd">Per instance metaclass (TBD)</h6>

</div>
<div class="sect5">
<h6 id="metaprogramming_emc">ExpandoMetaClass</h6>
<div class="paragraph">
<p>Groovy comes with a special <code>MetaClass</code> the so-called <code>ExpandoMetaClass</code>. It is special in that it allows for dynamically
adding or changing methods, constructors, properties and even static methods by using a neat closure syntax.</p>
</div>
<div class="paragraph">
<p>Applying those modifications can be especially useful in mocking or stubbing scenarios as shown in the <a href="core-testing-guide.html#testing_guide_emc">Testing Guide</a>.</p>
</div>
<div class="paragraph">
<p>Every <code>java.lang.Class</code> is supplied by Groovy with a special <code>metaClass</code> property that will give you a reference to an
<code>ExpandoMetaClass</code> instance. This instance can then be used to add methods or change the behaviour of already existing
ones.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
By default <code>ExpandoMetaClass</code> doesn&#8217;t do inheritance. To enable this you must call <code>ExpandoMetaClass#enableGlobally()</code>
before your app starts such as in the main method or servlet bootstrap.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following sections go into detail on how <code>ExpandoMetaClass</code> can be used in various scenarios.</p>
</div>
<div class="sect6">
<h7 id="_methods_2">Methods</h7>
<div class="paragraph">
<p>Once the <code>ExpandoMetaClass</code> is accessed by calling the <code>metaClass</code> property, methods can added by using either the left shift
<code>&lt;&lt;</code> or the <code>=</code> operator.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Note that the left shift operator is used to <em>append</em> a new method. If the method already exists
an exception will be thrown. If you want to <em>replace</em> a method you can use the <code>=</code> operator.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The operators are applied on a non-existent property of <code>metaClass</code> passing an instance of a <code>Closure</code> code block.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Book {
   String title
}

Book.metaClass.titleInUpperCase &lt;&lt; {-&gt; title.toUpperCase() }

def b = new Book(title:"The Stand")

assert "THE STAND" == b.titleInUpperCase()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above shows how a new method can be added to a class by accessing the <code>metaClass</code> property and using the <code>&lt;&lt;</code> or
 <code>=</code> operator to assign a <code>Closure</code> code block. The <code>Closure</code> parameters are interpreted as method parameters. Parameterless methods
 can be added by using the <code>{-&gt; ...}</code> syntax.</p>
</div>
</div>
<div class="sect6">
<h7 id="_properties_2">Properties</h7>
<div class="paragraph">
<p><code>ExpandoMetaClass</code> supports two mechanisms for adding or overriding properties.</p>
</div>
<div class="paragraph">
<p>Firstly, it has support for declaring a <em>mutable property</em> by simply assigning a value to a property of <code>metaClass</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Book {
   String title
}

Book.metaClass.author = "Stephen King"
def b = new Book()

assert "Stephen King" == b.author</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another way is to add getter and/or setter methods by using the standard mechanisms for adding instance methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Book {
  String title
}
Book.metaClass.getAuthor &lt;&lt; {-&gt; "Stephen King" }

def b = new Book()

assert "Stephen King" == b.author</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the source code example above the property is dictated by the closure and is a read-only property. It is feasible to add
an equivalent setter method but then the property value needs to be stored for later usage. This could be done as
shown in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Book {
  String title
}

def properties = Collections.synchronizedMap([:])

Book.metaClass.setAuthor = { String value -&gt;
   properties[System.identityHashCode(delegate) + "author"] = value
}
Book.metaClass.getAuthor = {-&gt;
   properties[System.identityHashCode(delegate) + "author"]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is not the only technique however. For example in a servlet container one way might be to store the values in
the currently executing request as request attributes (as is done in some cases in Grails).</p>
</div>
</div>
<div class="sect6">
<h7 id="_constructors">Constructors</h7>
<div class="paragraph">
<p>Constructors can be added by using a special <code>constructor</code> property. Either the <code>&lt;&lt;</code> or <code>=</code> operator can be used
to assign a <code>Closure</code> code block. The <code>Closure</code> arguments will become the constructor arguments when the code is
executed at runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Book {
    String title
}
Book.metaClass.constructor &lt;&lt; { String title -&gt; new Book(title:title) }

def book = new Book('Groovy in Action - 2nd Edition')
assert book.title == 'Groovy in Action - 2nd Edition'</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Be careful when adding constructors however, as it is very easy to get into stack overflow troubles.
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_static_methods">Static Methods</h7>
<div class="paragraph">
<p>Static methods can be added using the same technique as instance methods with the addition of the <code>static</code> qualifier
before the method name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Book {
   String title
}

Book.metaClass.static.create &lt;&lt; { String title -&gt; new Book(title:title) }

def b = Book.create("The Stand")</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_borrowing_methods">Borrowing Methods</h7>
<div class="paragraph">
<p>With <code>ExpandoMetaClass</code> it is possible to use Groovy&#8217;s method pointer syntax to borrow methods from other classes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Person {
    String name
}
class MortgageLender {
   def borrowMoney() {
      "buy house"
   }
}

def lender = new MortgageLender()

Person.metaClass.buyHouse = lender.&amp;borrowMoney

def p = new Person()

assert "buy house" == p.buyHouse()</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_dynamic_method_names">Dynamic Method Names</h7>
<div class="paragraph">
<p>Since Groovy allows you to use Strings as property names this in turns allows you to dynamically create method and
property names at runtime. To create a method with a dynamic name simply use the language feature of reference property
names as strings.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Person {
   String name = "Fred"
}

def methodName = "Bob"

Person.metaClass."changeNameTo${methodName}" = {-&gt; delegate.name = "Bob" }

def p = new Person()

assert "Fred" == p.name

p.changeNameToBob()

assert "Bob" == p.name</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same concept can be applied to static methods and properties.</p>
</div>
<div class="paragraph">
<p>One application of dynamic method names can be found in the Grails web application framework. The concept of "dynamic
codecs" is implemented by using dynamic method names.</p>
</div>
<div class="listingblock">
<div class="title"><code>HTMLCodec</code> Class</div>
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class HTMLCodec {
    static encode = { theTarget -&gt;
        HtmlUtils.htmlEscape(theTarget.toString())
    }

    static decode = { theTarget -&gt;
    	HtmlUtils.htmlUnescape(theTarget.toString())
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above shows a codec implementation. Grails comes with various codec implementations each defined in a single class.
At runtime there will be multiple codec classes in the application classpath. At application startup the framework adds
a <code>encodeXXX</code> and a <code>decodeXXX</code> method to certain meta-classes where <code>XXX</code> is the first part of the codec class name (e.g.
<code>encodeHTML</code>). This mechanism is in the following shown in some Groovy pseudo-code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def codecs = classes.findAll { it.name.endsWith('Codec') }

codecs.each { codec -&gt;
    Object.metaClass."encodeAs${codec.name-'Codec'}" = { codec.newInstance().encode(delegate) }
    Object.metaClass."decodeFrom${codec.name-'Codec'}" = { codec.newInstance().decode(delegate) }
}


def html = '&lt;html&gt;&lt;body&gt;hello&lt;/body&gt;&lt;/html&gt;'

assert '&lt;html&gt;&lt;body&gt;hello&lt;/body&gt;&lt;/html&gt;' == html.encodeAsHTML()</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_runtime_discovery">Runtime Discovery</h7>
<div class="paragraph">
<p>At runtime it is often useful to know what other methods or properties exist at the time the method is executed. <code>ExpandoMetaClass</code>
provides the following methods as of this writing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getMetaMethod</code></p>
</li>
<li>
<p><code>hasMetaMethod</code></p>
</li>
<li>
<p><code>getMetaProperty</code></p>
</li>
<li>
<p><code>hasMetaProperty</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Why can&#8217;t you just use reflection? Well because Groovy is different, it has the methods that are "real" methods and
methods that are available only at runtime. These are sometimes (but not always) represented as MetaMethods. The
MetaMethods tell you what methods are available at runtime, thus your code can adapt.</p>
</div>
<div class="paragraph">
<p>This is of particular use when overriding <code>invokeMethod</code>, <code>getProperty</code> and/or <code>setProperty</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_groovyobject_methods">GroovyObject Methods</h7>
<div class="paragraph">
<p>Another feature of <code>ExpandoMetaClass</code> is that it allows to override the methods <code>invokeMethod</code>, <code>getProperty</code> and
<code>setProperty</code>, all of them can be found in the <code>groovy.lang.GroovyObject</code> class.</p>
</div>
<div class="paragraph">
<p>The following example shows how to override <code>invokeMethod</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Stuff {
   def invokeMe() { "foo" }
}

Stuff.metaClass.invokeMethod = { String name, args -&gt;
   def metaMethod = Stuff.metaClass.getMetaMethod(name, args)
   def result
   if(metaMethod) result = metaMethod.invoke(delegate,args)
   else {
      result = "bar"
   }
   result
}

def stf = new Stuff()

assert "foo" == stf.invokeMe()
assert "bar" == stf.doStuff()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first step in the <code>Closure</code> code is to lookup the <code>MetaMethod</code> for the given name and arguments. If the method
can be found everything is fine and it is delegated to. If not, a dummy value is returned.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
A <code>MetaMethod</code> is a method that is known to exist on the <code>MetaClass</code> whether added at runtime or at compile-time.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The same logic can be used to override <code>setProperty</code> or <code>getProperty</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Person {
   String name = "Fred"
}

Person.metaClass.getProperty = { String name -&gt;
   def metaProperty = Person.metaClass.getMetaProperty(name)
   def result
   if(metaProperty) result = metaProperty.getProperty(delegate)
   else {
      result = "Flintstone"
   }
   result
}

def p = new Person()

assert "Fred" == p.name
assert "Flintstone" == p.other</code></pre>
</div>
</div>
<div class="paragraph">
<p>The important thing to note here is that instead of a <code>MetaMethod</code> a <code>MetaProperty</code> instance is looked up. If that exists
the <code>getProperty</code> method of the <code>MetaProperty</code> is called, passing the delegate.</p>
</div>
</div>
<div class="sect6">
<h7 id="_overriding_static_invokemethod">Overriding Static invokeMethod</h7>
<div class="paragraph">
<p><code>ExpandoMetaClass</code> even allows for overriding static method with a special <code>invokeMethod</code> syntax.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Stuff {
   static invokeMe() { "foo" }
}

Stuff.metaClass.'static'.invokeMethod = { String name, args -&gt;
   def metaMethod = Stuff.metaClass.getStaticMetaMethod(name, args)
   def result
   if(metaMethod) result = metaMethod.invoke(delegate,args)
   else {
      result = "bar"
   }
   result
}

assert "foo" == Stuff.invokeMe()
assert "bar" == Stuff.doStuff()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The logic that is used for overriding the static method is the same as we&#8217;ve seen before for overriding instance methods. The
only difference is the access to the <code>metaClass.static</code> property and the call to <code>getStaticMethodName</code> for retrieving
the static <code>MetaMethod</code> instance.</p>
</div>
</div>
<div class="sect6">
<h7 id="_extending_interfaces">Extending Interfaces</h7>
<div class="paragraph">
<p>It is possible to add methods onto interfaces with <code>ExpandoMetaClass</code>. To do this however, it <strong>must</strong> be enabled
globally using the <code>ExpandoMetaClass.enableGlobally()</code> method before application start-up.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">List.metaClass.sizeDoubled = {-&gt; delegate.size() * 2 }

def list = []

list &lt;&lt; 1
list &lt;&lt; 2

assert 4 == list.sizeDoubled()</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_extension_modules">Extension modules</h5>
<div class="sect5">
<h6 id="_extending_existing_classes">Extending existing classes</h6>
<div class="paragraph">
<p>An extension module allows you to add new methods to existing classes, including classes which are precompiled, like
classes from the JDK. Those new methods, unlike those defined through a metaclass or using a category, are available
globally. For example, when you write:</p>
</div>
<div class="listingblock">
<div class="title">Standard extension method</div>
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def file = new File(...)
def contents = file.getText('utf-8')</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getText</code> method doesn’t exist on the <code>File</code> class. However, Groovy knows it because it is defined in a special
class, <code>ResourceGroovyMethods</code>:</p>
</div>
<div class="listingblock">
<div class="title">ResourceGroovyMethods.java</div>
<div class="content">
<pre class="prettyprint"><code class="java language-java">public static String getText(File file, String charset) throws IOException {
 return IOGroovyMethods.getText(newReader(file, charset));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may notice that the extension method is defined using a static method in a &#8220;helper&#8221; class (where various extension
methods are defined). The first argument of the <code>getText</code> method corresponds to the receiver, while additional parameters
correspond to the arguments of the extension method. So here, we are defining a method called <em>getText</em> on
the <code>File</code> class (because the first argument is of type <code>File</code>), which takes a single argument as a parameter (the encoding <code>String</code>).</p>
</div>
<div class="paragraph">
<p>The process of creating an extension module is simple:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>write an extension class like above</p>
</li>
<li>
<p>write a module descriptor file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then you have to make the extension module visible to Groovy, which is as simple as having the extension module classes
and descriptor available on classpath. This means that you have the choice:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>either provide the classes and module descriptor directly on classpath</p>
</li>
<li>
<p>or bundle your extension module into a jar for reusability</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An extension module may add two kind of methods to a class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>instance methods (to be called on an instance of a class)</p>
</li>
<li>
<p>static methods (to be called on the class itself)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_instance_methods">Instance methods</h6>
<div class="paragraph">
<p>To add an instance method to an existing class, you need to create an extension class. For example, let&#8217;s say you
want to add a <code>maxRetries</code> method on <code>Integer</code> which accepts a closure and executes it at most <em>n</em> times until no
exception is thrown. To do that, you only need to write the following:</p>
</div>
<div class="listingblock">
<div class="title">MaxRetriesExtension.groovy</div>
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class MaxRetriesExtension {                                     <i class="conum" data-value="1"></i><b>(1)</b>
    static void maxRetries(Integer self, Closure code) {        <i class="conum" data-value="2"></i><b>(2)</b>
        int retries = 0
        Throwable e
        while (retries&lt;self) {
            try {
                code.call()
                break
            } catch (Throwable err) {
                e = err
                retries++
            }
        }
        if (retries==0 &amp;&amp; e) {
            throw e
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The extension class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>First argument of the static method corresponds to the receiver of the message, that is to say the extended instance</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then, after <a href="#module-descriptor">having declared your extension class</a>, you can call it this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">int i=0
5.maxRetries {
    i++
}
assert i == 1
i=0
try {
    5.maxRetries {
        throw new RuntimeException("oops")
    }
} catch (RuntimeException e) {
    assert i == 5
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_static_methods_2">Static methods</h6>
<div class="paragraph">
<p>It is also possible to add static methods to a class. In that case, the static method needs to be defined in its <strong>own</strong>
file:</p>
</div>
<div class="listingblock">
<div class="title">StaticStringExtension.groovy</div>
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class StaticStringExtension {                                       <i class="conum" data-value="1"></i><b>(1)</b>
    static String greeting(String self) {                           <i class="conum" data-value="2"></i><b>(2)</b>
        'Hello, world!'
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The static extension class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>First argument of the static method corresponds to the class being extended and is <strong>unused</strong></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In which case you can call it directly on the <code>String</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert String.greeting() == 'Hello, world!'</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="module-descriptor">Module descriptor</h6>
<div class="paragraph">
<p>For Groovy to be able to load your extension methods, you must declare
your extension helper classes. You must create a file named
<code>org.codehaus.groovy.runtime.ExtensionModule</code> into the
<code>META-INF/services</code> directory:</p>
</div>
<div class="listingblock">
<div class="title">org.codehaus.groovy.runtime.ExtensionModule</div>
<div class="content">
<pre>moduleName=Test module for specifications
moduleVersion=1.0-test
extensionClasses=support.MaxRetriesExtension
staticExtensionClasses=support.StaticStringExtension</pre>
</div>
</div>
<div class="paragraph">
<p>The module descriptor requires 4 keys:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>moduleName</em> : the name of your module</p>
</li>
<li>
<p><em>moduleVersion</em>: the version of your module. Note that version number
is only used to check that you don’t load the same module in two
different versions.</p>
</li>
<li>
<p><em>extensionClasses</em>: the list of extension helper classes for instance
methods. You can provide several classes, given that they are comma
separated.</p>
</li>
<li>
<p><em>staticExtensionClasses</em>: the list of extension helper classes for
static methods. You can provide several classes, given that they are
comma separated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that it is not required for a module to define both static helpers
and instance helpers, and that you may add several classes to a single
module. You can also extend different classes in a single module without
problem. It is even possible to use different classes in a single
extension class, but it is recommended to group extension methods into
classes by feature set.</p>
</div>
</div>
<div class="sect5">
<h6 id="_extension_modules_and_classpath">Extension modules and classpath</h6>
<div class="paragraph">
<p>It&#8217;s worth noting that you can&#8217;t use an extension which is compiled at the same time as code using it. That means that
to use an extension, it <strong>has</strong> to be available on classpath, as compiled classes, before the code using it gets compiled.
Usually, this means that you can&#8217;t have the <em>test</em> classes in the same source unit as the extension class itself. Since
in general, test sources are separated from normal sources and executed in another step of the build, this is not an issue.</p>
</div>
</div>
<div class="sect5">
<h6 id="_compatibility_with_type_checking">Compatibility with type checking</h6>
<div class="paragraph">
<p>Unlike categories, extension modules are compatible with type checking: if they are found on classpath, then the type
checker is aware of the extension methods and will not complain when you call them. It is also compatible with static
compilation.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compile_time_metaprogramming">4.4.2. Compile-time metaprogramming</h4>
<div class="paragraph">
<p>Compile-time metaprogramming in Groovy allows code generation at compile-time. Those transformations are altering the
Abstract Syntax Tree (AST) of a program, which is why in Groovy we call it AST transformations. AST transformations
allow you to hook into the compilation process, modify the AST and continue the compilation process to generate regular
bytecode. Compared to runtime metaprogramming, this has the advantage of making the changes visible in the class file
itself (that is to say, in the bytecode). Making it visible in the bytecode is important for example if you want the
transformations to be part of the class contract (implementing interfaces, extending abstract classes, &#8230;) or even
if you need your class to be callable from Java (or other JVM languages). For example, an AST transformation can add
methods to a class. If you do it with runtime metaprogramming, the new method would only be visible from Groovy. If you
do the same using compile-time metaprogramming, the method would be visible from Java too. Last but not least, performance
would likely be better with compile-time metaprogramming (because no initialization phase is required).</p>
</div>
<div class="paragraph">
<p>In this section, we will start with explaining the various compile-time transformations that are bundled with the Groovy
distribution. In a subsequent section, we will describe how you can <a href="#developing-ast-xforms">implement your own AST transformations</a>
and what are the disadvantages of this technique.</p>
</div>
<div class="sect4">
<h5 id="_available_ast_transformations">Available AST transformations</h5>
<div class="paragraph">
<p>Groovy comes with various AST transformations covering different needs: reducing boilerplate (code generation), implementing
design patterns (delegation, &#8230;), logging, declarative concurrency, cloning, safer scripting, tweaking the compilation,
implementing Swing patterns, testing and eventually managing dependencies. If none of those AST transformations cover
your needs, you can still implement your own, as show in section <a href="#developing-ast-xforms">Developing your own AST
transformations</a>.</p>
</div>
<div class="paragraph">
<p>AST transformations can be separated into two categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>global AST transformations are applied transparently, globally, as soon as they are found on compile classpath</p>
</li>
<li>
<p>local AST transformations are applied by annotating the source code with markers. Unlike global AST transformations,
local AST transformations may support parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Groovy doesn&#8217;t ship with any global AST transformation, but you can find a list of local AST transformations
available for you to use in your code here:</p>
</div>
<div class="sect5">
<h6 id="_code_generation_transformations">Code generation transformations</h6>
<div class="paragraph">
<p>This category of transformation includes AST transformations which help removing boilerplate code. This is typically
code that you have to write but that does not carry any useful information. By autogenerating this boilerplate code,
the code you have to write is left clean and concise and the chance of introducing an error by getting such
boilerplate code incorrect is reduced.</p>
</div>
<div class="sect6">
<h7 id="xform-ToString">@groovy.transform.ToString</h7>
<div class="paragraph">
<p>The <code>@ToString</code> AST transformation generates a human readable <code>toString</code> representation of the class. For example,
annotating the <code>Person</code> class like below will automatically generate the <code>toString</code> method for you:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.ToString

@ToString
class Person {
    String firstName
    String lastName
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this definition, then the following assertion passes, meaning that a <code>toString</code> method taking the field valuess from
the class and printing them out has been generated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def p = new Person(firstName: 'Jack', lastName: 'Nicholson')
assert p.toString() == 'Person(Jack, Nicholson)'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@ToString</code> annotation accepts several parameters which are summarized in the following table:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeNames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include names of properties in generated toString.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@ToString(includeNames=true)
class Person {
    String firstName
    String lastName
}

def p = new Person(firstName: 'Jack', lastName: 'Nicholson')
assert p.toString() == 'Person(firstName:Jack, lastName:Nicholson)'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of properties to exclude from toString</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@ToString(excludes=['firstName'])
class Person {
    String firstName
    String lastName
}

def p = new Person(firstName: 'Jack', lastName: 'Nicholson')
assert p.toString() == 'Person(Nicholson)'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of fields to include in toString</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@ToString(includes=['lastName'])
class Person {
    String firstName
    String lastName
}

def p = new Person(firstName: 'Jack', lastName: 'Nicholson')
assert p.toString() == 'Person(Nicholson)'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should superclass be included in toString</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@ToString
class Id { long id }

@ToString(includeSuper=true)
class Person extends Id {
    String firstName
    String lastName
}

def p = new Person(id:1, firstName: 'Jack', lastName: 'Nicholson')
assert p.toString() == 'Person(Jack, Nicholson, Id(1))'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields be included in toString, in addition to properties</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@ToString(includeFields=true)
class Person {
    String firstName
    String lastName
    private int age
    void test() {
       age = 42
    }
}

def p = new Person(firstName: 'Jack', lastName: 'Nicholson')
p.test()
assert p.toString() == 'Person(Jack, Nicholson, 42)'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignoreNulls</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should properties/fields with null value be displayed</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@ToString(ignoreNulls=true)
class Person {
    String firstName
    String lastName
}

def p = new Person(firstName: 'Jack')
assert p.toString() == 'Person(Jack)'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includePackage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use fully qualified class name instead of simple name in toString</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@ToString(includePackage=true)
class Person {
    String firstName
    String lastName
}

def p = new Person(firstName: 'Jack', lastName:'Nicholson')
assert p.toString() == 'acme.Person(Jack, Nicholson)'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cache the toString string. Should only be set to true if the class is immutable.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@ToString(cache=true)
class Person {
    String firstName
    String lastName
}

def p = new Person(firstName: 'Jack', lastName:'Nicholson')
def s1 = p.toString()
def s2 = p.toString()
assert s1 == s2
assert s1 == 'Person(Jack, Nicholson)'
assert s1.is(s2) // same instance</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-EqualsAndHashCode">@groovy.transform.EqualsAndHashCode</h7>
<div class="paragraph">
<p>The <code>@EqualsAndHashCode</code> AST transformation aims at generating <code>equals</code> and <code>hashCode</code> methods for you. The generated
hashcode follows the best practices as described in <em>Effective Java</em> by <em>Josh Bloch</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.EqualsAndHashCode
@EqualsAndHashCode
class Person {
    String firstName
    String lastName
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')
def p2 = new Person(firstName: 'Jack', lastName: 'Nicholson')

assert p1==p2
assert p1.hashCode() == p2.hashCode()</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are several options available to tweak the behavior of <code>@EqualsAndHashCode</code>:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of properties to exclude from equals/hashCode</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.EqualsAndHashCode
@EqualsAndHashCode(excludes=['firstName'])
class Person {
    String firstName
    String lastName
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')
def p2 = new Person(firstName: 'Bob', lastName: 'Nicholson')

assert p1==p2
assert p1.hashCode() == p2.hashCode()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of fields to include in equals/hashCode</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.EqualsAndHashCode
@EqualsAndHashCode(includes=['lastName'])
class Person {
    String firstName
    String lastName
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')
def p2 = new Person(firstName: 'Bob', lastName: 'Nicholson')

assert p1==p2
assert p1.hashCode() == p2.hashCode()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">callSuper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include super in equals and hashCode calculations</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.EqualsAndHashCode

@EqualsAndHashCode
class Living {
    String race
}

@EqualsAndHashCode(callSuper=true)
class Person extends Living {
    String firstName
    String lastName
}

def p1 = new Person(race:'Human', firstName: 'Jack', lastName: 'Nicholson')
def p2 = new Person(race: 'Human beeing', firstName: 'Jack', lastName: 'Nicholson')

assert p1!=p2
assert p1.hashCode() != p2.hashCode()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields be included in equals/hashCode, in addition to properties</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@ToString(includeFields=true)
class Person {
    String firstName
    String lastName
    private int age
    void test() {
       age = 42
    }
}

def p = new Person(firstName: 'Jack', lastName: 'Nicholson')
p.test()
assert p.toString() == 'Person(Jack, Nicholson, 42)'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cache the hashCode computation. Should only be set to true if the class is immutable.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@ToString(cache=true)
class Person {
    String firstName
    String lastName
}

def p = new Person(firstName: 'Jack', lastName:'Nicholson')
def s1 = p.toString()
def s2 = p.toString()
assert s1 == s2
assert s1 == 'Person(Jack, Nicholson)'
assert s1.is(s2) // same instance</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useCanEqual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should equals call canEqual helper method.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>See <a href="http://www.artima.com/lejava/articles/equality.html">http://www.artima.com/lejava/articles/equality.html</a></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-TupleConstructor">@groovy.transform.TupleConstructor</h7>
<div class="paragraph">
<p>The <code>@TupleConstructor</code> annotation aims at eliminating boilerplate code by generating constructors for you. A tuple
constructor is created for each property, with default values (using the Java default values). For example, the
following code will generate 3 constructors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.TupleConstructor

@TupleConstructor
class Person {
    String firstName
    String lastName
}

// traditional map-style constructor
def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')
// generated tuple constructor
def p2 = new Person('Jack', 'Nicholson')
// generated tuple constructor with default value for second property
def p3 = new Person('Jack')</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first constructor is a no-arg constructor which allows the traditional map-style construction. It is worth noting
that if the first property (or field) has type LinkedHashMap or if there is a single Map, AbstractMap or HashMap
property (or field), then the map-style mapping is not available.</p>
</div>
<div class="paragraph">
<p>The other constructors are generated by taking the properties in the order they are defined. Groovy will generate as
many constructors as they are properties (or fields, depending on the options).</p>
</div>
<div class="paragraph">
<p>The <code>@TupleConstructor</code> AST transformation accepts several configuration options:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of properties to exclude from tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.TupleConstructor

@TupleConstructor(excludes=['lastName'])
class Person {
    String firstName
    String lastName
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')
def p2 = new Person('Jack')
try {
    // will fail because the second property is excluded
    def p3 = new Person('Jack', 'Nicholson')
} catch (e) {
    assert e.message.contains ('Could not find matching constructor')
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of fields to include in tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.TupleConstructor

@TupleConstructor(includes=['firstName'])
class Person {
    String firstName
    String lastName
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')
def p2 = new Person('Jack')
try {
    // will fail because the second property is not included
    def p3 = new Person('Jack', 'Nicholson')
} catch (e) {
    assert e.message.contains ('Could not find matching constructor')
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields be included in tuple constructor generation, in addition to properties</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.TupleConstructor

@TupleConstructor(includeFields=true)
class Person {
    String firstName
    String lastName
    private String occupation
    public String toString() {
        "$firstName $lastName: $occupation"
    }
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson', occupation: 'Actor')
def p2 = new Person('Jack', 'Nicholson', 'Actor')

assert p1.firstName == p2.firstName
assert p1.lastName == p2.lastName
assert p1.toString() == 'Jack Nicholson: Actor'
assert p1.toString() == p2.toString()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should properties be included in tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.TupleConstructor

@TupleConstructor(includeProperties=false)
class Person {
    String firstName
    String lastName
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')

try {
    def p2 = new Person('Jack', 'Nicholson')
} catch(e) {
    // will fail because properties are not included
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuperFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields from super classes be included in tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.TupleConstructor

class Base {
    protected String occupation
    public String occupation() { this.occupation }
}

@TupleConstructor(includeSuperFields=true)
class Person extends Base {
    String firstName
    String lastName
    public String toString() {
        "$firstName $lastName: ${occupation()}"
    }
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson', occupation: 'Actor')

def p2 = new Person('Actor', 'Jack', 'Nicholson')

assert p1.firstName == p2.firstName
assert p1.lastName == p2.lastName
assert p1.toString() == 'Jack Nicholson: Actor'
assert p2.toString() == p1.toString()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuperProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should properties from super classes be included in tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.TupleConstructor

class Base {
    String occupation
}

@TupleConstructor(includeSuperProperties=true)
class Person extends Base {
    String firstName
    String lastName
    public String toString() {
        "$firstName $lastName: $occupation"
    }
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')

def p2 = new Person('Actor', 'Jack', 'Nicholson')

assert p1.firstName == p2.firstName
assert p1.lastName == p2.lastName
assert p1.toString() == 'Jack Nicholson: null'
assert p2.toString() == 'Jack Nicholson: Actor'
import groovy.transform.TupleConstructor

class Base {
    String occupation
    Base() {}
    Base(String job) { occupation = job?.toLowerCase() }
}

@TupleConstructor(includeSuperProperties = true, callSuper=true)
class Person extends Base {
    String firstName
    String lastName
    public String toString() {
        "$firstName $lastName: $occupation"
    }
}

def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')

def p2 = new Person('ACTOR', 'Jack', 'Nicholson')

assert p1.firstName == p2.firstName
assert p1.lastName == p2.lastName
assert p1.toString() == 'Jack Nicholson: null'
assert p2.toString() == 'Jack Nicholson: actor'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">callSuper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should super properties be called within a call to the parent constructor rather than set as properties</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy"></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">force</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, the transformation will do nothing if a constructor is already defined. Setting this property
to true, the constructor will be generated and it&#8217;s your responsability to ensure that no duplicate constructor
is defined</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>See javadocs</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-Canonical">@groovy.transform.Canonical</h7>
<div class="paragraph">
<p>The <code>@Canonical</code> AST transformation combines the effects of the <a href="#xform-ToString">@ToString</a>,
<a href="#xform-EqualsAndHashCode">@EqualsAndHashCode</a> and <a href="#xform-TupleConstructor">@TupleConstructor</a>
annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.Canonical

@Canonical
class Person {
    String firstName
    String lastName
}
def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')
assert p1.toString() == 'Person(Jack, Nicholson)' // Effect of @ToString

def p2 = new Person('Jack','Nicholson') // Effect of @TupleConstructor
assert p2.toString() == 'Person(Jack, Nicholson)'

assert p1==p2 // Effect of @EqualsAndHashCode
assert p1.hashCode()==p2.hashCode() // Effect of @EqualsAndHashCode</code></pre>
</div>
</div>
<div class="paragraph">
<p>A similar immutable class can be generated using the <a href="#xform-Immutable">@Immutable</a> AST transformation instead.
The <code>@Canonical</code> AST transformation supports several configuration options:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of properties to exclude from tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.Canonical

@Canonical(excludes=['lastName'])
class Person {
    String firstName
    String lastName
}
def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')
assert p1.toString() == 'Person(Jack)' // Effect of @ToString

def p2 = new Person('Jack') // Effect of @TupleConstructor
assert p2.toString() == 'Person(Jack)'

assert p1==p2 // Effect of @EqualsAndHashCode
assert p1.hashCode()==p2.hashCode() // Effect of @EqualsAndHashCode</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of fields to include in tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.Canonical

@Canonical(includes=['firstName'])
class Person {
    String firstName
    String lastName
}
def p1 = new Person(firstName: 'Jack', lastName: 'Nicholson')
assert p1.toString() == 'Person(Jack)' // Effect of @ToString

def p2 = new Person('Jack') // Effect of @TupleConstructor
assert p2.toString() == 'Person(Jack)'

assert p1==p2 // Effect of @EqualsAndHashCode
assert p1.hashCode()==p2.hashCode() // Effect of @EqualsAndHashCode</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-InheritConstructors">@groovy.transform.InheritConstructors</h7>
<div class="paragraph">
<p>The <code>@InheritConstructor</code> AST transformation aims at generating constructors matching super constructors for you. This
is in particular useful when overridding exception classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.InheritConstructors

@InheritConstructors
class CustomException extends Exception {}

// all those are generated constructors
new CustomException()
new CustomException("A custom message")
new CustomException("A custom message", new RuntimeException())
new CustomException(new RuntimeException())

// Java 7 only
// new CustomException("A custom message", new RuntimeException(), false, true)</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-Category">@groovy.lang.Category</h7>
<div class="paragraph">
<p>The <code>@Category</code> AST transformation simplifies the creation of Groovy categories. Historically, a Groovy category was
written like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class TripleCategory {
    public static Integer triple(Integer self) {
        3*self
    }
}
use (TripleCategory) {
    assert 9 == 3.triple()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Category</code> transformation lets you write the same using an instance-style class, rather that a static class style.
This removes the need for having the first argument of each method being the receiver. The category can be written like
this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Category(Integer)
class TripleCategory {
    public Integer triple() { 3*this }
}
use (TripleCategory) {
    assert 9 == 3.triple()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the mixed in class can be referenced using <code>this</code> instead. It&#8217;s also worth noting that using instance fields
in a category class is inherently unsafe: categories are not stateful (like traits).</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-IndexedProperty">@groovy.transform.IndexedProperty</h7>
<div class="paragraph">
<p>The <code>@IndexedProperty</code> annotation aims at generating indexed getters/setters for properties of list/array types.
This is in particular useful if you want to use a Groovy class from Java. While Groovy supports GPath to access properties,
this is not available from Java. The <code>@IndexedProperty</code> annotation will generate indexed properties of the following
form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class SomeBean {
    @IndexedProperty String[] someArray = new String[2]
    @IndexedProperty List someList = []
}

def bean = new SomeBean()
bean.setSomeArray(0, 'value')
bean.setSomeList(0, 123)

assert bean.someArray[0] == 'value'
assert bean.someList == [123]</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-Lazy">@groovy.lang.Lazy</h7>
<div class="paragraph">
<p>The <code>@Lazy</code> AST transformation implements lazy initialization of fields. For example, the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class SomeBean {
    @Lazy LinkedList myField
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will produce the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">List $myField
List getMyField() {
    if ($myField!=null) { return $myField }
    else {
        $myField = new LinkedList()
        return $myField
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default value which is used to initialize the field is the default constructor of the declaration type. It is possible
to define a default value by using a closure on the right hand side of the property assignment, as in the following
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>class SomeBean {
    @Lazy LinkedList myField = { ['a','b','c']}()
}</pre>
</div>
</div>
<div class="paragraph">
<p>In that case, the generated code looks like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>List $myField
List getMyField() {
    if ($myField!=null) { return $myField }
    else {
        $myField = { ['a','b','c']}()
        return $myField
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>If the field is declared volatile then initialization will be synchronized using the
<a href="http://en.wikipedia.org/wiki/Double-checked_locking">double-checked locking</a> pattern.</p>
</div>
<div class="paragraph">
<p>Using the <code>soft=true</code> parameter, the helper field will use a <code>SoftReference</code> instead, providing a simple way to
implement caching. In that case, if the garbage collector decides to collect the reference, initialization will occur
the next time the field is accessed.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-Newify">@groovy.lang.Newify</h7>
<div class="paragraph">
<p>The <code>@Newify</code> AST transformation is used to bring alternative syntaxes to construct objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using the <code>Python</code> style:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>@Newify([Tree,Leaf])
class TreeBuilder {
    Tree tree = Tree(Leaf('A'),Leaf('B'),Tree(Leaf('C')))
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>or using the <code>Ruby</code> style:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>@Newify([Tree,Leaf])
class TreeBuilder {
    Tree tree = Tree.new(Leaf.new('A'),Leaf.new('B'),Tree.new(Leaf.new('C')))
}</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Ruby</code> version can be disabled by setting the <code>auto</code> flag to <code>false</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-Sortable">@groovy.lang.Sortable</h7>
<div class="paragraph">
<p>The <code>@Sortable</code> AST transformation is used to help write classes that are <code>Comparable</code> and easily sorted by
numerous properties. It is easy to use as shown in the following example where we annotate the <code>Person</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.Sortable

@Sortable class Person {
    String first
    String last
    Integer born
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated class has the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it implements the <code>Comparable</code> interface</p>
</li>
<li>
<p>it contains a <code>compareTo</code> method with an implementation based on the natural ordering of the <code>first</code>, <code>last</code> and <code>born</code> properties</p>
</li>
<li>
<p>it has three methods returning comparators: <code>comparatorByFirst</code>, <code>comparatorByLast</code> and <code>comparatorByBorn</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The generated <code>compareTo</code> method will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">public int compareTo(java.lang.Object obj) {
    if (this.is(obj)) {
        return 0
    }
    if (!(obj instanceof Person)) {
        return -1
    }
    java.lang.Integer value = this.first &lt;=&gt; obj.first
    if (value != 0) {
        return value
    }
    value = this.last &lt;=&gt; obj.last
    if (value != 0) {
        return value
    }
    value = this.born &lt;=&gt; obj.born
    if (value != 0) {
        return value
    }
    return 0
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an example of the generated comparators, the <code>comparatorByFirst</code> comparator will have a <code>compare</code> method that looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">public int compare(java.lang.Object arg0, java.lang.Object arg1) {
    if (arg0 == arg1) {
        return 0
    }
    if (arg0 != null &amp;&amp; arg1 == null) {
        return -1
    }
    if (arg0 == null &amp;&amp; arg1 != null) {
        return 1
    }
    return arg0.first &lt;=&gt; arg1.first
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Person</code> class can be used wherever a <code>Comparable</code> is expected and the generated comparators
wherever a <code>Comparator</code> is expected as shown by these examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def people = [
    new Person(first: 'Johnny', last: 'Depp', born: 1963),
    new Person(first: 'Keira', last: 'Knightley', born: 1985),
    new Person(first: 'Geoffrey', last: 'Rush', born: 1951),
    new Person(first: 'Orlando', last: 'Bloom', born: 1977)
]

assert people[0] &gt; people[2]
assert people.sort()*.last == ['Rush', 'Depp', 'Knightley', 'Bloom']
assert people.sort(false, Person.comparatorByFirst())*.first == ['Geoffrey', 'Johnny', 'Keira', 'Orlando']
assert people.sort(false, Person.comparatorByLast())*.last == ['Bloom', 'Depp', 'Knightley', 'Rush']
assert people.sort(false, Person.comparatorByBorn())*.last == ['Rush', 'Depp', 'Bloom', 'Knightley']</code></pre>
</div>
</div>
<div class="paragraph">
<p>Normally, all properties are used in the generated <code>compareTo</code> method in the priority order in which they are defined.
You can include or exclude certain properties from the generated <code>compareTo</code> method by giving a list of property names
in the <code>includes</code> or <code>excludes</code> annotation attributes. If using <code>includes</code>, the order of the property names given will
determine the priority of properties when comparing. To illustrate, consider the following <code>Person</code> class definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Sortable(includes='first,born') class Person {
    String last
    int born
    String first
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It will have two comparator methods <code>comparatorByFirst</code> and <code>comparatorByBorn</code> and the generated <code>compareTo</code> method will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">public int compareTo(java.lang.Object obj) {
    if (this.is(obj)) {
        return 0
    }
    if (!(obj instanceof Person)) {
        return -1
    }
    java.lang.Integer value = this.first &lt;=&gt; obj.first
    if (value != 0) {
        return value
    }
    value = this.born &lt;=&gt; obj.born
    if (value != 0) {
        return value
    }
    return 0
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>Person</code> class can be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def people = [
    new Person(first: 'Ben', last: 'Affleck', born: 1972),
    new Person(first: 'Ben', last: 'Stiller', born: 1965)
]

assert people.sort()*.last == ['Stiller', 'Affleck']</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-Builder">@groovy.transform.builder.Builder</h7>
<div class="paragraph">
<p>The <code>@Builder</code> AST transformation is used to help write classes that can be created using <em>fluent</em> api calls.
The transform supports multiple building strategies to cover a range of cases and there are a number
of configuration options to customize the building process. If you&#8217;re an AST hacker, you can also define your own
strategy class. The following table lists the available strategies that are bundled with Groovy and the
configuration options each strategy supports.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">builderClassName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">builderMethodName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildMethodName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes/excludes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chained setters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "set"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ExternalStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">explicit builder class, class being built untouched</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "build"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default ""</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DefaultStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates a nested helper class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <em>&lt;TypeName&gt;</em>Builder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "builder"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "build"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default ""</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InitializerStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates a nested helper class providing type-safe fluent creation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <em>&lt;TypeName&gt;</em>Initializer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "createInitializer"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "create" but usually only used internally</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default ""</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">SimpleStrategy</div>
<p>To use the <code>SimpleStrategy</code>, annotate your Groovy class using the <code>@Builder</code> annotation, and specify the strategy as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.builder.*

@Builder(builderStrategy=SimpleStrategy)
class Person {
    String first
    String last
    Integer born
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, just call the setters in a chained fashion as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def p1 = new Person().setFirst('Johnny').setLast('Depp').setBorn(1963)
assert "$p1.first $p1.last" == 'Johnny Depp'</code></pre>
</div>
</div>
<div class="paragraph">
<p>For each property, a generated setter will be created which looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">public Person setFirst(java.lang.String first) {
    this.first = first
    return this
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can specify a prefix as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.builder.*

@Builder(builderStrategy=SimpleStrategy, prefix="")
class Person {
    String first
    String last
    Integer born
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And calling the chained setters would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def p = new Person().first('Johnny').last('Depp').born(1963)
assert "$p.first $p.last" == 'Johnny Depp'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the <code>SimpleStrategy</code> in conjunction with <code>@Canonical</code>. If your <code>@Builder</code> annotation doesn&#8217;t have
explicit <code>includes</code> or <code>excludes</code> annotation attributes but your <code>@Canonical</code> annotation does, the ones
from <code>@Canonical</code> will be re-used for <code>@Builder</code>.</p>
</div>
<div class="paragraph">
<p>The annotation attributes <code>builderClassName</code>, <code>buildMethodName</code>, <code>builderMethodName</code> and <code>forClass</code> are not supported for this strategy.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Groovy already has built-in building mechanisms. Don&#8217;t rush to using <code>@Builder</code> if the built-in mechanisms meet your needs. Some examples:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def p2 = new Person(first: 'Keira', last: 'Knightley', born: 1985)
def p3 = new Person().with {
    first = 'Geoffrey'
    last = 'Rush'
    born = 1951
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">ExternalStrategy</div>
<p>To use the <code>ExternalStrategy</code>, create and annotate a Groovy builder class using the <code>@Builder</code> annotation, specify the
class the builder is for using <code>forClass</code> and indicate use of the <code>ExternalStrategy</code>.
Suppose you have the following class you would like a builder for:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Person {
    String first
    String last
    int born
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>you explicitly create and use your builder class as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.builder.*

@Builder(builderStrategy=ExternalStrategy, forClass=Person)
class PersonBuilder { }

def p = new PersonBuilder().first('Johnny').last('Depp').born(1963).build()
assert "$p.first $p.last" == 'Johnny Depp'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the (normally empty) builder class you provide will be filled in with appropriate setters and a build method.
The generated build method will look something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">public Person build() {
    Person _thePerson = new Person()
    _thePerson.first = first
    _thePerson.last = last
    _thePerson.born = born
    return _thePerson
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class you are creating the builder for can be any Java or Groovy class following the normal JavaBean conventions,
e.g. a no-arg constructor and setters for the properties. Here is an example using a Java class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.builder.*

@Builder(builderStrategy=ExternalStrategy, forClass=javax.swing.DefaultButtonModel)
class ButtonModelBuilder {}

def model = new ButtonModelBuilder().enabled(true).pressed(true).armed(true).rollover(true).selected(true).build()
assert model.isArmed()
assert model.isPressed()
assert model.isEnabled()
assert model.isSelected()
assert model.isRollover()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated builder can be customised using the <code>prefix</code>, <code>includes</code>, <code>excludes</code> and <code>buildMethodName</code> annotation attributes.
Here is an example illustrating various customisations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.builder.*
import groovy.transform.Canonical

@Canonical
class Person {
    String first
    String last
    int born
}

@Builder(builderStrategy=ExternalStrategy, forClass=Person, includes=['first', 'last'], buildMethodName='create', prefix='with')
class PersonBuilder { }

def p = new PersonBuilder().withFirst('Johnny').withLast('Depp').create()
assert "$p.first $p.last" == 'Johnny Depp'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>builderMethodName</code> and <code>builderClassName</code> annotation attributes for <code>@Builder</code> aren&#8217;t applicable for this strategy.</p>
</div>
<div class="paragraph">
<p>You can use the <code>ExternalStrategy</code> in conjunction with <code>@Canonical</code>. If your <code>@Builder</code> annotation doesn&#8217;t have
explicit <code>includes</code> or <code>excludes</code> annotation attributes but the <code>@Canonical</code> annotation of the class you are creating
the builder for does, the ones from <code>@Canonical</code> will be re-used for <code>@Builder</code>.</p>
</div>
<div class="paragraph">
<div class="title">DefaultStrategy</div>
<p>To use the <code>DefaultStrategy</code>, annotate your Groovy class using the <code>@Builder</code> annotation as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.builder.Builder

@Builder
class Person {
    String firstName
    String lastName
    int age
}

def person = Person.builder().firstName("Robert").lastName("Lewandowski").age(21).build()
assert person.firstName == "Robert"
assert person.lastName == "Lewandowski"
assert person.age == 21</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want, you can customize various aspects of the building process
using the <code>builderClassName</code>, <code>buildMethodName</code>, <code>builderMethodName</code>, <code>prefix</code>, <code>includes</code> and <code>excludes</code> annotation attributes,
some of which are used in the example here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.builder.Builder

@Builder(buildMethodName='make', builderMethodName='maker', prefix='with', excludes='age')
class Person {
    String firstName
    String lastName
    int age
}

def p = Person.maker().withFirstName("Robert").withLastName("Lewandowski").make()
assert "$p.firstName $p.lastName" == "Robert Lewandowski"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This strategy also supports annotating static methods and constructors. In this case, the static method or constructor
parameters become the properties to use for building purposes and in the case of static methods, the return type
of the method becomes the target class being built. If you have more than one <code>@Builder</code> annotation used within
a class (at either the class, method or constructor positions) then it is up to you to ensure that the generated
helper classes and factory methods have unique names (i.e. no more than one can use the default name values).
Here is an example highlighting method and constructor usage (and also illustrating the renaming required for unique names).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.builder.*
import groovy.transform.*

@ToString
@Builder
class Person {
  String first, last
  int born

  Person(){}

  @Builder(builderClassName='MovieBuilder', builderMethodName='byRoleBuilder')
  Person(String roleName) {
     if (roleName == 'Jack Sparrow') {
         this.first = 'Johnny'; this.last = 'Depp'; this.born = 1963
     }
  }

  @Builder(builderClassName='NameBuilder', builderMethodName='nameBuilder', prefix='having', buildMethodName='fullName')
  static String join(String first, String last) {
      first + ' ' + last
  }

  @Builder(builderClassName='SplitBuilder', builderMethodName='splitBuilder')
  static Person split(String name, int year) {
      def parts = name.split(' ')
      new Person(first: parts[0], last: parts[1], born: year)
  }
}

assert Person.splitBuilder().name("Johnny Depp").year(1963).build().toString() == 'Person(Johnny, Depp, 1963)'
assert Person.byRoleBuilder().roleName("Jack Sparrow").build().toString() == 'Person(Johnny, Depp, 1963)'
assert Person.nameBuilder().havingFirst('Johnny').havingLast('Depp').fullName() == 'Johnny Depp'
assert Person.builder().first("Johnny").last('Depp').born(1963).build().toString() == 'Person(Johnny, Depp, 1963)'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>forClass</code> annotation attribute is not supported for this strategy.</p>
</div>
<div class="paragraph">
<div class="title">InitializerStrategy</div>
<p>To use the <code>InitializerStrategy</code>, annotate your Groovy class using the <code>@Builder</code> annotation, and specify the strategy as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.builder.*
import groovy.transform.*

@ToString
@Builder(builderStrategy=InitializerStrategy)
class Person {
    String firstName
    String lastName
    int age
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your class will be locked down to have a single public constructor taking a "fully set" initializer.
It will also have a factory method to create the initializer. These are used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@CompileStatic
def firstLastAge() {
    assert new Person(Person.createInitializer().firstName("John").lastName("Smith").age(21)).toString() == 'Person(John, Smith, 21)'
}
firstLastAge()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any attempt to use the initializer which doesn&#8217;t involve setting all the properties (though order is not important) will result in
a compilation error. If you don&#8217;t need this level of strictness, you don&#8217;t need to use <code>@CompileStatic</code>.</p>
</div>
<div class="paragraph">
<p>You can use the <code>InitializerStrategy</code> in conjunction with <code>@Canonical</code> and <code>@Immutable</code>. If your <code>@Builder</code> annotation
doesn&#8217;t have explicit <code>includes</code> or <code>excludes</code> annotation attributes but your <code>@Canonical</code> annotation does, the ones
from <code>@Canonical</code> will be re-used for <code>@Builder</code>. Here is an example using <code>@Builder</code> with <code>@Immutable</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.builder.*
import groovy.transform.*

@Builder(builderStrategy=InitializerStrategy)
@Immutable
class Person {
    String first
    String last
    int born
}

@CompileStatic
def createFirstLastBorn() {
  def p = new Person(Person.createInitializer().first('Johnny').last('Depp').born(1963))
  assert "$p.first $p.last $p.born" == 'Johnny Depp 1963'
}

createFirstLastBorn()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation attribute <code>forClass</code> is not supported for this strategy.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_class_design_annotations">Class design annotations</h6>
<div class="paragraph">
<p>This category of annotations are aimed at simplifying the implementation of well-known design patterns (delegation,
singleton, &#8230;) by using a declarative style.</p>
</div>
<div class="sect6">
<h7 id="xform-Delegate">@groovy.lang.Delegate</h7>
<div class="paragraph">
<p>The <code>@Delegate</code> AST transformation aims at implementing the delegation design pattern. In the following class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Event {
    @Delegate Date when
    String title
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>when</code> field is annotated with <code>@Delegate</code>, meaning that the <code>Event</code> class will delegate calls to <code>Date</code> methods
to the <code>when</code> field. In this case, the generated code looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Event {
    Date when
    String title
    boolean before(Date other) {
        when.before(other)
    }
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can call the <code>before</code> method, for example, directly on the <code>Event</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def ev = new Event(title:'Groovy keynote', when: Date.parse('yyyy/MM/dd', '2013/09/10'))
def now = new Date()
assert ev.before(now)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The behavior of the <code>@Delegate</code> AST transformation can be changed using the following parameters:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">interfaces</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the interfaces implemented by the field be implemented by the class too</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">interface Greeter { void sayHello() }
class MyGreeter implements Greeter { void sayHello() { println 'Hello!'} }

class DelegatingGreeter { // no explicit interface
    @Delegate MyGreeter greeter = new MyGreeter()
}
def greeter = new DelegatingGreeter()
assert greeter instanceof Greeter // interface was added transparently</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, also delegates methods annotated with @Deprecated</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class WithDeprecation {
    @Deprecated
    void foo() {}
}
class WithoutDeprecation {
    @Deprecated
    void bar() {}
}
class Delegating {
    @Delegate(deprecated=true) WithDeprecation with = new WithDeprecation()
    @Delegate WithoutDeprecation without = new WithoutDeprecation()
}
def d = new Delegating()
d.foo() // passes thanks to deprecated=true
d.bar() // fails because of @Deprecated</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">methodAnnotations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to carry over annotations from the methods of the delegate to your delegating method.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class WithAnnotations {
    @Transactional
    void method() {
    }
}
class DelegatingWithoutAnnotations {
    @Delegate WithAnnotations delegate
}
class DelegatingWithAnnotations {
    @Delegate(methodAnnotations = true) WithAnnotations delegate
}
def d1 = new DelegatingWithoutAnnotations()
def d2 = new DelegatingWithAnnotations()
assert d1.class.getDeclaredMethod('method').annotations.length==0
assert d2.class.getDeclaredMethod('method').annotations.length==1</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parameterAnnotations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to carry over annotations from the method parameters of the delegate to your delegating method.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class WithAnnotations {
    void method(@NotNull String str) {
    }
}
class DelegatingWithoutAnnotations {
    @Delegate WithAnnotations delegate
}
class DelegatingWithAnnotations {
    @Delegate(parameterAnnotations = true) WithAnnotations delegate
}
def d1 = new DelegatingWithoutAnnotations()
def d2 = new DelegatingWithAnnotations()
assert d1.class.getDeclaredMethod('method',String).parameterAnnotations[0].length==0
assert d2.class.getDeclaredMethod('method',String).parameterAnnotations[0].length==1</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of methods to be excluded from delegation. For more fine-grained control, see also <code>excludeTypes</code>.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Worker {
    void task1() {}
    void task2() {}
}
class Delegating {
    @Delegate(excludes=['task2']) Worker worker = new Worker()
}
def d = new Delegating()
d.task1() // passes
d.task2() // fails because method is excluded</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of methods to be included in delegation. For more fine-grained control, see also <code>includeTypes</code>.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Worker {
    void task1() {}
    void task2() {}
}
class Delegating {
    @Delegate(includes=['task1']) Worker worker = new Worker()
}
def d = new Delegating()
d.task1() // passes
d.task2() // fails because method is not included</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludeTypes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of interfaces containing method signatures to be excluded from delegation</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">interface AppendStringSelector {
    StringBuilder append(String str)
}
class UpperStringBuilder {
    @Delegate(excludeTypes=AppendStringSelector)
    StringBuilder sb1 = new StringBuilder()

    @Delegate(includeTypes=AppendStringSelector)
    StringBuilder sb2 = new StringBuilder()

    String toString() { sb1.toString() + sb2.toString().toUpperCase() }
}
def usb = new UpperStringBuilder()
usb.append(3.5d)
usb.append('hello')
usb.append(true)
assert usb.toString() == '3.5trueHELLO'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeTypes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of interfaces containing method signatures to be included in delegation</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">interface AppendBooleanSelector {
    StringBuilder append(boolean b)
}
interface AppendFloatSelector {
    StringBuilder append(float b)
}
class NumberBooleanBuilder {
    @Delegate(includeTypes=AppendBooleanSelector, interfaces=false)
    StringBuilder nums = new StringBuilder()
    @Delegate(includeTypes=[AppendFloatSelector], interfaces=false)
    StringBuilder bools = new StringBuilder()
    String result() { "${nums.toString()}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-Immutable">@groovy.transform.Immutable</h7>
<div class="paragraph">
<p>The <code>@Immutable</code> AST transformation simplifies the creation of immutable classes, that is to say classes for which
members are deemed immutable. For that, all you have to do is annotating the class like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.Immutable

@Immutable
class Point {
    int x
    int y
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Immutable classes generated with <code>@Immutable</code> are automatically made final. For a class to be immutable, you have to
make sure that properties are of an immutable type (primitive or boxed types), of a known-immutable type or another
class annotated with <code>@Immutable</code>. The effect of applying <code>@Immutable</code> to a class are pretty similar to those of
applying the <a href="#xform-Canonical">@Canonical</a> AST transformation, but with an immutable class: automatic generation of
<code>toString</code>, <code>equals</code> and <code>hashCode</code> methods for example, but trying to modify a property would throw a <code>ReadOnlyPropertyException</code>
in that case.</p>
</div>
<div class="paragraph">
<p>Since <code>@Immutable</code> relies on a predefined list of known immutable classes (like <code>java.net.URI</code> or <code>java.lang.String</code>
and fails if you use a type which is not in that list, you are allowed to instruct the transformation that some types
are deemed immutable thanks to the following parameters:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">knownImmutableClasses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of classes which are deemed immutable.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.Immutable
import groovy.transform.TupleConstructor

@TupleConstructor
final class Point {
    final int x
    final int y
    public String toString() { "($x,$y)" }
}

@Immutable(knownImmutableClasses=[Point])
class Triangle {
    Point a,b,c
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">knownImmutables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of property names which are deemed immutable.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.Immutable
import groovy.transform.TupleConstructor

@TupleConstructor
final class Point {
    final int x
    final int y
    public String toString() { "($x,$y)" }
}

@Immutable(knownImmutables=['a','b','c'])
class Triangle {
    Point a,b,c
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyWith</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A boolean whether to generate a <code>copyWith( Map )</code> method.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.Immutable

@Immutable( copyWith=true )
class User {
    String  name
    Integer age
}

def bob   = new User( 'bob', 43 )
def alice = bob.copyWith( name:'alice' )
assert alice.name == 'alice'
assert alice.age  == 43</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-Memoized">@groovy.transform.Memoized</h7>
<div class="paragraph">
<p>The <code>@Memoized</code> AST transformations simplifies the implementation of caching by allowing the result of method calls
to be cached just by annotating the method with <code>@Memoized</code>. Let&#8217;s imagine the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">long longComputation(int seed) {
    // slow computation
    Thread.sleep(1000*seed)
    System.nanoTime()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This emulates a long computation, based on the actual parameters of the method. Without <code>@Memoized</code>, each method call
would take several seconds plus it would return a random result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def x = longComputation(1)
def y = longComputation(1)
assert x!=y</code></pre>
</div>
</div>
<div class="paragraph">
<p>Adding <code>@Memoized</code> changes the semantics of the method by adding caching, based on the parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Memoized
long longComputation(int seed) {
    // slow computation
    Thread.sleep(1000*seed)
    System.nanoTime()
}

def x = longComputation(1) // returns after 1 second
def y = longComputation(1) // returns immediatly
def z = longComputation(2) // returns after 2 seconds
assert x==y
assert x!=z</code></pre>
</div>
</div>
<div class="paragraph">
<p>The size of the cache can be configured using two optional parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>protectedCacheSize</em>: the number of results which are guaranteed not to be cleared after garbage collection</p>
</li>
<li>
<p><em>maxCacheSize</em>: the maximum number of results that can be kept in memory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, the size of the cache is unlimited and no cache result is protected from garbage collection. Setting a
<em>protectedCacheSize&gt;0</em> would create an unlimited cache with some results protected. Setting <em>maxCacheSize&gt;0</em> would
 create a limited cache but without any protection from garbage protection. Setting both would create a limited,
 protected cache.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-Singleton">@groovy.lang.Singleton</h7>
<div class="paragraph">
<p>The <code>@Singleton</code> annotation can be used to implement the singleton design pattern on a class. The singleton instance
is defined eagerly by default, using class initialization, or lazily, in which case the field is initialized using
double checked locking.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Singleton
class GreetingService {
    String greeting(String name) { "Hello, $name!" }
}
assert GreetingService.instance.greeting('Bob') == 'Hello, Bob!'</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the singleton is created eagerly when the class is initialized and available through the <code>instance</code> property.
It is possible to change the name of the singleton using the <code>property</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Singleton(property='theOne')
class GreetingService {
    String greeting(String name) { "Hello, $name!" }
}

assert GreetingService.theOne.greeting('Bob') == 'Hello, Bob!'</code></pre>
</div>
</div>
<div class="paragraph">
<p>And it is also possible to make initialization lazy using the <code>lazy</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Collaborator {
    public static boolean init = false
}
@Singleton(lazy=true,strict=false)
class GreetingService {
    static void init() {}
    GreetingService() {
        Collaborator.init = true
    }
    String greeting(String name) { "Hello, $name!" }
}
GreetingService.init() // make sure class is initialized
assert Collaborator.init == false
GreetingService.instance
assert Collaborator.init == true
assert GreetingService.instance.greeting('Bob') == 'Hello, Bob!'</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we also set the <code>strict</code> parameter to false, which allows us to define our own constructor.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-Mixin">@groovy.transform.Mixin</h7>
<div class="paragraph">
<p>Deprecated. Consider using traits instead.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_logging_improvements">Logging improvements</h6>
<div class="paragraph">
<p>Groovy provides AST transformation that helps integrating with the most widely used logging frameworks. It&#8217;s worth noting
that annotating a class with one of those annotations doesn&#8217;t prevent you from adding the appropriate logging framework
on classpath.</p>
</div>
<div class="paragraph">
<p>All transformations work in a similar way:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>add static final <code>log</code> field corresponding to the logger</p>
</li>
<li>
<p>wrap all calls to <code>log.level()</code> into the appropriate <code>log.isLevelEnabled</code> guard, depending on the underlying framework</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Those transformations support two parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>value</code> (default <code>log</code>) corresponds to the name of the logger field</p>
</li>
<li>
<p><code>category</code> (defaults to the class name) is the name of the logger category</p>
</li>
</ul>
</div>
<div class="sect6">
<h7 id="xform-Log">@groovy.util.logging.Log</h7>
<div class="paragraph">
<p>The first logging AST transformation available is the <code>@Log</code> annotation which relies on the JDK logging framework. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@groovy.util.logging.Log
class Greeter {
    void greet() {
        log.info 'Called greeter'
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import java.util.logging.Level
import java.util.logging.Logger

class Greeter {
    private final static Logger log = Logger.getLogger(Greeter.name)
    void greet() {
        if (log.isLoggable(Level.INFO)) {
            log.info 'Called greeter'
        }
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-Commons">@groovy.util.logging.Commons</h7>
<div class="paragraph">
<p>Groovy supports the <a href="http://commons.apache.org/proper/commons-logging/">Apache Commons Logging</a> framework using to the
<code>@Commons</code> annotation. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@groovy.util.logging.Commons
class Greeter {
    void greet() {
        log.debug 'Called greeter'
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import org.apache.commons.logging.LogFactory
import org.apache.commons.logging.Log

class Greeter {
    private final static Log log = LogFactory.getLog(Greeter)
    void greet() {
        if (log.isDebugEnabled()) {
            log.debug 'Called greeter'
        }
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-Log4j">@groovy.util.logging.Log4j</h7>
<div class="paragraph">
<p>Groovy supports the <a href="http://logging.apache.org/log4j/1.2/">Apache Log4j 1.x</a> framework using to the
<code>@Log4j</code> annotation. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@groovy.util.logging.Log4j
class Greeter {
    void greet() {
        log.debug 'Called greeter'
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import org.apache.log4j.Logger

class Greeter {
    private final static Logger log = Logger.getLogger(Greeter)
    void greet() {
        if (log.isDebugEnabled()) {
            log.debug 'Called greeter'
        }
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-Log4j2">@groovy.util.logging.Log4j2</h7>
<div class="paragraph">
<p>Groovy supports the <a href="http://logging.apache.org/log4j/2.x/">Apache Log4j 2.x</a> framework using to the
<code>@Log4j2</code> annotation. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@groovy.util.logging.Log4j2
class Greeter {
    void greet() {
        log.debug 'Called greeter'
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import org.apache.logging.log4j.LogManager
import org.apache.logging.log4j.Logger

class Greeter {
    private final static Logger log = LogManager.getLogger(Greeter)
    void greet() {
        if (log.isDebugEnabled()) {
            log.debug 'Called greeter'
        }
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-Slf4j">@groovy.util.logging.Slf4j</h7>
<div class="paragraph">
<p>Groovy supports the <a href="http://www.slf4j.org/">Simple Logging Facade for Java (SLF4J)</a> framework using to the
<code>@Slf4j</code> annotation. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@groovy.util.logging.Slf4j
class Greeter {
    void greet() {
        log.debug 'Called greeter'
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import org.slf4j.LoggerFactory
import org.slf4j.Logger

class Greeter {
    private final static Logger log = LoggerFactory.getLogger(Greeter)
    void greet() {
        if (log.isDebugEnabled()) {
            log.debug 'Called greeter'
        }
        println 'Hello, world!'
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_declarative_concurrency">Declarative concurrency</h6>
<div class="paragraph">
<p>The Groovy language provides a set of annotations aimed at simplifying common concurrency patterns in a declarative
approach.</p>
</div>
<div class="sect6">
<h7 id="xform-Synchronized">@groovy.transform.Synchronized</h7>
<div class="paragraph">
<p>The <code>@Synchronized</code> AST transformations works in a similar way to the <code>synchronized</code> keyword but locks on different
objects for safer concurrency. It can be applied on any method or static method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.Synchronized

import java.util.concurrent.Executors
import java.util.concurrent.TimeUnit

class Counter {
    int cpt
    @Synchronized
    int incrementAndGet() {
        cpt++
    }
    int get() {
        cpt
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Writing this is equivalent to creating a lock object and wrapping the whole method into a synchronized block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Counter {
    int cpt
    private final Object $lock = new Object()

    int incrementAndGet() {
        synchronized($lock) {
            cpt++
        }
    }
    int get() {
        cpt
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, <code>@Synchronized</code> creates a field named <code>$lock</code> (or <code>$LOCK</code> for a static method) but you can make it use any
field you want by specifying the value attribute, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.Synchronized

import java.util.concurrent.Executors
import java.util.concurrent.TimeUnit

class Counter {
    int cpt
    private final Object myLock = new Object()

    @Synchronized('myLock')
    int incrementAndGet() {
        cpt++
    }
    int get() {
        cpt
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-WithReadLock">@groovy.transform.WithReadLock and @groovy.transform.WithWriteLock</h7>
<div class="paragraph">
<p>The <code>@WithReadLock</code> AST transformation works in conjunction with the <code>@WithWriteLock</code> transformation
to provide read/write synchronization using the <code>ReentrantReadWriteLock</code> facility that the JDK provides. The annotation
can be added to a method or a static method. It will transparently create a <code>$reentrantLock</code> final field (or
<code>$REENTRANTLOCK</code> for a static method) and proper synchronization code will be added. For example, the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.WithReadLock
import groovy.transform.WithWriteLock

class Counters {
    public final Map&lt;String,Integer&gt; map = [:].withDefault { 0 }

    @WithReadLock
    int get(String id) {
        map.get(id)
    }

    @WithWriteLock
    void add(String id, int num) {
        Thread.sleep(200) // emulate long computation
        map.put(id, map.get(id)+num)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.WithReadLock as WithReadLock
import groovy.transform.WithWriteLock as WithWriteLock

public class Counters {

    private final Map&lt;String, Integer&gt; map
    private final java.util.concurrent.locks.ReentrantReadWriteLock $reentrantlock

    public int get(java.lang.String id) {
        $reentrantlock.readLock().lock()
        try {
            map.get(id)
        }
        finally {
            $reentrantlock.readLock().unlock()
        }
    }

    public void add(java.lang.String id, int num) {
        $reentrantlock.writeLock().lock()
        try {
            java.lang.Thread.sleep(200)
            map.put(id, map.get(id) + num )
        }
        finally {
            $reentrantlock.writeLock().unlock()
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>@WithReadLock</code> and <code>@WithWriteLock</code> support specifying an alternative lock object. In that case, the referenced
 field must be declared by the user, like in the following alternative:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.WithReadLock
import groovy.transform.WithWriteLock

import java.util.concurrent.locks.ReentrantReadWriteLock

class Counters {
    public final Map&lt;String,Integer&gt; map = [:].withDefault { 0 }
    private final ReentrantReadWriteLock customLock = new ReentrantReadWriteLock()

    @WithReadLock('customLock')
    int get(String id) {
        map.get(id)
    }

    @WithWriteLock('customLock')
    void add(String id, int num) {
        Thread.sleep(200) // emulate long computation
        map.put(id, map.get(id)+num)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For details</p>
</div>
<div class="ulist">
<ul>
<li>
<p>See Javadoc for <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?groovy/transform/WithReadLock.html' target='_blank'><code>groovy.transform.WithReadLock</code></a></p>
</li>
<li>
<p>See Javadoc for <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?groovy/transform/WithWriteLock.html' target='_blank'><code>groovy.transform.WithWriteLock</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_easier_cloning_and_externalizing">Easier cloning and externalizing</h6>
<div class="paragraph">
<p>Groovy provides two annotations aimed at facilitating the implementation of <code>Clonable</code> and <code>Externalizable</code> interfaces,
respectively named <code>@AutoClone</code> and <code>@AutoExternalize</code>.</p>
</div>
<div class="sect6">
<h7 id="xform-AutoClone">@groovy.transform.AutoClone</h7>
<div class="paragraph">
<p>The <code>@AutoClone</code> annotation is aimed at implementing the <code>@java.lang.Cloneable</code> interface using various strategies, thanks to the <code>style</code> parameter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the default <code>AutoCloneStyle.CLONE</code> strategy calls <code>super.clone()</code> first then <code>clone()</code> on each cloneable property</p>
</li>
<li>
<p>the <code>AutoCloneStyle.SIMPLE</code> strategy uses a regular constructor call and copies properties from the source to the clone</p>
</li>
<li>
<p>the <code>AutoCloneStyle.COPY_CONSTRUCTOR</code> strategy creates and uses a copy constructor</p>
</li>
<li>
<p>the <code>AutoCloneStyle.SERIALIZATION</code> strategy uses serialization (or externalization) to clone the object</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of those strategies have pros and cons which are discussed in the Javadoc for <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?groovy/transform/AutoClone.html' target='_blank'><code>groovy.transform.AutoClone</code></a> and <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?groovy/transform/AutoCloneStyle.html' target='_blank'><code>groovy.transform.AutoCloneStyle</code></a> .</p>
</div>
<div class="paragraph">
<p>For example, the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.AutoClone

@AutoClone
class Book {
    String isbn
    String title
    List&lt;String&gt; authors
    Date publicationDate
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Book implements Cloneable {
    String isbn
    String title
    List&lt;String&gt; authors
    Date publicationDate

    public Book clone() throws CloneNotSupportedException {
        Book result = super.clone()
        result.authors = authors instanceof Cloneable ? (List) authors.clone() : authors
        result.publicationDate = publicationDate.clone()
        result
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the String properties aren&#8217;t explicitly handled because Strings are immutable and the <code>clone()</code> method from <code>Object</code> will copy the String references. The same would apply to primitive fields and most of the concrete subclasses of <code>java.lang.Number</code>.</p>
</div>
<div class="paragraph">
<p>In addition to cloning styles, <code>@AutoClone</code> supports multiple options:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of property or field names that need to be excluded from cloning. A string consisting of a comma-separated field/property names is also allowed.
See <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?groovy/transform/AutoClone.html#excludes' target='_blank'><code>groovy.transform.AutoClone</code></a> for details</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.AutoClone
import groovy.transform.AutoCloneStyle

@AutoClone(style=AutoCloneStyle.SIMPLE,excludes='authors')
class Book {
    String isbn
    String title
    List authors
    Date publicationDate
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, only properties are cloned. Setting this flag to true will also clone fields.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.AutoClone
import groovy.transform.AutoCloneStyle

@AutoClone(style=AutoCloneStyle.SIMPLE,includeFields=true)
class Book {
    String isbn
    String title
    List authors
    protected Date publicationDate
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-AutoExternalize">@groovy.transform.AutoExternalize</h7>
<div class="paragraph">
<p>The <code>@AutoExternalize</code> AST transformation will assist in the creation of <code>java.io.Externalizable</code> classes. It will
automatically add the interface to the class and generate the <code>writeExternal</code> and <code>readExternal</code> methods. For example, this
code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.AutoExternalize

@AutoExternalize
class Book {
    String isbn
    String title
    float price
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be converted into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Book implements java.io.Externalizable {
    String isbn
    String title
    float price

    void writeExternal(ObjectOutput out) throws IOException {
        out.writeObject(isbn)
        out.writeObject(title)
        out.writeFloat( price )
    }

    public void readExternal(ObjectInput oin) {
        isbn = (String) oin.readObject()
        title = (String) oin.readObject()
        price = oin.readFloat()
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@AutoExternalize</code> annotation supports two parameters which will let you slightly customize its behavior:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of property or field names that need to be excluded from externalizing. A string consisting of a comma-separated field/property names is also allowed.
See <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?groovy/transform/AutoExternalize.html#excludes' target='_blank'><code>groovy.transform.AutoExternalize</code></a> for details</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.AutoExternalize

@AutoExternalize(excludes='price')
class Book {
    String isbn
    String title
    float price
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, only properties are externalized. Setting this flag to true will also clone fields.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.AutoExternalize

@AutoExternalize(includeFields=true)
class Book {
    String isbn
    String title
    protected float price
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_safer_scripting">Safer scripting</h6>
<div class="paragraph">
<p>The Groovy language makes it easy to execute user scripts at runtime (for example using <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?groovy/lang/GroovyShell.html' target='_blank'><code>groovy.lang.GroovyShell</code></a>),
but how do you make sure that a script won&#8217;t eat all CPU (infinite loops) or that concurrent scripts won&#8217;t slowly consume
all available threads of a thread pool? Groovy provides several annotations which are aimed towards safer scripting,
generating code which will for example allow you to interrupt execution automatically.</p>
</div>
<div class="sect6">
<h7 id="xform-ThreadInterrupt">@groovy.transform.ThreadInterrupt</h7>
<div class="paragraph">
<p>One complicated situation in the JVM world is when a thread can&#8217;t be stopped. The <code>Thread#stop</code> method exists but is
deprecated (and isn&#8217;t reliable) so your only chance relies in <code>Thread#interrupt</code>. Calling the latter will set the
<code>interrupt</code> flag on the thread, but it will <strong>not</strong> stop the execution of the thread. This is problematic because it&#8217;s the
responsability of the code executing in the thread to check the interrupt flag and properly exit. This makes sense when
you, as a developer, know that the code you are executing is meant to be run in an independent thread, but in general,
you don&#8217;t know it. It&#8217;s even worse with user scripts, who might not even know what a thread is (think of DSLs).</p>
</div>
<div class="paragraph">
<p><code>@ThreadInterrupt</code> simplifies this by adding thread interruption checks at critical places in the code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>loops (for, while)</p>
</li>
<li>
<p>first instruction of a method</p>
</li>
<li>
<p>first instruction of a closure body</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s imagine the following user script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">while (true) {
    i++
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is an obvious infinite loop. If this code executes in its own thread, interrupting wouldn&#8217;t help: if you <code>join</code> on
the thread, then the calling code would be able to continue, but the thread would still be alive, running in background
without any ability for you to stop it, slowly causing thread starvation.</p>
</div>
<div class="paragraph">
<p>One possibility to work around this is to setup your shell this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def config = new CompilerConfiguration()
config.addCompilationCustomizers(
        new ASTTransformationCustomizer(ThreadInterrupt)
)
def binding = new Binding(i:0)
def shell = new GroovyShell(binding,config)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The shell is then configured to automatically apply the <code>@ThreadInterrupt</code> AST transformations on all scripts. This allows
you to execute user scripts this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def t = Thread.start {
    shell.evaluate(userCode)
}
t.join(500) // give at most 500ms for the script to complete
if (t.alive) {
    t.interrupt()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The transformation automatically modified user code like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">while (true) {
    if (Thread.currentThread().interrupted) {
        throw new InterruptedException('The current thread has been interrupted.')
    }
    i++
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The check which is introduced inside the loop guarantees that if the <code>interrupt</code> flag is set on the current thread, an
exception will be thrown, interrupting the execution of the thread.</p>
</div>
<div class="paragraph">
<p><code>@ThreadInterrupt</code> supports multiple options that will let you further customize the behavior of the transformation:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">thrown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.InterruptedException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the type of exception which is thrown if the thread is interrupted.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class BadException extends Exception {
    BadException(String message) { super(message) }
}

def config = new CompilerConfiguration()
config.addCompilationCustomizers(
        new ASTTransformationCustomizer(thrown:BadException, ThreadInterrupt)
)
def binding = new Binding(i:0)
def shell = new GroovyShell(this.class.classLoader,binding,config)

def userCode = """
try {
    while (true) {
        i++
    }
} catch (BadException e) {
    i = -1
}
"""

def t = Thread.start {
    shell.evaluate(userCode)
}
t.join(1000) // give at most 1s for the script to complete
assert binding.i &gt; 0
if (t.alive) {
    t.interrupt()
}
Thread.sleep(100)
assert binding.i == -1'''</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkOnMethodStart</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should an interruption check be inserted at the beginning of each method body. See <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?groovy/transform/ThreadInterrupt.html' target='_blank'><code>groovy.transform.ThreadInterrupt</code></a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@ThreadInterrupt(checkOnMethodStart=false)</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllClasses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all classes of the same source unit (in the same source file). See <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?groovy/transform/ThreadInterrupt.html' target='_blank'><code>groovy.transform.ThreadInterrupt</code></a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@ThreadInterrupt(applyToAllClasses=false)
class A { ... } // interrupt checks added
class B { ... } // no interrupt checks</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllMembers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all members of class. See <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?groovy/transform/ThreadInterrupt.html' target='_blank'><code>groovy.transform.ThreadInterrupt</code></a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class A {
    @ThreadInterrupt(applyToAllMembers=false)
    void method1() { ... } // interrupt checked added
    void method2() { ... } // no interrupt checks
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-TimedInterrupt">@groovy.transform.TimedInterrupt</h7>
<div class="paragraph">
<p>The <code>@TimedInterrupt</code> AST transformation tries to solve a slightly different problem from <a href="#xform-ThreadInterrupt">@groovy.transform.ThreadInterrupt</a>: instead of checking the <code>interrupt</code> flag of the thread, it will automatically
throw an exception if the thread has been running for too long.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
This annotation does <strong>not</strong> spawn a monitoring thread. Instead, it works in a similar manner as <code>@ThreadInterrupt</code> by placing checks at appropriate places in the code. This means that if you
have a thread blocked by I/O, it will <strong>not</strong> be interrupted.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Imagine the following user code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def fib(int n) { n&lt;2?n:fib(n-1)+fib(n-2) }

result = fib(600)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The implementation of the famous Fibonacci number computation here is far from optimized. If it is called with a high <code>n</code> value, it can take minutes to answer. With <code>@TimedInterrupt</code>, you can
choose how long a script is allowed to run. The following setup code will allow the user script to run for 1 second at max:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def config = new CompilerConfiguration()
config.addCompilationCustomizers(
        new ASTTransformationCustomizer(value:1, TimedInterrupt)
)
def binding = new Binding(result:0)
def shell = new GroovyShell(this.class.classLoader, binding,config)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code is equivalent to annotating a class with <code>@TimedInterrupt</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@TimedInterrup(value=1, unit=TimeUnit.SECONDS)
class MyClass {
    def fib(int n) {
        n&lt;2?n:fib(n-1)+fib(n-2)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@TimedInterrupt</code> supports multiple options that will let you further customize the behavior of the transformation:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long.MAX_VALUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used in combination with <code>unit</code> to specify after how long execution times out.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@TimedInterrupt(value=500L, unit= TimeUnit.MILLISECONDS, applyToAllClasses = false)
class Slow {
    def fib(n) { n&lt;2?n:fib(n-1)+fib(n-2) }
}
def result
def t = Thread.start {
    result = new Slow().fib(500)
}
t.join(1000)
assert result == null
assert !t.alive</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimeUnit.SECONDS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used in combination with <code>value</code> to specify after how long execution times out.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@TimedInterrupt(value=500L, unit= TimeUnit.MILLISECONDS, applyToAllClasses = false)
class Slow {
    def fib(n) { n&lt;2?n:fib(n-1)+fib(n-2) }
}
def result
def t = Thread.start {
    result = new Slow().fib(500)
}
t.join(1000)
assert result == null
assert !t.alive</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">thrown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.concurrent.TimeoutException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the type of exception which is thrown if timeout is reached.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@TimedInterrupt(thrown=TooLongException, applyToAllClasses = false, value=1L)
class Slow {
    def fib(n) { Thread.sleep(100); n&lt;2?n:fib(n-1)+fib(n-2) }
}
def result
def t = Thread.start {
    try {
        result = new Slow().fib(50)
    } catch (TooLongException e) {
        result = -1
    }
}
t.join(2000)
assert result == -1</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkOnMethodStart</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should an interruption check be inserted at the beginning of each method body. See <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?groovy/transform/TimedInterrupt.html' target='_blank'><code>groovy.transform.TimedInterrupt</code></a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@TimedInterrupt(checkOnMethodStart=false)</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllClasses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all classes of the same source unit (in the same source file). See <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?groovy/transform/TimedInterrupt.html' target='_blank'><code>groovy.transform.TimedInterrupt</code></a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@TimedInterrupt(applyToAllClasses=false)
class A { ... } // interrupt checks added
class B { ... } // no interrupt checks</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllMembers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all members of class. See <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?groovy/transform/TimedInterrupt.html' target='_blank'><code>groovy.transform.TimedInterrupt</code></a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class A {
    @TimedInterrupt(applyToAllMembers=false)
    void method1() { ... } // interrupt checked added
    void method2() { ... } // no interrupt checks
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
<code>@TimedInterrupt</code> is currently not compatible with static methods!
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="xform-ConditionalInterrupt">@groovy.transform.ConditionalInterrupt</h7>
<div class="paragraph">
<p>The last annotation for safer scripting is the base annotation when you want to interrupt a script using a custom strategy. In particular, this is the annotation of choice if you
want to use resource management (limit the number of calls to an API, &#8230;). In the following example, user code is using an infinite loop, but <code>@ConditionalInterrupt</code> will allow us
to check a quota manager and interrupt automatically the script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@ConditionalInterrupt({Quotas.disallow('user')})
class UserCode {
    void doSomething() {
        int i=0
        while (true) {
            println "Consuming resources ${++i}"
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The quota checking is very basic here, but it can be any code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Quotas {
    static def quotas = [:].withDefault { 10 }
    static boolean disallow(String userName) {
        println "Checking quota for $userName"
        (quotas[userName]--)&lt;0
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can make sure <code>@ConditionalInterrupt</code> works properly using this test code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert Quotas.quotas['user'] == 10
def t = Thread.start {
    new UserCode().doSomething()
}
t.join(1000)
assert !t.alive
assert Quotas.quotas['user'] &lt; 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, in practice, it is unlikely that <code>@ConditionalInterrupt</code> will be itself added by hand on user code. It can be injected in a similar manner as the example shown in the
<a href="#xform-ThreadInterrupt">ThreadInterrupt</a> section, using the <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?org/codehaus/groovy/control/customizers/ASTTransformationCustomizer.html' target='_blank'><code>org.codehaus.groovy.control.customizers.ASTTransformationCustomizer</code></a> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def config = new CompilerConfiguration()
def checkExpression = new ClosureExpression(
        Parameter.EMPTY_ARRAY,
        new ExpressionStatement(
                new MethodCallExpression(new ClassExpression(ClassHelper.make(Quotas)), 'disallow', new ConstantExpression('user'))
        )
)
config.addCompilationCustomizers(
        new ASTTransformationCustomizer(value: checkExpression, ConditionalInterrupt)
)

def shell = new GroovyShell(this.class.classLoader,new Binding(),config)

def userCode = """
        int i=0
        while (true) {
            println "Consuming resources \\${++i}"
        }
"""

assert Quotas.quotas['user'] == 10
def t = Thread.start {
    shell.evaluate(userCode)
}
t.join(1000)
assert !t.alive
assert Quotas.quotas['user'] &lt; 0</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@ConditionalInterrupt</code> supports multiple options that will let you further customize the behavior of the transformation:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The closure which will be called to check if execution is allowed. If the closure returns false, execution is allowed. If it returns true, then an exception will be thrown.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@ConditionalInterrupt({ ... })</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">thrown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.InterruptedException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the type of exception which is thrown if execution should be aborted.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">config.addCompilationCustomizers(
        new ASTTransformationCustomizer(thrown: QuotaExceededException,value: checkExpression, ConditionalInterrupt)
)
assert Quotas.quotas['user'] == 10
def t = Thread.start {
    try {
        shell.evaluate(userCode)
    } catch (QuotaExceededException) {
        Quotas.quotas['user'] = 'Quota exceeded'
    }
}
t.join(1000)
assert !t.alive
assert Quotas.quotas['user'] == 'Quota exceeded'</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkOnMethodStart</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should an interruption check be inserted at the beginning of each method body. See <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?groovy/transform/ConditionalInterrupt.html' target='_blank'><code>groovy.transform.ConditionalInterrupt</code></a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@ConditionalInterrupt(checkOnMethodStart=false)</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllClasses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all classes of the same source unit (in the same source file). See <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?groovy/transform/ConditionalInterrupt.html' target='_blank'><code>groovy.transform.ConditionalInterrupt</code></a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@ConditionalInterrupt(applyToAllClasses=false)
class A { ... } // interrupt checks added
class B { ... } // no interrupt checks</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllMembers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all members of class. See <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?groovy/transform/ConditionalInterrupt.html' target='_blank'><code>groovy.transform.ConditionalInterrupt</code></a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class A {
    @ConditionalInterrupt(applyToAllMembers=false)
    void method1() { ... } // interrupt checked added
    void method2() { ... } // no interrupt checks
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_compiler_directives">Compiler directives</h6>
<div class="paragraph">
<p>This category of AST transformations groups annotations which have a direct impact on the semantics of the code, rather
than focusing on code generation. With that regards, they can be seen as compiler directives that either change the
behavior of a program at compile time or runtime.</p>
</div>
<div class="sect6">
<h7 id="xform-Field">@groovy.transform.Field</h7>
<div class="paragraph">
<p>The <code>@Field</code> annotation only makes sense in the context of a script and aims at solving a common scoping error with
scripts. The following example will for example fail at runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def x

String line() {
    "="*x
}

x=3
assert "===" == line()
x=5
assert "=====" == line()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The error that is thrown may be difficult to interpret: <code>groovy.lang.MissingPropertyException: No such property: x</code>. The reason is that scripts are compiled
to classes and the script body is itself compiled as a single <em>run()</em> method. Methods which are defined in the scripts are independent, so the code above is
equivalent to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class MyScript extends Script {

    String line() {
        "="*x
    }

    public def run() {
        def x
        x=3
        assert "===" == line()
        x=5
        assert "=====" == line()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>So <code>def x</code> is effectiveley interpreted as a local variable, outside of the scope of the <code>line</code> method. The <code>@Field</code> AST transformation aims at fixing this
by changing the scope of the variable to a field of the enclosing script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Field def x

String line() {
    "="*x
}

x=3
assert "===" == line()
x=5
assert "=====" == line()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting, equivalent, code is now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class MyScript extends Script {

    def x

    String line() {
        "="*x
    }

    public def run() {
        x=3
        assert "===" == line()
        x=5
        assert "=====" == line()
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-PackageScope">@groovy.transform.PackageScope</h7>
<div class="paragraph">
<p>By default, Groovy visibility rules imply that if you create a field without specifying a modifier, then the field is interpreted as a property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Person {
    String name // this is a property
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Should you want to create a package private field instead of a property (private field+getter/setter), then annotate your field with <code>@PackageScope</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Person {
    @PackageScope String name // not a property anymore
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@PackageScope</code> annotation can also be used for classes, methods and constructors. In addition, by specifying a list
of <code>PackageScopeTarget</code> values as the annotation attribute at the class level, all members within that class that don&#8217;t
have an explicit modifier and match the provided <code>PackageScopeTarget</code> will remain package protected. For example to apply
to fields within a class use the following annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import static groovy.transform.PackageScopeTarget.FIELDS
@PackageScope(FIELDS)
class Person {
  String name     // not a property, package protected
  Date dob        // not a property, package protected
  private int age // explicit modifier, so won't be touched
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@PackageScope</code> annotation is seldom used as part of normal Groovy conventions but is sometimes useful
for factory methods that should be visible internally within a package or for methods or constructors provided
for testing purposes, or when integrating with third-party libraries which require such visibility conventions.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-AnnotationCollector">@groovy.transform.AnnotationCollector</h7>
<div class="paragraph">
<p><code>@AnnotationCollector</code> allows the creation of meta-annotation, which are described in a <a href="#meta-annotations">dedicated section</a>.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-TypeChecked">@groovy.transform.TypeChecked</h7>
<div class="paragraph">
<p><code>@TypeChecked</code> activates compile-time type checking on your Groovy code. See <a href="#section-typechecked">section on type checking</a> for details.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-CompileStatic">@groovy.transform.CompileStatic</h7>
<div class="paragraph">
<p><code>@CompileStatic</code> activates static compilation on your Groovy code. See <a href="#section-typechecked">section on type checking</a> for details.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-CompileDynamic">@groovy.transform.CompileDynamic</h7>
<div class="paragraph">
<p><code>@CompileDynamic</code> disables static compilation on parts of your Groovy code. See <a href="#section-typechecked">section on type checking</a> for details.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-DelegatesTo">@groovy.lang.DelegatesTo</h7>
<div class="paragraph">
<p><code>@DelegatesTo</code> is not, technically speaking, an AST transformation. It is aimed at documenting code and helping the compiler in case you are
using <a href="#xform-TypeChecked">type checking</a> or <a href="#xform-CompileStatic">static compilation</a>. The annotation is described throughfully in the
<a href="#section-delegatesto">DSL section</a> of this guide.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_swing_patterns">Swing patterns</h6>
<div class="sect6">
<h7 id="xform-Bindable">@groovy.beans.Bindable</h7>
<div class="paragraph">
<p><code>@Bindable</code> is an AST transformation that transforms a regular property into a bound property (according to the <a href="http://download.oracle.com/otndocs/jcp/7224-javabeans-1.01-fr-spec-oth-JSpec/">JavaBeans specification</a>).
The <code>@Bindable</code> annotation can be placed on a property or a class. To convert all properties of a class into bound properties, on can annotate the class like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.beans.Bindable

@Bindable
class Person {
    String name
    int age
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is equivalent to writing this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import java.beans.PropertyChangeListener
import java.beans.PropertyChangeSupport

class Person {
    final private PropertyChangeSupport this$propertyChangeSupport

    String name
    int age

    public void addPropertyChangeListener(PropertyChangeListener listener) {
        this$propertyChangeSupport.addPropertyChangeListener(listener)
    }

    public void addPropertyChangeListener(String name, PropertyChangeListener listener) {
        this$propertyChangeSupport.addPropertyChangeListener(name, listener)
    }

    public void removePropertyChangeListener(PropertyChangeListener listener) {
        this$propertyChangeSupport.removePropertyChangeListener(listener)
    }

    public void removePropertyChangeListener(String name, PropertyChangeListener listener) {
        this$propertyChangeSupport.removePropertyChangeListener(name, listener)
    }

    public void firePropertyChange(String name, Object oldValue, Object newValue) {
        this$propertyChangeSupport.firePropertyChange(name, oldValue, newValue)
    }

    public PropertyChangeListener[] getPropertyChangeListeners() {
        return this$propertyChangeSupport.getPropertyChangeListeners()
    }

    public PropertyChangeListener[] getPropertyChangeListeners(String name) {
        return this$propertyChangeSupport.getPropertyChangeListeners(name)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Bindable</code> therefore removes a lot of boilerplate from your class, dramatically increasing readability. If the annotation is put on a single property, only that property is bound:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.beans.Bindable

class Person {
    String name
    @Bindable int age
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-ListenerList">@groovy.beans.ListenerList</h7>
<div class="paragraph">
<p>The <code>@ListenerList</code> AST transformation generates code for adding, removing and getting the list of listeners to a class, just by annotating a collection property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import java.awt.event.ActionListener
import groovy.beans.ListenerList

class Component {
    @ListenerList
    List&lt;ActionListener&gt; listeners;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The transform will generate the appropriate add/remove methods based on the generic type of the list. In addition, it will also create <code>fireXXX</code> methods based on the public methods declared on the class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import java.awt.event.ActionEvent
import java.awt.event.ActionListener as ActionListener
import groovy.beans.ListenerList as ListenerList

public class Component {

    @ListenerList
    private List&lt;ActionListener&gt; listeners

    public void addActionListener(ActionListener listener) {
        if ( listener == null) {
            return
        }
        if ( listeners == null) {
            listeners = []
        }
        listeners.add(listener)
    }

    public void removeActionListener(ActionListener listener) {
        if ( listener == null) {
            return
        }
        if ( listeners == null) {
            listeners = []
        }
        listeners.remove(listener)
    }

    public ActionListener[] getActionListeners() {
        Object __result = []
        if ( listeners != null) {
            __result.addAll(listeners)
        }
        return (( __result ) as ActionListener[])
    }

    public void fireActionPerformed(ActionEvent param0) {
        if ( listeners != null) {
            ArrayList&lt;ActionListener&gt; __list = new ArrayList&lt;ActionListener&gt;(listeners)
            for (def listener : __list ) {
                listener.actionPerformed(param0)
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Bindable</code> supports multiple options that will let you further customize the behavior of the transformation:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generic type name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, the suffix which will be appended to add/remove/&#8230; methods is the simple class name of the generic type of the list.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Component {
    @ListenerList(name='item')
    List&lt;ActionListener&gt; listeners;
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">synchronize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, generated methods will be synchronized</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Component {
    @ListenerList(synchronize = true)
    List&lt;ActionListener&gt; listeners;
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-Vetoable">@groovy.beans.Vetoable</h7>
<div class="paragraph">
<p>The <code>@Vetoable</code> annotation works in a similar manner to <code>@Bindable</code> but generates constrained property according to the JavaBeans specification, instead of bound properties. The annotation
can be placed on a class, meaning that all properties will be converted to constrained properties, or on a single property. For example, annotating this class with <code>@Vetoable</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.beans.Vetoable

import java.beans.PropertyVetoException
import java.beans.VetoableChangeListener

@Vetoable
class Person {
    String name
    int age
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">public class Person {

    private String name
    private int age
    final private java.beans.VetoableChangeSupport this$vetoableChangeSupport

    public void addVetoableChangeListener(VetoableChangeListener listener) {
        this$vetoableChangeSupport.addVetoableChangeListener(listener)
    }

    public void addVetoableChangeListener(String name, VetoableChangeListener listener) {
        this$vetoableChangeSupport.addVetoableChangeListener(name, listener)
    }

    public void removeVetoableChangeListener(VetoableChangeListener listener) {
        this$vetoableChangeSupport.removeVetoableChangeListener(listener)
    }

    public void removeVetoableChangeListener(String name, VetoableChangeListener listener) {
        this$vetoableChangeSupport.removeVetoableChangeListener(name, listener)
    }

    public void fireVetoableChange(String name, Object oldValue, Object newValue) throws PropertyVetoException {
        this$vetoableChangeSupport.fireVetoableChange(name, oldValue, newValue)
    }

    public VetoableChangeListener[] getVetoableChangeListeners() {
        return this$vetoableChangeSupport.getVetoableChangeListeners()
    }

    public VetoableChangeListener[] getVetoableChangeListeners(String name) {
        return this$vetoableChangeSupport.getVetoableChangeListeners(name)
    }

    public void setName(String value) throws PropertyVetoException {
        this.fireVetoableChange('name', name, value)
        name = value
    }

    public void setAge(int value) throws PropertyVetoException {
        this.fireVetoableChange('age', age, value)
        age = value
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the annotation is put on a single property, only that property is made vetoable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.beans.Vetoable

class Person {
    String name
    @Vetoable int age
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_test_assistance">Test assistance</h6>
<div class="sect6">
<h7 id="xform-NotYetImplemented">@groovy.lang.NotYetImplemented</h7>
<div class="paragraph">
<p><code>@NotYetImplemented</code> is used to invert the result of a JUnit 3/4 test case. It is in particular useful if a feature is not yet implemented but the test is. In that case, it is expected
that the test fails. Marking it with <code>@NotYetImplemented</code> will inverse the result of the test, like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.NotYetImplemented

class Maths {
    static int fib(int n) {
        // todo: implement later
    }
}

class MathsTest extends GroovyTestCase {
    @NotYetImplemented
    void testFib() {
        def dataTable = [
                1:1,
                2:1,
                3:2,
                4:3,
                5:5,
                6:8,
                7:13
        ]
        dataTable.each { i, r -&gt;
            assert Maths.fib(i) == r
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another advantage of using this technique is that you can write test cases for bugs before knowing how to fix them. If some time in the future, a modification in the code fixes a bug by side effect,
you&#8217;ll be notified because a test which was expected to fail passed.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-ASTTest">@groovy.transform.ASTTest</h7>
<div class="paragraph">
<p><code>@ASTTest</code> is a special AST transformation meant to help debugging other AST transformations or the Groovy compiler itself. It will let the developer "explore" the AST during compilation and
perform assertions on the AST rather than on the result of compilation. This means that this AST transformations gives access to the AST before the bytecode is produced. <code>@ASTTest</code> can be
placed on any annotable node and requires two parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>phase</em>: sets at which phase at which <code>@ASTTest</code> will be triggered. The test code will work on the AST tree at the end of this phase.</p>
</li>
<li>
<p><em>value</em>: the code which will be executed once the phase is reached, on the annotated node</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
Compile phase has to be chosen from one of <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?org/codehaus/groovy/control/CompilePhase.html' target='_blank'><code>org.codehaus.groovy.control.CompilePhase</code></a> . However, since it is not possible to annotate a node twice with the same annotation, you will
not be able to use <code>@ASTTest</code> on the same node at two distinct compile phases.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>value</code> is a closure expression which has access to a special variable <code>node</code> corresponding to the annotated node, and a helper <code>lookup</code> method which will be discussed <a href="#asttest-lookup">here</a>.
For example, you can annotate a class node like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.ASTTest
import org.codehaus.groovy.ast.ClassNode
import static org.codehaus.groovy.control.CompilePhase.*

@ASTTest(phase=CONVERSION, value={   <i class="conum" data-value="1"></i><b>(1)</b>
    assert node instanceof ClassNode <i class="conum" data-value="2"></i><b>(2)</b>
    assert node.name == 'Person'     <i class="conum" data-value="3"></i><b>(3)</b>
})
class Person {

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>we&#8217;re checking the state of the Abstract Syntax Tree after the CONVERSION phase</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>node refers to the AST node which is annotated by @ASTTest</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>it can be used to perform assertions at compile time</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One interesting feature of <code>@ASTTest</code> is that if an assertion fails, then <strong>compilation will fail</strong>. Now imagine that we want to check the behavior of an AST transformation at compile time.
We will take <code>@PackageScope</code> here, and we will want to verify that a property annotated with <code>@PackageScope</code> becomes a package private field. For this, we have to know at which phase the
transform runs, which can be found in <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?org/codehaus/groovy/transform/PackageScopeASTTransformation.html' target='_blank'><code>org.codehaus.groovy.transform.PackageScopeASTTransformation</code></a> : semantic analysis. Then a test can be written like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.ASTTest
import groovy.transform.PackageScope

import static org.codehaus.groovy.control.CompilePhase.*

@ASTTest(phase=SEMANTIC_ANALYSIS, value= {
    def nameNode = node.properties.find { it.name == 'name' }
    def ageNode = node.properties.find { it.name == 'age' }
    assert nameNode
    assert ageNode == null // shouldn't be a property anymore
    def ageField = node.getDeclaredField 'age'
    assert ageField.modifiers == 0
})
class Person {
    String name
    @PackageScope int age
}</code></pre>
</div>
</div>
<div id="asttest-lookup" class="paragraph">
<p>The <code>@ASTTest</code> annotation can only be placed wherever the grammar allows it. Sometimes, you would like to test the contents of an AST node which is not annotable. In this case,
<code>@ASTTest</code> provides a convenient <code>lookup</code> method which will search the AST for nodes which are labelled with a special token:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def list = lookup('anchor') <i class="conum" data-value="1"></i><b>(1)</b>
Statement stmt = list[0] <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>returns the list of AST nodes which label is <em>anchor</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>it is always necessary to choose which element to process since lookup always returns a list</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Imagine, for example, that you want to test the declared type of a for loop variable. Then you can do it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.transform.ASTTest
import groovy.transform.PackageScope
import org.codehaus.groovy.ast.ClassHelper
import org.codehaus.groovy.ast.expr.DeclarationExpression
import org.codehaus.groovy.ast.stmt.ForStatement

import static org.codehaus.groovy.control.CompilePhase.*

class Something {
    @ASTTest(phase=SEMANTIC_ANALYSIS, value= {
        def forLoop = lookup('anchor')[0]
        assert forLoop instanceof ForStatement
        def decl = forLoop.collectionExpression.expressions[0]
        assert decl instanceof DeclarationExpression
        assert decl.variableExpression.name == 'i'
        assert decl.variableExpression.originType == ClassHelper.int_TYPE
    })
    void someMethod() {
        int x = 1;
        int y = 10;
        anchor: for (int i=0; i&lt;x+y; i++) {
            println "$i"
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_grape_handling">Grape handling</h6>
<div class="sect6">
<h7 id="xform-Grab">@groovy.lang.Grab</h7>

</div>
<div class="sect6">
<h7 id="xform-GrabConfig">@groovy.lang.GrabConfig</h7>

</div>
<div class="sect6">
<h7 id="xform-GrabExclude">@groovy.lang.GrabExclude</h7>

</div>
<div class="sect6">
<h7 id="xform-GrabResolver">@groovy.lang.GrabResolver</h7>

</div>
<div class="sect6">
<h7 id="xform-Grapes">@groovy.lang.Grapes</h7>
<div class="paragraph">
<p><code>Grape</code> is a dependency management engine embedded into Groovy, relying on several annotations which are described
throughfully in this <a href="#section-grape">section of the guide</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="developing-ast-xforms">Developing AST transformations (TBD)</h5>
<div class="sect5">
<h6 id="_compilation_phases_guide_tbd">Compilation phases guide (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_local_transformations_tbd">Local transformations (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_global_transformations_tbd">Global transformations (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_ast_api_guide_tbd">AST API guide (TBD)</h6>

</div>
<div class="sect5">
<h6 id="_testing_ast_transformations_tbd">Testing AST transformations (TBD)</h6>

</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-grape">4.5. Dependency management with Grape</h3>
<div class="sect3">
<h4 id="_quick_start">4.5.1. Quick start</h4>
<div class="sect4">
<h5 id="_add_a_dependency">Add a Dependency</h5>
<div class="paragraph">
<p>Grape is a JAR dependency manager embedded into Groovy. Grape lets you quickly add maven repository dependencies to your
classpath, making scripting even easier. The simplest use is as simple as adding an annotation to your script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Grab(group='org.springframework', module='spring-orm', version='3.2.5.RELEASE')
import org.springframework.jdbc.core.JdbcTemplate</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Grab</code> also supports a shorthand notation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Grab('org.springframework:spring-orm:3.2.5.RELEASE')
import org.springframework.jdbc.core.JdbcTemplate</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we are using an annotated import here, which is the recommanded way. You can also search for
dependencies on <a href="http://mvnrepository.com">mvnrepository.com</a> and it will
provide you the <code>@Grab</code> annotation form of the <code>pom.xml</code> entry.</p>
</div>
</div>
<div class="sect4">
<h5 id="Grape-SpecifyAdditionalRepositories">Specify Additional Repositories</h5>
<div class="paragraph">
<p>Not all dependencies are in maven central. You can add new ones like
this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@GrabResolver(name='restlet', root='http://maven.restlet.org/')
@Grab(group='org.restlet', module='org.restlet', version='1.1.6')</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-MavenClassifiers">Maven Classifiers</h5>
<div class="paragraph">
<p>Some maven dependencies need classifiers in order to be able to resolve.
You can fix that like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Grab(group='net.sf.json-lib', module='json-lib', version='2.2.3', classifier='jdk15')</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-ExcludingTransitiveDependencies">Excluding Transitive Dependencies</h5>
<div class="paragraph">
<p>Sometimes you will want to exclude transitive dependencies as you might
be already using a slightly different but compatible version of some
artifact. You can do this as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Grab('net.sourceforge.htmlunit:htmlunit:2.8')
@GrabExclude('xml-apis:xml-apis')</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-JDBCDrivers">JDBC Drivers</h5>
<div class="paragraph">
<p>Because of the way JDBC drivers are loaded, you’ll need to configure
Grape to attach JDBC driver dependencies to the system class loader.
I.e:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@GrabConfig(systemClassLoader=true)
@Grab(group='mysql', module='mysql-connector-java', version='5.1.6')</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-UsingGrapeFromtheGroovyShell">Using Grape From the Groovy Shell</h5>
<div class="paragraph">
<p>From groovysh use the method call variant:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">groovy.grape.Grape.grab(group:'org.springframework', module:'spring', version:'2.5.6')</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-Proxysettings">Proxy settings</h5>
<div class="paragraph">
<p>If you are behind a firewall and/or need to use Groovy/Grape through a
proxy server, you can specify those settings on the command like via the
http.proxyHost and http.proxyPort system properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy -Dhttp.proxyHost=yourproxy -Dhttp.proxyPort=8080 yourscript.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>Or you can make this system wide by adding these properties to your
JAVA_OPTS environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>JAVA_OPTS = -Dhttp.proxyHost=yourproxy -Dhttp.proxyPort=8080</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-Logging">Logging</h5>
<div class="paragraph">
<p>If you want to see what Grape is doing set the system property
&#8220;groovy.grape.report.downloads&#8221; to &#8220;true&#8221; (e.g. add
&#8220;-Dgroovy.grape.report.downloads=true&#8221; to JAVA_OPTS) and Grape will
print the following infos to System.error:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Starting resolve of a dependency</p>
</li>
<li>
<p>Starting download of an artifact</p>
</li>
<li>
<p>Retrying download of an artifact</p>
</li>
<li>
<p>Download size and time for downloaded artifacts</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Grape-Detail">4.5.2. Detail</h4>
<div class="paragraph">
<p>Grape (The <em>Groovy Adaptable Packaging Engine</em> or <em>Groovy Advanced
Packaging Engine</em>) is the infrastructure enabling the grab() calls in
Groovy, a set of classes leveraging <a href="http://ant.apache.org/ivy/">Ivy</a> to allow for a repository driven
module system for Groovy. This allows a developer to write a script with
an essentially arbitrary library requirement, and ship just the script.
Grape will, at runtime, download as needed and link the named libraries
and all dependencies forming a transitive closure when the script is run
from existing repositories such as JCenter, Ibiblio, Codehaus, and java.net.</p>
</div>
<div class="paragraph">
<p>Grape follows the Ivy conventions for module version identification,
with naming change.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>group</code> - Which module group the module comes from. Translates
directly to a Maven groupId or an Ivy Organization. Any group matching
<code>/groovy[x][\..*]^/</code> is reserved and may have special meaning to the
groovy endorsed modules.</p>
</li>
<li>
<p><code>module</code> - The name of the module to load. Translated directly to a
Maven artifactId or an Ivy artifact.</p>
</li>
<li>
<p><code>version</code> - The version of the module to use. Either a literal version
&#8216;1.1-RC3&#8217; or an Ivy Range &#8216;[2.2.1,)&#8217; meaning 2.2.1 or any greater
version).</p>
</li>
<li>
<p><code>classifier</code> - The optional classifier to use (for example, <em>jdk15</em>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The downloaded modules will be stored according to Ivy’s standard
mechanism with a cache root of <code>~/.groovy/grape</code></p>
</div>
</div>
<div class="sect3">
<h4 id="Grape-Usage">4.5.3. Usage</h4>
<div class="sect4">
<h5 id="Grape-Annotation">Annotation</h5>
<div class="paragraph">
<p>One or more <code>groovy.lang.Grab</code> annotations can be added at any place that
annotations are accepted to tell the compiler that this code relies on
the specific library. This will have the effect of adding the library to
the classloader of the groovy compiler. This annotation is detected and
evaluated before any other resolution of classes in the script, so
imported classes can be properly resolved by a <code>@Grab</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import com.jidesoft.swing.JideSplitButton
@Grab(group='com.jidesoft', module='jide-oss', version='[2.2.1,2.3.0)')
public class TestClassAnnotation {
    public static String testMethod () {
        return JideSplitButton.class.name
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An appropriate <code>grab(...)</code> call will be added to the static initializer
of the class of the containing class (or script class in the case of an
annotated script element).</p>
</div>
</div>
<div class="sect4">
<h5 id="Grape-MultipleGrapeAnnotations">Multiple Grape Annotations</h5>
<div class="paragraph">
<p>In order to use a Grape annotation multiple times on the same node you must use the
<code>@Grapes</code> annotation, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Grapes([
   @Grab(group='commons-primitives', module='commons-primitives', version='1.0'),
   @Grab(group='org.ccil.cowan.tagsoup', module='tagsoup', version='0.9.7')])
class Example {
// ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Otherwise you’ll encounter the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Cannot specify duplicate annotation on the same member</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-Methodcall">Method call</h5>
<div class="paragraph">
<p>Typically a call to grab will occur early in the script or in class
initialization. This is to insure that the libraries are made available
to the ClassLoader before the groovy code relies on the code. A couple
of typical calls may appear as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.grape.Grape
// random maven library
Grape.grab(group:'com.jidesoft', module:'jide-oss', version:'[2.2.0,)')
Grape.grab([group:'org.apache.ivy', module:'ivy', version:'2.0.0-beta1', conf:['default', 'optional']],
     [group:'org.apache.ant', module:'ant', version:'1.7.0'])

// endorsed Groovy Module
// FUTURE grab('Scriptom')</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Multiple calls to grab in the same context with the same parameters
should be idempotent. However, if the same code is called with a
different <code>ClassLoader</code> context then resolution may be re-run.</p>
</li>
<li>
<p>If the <code>args</code> map passed into the <code>grab</code> call has an attribute
<code>noExceptions</code> that evaluates true no exceptions will be thrown.</p>
</li>
<li>
<p><code>grab</code> requires that a <code>RootLoader</code> or <code>GroovyClassLoader</code> be specified or
be in the <code>ClassLoader</code> chain of the calling class. By default failure to
have such a <code>ClassLoader</code> available will result in module resolution and
an exception being thrown</p>
<div class="ulist">
<ul>
<li>
<p>The ClassLoader passed in via the <code>classLoader:</code> argument and it’s
parent classloaders.</p>
</li>
<li>
<p>The ClassLoader of the object passed in as the <code>referenceObject:</code>
argument, and it’s parent classloaders.</p>
</li>
<li>
<p>The ClassLoader of the class issuing the call to <code>grab</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="Grape-grabHashMapParameters">grab(HashMap) Parameters</h6>
<div class="ulist">
<ul>
<li>
<p><code>group:</code> - &lt;String&gt; - Which module group the module comes from.
Translates directly to a Maven groupId. Any group matching
<code>/groovy(|\..|x|x\..)/</code> is reserved and may have special meaning to the
groovy endorsed modules.</p>
</li>
<li>
<p><code>module:</code> - &lt;String&gt; - The name of the module to load. Translated
directly to a Maven artifactId.</p>
</li>
<li>
<p><code>version:</code> - &lt;String&gt; and possibly &lt;Range&gt; - The version of the module
to use. Either a literal version &#8216;1.1-RC3&#8217; or an Ivy Range &#8216;[2.2.1,)&#8217;
meaning 2.2.1 or any greater version).</p>
</li>
<li>
<p><code>classifier:</code> - &lt;String&gt; - The Maven classifier to resolve by.</p>
</li>
<li>
<p><code>conf:</code> - &lt;String&gt;, default <code>default' - The configuration or scope of
the module to download. The default conf is `default:</code> which maps to the
maven <code>runtime</code> and <code>master</code> scopes.</p>
</li>
<li>
<p><code>force:</code>- &lt;boolean&gt;, defaults true - Used to indicate that this
revision must be used in case of conflicts, independently of</p>
</li>
<li>
<p>conflicts manager</p>
</li>
<li>
<p><code>changing:</code> - &lt;boolean&gt;, default false - Whether the artifact can
change without it’s version designation changing.</p>
</li>
<li>
<p><code>transitive:</code> - &lt;boolean&gt;, default true - Whether to resolve other
dependencies this module has or not.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are two principal variants of <code>grab</code>, one with a single Map and
one with an arguments Map and multiple dependencies map. A call to the
single map grab is the same as calling grab with the same map passed in
twice, so grab arguments and dependencies can be mixed in the same map,
and grab can be called as a single method with named parameters.</p>
</div>
<div class="paragraph">
<p>There are synonyms for these parameters. Submitting more than one is a
runtime exception.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>group:</code>, <code>groupId:</code>, <code>organisation:</code>, <code>organization:</code>, <code>org:</code></p>
</li>
<li>
<p><code>module:</code>, <code>artifactId:</code>, <code>artifact:</code></p>
</li>
<li>
<p><code>version:</code>, <code>revision:</code>, <code>rev:</code></p>
</li>
<li>
<p><code>conf:</code>, <code>scope:</code>, <code>configuration:</code></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="Grape-ArgumentsMaparguments">Arguments Map arguments</h6>
<div class="ulist">
<ul>
<li>
<p><code>classLoader:</code> - &lt;GroovyClassLaoder&gt; or &lt;RootClassLoader&gt; - The
ClassLoader to add resolved Jars to</p>
</li>
<li>
<p><code>refObject:</code> - &lt;Object&gt; - The closest parent ClassLoader for the
object’s class will be treated as though it were passed in as
<code>classLoader:</code></p>
</li>
<li>
<p><code>validate:</code> - &lt;boolean&gt;, default false - Should poms or ivy files be
validated (true), or should we trust the cache (false).</p>
</li>
<li>
<p><code>noExceptions:</code> - &lt;boolean&gt;, default false - If ClassLoader resolution
or repository querying fails, should we throw an exception (false) or
fail silently (true).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-CommandLineTool">Command Line Tool</h5>
<div class="paragraph">
<p>Grape added a command line executable &#8216;grape&#8217; that allows for the
inspection and management of the local grape cache.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>grape install &lt;groupId&gt; &lt;artifactId&gt; [&lt;version&gt;]</pre>
</div>
</div>
<div class="paragraph">
<p>This installs the specified groovy module or maven artifact. If a
version is specified that specific version will be installed, otherwise
the most recent version will be used (as if &#8216;*&#8217; we passed in).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>grape list</pre>
</div>
</div>
<div class="paragraph">
<p>Lists locally installed modules (with their full maven name in the case
of groovy modules) and versions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>grape resolve (&lt;groupId&gt; &lt;artifactId&gt; &lt;version&gt;)+</pre>
</div>
</div>
<div class="paragraph">
<p>This returns the file locations of the jars representing the artifcats
for the specified module(s) and the respective transitive dependencies.
You may optionally pass in -ant, -dos, or -shell to get the dependencies
expressed in a format applicable for an ant script, windows batch file,
or unix shell script respectively. -ivy may be passed to see the
dependencies expressed in an ivy like format.</p>
</div>
</div>
<div class="sect4">
<h5 id="Grape-Advancedconfiguration">Advanced configuration</h5>
<div class="sect5">
<h6 id="Grape-RepositoryDirectory">Repository Directory</h6>
<div class="paragraph">
<p>If you need to change the directory grape uses for downloading libraries
you can specify the grape.root system property to change the default
(which is ~/.groovy/grape)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy -Dgrape.root=/repo/grape yourscript.groovy</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="Grape-CustomizeIvysettings">Customize Ivy settings</h6>
<div class="paragraph">
<p>You can customize the ivy settings that Grape uses by creating a
~/.groovy/grapeConfig.xml file. If no such file exists,
<a href="http://svn.codehaus.org/groovy/tags/GROOVY_1_6_0/src/main/groovy/grape/defaultGrapeConfig.xml">here</a>
are the default settings used by Grape:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="xml language-xml">&lt;ivysettings&gt;
  &lt;settings defaultResolver="downloadGrapes"/&gt;
  &lt;resolvers&gt;
    &lt;chain name="downloadGrapes"&gt;
      &lt;filesystem name="cachedGrapes"&gt;
        &lt;ivy pattern="${user.home}/.groovy/grapes/[organisation]/[module]/ivy-[revision].xml"/&gt;
        &lt;artifact pattern="${user.home}/.groovy/grapes/[organisation]/[module]/[type]s/[artifact]-[revision].[ext]"/&gt;
      &lt;/filesystem&gt;
      &lt;!-- todo add 'endorsed groovy extensions' resolver here --&gt;
      &lt;ibiblio name="codehaus" root="http://repository.codehaus.org/" m2compatible="true"/&gt;
      &lt;ibiblio name="ibiblio" m2compatible="true"/&gt;
      &lt;ibiblio name="java.net2" root="http://download.java.net/maven/2/" m2compatible="true"/&gt;
    &lt;/chain&gt;
  &lt;/resolvers&gt;
&lt;/ivysettings&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on how to customize these settings, please refer to
the <a href="http://ant.apache.org/ivy/history/latest-release/settings.html">Ivy
documentation</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="Grape-AddyourlocalMaven2repository">Add your local Maven2 repository</h6>
<div class="paragraph">
<p>If you find yourself wanting to reuse artifacts that you already have
locally in your Maven2 repository, then you can add this line to your
~/.groovy/grapeConfig.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="xml language-xml">&lt;ibiblio name="local" root="file:${user.home}/.m2/repository/" m2compatible="true"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And further customize your Grape configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="xml language-xml">&lt;?xml version="1.0"?&gt;
&lt;ivysettings&gt;
    &lt;settings defaultResolver="downloadGrapes"/&gt;
    &lt;resolvers&gt;
        &lt;chain name="downloadGrapes"&gt;
            &lt;!-- todo add 'endorsed groovy extensions' resolver here --&gt;
            &lt;ibiblio name="local" root="file:${user.home}/.m2/repository/" m2compatible="true"/&gt;
            &lt;filesystem name="cachedGrapes"&gt;
                &lt;ivy pattern="${user.home}/.groovy/grapes/[organisation]/[module]/ivy-[revision].xml"/&gt;
                &lt;artifact pattern="${user.home}/.groovy/grapes/[organisation]/[module]/[type]s/[artifact]-[revision].[ext]"/&gt;
            &lt;/filesystem&gt;
            &lt;ibiblio name="codehaus" root="http://repository.codehaus.org/" m2compatible="true"/&gt;
            &lt;ibiblio name="ibiblio" m2compatible="true"/&gt;
            &lt;ibiblio name="java.net2" root="http://download.java.net/maven/2/" m2compatible="true"/&gt;
        &lt;/chain&gt;
    &lt;/resolvers&gt;
&lt;/ivysettings&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-MoreExamples">More Examples</h5>
<div class="paragraph">
<p>Using Apache Commons Collections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">// create and use a primitive array
import org.apache.commons.collections.primitives.ArrayIntList

@Grab(group='commons-primitives', module='commons-primitives', version='1.0')
def createEmptyInts() { new ArrayIntList() }

def ints = createEmptyInts()
ints.add(0, 42)
assert ints.size() == 1
assert ints.get(0) == 42</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using TagSoup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">// find the PDF links in the Java 1.5.0 documentation
@Grab(group='org.ccil.cowan.tagsoup', module='tagsoup', version='0.9.7')
def getHtml() {
    def parser = new XmlParser(new org.ccil.cowan.tagsoup.Parser())
    parser.parse("http://java.sun.com/j2se/1.5.0/download-pdf.html")
}
html.body.'**'.a.@href.grep(~/.*\.pdf/).each{ println it }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using Google Collections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">// Google Collections example


import com.google.common.collect.HashBiMap
@Grab(group='com.google.code.google-collections', module='google-collect', version='snapshot-20080530')
def getFruit() { [grape:'purple', lemon:'yellow', orange:'orange'] as HashBiMap }
assert fruit.lemon == 'yellow'
assert fruit.inverse().yellow == 'lemon'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Launching a Jetty server to serve Groovy templates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Grapes([
    @Grab(group='org.eclipse.jetty.aggregate', module='jetty-server', version='8.1.7.v20120910'),
    @Grab(group='org.eclipse.jetty.aggregate', module='jetty-servlet', version='8.1.7.v20120910'),
    @Grab(group='javax.servlet', module='javax.servlet-api', version='3.0.1')])

import org.eclipse.jetty.server.Server
import org.eclipse.jetty.servlet.*
import groovy.servlet.*

def runServer(duration) {
    def server = new Server(8080)
    def context = new ServletContextHandler(server, "/", ServletContextHandler.SESSIONS);
    context.resourceBase = "."
    context.addServlet(TemplateServlet, "*.gsp")
    server.start()
    sleep duration
    server.stop()
}

runServer(10000)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Grape will download Jetty and its dependencies on first launch of this
script, and cache them. We’re creating a new Jetty Server on port 8080,
then expose Groovy’s TemplateServlet at the root of the context — Groovy
comes with its own powerful template engine mechanism. We start the
server and let it run for a certain duration. Each time someone will hit
<a href="http://localhost:8080/somepage.gsp">http://localhost:8080/somepage.gsp</a>, it will display the somepage.gsp
template to the user — those template pages should be situated in the
same directory as this server script.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_guide">4.6. Testing Guide</h3>
<div class="sect3">
<h4 id="_introduction_2">4.6.1. Introduction</h4>
<div class="paragraph">
<p>The Groovy programming language comes with great support for writing tests. In addition to the language
features and test integration with state-of-the-art testing libraries and frameworks, the Groovy ecosystem has born
a rich set of testing libraries and frameworks.</p>
</div>
<div class="paragraph">
<p>This chapter will start with language specific testing features and continue with a closer look at JUnit integration,
Spock for specifications and Geb for functional tests. Finally, we an overview of other testing libraries known to
be working with Groovy.</p>
</div>
</div>
<div class="sect3">
<h4 id="_language_features">4.6.2. Language Features</h4>
<div class="paragraph">
<p>Besides integrated support for JUnit, the Groovy programming language comes with features that have proven
to be very valuable for test-driven development. This section gives insight on them.</p>
</div>
<div class="sect4">
<h5 id="_power_assertions">Power Assertions</h5>
<div class="paragraph">
<p>Writing tests means formulating assumptions by using assertions. In Java this can be done by using the <code>assert</code>
keyword that has been added in J2SE 1.4. In Java, <code>assert</code> statements can be enabled via the JVM parameters <code>-ea</code>
(or <code>-enableassertions</code>) and <code>-da</code> (or <code>-disableassertions</code>). Assertion statements in Java are disabled by default.</p>
</div>
<div class="paragraph">
<p>Groovy comes with a rather <em>powerful variant</em> of <code>assert</code> also known as <em>power assertion statement</em>. Groovy&#8217;s power
<code>assert</code> differs from the Java version in its output given the boolean expression validates to <code>false</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def x = 1
assert x == 2

// Output:             <i class="conum" data-value="1"></i><b>(1)</b>
//
// Assertion failed:
// assert x == 2
//        | |
//        1 false</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This section shows the std-err output</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>java.lang.AssertionError</code> that is thrown whenever the assertion can not be validated successfully, contains
an extended version of the original exception message. The power assertion output shows evaluation results from
the outer to the inner expression.</p>
</div>
<div class="paragraph">
<p>The power assertion statements true power unleashes in complex Boolean statements, or statements with
collections or other <code>toString</code>-enabled classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def x = [1,2,3,4,5]
assert (x &lt;&lt; 6) == [6,7,8,9,10]

// Output:
//
// Assertion failed:
// assert (x &lt;&lt; 6) == [6,7,8,9,10]
//         | |     |
//         | |     false
//         | [1, 2, 3, 4, 5, 6]
//         [1, 2, 3, 4, 5, 6]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another important difference from Java is that in Groovy assertions are <em>enabled by default</em>. It has been a language design
decision to remove the possibility to deactivate assertions. Or, as Bertrand Meyer stated, ``it makes no sense to take
off your swim ring if you put your feet into real water``.</p>
</div>
<div class="paragraph">
<p>One thing to be aware of are methods with side-effects inside Boolean expressions in power assertion statements. As
the internal error message construction mechanism does only store references to instances under target,
 it happens that the error message text is invalid at rendering time in case of side-effecting methods involved:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert [[1,2,3,3,3,3,4]].first().unique() == [1,2,3]

// Output:
//
// Assertion failed:
// assert [[1,2,3,3,3,3,4]].first().unique() == [1,2,3]
//                          |       |        |
//                          |       |        false
//                          |       [1, 2, 3, 4]
//                          [1, 2, 3, 4]           <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The error message shows the actual state of the collection, not the state before the <code>unique</code> method was applied</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
If you choose to provide a custom assertion error message this can be done by using the Java syntax <code>assert
expression1 : expression2</code> where <code>expression1</code> is the Boolean expression and <code>expression2</code> is the custom error message.
 Be aware though that this will disable the power assert and will fully fallback to custom
 error messages on assertion errors.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_mocking_and_stubbing">Mocking and Stubbing</h5>
<div class="paragraph">
<p>Groovy has excellent built-in support for a range of mocking and stubbing alternatives. When using Java, dynamic mocking
frameworks are very popular. A key reason for this is that it is hard work creating custom hand-crafted mocks using Java.
Such frameworks can be used easily with Groovy if you choose but creating custom mocks is much easier in Groovy. You
can often get away with simple maps or closures to build your custom mocks.</p>
</div>
<div class="paragraph">
<p>The following sections show ways to create mocks and stubs with Groovy language features only.</p>
</div>
<div class="sect5">
<h6 id="_map_coercion">Map Coercion</h6>
<div class="paragraph">
<p>By using maps or expandos, we can incorporate desired behaviour of a collaborator very easily as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class TranslationService {
    String convert(String key) {
        return "test"
    }
}

def service = [convert: { String key -&gt; 'some text' }] as TranslationService
assert 'some text' == service.convert('key.text')</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>as</code> operator can be used to coerce a map to a particular class. The given map keys are interpreted as
method names and the values, being <code>groovy.lang.Closure</code> blocks, are interpreted as method code blocks.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Be aware that map coercion can get into the way if you deal with custom <code>java.util.Map</code> descendant classes in combination
with the <code>as</code> operator. The map coercion mechanism is targeted directly at certain collection classes, it doesn&#8217;t take
custom classes into account.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_closure_coercion">Closure Coercion</h6>
<div class="paragraph">
<p>The <em>as</em> operator can be used with closures in a neat way which is great for developer testing in simple scenarios.
We haven&#8217;t found this technique to be so powerful that we want to do away with dynamic mocking, but it can be very
useful in simple cases none-the-less.</p>
</div>
<div class="paragraph">
<p>Classes or interfaces holding a single method, including SAM (single abstract method) classes, can be used to coerce
a closure block to be an object of the given type. Be aware that for doing this, Groovy internally create a proxy object
descending for the given class. So the object will not be a direct instance of the given class. This important if, for
example, the generated proxy object&#8217;s meta-class is altered afterwards.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have an example on coercing a closure to be of a specific type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def service = { String key -&gt; 'some text' } as TranslationService
assert 'some text' == service.convert('key.text')</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy supports a feature called implicit SAM coercion. This means that the <code>as</code> operator is not necessary in situations
where the runtime can infer the target SAM type. This type of coercion might be useful in tests to mock entire SAM
classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">abstract class BaseService {
    abstract void doSomething()
}

BaseService service = { -&gt; println 'doing something' }
service.doSomething()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mockfor_and_stubfor">MockFor and StubFor</h6>
<div class="paragraph">
<p>The Groovy mocking and stubbing classes can be found in the <code>groovy.mock.interceptor</code> package.</p>
</div>
<div class="paragraph">
<p>The <code>MockFor</code> class supports (typically unit) testing of classes in isolation by allowing a <em>strictly ordered</em> expectation
of the behavior of collaborators to be defined. A typical test scenario involves a class under test and one or more collaborators. In such a scenario it is
often desirable to just test the business logic of the class under test. One strategy for doing that is to replace
the collaborator instances with simplified mock objects to help isolate out the logic in the test target. MockFor
allows such mocks to be created using meta-programming. The desired behavior of collaborators is defined as a behavior
specification. The behavior is enforced and checked automatically.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume our target classes looked like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Person {
    String first, last
}

class Family {
    Person father, mother
    def nameOfMother() { "$mother.first $mother.last" }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With <code>MockFor</code>, a mock expectation is always sequence dependent and its use automatically ends with a call to <code>verify</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def mock = new MockFor(Person)      <i class="conum" data-value="1"></i><b>(1)</b>
mock.demand.getFirst{ 'dummy' }
mock.demand.getLast{ 'name' }
mock.use {                          <i class="conum" data-value="2"></i><b>(2)</b>
    def mary = new Person(first:'Mary', last:'Smith')
    def f = new Family(mother:mary)
    assert f.nameOfMother() == 'dummy name'
}
mock.expect.verify()                <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a new mock is created by a new instance of <code>MockFor</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>a <code>Closure</code> is passed to <code>use</code> which enables the mocking functionality</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>a call to <code>verify</code> checks whether the sequence and number of method calls is as expected</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>StubFor</code> class supports (typically unit) testing of classes in isolation by allowing a <em>loosely-ordered</em> expectation
of the behavior of collaborators to be defined. A typical test scenario involves a class under test and one or more
collaborators. In such a scenario it is often desirable to just test the business logic of the CUT. One strategy for
doing that is to replace the collaborator instances with simplified stub objects to help isolate out the logic
in the target class. <code>StubFor</code> allows such stubs to be created using meta-programming. The desired behavior of
collaborators is defined as a behavior specification.</p>
</div>
<div class="paragraph">
<p>In contrast to <code>MockFor</code> the stub expectation checked with <code>verify</code> is sequence independent and its use is optional:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def stub = new StubFor(Person)      <i class="conum" data-value="1"></i><b>(1)</b>
stub.demand.with {                  <i class="conum" data-value="2"></i><b>(2)</b>
    getLast{ 'name' }
    getFirst{ 'dummy' }
}
stub.use {                          <i class="conum" data-value="3"></i><b>(3)</b>
    def john = new Person(first:'John', last:'Smith')
    def f = new Family(father:john)
    assert f.father.first == 'dummy'
    assert f.father.last == 'name'
}
stub.expect.verify()                <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a new stub is created by a new instance of <code>StubFor</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>with</code> method is used for delegating all calls inside the closure to the <code>StubFor</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>a <code>Closure</code> is passed to <code>use</code> which enables the stubbing functionality</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>a call to <code>verify</code> (optional) checks whether the number of method calls is as expected</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>MockFor</code> and <code>StubFor</code> can not be used to test statically compiled classes e.g for Java classes or Groovy classes that
make use of <code>@CompileStatic</code>. To stub and/or mock these classes you can use Spock or one of the Java mocking libraries.</p>
</div>
</div>
<div class="sect5">
<h6 id="testing_guide_emc">Expando Meta-Class (EMC)</h6>
<div class="paragraph">
<p>Groovy includes a special <code>MetaClass</code> the so-called <code>ExpandoMetaClass</code> (EMC). It allows to dynamically add methods,
constructors, properties and static methods using a neat closure syntax.</p>
</div>
<div class="paragraph">
<p>Every <code>java.lang.Class</code> is supplied with a special <code>metaClass</code> property that will give a reference to an
<code>ExpandoMetaClass</code> instance. The expando meta-class is not restricted to custom classes, it can be used for
JDK classes like for example <code>java.lang.String</code> as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">String.metaClass.swapCase = {-&gt;
    def sb = new StringBuffer()
    delegate.each {
        sb &lt;&lt; (Character.isUpperCase(it as char) ? Character.toLowerCase(it as char) :
            Character.toUpperCase(it as char))
    }
    sb.toString()
}

def s = "heLLo, worLD!"
assert s.swapCase() == 'HEllO, WORld!'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ExpandoMetaClass</code> is a rather good candidate for mocking functionality as it allows for more advanced stuff
like mocking static methods</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Book {
    String title
}

Book.metaClass.static.create &lt;&lt; { String title -&gt; new Book(title:title) }

def b = Book.create("The Stand")
assert b.title == 'The Stand'</code></pre>
</div>
</div>
<div class="paragraph">
<p>or even constructors</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Book.metaClass.constructor &lt;&lt; { String title -&gt; new Book(title:title) }

def b = new Book("The Stand")
assert b.title == 'The Stand'</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Mocking constructors might seem like a hack that&#8217;s better not even to be considered but even there might be valid
use cases. An example can be found in Grails where domain class constructors are added at run-time with the
help of <code>ExpandoMetaClass</code>. This lets the domain object register itself in the Spring application context and allows
for injection of services or other beans controlled by the dependency-injection container.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to change the <code>metaClass</code> property on a per test method level you need to remove the changes that were
done to the meta-class, otherwise those changes would be persistent across test method calls. Changes are removed by
replacing the meta-class in the <code>GroovyMetaClassRegistry</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">GroovySystem.metaClassRegistry.setMetaClass(java.lang.String, null)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another alternative is to register a <code>MetaClassRegistryChangeEventListener</code>, track the changed classes and remove
the changes in the cleanup method of your chosen testing runtime. A good example can be found <a href="https://github.com/grails/grails-core/blob/master/grails-bootstrap/src/main/groovy/org/codehaus/groovy/grails/cli/support/MetaClassRegistryCleaner.java">in the Grails web
development framework</a>.</p>
</div>
<div class="paragraph">
<p>Besides using the <code>ExpandoMetaClass</code> on a class-level, there is also support for using the meta-class on a per-object
level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def b = new Book(title: "The Stand")
b.metaClass.getTitle {-&gt; 'My Title' }

assert b.title == 'My Title'</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the meta-class change is related to the instance only. Depending on the test scenario this might be a better
fit than the global meta-class change.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_gdk_methods">GDK Methods</h5>
<div class="paragraph">
<p>The following section gives a brief overview on GDK methods that can be leveraged in test case scenarios, for example for
test data generation.</p>
</div>
<div class="sect5">
<h6 id="_iterable_combinations">Iterable#combinations</h6>
<div class="paragraph">
<p>The <code>combinations</code> method that is added on <code>java.lang.Iterable</code> compliant classes can be used to get a list of
combinations from a list containing two or more sub-lists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">void testCombinations() {
    def combinations = [[2, 3],[4, 5, 6]].combinations()
    assert combinations == [[2, 4], [3, 4], [2, 5], [3, 5], [2, 6], [3, 6]]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method could be used in test case scenarios to generate all possible argument combinations for a specific method
call.</p>
</div>
</div>
<div class="sect5">
<h6 id="_iterable_eachcombination">Iterable#eachCombination</h6>
<div class="paragraph">
<p>The <code>eachCombination</code> method that is added on <code>java.lang.Iterable</code> can be used to apply a function (or in this
 case a <code>groovy.lang.Closure</code>) to each if the combinations that has been built by the <code>combinations</code> method:</p>
</div>
<div class="paragraph">
<p><code>eachCombination</code> is a GDK method that is added to all classes conforming to the <code>java.lang.Iterable</code> interface.
It applies a function on each combination of the input lists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">void testEachCombination() {
    [[2, 3],[4, 5, 6]].eachCombination { println it[0] + it[1] }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method could be used in the testing context to call methods with each of the generated combinations.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_tool_support">Tool Support</h5>
<div class="sect5">
<h6 id="_test_code_coverage">Test Code Coverage</h6>
<div class="paragraph">
<p>Code coverage is a useful measure of the effectiveness of (unit) tests. A program with high code coverage has a
lower chance to hold critical bugs than a program with no or low coverage. To get code coverage metrics,
the generated byte-code usually needs to be instrumented before the tests are executed. One tool with Groovy support
 for this task is <a href="http://cobertura.github.io/cobertura/">Cobertura</a>.</p>
</div>
<div class="paragraph">
<p>Various frameworks and build tools come with Cobertura integration. For Grails, there is the <a href="http://grails.org/plugin/code-coverage">code coverage plugin</a> based
on Cobertura, for Gradle there is the <a href="https://github.com/eriwen/gradle-cobertura-plugin">gradle-cobertura plugin</a>, to name only two of them.</p>
</div>
<div class="paragraph">
<p>The following code listing shows an example on how to enable Cobertura test coverage reports in a Gradle build script from
a Groovy project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def pluginVersion = '&lt;plugin version&gt;'
def groovyVersion = '&lt;groovy version&gt;'
def junitVersion = '&lt;junit version&gt;'

buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath 'com.eriwen:gradle-cobertura-plugin:${pluginVersion}'
    }
}

apply plugin: 'groovy'
apply plugin: 'cobertura'

repositories {
    mavenCentral()
}

dependencies {
    compile "org.codehaus.groovy:groovy-all:${groovyVersion}"
    testCompile "junit:junit:${junitVersion}"
}

cobertura {
    format = 'html'
    includes = ['**/*.java', '**/*.groovy']
    excludes = ['com/thirdparty/**/*.*']
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Several output formats can be chosen for Cobertura coverage reports and test code coverage reports can be added to
continuous integration build tasks.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_unit_tests_with_junit_3_and_4">4.6.3. Unit Tests with JUnit 3 and 4</h4>
<div class="paragraph">
<p>Groovy simplifies JUnit testing, making it more Groovy. In the following sections we will have a closer look at
JUnit 3/4 Groovy integration.</p>
</div>
<div class="sect4">
<h5 id="_junit_3">JUnit 3</h5>
<div class="paragraph">
<p>Maybe one of the most prominent Groovy classes supporting JUnit 3 tests is the <code>GroovyTestCase</code> class. Being
derived from <code>junit.framework.TestCase</code> it offers a bunch of additional methods that make testing in Groovy a breeze.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Although <code>GroovyTestCase</code> inherits from <code>TestCase</code> doesn&#8217;t mean you can&#8217;t use JUnit 4 features in your project. In fact,
the most recent Groovy versions come with a bundled JUnit 4 and that comes with a backwards compatible <code>TestCase</code>
implementation. There have been some discussion on the Groovy mailing-list on whether to use <code>GroovyTestCase</code> or JUnit 4
with the result that it is mostly a matter of taste, but with <code>GroovyTestCase</code> you get a bunch of methods for free that
make certain types of tests easier to write.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this section, we will have a look at some of the methods provided by <code>GroovyTestCase</code>. A full list of these can be
found in the JavaDoc documentation for <a href="http://groovy.codehaus.org/api/groovy/util/GroovyTestCase.html">groovy.util.GroovyTestCase</a>,
don&#8217;t forget it is inherited from <code>junit.framework.TestCase</code> which inherits all the <code>assert*</code> methods.</p>
</div>
<div class="sect5">
<h6 id="_assertion_methods">Assertion Methods</h6>
<div class="paragraph">
<p><code>GroovyTestCase</code> is inherited from <code>junit.framework.TestCase</code> therefore it inherits a large number of assertion methods
being available to be called in every test method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class MyTestCase extends GroovyTestCase {

    void testAssertions() {
        assertTrue(1 == 1)
        assertEquals("test", "test")

        def x = "42"
        assertNotNull "x must not be null", x
        assertNull null

        assertSame x, x
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As can be seen above, in contrast to Java it is possible to leave out the parenthesis in most situations which
leads to even more readability of JUnit assertion method call expressions.</p>
</div>
<div class="paragraph">
<p>An interesting assertion method that is added by <code>GroovyTestCase</code> is <code>assertScript</code>. It ensures that the given Groovy
code string succeeds without any exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">void testScriptAssertions() {
    assertScript '''
        def x = 1
        def y = 2

        assert x + y == 3
    '''
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_shouldfail_methods">shouldFail Methods</h6>
<div class="paragraph">
<p><code>shouldFail</code> can be used to check whether the given code block fails or not. In case it fails, the assertion does hold,
otherwise the assertion fails:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">void testInvalidIndexAccess1() {
    def numbers = [1,2,3,4]
    shouldFail {
        numbers.get(4)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above uses the basic <code>shouldFail</code> method interface that takes a <code>groovy.lang.Closure</code> as a single argument.
 The <code>Closure</code> instance holds the code that is supposed to be breaking during run-time.</p>
</div>
<div class="paragraph">
<p>If we wanted to assert <code>shouldFail</code> on a specific <code>java.lang.Exception</code> type we could have done so by using the <code>shouldFail</code>
implementation that takes the <code>Exception</code> class as first argument and the <code>Closure</code> as second argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">void testInvalidIndexAccess2() {
    def numbers = [1,2,3,4]
    shouldFail IndexOutOfBoundsException, {
        numbers.get(4)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If anything other than <code>IndexOutOfBoundsException</code> (or a descendant class of it) is thrown, the test case will fail.</p>
</div>
<div class="paragraph">
<p>A pretty nice feature of <code>shouldFail</code> hasn&#8217;t been visible so far: it returns the exception message. This is really
useful if you want to assert on the exception error message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">void testInvalidIndexAccess3() {
    def numbers = [1,2,3,4]
    def msg = shouldFail IndexOutOfBoundsException, {
        numbers.get(4)
    }
    assert msg.contains('Index: 4, Size: 4')
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_notyetimplemented_method">notYetImplemented Method</h6>
<div class="paragraph">
<p>The <code>notYetImplemented</code> method has been greatly influenced by HtmlUnit. It allows to write a test method but mark it
as not yet implemented. As long as the test method fails and is marked with <code>notYetImplemented</code> the test goes green:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">void testNotYetImplemented1() {
    if (notYetImplemented()) return   <i class="conum" data-value="1"></i><b>(1)</b>

    assert 1 == 2                     <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a call to <code>notYetImplemented</code> is necessary for <code>GroovyTestCase</code> to get the current method stack.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>as long as the test evaluates to <code>false</code> the test execution will be successful.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An alternative to the <code>notYetImplemented</code> method is the <code>@NotYetImplemented</code> annotation. It allows for annotating a
method as not yet implemented, with the exact same behavior as <code>GroovyTestCase#notYetImplemented</code> but without the need
for the <code>notYetImplemented</code> method call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@NotYetImplemented
void testNotYetImplemented2() {
    assert 1 == 2
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_junit_4">JUnit 4</h5>
<div class="paragraph">
<p>Groovy can be used to write JUnit 4 test cases without any restrictions. The <code>groovy.test.GroovyAssert</code> holds
various static methods that can be used as replacement for the <code>GroovyTestCase</code> methods in JUnit 4 tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import org.junit.Test

import static groovy.test.GroovyAssert.shouldFail

class JUnit4ExampleTests {

    @Test
    void indexOutOfBoundsAccess() {
        def numbers = [1,2,3,4]
        shouldFail {
            numbers.get(4)
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As can be seen in the example above, the static methods found in <code>GroovyAssert</code> are imported at the beginning of the
 class definition thus <code>shouldFail</code> can be used the same way it can be used in a <code>GroovyTestCase</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<code>groovy.test.GroovyAssert</code> descends from <code>org.junit.Assert</code> that means it inherits all JUnit assertion methods. However,
with the introduction of the power assertion statement, it turned out to be <em>good practice to rely on assertion statements</em>
instead of using the JUnit assertion methods with the improved message being the main reason.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_with_spock">4.6.4. Testing with Spock</h4>
<div class="paragraph">
<p>Spock is a testing and specification framework for Java and Groovy applications. What makes it stand out from the
crowd is its beautiful and highly expressive specification DSL. In practice, Spock specifications are written as
Groovy classes. Although written in Groovy they can be used to test Java classes. Spock can be used for unit,
integration or BDD (behavior-driven-development) testing, it doesn&#8217;t put itself into a specific category of testing
frameworks or libraries.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Beside these awesome features Spock is a good example on how to leverage advanced Groovy programming
language features in third party libraries, for example, by using Groovy AST transformations.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
This section should not serve as detailed guide on how to use Spock, it should rather give an impression what Spock
is about and how it can be leveraged for unit, integration, functional or any other type of testing.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The next section we will have an first look at the anatomy of a Spock specification. It should give a
pretty good feeling on what Spock is up to.</p>
</div>
<div class="sect4">
<h5 id="_specifications">Specifications</h5>
<div class="paragraph">
<p>Spock lets you write specifications that describe features (properties, aspects) exhibited by a system of
interest. The "system" can be anything between a single class and an entire application, a more advanced term for it is
<em>system under specification</em>. The <em>feature description</em> starts from a specific snapshot of the system and its
collaborators, this snapshot is called the <em>feature&#8217;s fixture</em>.</p>
</div>
<div class="paragraph">
<p>Spock specification classes are derived from <code>spock.lang.Specification</code>. A concrete specification class might consist
of fields, fixture methods, features methods and helper methods.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at a simple specification with a single feature method for an imaginary <code>Stack</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class StackSpec extends Specification {

    def "adding an element leads to size increase"() {  <i class="conum" data-value="1"></i><b>(1)</b>
        setup: "a new stack instance is created"        <i class="conum" data-value="2"></i><b>(2)</b>
            def stack = new Stack()

        when:                                           <i class="conum" data-value="3"></i><b>(3)</b>
            stack.push 42

        then:                                           <i class="conum" data-value="4"></i><b>(4)</b>
            stack.size() == 1
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Feature method, is by convention named with a String literal.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Setup block, here is where any setup work for this feature needs to be done.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>When block describes a stimulus, a certain action under target by this feature specification.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Then block any expressions that can be used to validate the result of the code that was triggered by the when block.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Spock feature specifications are defined as methods inside a <code>spock.lang.Specification</code> class. They describe the feature
by using a String literal instead of a method name.</p>
</div>
<div class="paragraph">
<p>A feature method holds multiple blocks, in our example we used <code>setup</code>, <code>when</code> and <code>then</code>. The <code>setup</code> block is special
in that it is optional and allows to configure local variables visible inside the feature method. The <code>when</code> block
defines the stimulus and is a companion of the <code>then</code> block which describes the response to the stimulus.</p>
</div>
<div class="paragraph">
<p>Note that the <code>setup</code> method in the <code>StackSpec</code> above additionally
  has a description String. Description Strings are optional and can be added after block labels (like <code>setup</code>, <code>when</code>,
  <code>then</code>).</p>
</div>
</div>
<div class="sect4">
<h5 id="_more_spock">More Spock</h5>
<div class="paragraph">
<p>Spock provides much more features like data tables or advanced mocking capabilities. Feel free to consult the
<a href="https://github.com/spockframework/spock">Spock GitHub page</a> for more documentation and download information.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_functional_tests_with_geb">4.6.5. Functional Tests with Geb</h4>
<div class="paragraph">
<p>Geb is a functional web testing and scraper library that integrates with JUnit and Spock. It is based upon the
Selenium web drivers and, like Spock, provides a Groovy DSL to write functional tests for web applications.</p>
</div>
<div class="paragraph">
<p>Geb has great features that make it a good fit for a functional testing library:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DOM access via a JQuery-like <code>$</code> function</p>
</li>
<li>
<p>implements the <em>page pattern</em></p>
</li>
<li>
<p>support for modularization of certain web components (e.g. menu-bars, etc.) with <em>modules</em></p>
</li>
<li>
<p>integration with JavaScript via the JS variable</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
This section should not serve as detailed guide on how to use Geb, it should rather give an impression what Geb
is about and how it can be leveraged functional testing.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The next section will give an example on how Geb can be used to write a functional test for a simple
 web page with a single search field.</p>
</div>
<div class="sect4">
<h5 id="_a_geb_script">A Geb Script</h5>
<div class="paragraph">
<p>Although Geb can be used standalone in a Groovy script, in many scenarios it&#8217;s used in combination with other testing
frameworks. Geb comes with various base classes that can be used in JUnit 3, 4, TestNG or Spock tests. The base classes
are part of additional Geb modules that need to be added as a dependency.</p>
</div>
<div class="paragraph">
<p>For example, the following <code>@Grab</code> dependencies have to be used to run Geb with the Selenium Firefox driver in
JUnit4 tests. The module that is needed for JUnit 3/4 support is <code>geb-junit</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Grapes([
    @Grab("org.gebish:geb-core:0.9.2"),
    @Grab("org.gebish:geb-junit:0.9.2"),
    @Grab("org.seleniumhq.selenium:selenium-firefox-driver:2.26.0"),
    @Grab("org.seleniumhq.selenium:selenium-support:2.26.0")
])</code></pre>
</div>
</div>
<div class="paragraph">
<p>The central class in Geb is the <code>geb.Browser</code> class. As its name implies it is used
 to browse pages and access DOM elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def browser = new Browser(driver: new FirefoxDriver(), baseUrl: 'http://myhost:8080/myapp')  <i class="conum" data-value="1"></i><b>(1)</b>
browser.drive {
    go "/login"                        <i class="conum" data-value="2"></i><b>(2)</b>

    $("#username").text = 'John'       <i class="conum" data-value="3"></i><b>(3)</b>
    $("#password").text = 'Doe'

    $("#loginButton").click()

    assert title == "My Application - Dashboard"
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A new <code>Browser</code> instance is created. In this case it uses the Selenium <code>FirefoxDriver</code> and sets the <code>baseUrl</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>go</code> is used to navigate to an URL or relative URI</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>$</code> together with CSS selectors is used to access the <code>username</code> and <code>password</code> DOM fields.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>Browser</code> class comes with a <code>drive</code> method that delegates all method/property calls to the current
<code>browser</code> instance. The <code>Browser</code> configuration must not be done inline, it can also be externalized in a
<code>GebConfig.groovy</code> configuration file for example. In practice, the usage of the <code>Browser</code> class is mostly hidden
by Geb test base classes. They delegate all missing properties and method calls to the current <code>browser</code> instance
that exists in the background:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class SearchTests extends geb.junit4.GebTest {

    @Test
    void executeSeach() {
        go 'http://somehost/mayapp/search'              <i class="conum" data-value="1"></i><b>(1)</b>
        $('#searchField').text = 'John Doe'             <i class="conum" data-value="2"></i><b>(2)</b>
        $('#searchButton').click()                      <i class="conum" data-value="3"></i><b>(3)</b>

        assert $('.searchResult a').first().text() == 'Mr. John Doe' <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Browser#go</code> takes a relative or absolute link and calls the page.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>Browser#$</code> is used to access DOM content. Any CSS selectors supported by the underlying Selenium drivers are allowed</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>click</code> is used to click a button.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>$</code> is used to get the first link out of the <code>searchResult</code> block</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example above shows a simple Geb web test with the JUnit 4 base class <code>geb.junit4.GebTest</code>. Note that in this case
the <code>Browser</code> configuration is externalized. <code>GebTest</code> delegates methods like <code>go</code> and <code>$</code> to the underlying <code>browser</code>
 instance.</p>
</div>
</div>
<div class="sect4">
<h5 id="_more_geb">More Geb</h5>
<div class="paragraph">
<p>In the previous section we only scratched the surface of the available Geb features. More information on Geb can be found
at the <a href="http://gebish.org">project homepage</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_other_testing_libraries_and_frameworks">4.6.6. Other Testing Libraries and Frameworks</h4>
<div class="sect4">
<h5 id="_testng">TestNG</h5>
<div class="paragraph">
<p><a href="http://testng.org/">TestNG</a> is a testing framework inspired from JUnit and NUnit but with new functionality to make
it more powerful and easier to use. Features include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JDK 5 Annotations</p>
</li>
<li>
<p>Flexible test configuration</p>
</li>
<li>
<p>Support for data-driven testing (with <code>@DataProvider</code>)</p>
</li>
<li>
<p>Support for parameters</p>
</li>
<li>
<p>Allows distribution of tests on slave machines</p>
</li>
<li>
<p>Powerful execution model (no more TestSuite)</p>
</li>
<li>
<p>Supported by a variety of tools and plug-ins (Eclipse, IDEA, Maven, etc&#8230;)</p>
</li>
<li>
<p>Embeds <code>BeanShell</code> for further flexibility</p>
</li>
<li>
<p>Default JDK functions for runtime and logging (no dependencies)</p>
</li>
<li>
<p>Dependent methods for application server testing</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_mockito">Mockito</h5>
<div class="paragraph">
<p><a href="https://code.google.com/p/mockito/">Mockito</a> is a Java mocking library. It has very slim API, almost no time is needed
to start mocking. Features include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mocks concrete classes as well as interfaces</p>
</li>
<li>
<p>Little annotation syntax sugar - <code>@Mock</code></p>
</li>
<li>
<p>Verification errors are clean - click on stack trace to see failed verification in test; click on exception&#8217;s cause
to navigate to actual interaction in code. Stack trace is always clean.</p>
</li>
<li>
<p>Allows flexible verification in order (e.g: verify in order what you want, not every single interaction)</p>
</li>
<li>
<p>Supports exact-number-of-times and at-least-once verification</p>
</li>
<li>
<p>Flexible verification or stubbing using argument matchers (<code>anyObject()</code>, <code>anyString()</code> or <code>refEq()</code> for reflection-based
equality matching)</p>
</li>
<li>
<p>Allows creating custom argument matchers or using existing Hamcrest matchers</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_easymock">EasyMock</h5>
<div class="paragraph">
<p><a href="http://easymock.org/">EasyMock</a> is a mocking library for Java. Features include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hand-writing classes for Mock Objects is not needed.</p>
</li>
<li>
<p>Supports refactoring-safe Mock Objects: test code will not break at runtime when renaming methods or reordering method parameters</p>
</li>
<li>
<p>Supports return values and exceptions.</p>
</li>
<li>
<p>Supports checking the order of method calls, for one or more Mock Objects.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_jbehave">JBehave</h5>
<div class="paragraph">
<p><a href="http://jbehave.org/">JBehave</a> is a framework for Behaviour-Driven Development (BDD). BDD is an evolution of test-driven
development and acceptance-test driven design, and is intended to make these practices more accessible and intuitive
to newcomers and experts alike. It shifts the vocabulary from being test-based to behaviour-based, and positions itself
as a design philosophy.</p>
</div>
</div>
<div class="sect4">
<h5 id="_jmockit">JMockit</h5>
<div class="paragraph">
<p><a href="https://code.google.com/p/jmockit/">jmockit</a> is a mocking library for Java.</p>
</div>
<div class="paragraph">
<p>Unresolved directive in index.adoc - include::subprojects/groovy-json/src/spec/doc/json-userguide.adoc[]</p>
</div>
</div>
<div class="sect4">
<h5 id="_interacting_with_a_sql_database_tbd">Interacting with a SQL database (TBD)</h5>

</div>
<div class="sect4">
<h5 id="_processing_xml_tbd">Processing XML (TBD)</h5>

</div>
<div class="sect4">
<h5 id="_scripting_ant_tasks_tbd">Scripting Ant tasks (TBD)</h5>

</div>
</div>
</div>
<div class="sect2">
<h3 id="_template_engines">4.7. Template engines</h3>
<div class="sect3">
<h4 id="_introduction_3">4.7.1. Introduction</h4>
<div class="paragraph">
<p>Groovy supports multiple ways to generate text dynamically including <code>GStrings</code>, <code>printf</code> if you are using Java 5, and <a href="#_markupbuilder">MarkupBuilder</a> just to name a few. In addition to these, there is a dedicated template framework which is well-suited to applications where the text to be generated follows the form of a static template.</p>
</div>
</div>
<div class="sect3">
<h4 id="_template_framework">4.7.2. Template framework</h4>
<div class="paragraph">
<p>The template framework in Groovy consists of a <code>TemplateEngine</code> abstract base class that engines must implement and a <code>Template</code> interface that the resulting templates they generate must implement.</p>
</div>
<div class="paragraph">
<p>Included with Groovy are several template engines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SimpleTemplateEngine</code> - for basic templates</p>
</li>
<li>
<p><code>GStringTemplateEngine</code> - stores the template as writable closures (useful for streaming scenarios)</p>
</li>
<li>
<p><code>XmlTemplateEngine</code> - works well when the template and output are valid XML</p>
</li>
<li>
<p><code>MarkupTemplateEngine</code> - a very complete, optimized, template engine</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_simpletemplateengine">4.7.3. SimpleTemplateEngine</h4>
<div class="paragraph">
<p>Shown here is the <code>SimpleTemplateEngine</code> that allows you to use JSP-like scriptlets (see example below), script, and EL expressions in your template in order to generate parameterized text. Here is an example of using the system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def text = 'Dear "$firstname $lastname",\nSo nice to meet you in &lt;% print city %&gt;.\nSee you in ${month},\n${signed}'

def binding = ["firstname":"Sam", "lastname":"Pullara", "city":"San Francisco", "month":"December", "signed":"Groovy-Dev"]

def engine = new groovy.text.SimpleTemplateEngine()
def template = engine.createTemplate(text).make(binding)

def result = 'Dear "Sam Pullara",\nSo nice to meet you in San Francisco.\nSee you in December,\nGroovy-Dev'

assert result == template.toString()</code></pre>
</div>
</div>
<div class="paragraph">
<p>While it is generally not deemed good practice to mix processing logic in your template (or view), sometimes very simple logic can be useful. E.g. in the example above, we could change this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">$firstname</code></pre>
</div>
</div>
<div class="paragraph">
<p>to this (assuming we have set up a static import for capitalize <strong>inside</strong> the template):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">${firstname.capitalize()}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">&lt;% print city %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">&lt;% print city == "New York" ? "The Big Apple" : city %&gt;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_advanced_usage_note">Advanced Usage Note</h5>
<div class="paragraph">
<p>If you happen to be embedding your template directly in your script (as we did above) you have to be careful about backslash escaping. Because the template string itself will be parsed by Groovy before it is passed to the the templating framework, you have to escape any backslashes inside GString expressions or scriptlet <em>code</em> that are entered as part of a Groovy program. E.g. if we wanted quotes around <em>The Big Apple</em> above, we would use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">&lt;% print city == "New York" ? "\\"The Big Apple\\"" : city %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, if we wanted a newline, we would use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">\\n</code></pre>
</div>
</div>
<div class="paragraph">
<p>in any GString expression or scriptlet 'code' that appears inside a Groovy script. A normal "<code>\n</code>" is fine within the static template text itself or if the entire template itself is in an external template file. Similarly, to represent an actual backslash in your text you would need</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">\\\\</code></pre>
</div>
</div>
<div class="paragraph">
<p>in an external file or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">\\\\</code></pre>
</div>
</div>
<div class="paragraph">
<p>in any GString expression or scriptlet 'code'. (Note: the necessity to have this extra slash may go away in a future version of Groovy if we can find an easy way to support such a change.)</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gstringtemplateengine">4.7.4. GStringTemplateEngine</h4>
<div class="paragraph">
<p>As an example of using the <code>GStringTemplateEngine</code>, here is the example above done again (with a few changes to show some other options). First we will store the template in a file this time:</p>
</div>
<div class="listingblock">
<div class="title">test.template</div>
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Dear "$firstname $lastname",
So nice to meet you in &lt;% out &lt;&lt; (city == "New York" ? "\\"The Big Apple\\"" : city) %&gt;.
See you in ${month},
${signed}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we used <code>out</code> instead of <code>print</code> to support the streaming nature of <code>GStringTemplateEngine</code>. Because we have the template in a separate file, there is no need to escape the backslashes. Here is how we call it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def f = new File('test.template')
def engine = new groovy.text.GStringTemplateEngine()
def template = engine.createTemplate(f).make(binding)
println template.toString()</code></pre>
</div>
</div>
<div class="paragraph">
<p>and here is the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Dear "Sam Pullara",
So nice to meet you in "The Big Apple".
See you in December,
Groovy-Dev</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_xmltemplateengine">4.7.5. XmlTemplateEngine</h4>
<div class="paragraph">
<p><code>XmlTemplateEngine</code> for use in templating scenarios where both the template source and the expected output are intended to be XML. Templates may use the normal <code>${expression}</code> and <code>$variable</code> notations to insert an arbitrary expression into the template. In addition, support is also provided for special tags: <code>&lt;gsp:scriptlet&gt;</code> (for inserting code fragments) and <code>&lt;gsp:expression&gt;</code> (for code fragments which produce output).</p>
</div>
<div class="paragraph">
<p>Comments and processing instructions will be removed as part of processing and special XML characters such as <code>&lt;</code>, <code>&gt;</code>, <code>"</code> and <code>'</code> will be escaped using the respective XML notation. The output will also be indented using standard XML pretty printing.</p>
</div>
<div class="paragraph">
<p>The xmlns namespace definition for gsp: tags will be removed but other namespace definitions will be preserved (but may change to an equivalent position within the XML tree).</p>
</div>
<div class="paragraph">
<p>Normally, the template source will be in a file but here is a simple example providing the XML template as a string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def binding = [firstname: 'Jochen', lastname: 'Theodorou', nickname: 'blackdrag', salutation: 'Dear']
def engine = new groovy.text.XmlTemplateEngine()
def text = '''\
    &lt;document xmlns:gsp='http://groovy.codehaus.org/2005/gsp' xmlns:foo='baz' type='letter'&gt;
        &lt;gsp:scriptlet&gt;def greeting = "${salutation}est"&lt;/gsp:scriptlet&gt;
        &lt;gsp:expression&gt;greeting&lt;/gsp:expression&gt;
        &lt;foo:to&gt;$firstname "$nickname" $lastname&lt;/foo:to&gt;
        How are you today?
    &lt;/document&gt;
'''
def template = engine.createTemplate(text).make(binding)
println template.toString()</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example will produce this output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="xml language-xml">&lt;document type='letter'&gt;
  Dearest
  &lt;foo:to xmlns:foo='baz'&gt;
    Jochen &amp;quot;blackdrag&amp;quot; Theodorou
  &lt;/foo:to&gt;
  How are you today?
&lt;/document&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unresolved directive in src/spec/doc/template-engines.adoc - include::/usr/project/git/groovy-doc/subprojects/groovy-templates/src/spec/doc/markup-template-engine.adoc[]
:leveloffset: 2</p>
</div>
<div class="sect4">
<h5 id="_other_solutions">Other solutions</h5>
<div class="paragraph">
<p>Also, there are other templating solutions that can be used along with Groovy, such as <a href="http://freemarker.org">FreeMarker</a>, <a href="http://velocity.apache.org">Velocity</a>, <a href="http://stringtemplate.org">StringTemplate</a> and others.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_servlet_support_tbd">4.8. Servlet support (TBD)</h3>

</div>
<div class="sect2">
<h3 id="_integrating_groovy_in_a_java_application">4.9. Integrating Groovy in a Java application</h3>
<div class="sect3">
<h4 id="_groovy_integration_mechanisms">4.9.1. Groovy integration mechanisms</h4>
<div class="paragraph">
<p>The Groovy language proposes several ways to integrate itself into applications (Java or even Groovy) at runtime, from
the most basic, simple code execution to the most complete, integrating caching and compiler customization.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
All the examples written in this section are using Groovy, but the same integration mechanisms can be used from
Java.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="integ-eval">Eval</h5>
<div class="paragraph">
<p>The <code>groovy.util.Eval</code> class is the simplest way to execute Groovy dynamically at runtime. This can be done by calling the <code>me</code>
method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.util.Eval

assert Eval.me('33*3') == 99
assert Eval.me('"foo".toUpperCase()') == 'FOO'</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Eval</code> supports multiple variants that accept parameters for simple evaluation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">assert Eval.x(4, '2*x') == 8                <i class="conum" data-value="1"></i><b>(1)</b>
assert Eval.me('k', 4, '2*k') == 8          <i class="conum" data-value="2"></i><b>(2)</b>
assert Eval.xy(4, 5, 'x*y') == 20           <i class="conum" data-value="3"></i><b>(3)</b>
assert Eval.xyz(4, 5, 6, 'x*y+z') == 26     <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Simple evaluation with one bound parameter named <code>x</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Same evaluation, with a custom bound parameter named <code>k</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Simple evaluation with two bound parameters named <code>x</code> and <code>y</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Simple evaluation with three bound parameters named <code>x</code>, <code>y</code> and <code>z</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>Eval</code> class makes it very easy to evaluate simple scripts, but doesn&#8217;t scale: there is no caching of the script, and
it isn&#8217;t meant to evaluate more than one liners.</p>
</div>
</div>
<div class="sect4">
<h5 id="integ-groovyshell">GroovyShell</h5>
<div class="sect5">
<h6 id="_multiple_sources">Multiple sources</h6>
<div class="paragraph">
<p>The <code>groovy.lang.GroovyShell</code> class is the preferred way to evaluate scripts with the ability to cache the resulting
script instance. Although the <code>Eval</code> class returns the result of the execution of the compiled script, the <code>GroovyShell</code>
class offers more options.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def shell = new GroovyShell()                           <i class="conum" data-value="1"></i><b>(1)</b>
def result = shell.evaluate '3*5'                       <i class="conum" data-value="2"></i><b>(2)</b>
def result2 = shell.evaluate(new StringReader('3*5'))   <i class="conum" data-value="3"></i><b>(3)</b>
assert result == result2
def script = shell.parse '3*5'                          <i class="conum" data-value="4"></i><b>(4)</b>
assert script instanceof groovy.lang.Script
assert script.run() == 15                               <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a new <code>GroovyShell</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>can be used as <code>Eval</code> with direct execution of the code</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>can read from multiple sources (<code>String</code>, <code>Reader</code>, <code>File</code>, <code>InputStream</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>can defer execution of the script. <code>parse</code> returns a <code>Script</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>Script</code> defines a <code>run</code> method</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_sharing_data_between_a_script_and_the_application">Sharing data between a script and the application</h6>
<div class="paragraph">
<p>It is possible to share data between the application and the script using a <code>groovy.lang.Binding</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def sharedData = new Binding()                          <i class="conum" data-value="1"></i><b>(1)</b>
def shell = new GroovyShell(sharedData)                 <i class="conum" data-value="2"></i><b>(2)</b>
def now = new Date()
sharedData.setProperty('text', 'I am shared data!')     <i class="conum" data-value="3"></i><b>(3)</b>
sharedData.setProperty('date', now)                     <i class="conum" data-value="4"></i><b>(4)</b>

String result = shell.evaluate('"At $date, $text"')     <i class="conum" data-value="5"></i><b>(5)</b>

assert result == "At $now, I am shared data!"</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a new <code>Binding</code> that will contain shared data</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>create a <code>GroovyShell</code> using this shared data</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>add a string to the binding</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>add a date to the binding (you are not limited to simple types)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>evaluate the script</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that it is also possible to write from the script into the binding:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def sharedData = new Binding()                          <i class="conum" data-value="1"></i><b>(1)</b>
def shell = new GroovyShell(sharedData)                 <i class="conum" data-value="2"></i><b>(2)</b>

shell.evaluate('foo=123')                               <i class="conum" data-value="3"></i><b>(3)</b>

assert sharedData.getProperty('foo') == 123             <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a new <code>Binding</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>create a new <code>GroovyShell</code> using that shared data</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>use an <strong>undeclared</strong> variable to store the result into the binding</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>read the result from the caller</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is important to understand that you need to use an undeclared variable if you want to write into the binding. Using
<code>def</code> or an <code>explicit</code> type like in the example below would fail because you would then create a <em>local variable</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def sharedData = new Binding()
def shell = new GroovyShell(sharedData)

shell.evaluate('int foo=123')

try {
    assert sharedData.getProperty('foo')
} catch (MissingPropertyException e) {
    println "foo is defined as a local variable"
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
You must be very careful when using shared data in a multithreaded environment. The <code>Binding</code> instance that
you pass to <code>GroovyShell</code> is <strong>not</strong> thread safe, and shared by all scripts.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible to work around the shared instance of <code>Binding</code> by leveraging the <code>Script</code> instance which is returned
by <code>parse</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def shell = new GroovyShell()

def b1 = new Binding(x:3)                       <i class="conum" data-value="1"></i><b>(1)</b>
def b2 = new Binding(x:4)                       <i class="conum" data-value="2"></i><b>(2)</b>
def script = shell.parse('x = 2*x')
script.binding = b1
script.run()
script.binding = b2
script.run()
assert b1.getProperty('x') == 6
assert b2.getProperty('x') == 8
assert b1 != b2</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>will store the <code>x</code> variable inside <code>b1</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>will store the <code>x</code> variable inside <code>b2</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>However, you must be aware that you are still sharing the <strong>same instance</strong> of a script. So this technique cannot be
used if you have two threads working on the same script. In that case, you must make sure of creating two distinct
script instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def shell = new GroovyShell()

def b1 = new Binding(x:3)
def b2 = new Binding(x:4)
def script1 = shell.parse('x = 2*x')            <i class="conum" data-value="1"></i><b>(1)</b>
def script2 = shell.parse('x = 2*x')            <i class="conum" data-value="2"></i><b>(2)</b>
assert script1 != script2
script1.binding = b1                            <i class="conum" data-value="3"></i><b>(3)</b>
script2.binding = b2                            <i class="conum" data-value="4"></i><b>(4)</b>
def t1 = Thread.start { script1.run() }         <i class="conum" data-value="5"></i><b>(5)</b>
def t2 = Thread.start { script2.run() }         <i class="conum" data-value="6"></i><b>(6)</b>
[t1,t2]*.join()                                 <i class="conum" data-value="7"></i><b>(7)</b>
assert b1.getProperty('x') == 6
assert b2.getProperty('x') == 8
assert b1 != b2</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create an instance of script for thread 1</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>create an instance of script for thread 2</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>assign first binding to script 1</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>assign second binding to script 2</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>start first script in a separate thread</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>start second script in a separate thread</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>wait for completion</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In case you need thread safety like here, it is more advisable to use the <a href="#groovyclassloader">GroovyClassLoader</a>
directly instead.</p>
</div>
</div>
<div class="sect5">
<h6 id="_custom_script_class">Custom script class</h6>
<div class="paragraph">
<p>We have seen that the <code>parse</code> method returns an instance of <code>groovy.lang.Script</code>, but it is possible to use a custom
class, given that it extends <code>Script</code> itself. It can be used to provide additional behavior to the script like in
the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">abstract class MyScript extends Script {
    String name

    String greet() {
        "Hello, $name!"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The custom class defines a property called <code>name</code> and a new method called <code>greet</code>. This class can be used as the script
base class by using a custom configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import org.codehaus.groovy.control.CompilerConfiguration

def config = new CompilerConfiguration()                                    <i class="conum" data-value="1"></i><b>(1)</b>
config.scriptBaseClass = 'MyScript'                                         <i class="conum" data-value="2"></i><b>(2)</b>

def shell = new GroovyShell(this.class.classLoader, new Binding(), config)  <i class="conum" data-value="3"></i><b>(3)</b>
def script = shell.parse('greet()')                                         <i class="conum" data-value="4"></i><b>(4)</b>
assert script instanceof MyScript
script.setName('Michel')
assert script.run() == 'Hello, Michel!'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a <code>CompilerConfiguration</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>instruct it to use <code>MyScript</code> as the base class for scripts</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>then use the compiler configuration when you create the shell</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the script now has access to the new method <code>greet</code></td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
You are not limited to the sole <em>scriptBaseClass</em> configuration. You can use any of the compiler configuration
tweaks, including the <a href="#compilation-customizers">compilation customizers</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="groovyclassloader">GroovyClassLoader</h5>
<div class="paragraph">
<p>In the <a href="#integ-groovyshell">previous section</a>, we have shown that <code>GroovyShell</code> was an easy tool to execute scripts, but
it makes it complicated to compile anything but scripts. Internally, it makes use of the <code>groovy.lang.GroovyClassLoader</code>,
which is at the heart of the compilation and loading of classes at runtime.</p>
</div>
<div class="paragraph">
<p>By leveraging the <code>GroovyClassLoader</code> instead of <code>GroovyShell</code>, you will be able to load classes, instead of instances
of scripts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.lang.GroovyClassLoader

def gcl = new GroovyClassLoader()                                           <i class="conum" data-value="1"></i><b>(1)</b>
def clazz = gcl.parseClass('class Foo { void doIt() { println "ok" } }')    <i class="conum" data-value="2"></i><b>(2)</b>
assert clazz.name == 'Foo'                                                  <i class="conum" data-value="3"></i><b>(3)</b>
def o = clazz.newInstance()                                                 <i class="conum" data-value="4"></i><b>(4)</b>
o.doIt()                                                                    <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a new <code>GroovyClassLoader</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>parseClass</code> will return an instance of <code>Class</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>you can check that the class which is returns is really the one defined in the script</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>and you can create a new instance of the class, which is not a script</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>then call any method on it</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
A GroovyClassLoader keeps a reference of all the classes it created, so it is easy to create a memory leak. In
particular, if you execute the same script twice, if it is a String, then you obtain two distinct classes!
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import groovy.lang.GroovyClassLoader

def gcl = new GroovyClassLoader()
def clazz1 = gcl.parseClass('class Foo { }')                                <i class="conum" data-value="1"></i><b>(1)</b>
def clazz2 = gcl.parseClass('class Foo { }')                                <i class="conum" data-value="2"></i><b>(2)</b>
assert clazz1.name == 'Foo'                                                 <i class="conum" data-value="3"></i><b>(3)</b>
assert clazz2.name == 'Foo'
assert clazz1 != clazz2                                                     <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>dynamically create a class named "Foo"</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>create an identical looking class, using a separate <code>parseClass</code> call</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>make sure both classes have the same name</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>but they are actually different!</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The reason is that a <code>GroovyClassLoader</code> doesn&#8217;t keep track of the source text. If you want to have the same instance,
then the source <strong>must</strong> be a file, like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def gcl = new GroovyClassLoader()
def clazz1 = gcl.parseClass(file)                                           <i class="conum" data-value="1"></i><b>(1)</b>
def clazz2 = gcl.parseClass(new File(file.absolutePath))                    <i class="conum" data-value="2"></i><b>(2)</b>
assert clazz1.name == 'Foo'                                                 <i class="conum" data-value="3"></i><b>(3)</b>
assert clazz2.name == 'Foo'
assert clazz1 == clazz2                                                     <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>parse a class from a <code>File</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>parse a class from a distinct file instance, but pointing to the same physical file</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>make sure our classes have the same name</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>but now, they are the same instance</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using a <code>File</code> as input, the <code>GroovyClassLoader</code> is capable of <strong>caching</strong> the generated class file, which avoids
creating multiple classes at runtime for the same source.</p>
</div>
</div>
<div class="sect4">
<h5 id="_groovyscriptengine">GroovyScriptEngine</h5>
<div class="paragraph">
<p>The <code>groovy.util.GroovyScriptEngine</code> class provides a flexible foundation for applications which rely on script
reloading and script dependencies. While <code>GroovyShell</code> focuses on standalone <code>Script`s and `GroovyClassLoader</code> handles
dynamic compilation and loading of any Groovy class, the <code>GroovyScriptEngine</code> will add a layer on top of <code>GroovyClassLoader</code>
to handle both script dependencies and reloading.</p>
</div>
<div class="paragraph">
<p>To illustrate this, we will create a script engine and execute code in an infinite loop. First of all, you need to create
a directory with the following script inside:</p>
</div>
<div class="listingblock">
<div class="title">ReloadingTest.groovy</div>
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Greeter {
    String sayHello() {
        def greet = "Hello, world!"
        greet
    }
}

new Greeter()</code></pre>
</div>
</div>
<div class="paragraph">
<p>then you can execute this code using a <code>GroovyScriptEngine</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def binding = new Binding()
def engine = new GroovyScriptEngine([tmpDir.toURI().toURL()] as URL[])          <i class="conum" data-value="1"></i><b>(1)</b>

while (true) {
    def greeter = engine.run('ReloadingTest.groovy', binding)                   <i class="conum" data-value="2"></i><b>(2)</b>
    println greeter.sayHello()                                                  <i class="conum" data-value="3"></i><b>(3)</b>
    Thread.sleep(1000)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a script engine which will look for sources into our source directory</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>execute the script, which will return an instance of <code>Greeter</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>print the greeting message</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>At this point, you should see a message printed every second:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello, world!
Hello, world!
...</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Without</strong> interrupting the script execution, now replace the contents of the <code>ReloadingTest</code> file with:</p>
</div>
<div class="listingblock">
<div class="title">ReloadingTest.groovy</div>
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Greeter {
    String sayHello() {
        def greet = "Hello, Groovy!"
        greet
    }
}


new Greeter()</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the message should change to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello, world!
...
Hello, Groovy!
Hello, Groovy!
...</pre>
</div>
</div>
<div class="paragraph">
<p>But it is also possible to have a dependency on another script. To illustrate this, create the following file into
the same directory, without interrupting the executing script:</p>
</div>
<div class="listingblock">
<div class="title">Depencency.groovy</div>
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Dependency {
    String message = 'Hello, dependency 1'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and update the <code>ReloadingTest</code> script like this:</p>
</div>
<div class="listingblock">
<div class="title">ReloadingTest.groovy</div>
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import Dependency

class Greeter {
    String sayHello() {
        def greet = new Dependency().message
        greet
    }
}

new Greeter()</code></pre>
</div>
</div>
<div class="paragraph">
<p>And this time, the message should change to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello, Groovy!
...
Hello, dependency 1!
Hello, dependency 1!
...</pre>
</div>
</div>
<div class="paragraph">
<p>And as a last test, you can update the <code>Dependency.groovy</code> file without touching the <code>ReloadingTest</code> file:</p>
</div>
<div class="listingblock">
<div class="title">Depencency.groovy</div>
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Dependency {
    String message = 'Hello, dependency 2'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And you should observe that the dependent file was reloaded:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello, dependency 1!
...
Hello, dependency 2!
Hello, dependency 2!</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_compilationunit">CompilationUnit</h5>
<div class="paragraph">
<p>Ultimately, it is possible to perform more operations during compilation by relying directly on the
<code>org.codehaus.groovy.control.CompilationUnit</code> class. This class is responsible for determining the various steps of
compilation and would let you introduce new steps or even stop compilation at various phases. This is for example how
stub generation is done, for the joint compiler.</p>
</div>
<div class="paragraph">
<p>However, overriding <code>CompilationUnit</code> is not recommanded and should only be done if no other standard solution works.</p>
</div>
<div class="paragraph">
<p>Unresolved directive in src/spec/doc/guide-integrating.adoc - include::/usr/project/git/groovy-doc/subprojects/groovy-bsf/src/spec/doc/integrating-bsf.adoc[]
:leveloffset: 2</p>
</div>
<div class="paragraph">
<p>Unresolved directive in src/spec/doc/guide-integrating.adoc - include::/usr/project/git/groovy-doc/subprojects/groovy-jsr223/src/spec/doc/integrating-jsr223.adoc[]
:leveloffset: 2</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_domain_specific_languages">4.9.2. Domain-Specific Languages</h4>
<div class="sect4">
<h5 id="_command_chains">Command chains</h5>
<div class="paragraph">
<p>Groovy lets you omit parentheses around the arguments of a
method call for top-level statements. &#8220;command chain&#8221; feature extends this by allowing us to chain such
parentheses-free method calls, requiring neither parentheses around arguments, nor dots between the chained calls.
The general idea is that a call like <code>a b c d</code> will actually be equivalent to <code>a(b).c(d)</code>. This
also works with multiple arguments, closure arguments, and even named arguments. Furthermore, such command chains can
also appear on the right-hand side of assignments. Let’s have a look at some examples
supported by this new syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">// equivalent to: turn(left).then(right)
turn left then right

// equivalent to: take(2.pills).of(chloroquinine).after(6.hours)
take 2.pills of chloroquinine after 6.hours

// equivalent to: paint(wall).with(red, green).and(yellow)
paint wall with red, green and yellow

// with named parameters too
// equivalent to: check(that: margarita).tastes(good)
check that: margarita tastes good

// with closures as parameters
// equivalent to: given({}).when({}).then({})
given { } when { } then { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to use methods in the chain which take no arguments,
but in that case, the parentheses are needed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">// equivalent to: select(all).unique().from(names)
select all unique() from names</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your command chain contains an odd number of elements, the chain will
be composed of method / arguments, and will finish by a final property
access:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">// equivalent to: take(3).cookies
// and also this: take(3).getCookies()
take 3 cookies</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command chain approach opens up interesting possibilities in terms of the much wider range of DSLs which
can now be written in Groovy.</p>
</div>
<div class="paragraph">
<p>The above examples illustrate using a command chain based DSL but not how to create one. There are various strategies
that you can use, but to illustrate creating such a DSL, we will show a couple of examples - first using maps and Closures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">show = { println it }
square_root = { Math.sqrt(it) }

def please(action) {
  [the: { what -&gt;
    [of: { n -&gt; action(what(n)) }]
  }]
}

// equivalent to: please(show).the(square_root).of(100)
please show the square_root of 100
// ==&gt; 10.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a second example, consider how you might write a DSL for simplifying
one of your existing APIs. Maybe you need to put this code in front of
customers, business analysts or testers who might be not hard-core Java
developers. We’ll use the <code>Splitter</code> from the Google
<a href="http://code.google.com/p/guava-libraries/">Guava libraries</a> project as it
already has a nice Fluent API. Here is how we might use it out of the
box:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Grab('com.google.guava:guava:r09')
import com.google.common.base.*
def result = Splitter.on(',').trimResults(CharMatcher.is('_' as char)).split("_a ,_b_ ,c__").iterator().toList()</code></pre>
</div>
</div>
<div class="paragraph">
<p>It reads fairly well for a Java developer but if that is not your target
audience or you have many such statements to write, it could be
considered a little verbose. Again, there are many options for writing a
DSL. We’ll keep it simple with Maps and Closures. We’ll first write a
helper method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Grab('com.google.guava:guava:r09')
import com.google.common.base.*
def split(string) {
  [on: { sep -&gt;
    [trimming: { trimChar -&gt;
      Splitter.on(sep).trimResults(CharMatcher.is(trimChar as char)).split(string).iterator().toList()
    }]
  }]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>now instead of this line from our original example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def result = Splitter.on(',').trimResults(CharMatcher.is('_' as char)).split("_a ,_b_ ,c__").iterator().toList()</code></pre>
</div>
</div>
<div class="paragraph">
<p>we can write this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def result = split "_a ,_b_ ,c__" on ',' trimming '_\'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_operator_overloading_tbd">Operator overloading (TBD)</h5>

</div>
<div class="sect4">
<h5 id="_script_base_classes_tbd">Script base classes (TBD)</h5>

</div>
<div class="sect4">
<h5 id="_adding_properties_to_numbers_tbd">Adding properties to numbers (TBD)</h5>

</div>
<div class="sect4">
<h5 id="section-delegatesto">@DelegatesTo</h5>
<div class="sect5">
<h6 id="TheDelegatesToannotation-DSLsmadeeasy">Explaining delegation strategy at compile time</h6>
<div class="paragraph">
<p><code>@groovy.lang.DelegatesTo</code> is a documentation and compile-time annotation aimed at:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>documenting APIs that use closures as arguments</p>
</li>
<li>
<p>providing type information for the static type checker and compiler</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Groovy language is a platform of choice for building DSLs. Using
closures, it’s quite easy to create custom control structures, as well
as it is simple to create builders. Imagine that you have the following
code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">email {
    from 'dsl-guru@mycompany.com'
    to 'john.doe@waitaminute.com'
    subject 'The pope has resigned!'
    body {
        p 'Really, the pope has resigned!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>One way of implementing this is using the builder strategy, which
implies a method, named <code>email</code> which accepts a closure as an argument.
The method may delegate subsequent calls to an object that implements
the <code>from</code>, <code>to</code>, <code>subject</code> and <code>body</code> methods. Again, <code>body</code> is a
method which accepts a closure as an argument and that uses the builder
strategy.</p>
</div>
<div class="paragraph">
<p>Implementing such a builder is usually done the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def email(Closure cl) {
    def email = new EmailSpec()
    def code = cl.rehydrate(email, this, this)
    code.resolveStrategy = Closure.DELEGATE_ONLY
    code()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>the <code>EmailSpec</code> class implements the <code>from</code>, <code>to</code>, … methods. By
calling <code>rehydrate</code>, we’re creating a copy of the closure for which we
set the <code>delegate</code>, <code>owner</code> and <code>thisObject</code> values. Setting the owner
and the <code>this</code> object is not very important here since we will use the
<code>DELEGATE_ONLY</code> strategy which says that the method calls will be
resolved only against the delegate of the closure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class EmailSpec {
    void from(String from) { println "From: $from"}
    void to(String... to) { println "To: $to"}
    void subject(String subject) { println "Subject: $subject"}
    void body(Closure body) {
        def bodySpec = new BodySpec()
        def code = body.rehydrate(bodySpec, this, this)
        code.resolveStrategy = Closure.DELEGATE_ONLY
        code()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>EmailSpec</code> class has itself a <code>body</code> method accepting a closure that is cloned and executed. This is what
we call the builder pattern in Groovy.</p>
</div>
<div class="paragraph">
<p>One of the problems with the code that we’ve shown is that the user of
the <code>email</code> method doesn’t have any information about the methods that
he’s allowed to call inside the closure. The only possible information
is from the method documentation. There are two issues with this: first
of all, documentation is not always written, and if it is, it’s not
always available (javadoc not downloaded, for example). Second, it
doesn’t help IDEs. What would be really interesting, here, is for IDEs
to help the developer by suggesting, once they are in the closure body,
methods that exist on the <code>email</code> class.</p>
</div>
<div class="paragraph">
<p>Moreover, if the user calls a method in the closure which is not defined
by the <code>EmailSpec</code> class, the IDE should at least issue a warning (because
it’s very likely that it will break at runtime).</p>
</div>
<div class="paragraph">
<p>One more problem with the code above is that it is not compatible with static type checking. Type checking would let
the user know if a method call is authorized at compile time instead of runtime, but if you try to perform type
checking on this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">email {
    from 'dsl-guru@mycompany.com'
    to 'john.doe@waitaminute.com'
    subject 'The pope has resigned!'
    body {
        p 'Really, the pope has resigned!'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the type checker will know that there’s an <code>email</code> method accepting
a <code>Closure</code>, but it will complain for every method call <strong>inside</strong> the
closure, because <code>from</code>, for example, is not a method which is defined
in the class. Indeed, it’s defined in the <code>EmailSpec</code> class and it has
absolutely no hint to help it knowing that the closure delegate will, at
runtime, be of type <code>EmailSpec</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@groovy.transform.TypeChecked
void sendEmail() {
    email {
        from 'dsl-guru@mycompany.com'
        to 'john.doe@waitaminute.com'
        subject 'The pope has resigned!'
        body {
            p 'Really, the pope has resigned!'
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will fail compilation with errors like this one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Static type checking] - Cannot find matching method MyScript#from(java.lang.String). Please check if the declared type is right and if the method exists.
 @ line 31, column 21.
                       from 'dsl-guru@mycompany.com'</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="TheDelegatesToannotation-DelegatesTo">@DelegatesTo</h6>
<div class="paragraph">
<p>For those reasons, Groovy 2.1 introduced a new annotation
named <code>@DelegatesTo</code>. The goal of this annotation is to solve both the
documentation issue, that will let your IDE know about the expected
methods in the closure body, and it will also solve the type checking
issue, by giving hints to the compiler about what are the potential
receivers of method calls in the closure body.</p>
</div>
<div class="paragraph">
<p>The idea is to annotate the <code>Closure</code> parameter of the <code>email</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def email(@DelegatesTo(EmailSpec) Closure cl) {
    def email = new EmailSpec()
    def code = cl.rehydrate(email, this, this)
    code.resolveStrategy = Closure.DELEGATE_ONLY
    code()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>What we’ve done here is telling the compiler (or the IDE) that when the
method will be called with a closure, the delegate of this closure will
be set to an object of type <code>email</code>. But there is still a problem: the
defaut delegation strategy is not the one which is used in our method.
So we will give more information and tell the compiler (or the IDE) that
the delegation strategy is also changed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def email(@DelegatesTo(strategy=Closure.DELEGATE_ONLY, value=EmailSpec) Closure cl) {
    def email = new EmailSpec()
    def code = cl.rehydrate(email, this, this)
    code.resolveStrategy = Closure.DELEGATE_ONLY
    code()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, both the IDE and the type checker (if you are using <code>@TypeChecked</code>)
will be aware of the delegate and the delegation strategy. This is very
nice because it will both allow the IDE to provide smart completion, but
it will also remove errors at compile time that exist only because the
behaviour of the program is normally only known at runtime!</p>
</div>
<div class="paragraph">
<p>The following code will now pass compilation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@TypeChecked
void doEmail() {
    email {
        from 'dsl-guru@mycompany.com'
        to 'john.doe@waitaminute.com'
        subject 'The pope has resigned!'
        body {
            p 'Really, the pope has resigned!'
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="TheDelegatesToannotation-DelegatesTomodes">DelegatesTo modes</h6>
<div class="paragraph">
<p><code>@DelegatesTo</code> supports multiple modes that we will describe with examples
in this section.</p>
</div>
<div class="sect6">
<h7 id="TheDelegatesToannotation-Simpledelegation">Simple delegation</h7>
<div class="paragraph">
<p>In this mode, the only mandatory parameter is the <em>value</em> which says to
which class we delegate calls. Nothing more. We’re telling the compiler
that the type of the delegate will <strong>always</strong> be of the type documented
by <code>@DelegatesTo</code> (note that it can be a subclass, but if it is, the
methods defined by the subclass will not be visible to the type
checker).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">void body(@DelegatesTo(BodySpec) Closure cl) {
    // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="TheDelegatesToannotation-Delegationstrategy">Delegation strategy</h7>
<div class="paragraph">
<p>In this mode, you must specify both the delegate class <strong>and</strong> a
delegation strategy. This must be used if the closure will not be called
with the default delegation strategy, which is <code>Closure.OWNER_FIRST</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">void body(@DelegatesTo(strategy=Closure.DELEGATE_ONLY, value=BodySpec) Closure cl) {
    // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="TheDelegatesToannotation-Delegatetoparameter">Delegate to parameter</h7>
<div class="paragraph">
<p>In this variant, we will tell the compiler that we are delegating to
another parameter of the method. Take the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def exec(Object target, Closure code) {
   def clone = code.rehydrate(target, this, this)
   clone()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the delegate which will be used is <strong>not</strong> created inside the <code>exec</code>
method. In fact, we take an argument of the method and delegate to it.
Usage may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def email = new Email()
exec(email) {
   from '...'
   to '...'
   send()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each of the method calls are delegated to the <code>email</code> parameter. This is
a widely used pattern which is also supported by <code>@DelegatesTo</code> using a
companion annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def exec(@DelegatesTo.Target Object target, @DelegatesTo Closure code) {
   def clone = code.rehydrate(target, this, this)
   clone()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A closure is annotated with <code>@DelegatesTo</code>, but this time, without
specifying any class. Instead, we’re annotating another parameter
with <code>@DelegatesTo.Target</code>. The type of the delegate is then determined
at compile time. One could think that we are using the parameter type,
which in this case is <code>Object</code> but this is not true. Take this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Greeter {
   void sayHello() { println 'Hello' }
}
def greeter = new Greeter()
exec(greeter) {
   sayHello()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember that this works out of the box <strong>without</strong> having to annotate
with <code>@DelegatesTo</code>. However, to make the IDE aware of the delegate
type, or the <strong>type checker</strong> aware of it, we need to add <code>@DelegatesTo</code>.
And in this case, it will now that the <code>Greeter</code> variable is of
type <code>Greeter</code>, so it will not report errors on the <em>sayHello</em>
method <strong>even if the exec method doesn’t explicitely define the target as
of type Greeter</strong>. This is a very powerful feature, because it prevents
you from writing multiple versions of the same <code>exec</code> method for
different receiver types!</p>
</div>
<div class="paragraph">
<p>In this mode, the <code>@DelegatesTo</code> annotation also supports the <code>strategy</code>
parameter that we’ve described upper.</p>
</div>
</div>
<div class="sect6">
<h7 id="TheDelegatesToannotation-Multipleclosures">Multiple closures</h7>
<div class="paragraph">
<p>In the previous example, the <code>exec</code> method accepted only one closure,
but you may have methods that take multiple closures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">void fooBarBaz(Closure foo, Closure bar, Closure baz) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then nothing prevents you from annotating each closure
with <code>@DelegatesTo</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Foo { void foo(String msg) { println "Foo ${msg}!" } }
class Bar { void bar(int x) { println "Bar ${x}!" } }
class Baz { void baz(Date d) { println "Baz ${d}!" } }

void fooBarBaz(@DelegatesTo(Foo) Closure foo, @DelegatesTo(Bar) Closure bar, @DelegatesTo(Baz) Closure baz) {
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>But more importantly, if you have multiple closures <strong>and</strong> multiple
arguments, you can use several targets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">void fooBarBaz(
    @DelegatesTo.Target('foo') foo,
    @DelegatesTo.Target('bar') bar,
    @DelegatesTo.Target('baz') baz,

    @DelegatesTo(target='foo') Closure cl1,
    @DelegatesTo(target='bar') Closure cl2,
    @DelegatesTo(target='baz') Closure cl3) {
    cl1.rehydrate(foo, this, this).call()
    cl2.rehydrate(bar, this, this).call()
    cl3.rehydrate(baz, this, this).call()
}

def a = new Foo()
def b = new Bar()
def c = new Baz()
fooBarBaz(
    a, b, c,
    { foo('Hello') },
    { bar(123) },
    { baz(new Date()) }
)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
At this point, you may wonder why we don’t use the parameter names as
references. The reason is that the information (the parameter name) is
not always available (it’s a debug-only information), so it’s a
limitation of the JVM.
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_delegating_to_a_generic_type">Delegating to a generic type</h7>
<div class="paragraph">
<p>In some situations, it is interesting to instruct the IDE or the compiler that the delegate type will not be a parameter
but a generic type. Imagine a configurator that runs on a list of elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">public &lt;T&gt; void configure(List&lt;T&gt; elements, Closure configuration) {
   elements.each { e-&gt;
      def clone = configuration.rehydrate(e, this, this)
      clone.resolveStrategy = Closure.DELEGATE_FIRST
      clone.call()
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then this method can be called with any list like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@groovy.transform.ToString
class Realm {
   String name
}
List&lt;Realm&gt; list = []
3.times { list &lt;&lt; new Realm() }
configure(list) {
   name = 'My Realm'
}
assert list.every { it.name == 'My Realm' }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To let the type checker and the IDE know that the <code>configure</code> method calls the closure on each element of the list, you
 need to use <code>@DelegatesTo</code> differently:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">public &lt;T&gt; void configure(
    @DelegatesTo.Target List&lt;T&gt; elements,
    @DelegatesTo(strategy=Closure.DELEGATE_FIRST, genericTypeIndex=0) Closure configuration) {
   def clone = configuration.rehydrate(e, this, this)
   clone.resolveStrategy = Closure.DELEGATE_FIRST
   clone.call()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@DelegatesTo</code> takes an optional <code>genericTypeIndex</code> argument that tells what is the index of the generic type that will
be used as the delegate type. This <strong>must</strong> be used in conjunction with <code>@DelegatesTo.Target</code> and the index starts at 0. In
the example above, that means that the delegate type is resolved against <code>List&lt;T&gt;</code>, and since the generic type at index
0 is <code>T</code> and inferred as a <code>Realm</code>, the type checker infers that the delegate type will be of type <code>Realm</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
We&#8217;re using a <code>genericTypeIndex</code> instead of a placeholder (<code>T</code>) because of JVM limitations.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="compilation-customizers">Compilation customizers</h5>
<div class="sect5">
<h6 id="_introduction_4">Introduction</h6>
<div class="paragraph">
<p>Whether you are using <code>groovyc</code> to compile classes or a <code>GroovyShell</code>,
for example, to execute scripts, under the hood, a <em>compiler configuration</em> is used. This configuration holds information
like the source encoding or the classpath but it can also be used to perform more operations like adding imports by
default, applying AST transformations transparently or disabling global AST transformations.</p>
</div>
<div class="paragraph">
<p>The goal of compilation customizers is to make those common tasks easy to implement. For that, the <code>CompilerConfiguration</code>
class is the entry point. The general schema will always be based on the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import org.codehaus.groovy.control.CompilerConfiguration
// create a configuration
def config = new CompilerConfiguration()
// tweak the configuration
config.addCompilationCustomizers(...)
// run your script
def shell = new GroovyShell(config)
shell.evaluate(script)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Compilation customizers must extend the <em>org.codehaus.groovy.control.customizers.CompilationCustomizer</em> class. A customizer works:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>on a specific compilation phase</p>
</li>
<li>
<p>on <em>every</em> class node being compiled</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can implement your own compilation customizer but Groovy includes some of the most common operations.</p>
</div>
</div>
<div class="sect5">
<h6 id="_import_customizer">Import customizer</h6>
<div class="paragraph">
<p>Using this compilation customizer, your code will have imports added
transparently. This is in particular useful for scripts implementing a
DSL where you want to avoid users from having to write imports. The
import customizer will let you add all the variants of imports the
Groovy language allows, that is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>class imports, optionally aliased</p>
</li>
<li>
<p>star imports</p>
</li>
<li>
<p>static imports, optionally aliased</p>
</li>
<li>
<p>static star imports</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import org.codehaus.groovy.control.customizers.ImportCustomizer

def icz = new ImportCustomizer()
// "normal" import
icz.addImports('java.util.concurrent.atomic.AtomicInteger', 'java.util.concurrent.ConcurrentHashMap')
// "aliases" import
icz.addImport('CHM', 'java.util.concurrent.ConcurrentHashMap')
// "static" import
icz.addStaticImport('java.lang.Math', 'PI') // import static java.lang.Math.Pi
// "aliased static" import
icz.addStaticImport('pi', 'java.lang.Math', 'PI') // import static java.lang.Math.PI as pi
// "star" import
icz.addStarImports 'java.util.concurrent' // import java.util.concurrent.*
// "static star" import
icz.addStaticStars 'java.lang.Math' // import static java.lang.Math.*</code></pre>
</div>
</div>
<div class="paragraph">
<p>A detailed description of all shortcuts can be found in <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?org/codehaus/groovy/control/customizers/ImportCustomizer.html' target='_blank'><code>org.codehaus.groovy.control.customizers.ImportCustomizer</code></a></p>
</div>
</div>
<div class="sect5">
<h6 id="_ast_transformation_customizer">AST transformation customizer</h6>
<div class="paragraph">
<p>The AST transformation customizer is meant to apply AST transformations
transparently. Unlike global AST transformations that apply on every
class beeing compiled as long as the transform is found on classpath
(which has drawbacks like increasing the compilation time or side
effects due to transformations applied where they should not), the
customizer will allow you to selectively apply a transform only for
specific scripts or classes.</p>
</div>
<div class="paragraph">
<p>As an example, let’s say you want to be able to use <code>@Log</code> in a script.
The problem is that <code>@Log</code> is normally applied on a class node and a
script, by definition, doesn’t require one. But implementation wise,
scripts are classes, it’s just that you cannot annotate this implicit
class node with <code>@Log</code>. Using the AST customizer, you have a workaround
to do it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import org.codehaus.groovy.control.customizers.ASTTransformationCustomizer
import groovy.util.logging.Log

def acz = new ASTTransformationCustomizer(Log)
config.addCompilationCustomizers(acz)</code></pre>
</div>
</div>
<div class="paragraph">
<p>That’s all! Internally, the <code>@Log</code> AST transformation is applied to
every class node in the compilation unit. This means that it will be
applied to the script, but also to classes defined within the script.</p>
</div>
<div class="paragraph">
<p>If the AST transformation that you are using accepts parameters, you can
use parameters in the constructor too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def acz = new ASTTransformationCustomizer(Log, value: 'LOGGER')
// use name 'LOGGER' instead of the default 'log'
config.addCompilationCustomizers(acz)</code></pre>
</div>
</div>
<div class="paragraph">
<p>As the AST transformation customizers works with objects instead of AST
nodes, not all values can be converted to AST transformation parameters.
For example, primitive types are converted to <code>ConstantExpression</code> (that
is <code>LOGGER</code> is converted to <code>new ConstantExpression('LOGGER')</code>, but if
your AST transformation takes a closure as an argument, then you have to
give it a <code>ClosureExpression</code>, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def configuration = new CompilerConfiguration()
def expression = new AstBuilder().buildFromCode(CompilePhase.CONVERSION) { -&gt; true }.expression[0]
def customizer = new ASTTransformationCustomizer(ConditionalInterrupt, value: expression, thrown: SecurityException)
configuration.addCompilationCustomizers(customizer)
def shell = new GroovyShell(configuration)
shouldFail(SecurityException) {
    shell.evaluate("""
        // equivalent to adding @ConditionalInterrupt(value={true}, thrown: SecurityException)
        class MyClass {
            void doIt() { }
        }
        new MyClass().doIt()
    """)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a complete list of options, please refer to <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?org/codehaus/groovy/control/customizers/ASTTransformationCustomizer.html' target='_blank'><code>org.codehaus.groovy.control.customizers.ASTTransformationCustomizer</code></a></p>
</div>
</div>
<div class="sect5">
<h6 id="_secure_ast_customizer">Secure AST customizer</h6>
<div class="paragraph">
<p>This customizer will allow the developer of a DSL to restrict the
<strong>grammar</strong> of the language, to prevent users from using some constructs,
for example. It is only &#8220;secure&#8221; in that sense only and it is very
important to understand that it does <strong>not</strong> replace a security manager.
The only reason for it to exist is to limit the expressiveness of the
language. This customizer only works at the AST (abstract syntax tree)
level, not at runtime! It can be strange at first glance, but it makes
much more sense if you think of Groovy as a platform to build DSLs. You
may not want a user to have a complete language at hand. In the example
below, we will demonstrate it using an example of language that only
allows arithmetic operations, but this customizer allows you to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>allow/disallow creation of closures</p>
</li>
<li>
<p>allow/disallow imports</p>
</li>
<li>
<p>allow/disallow package definition</p>
</li>
<li>
<p>allow/disallow definition of methods</p>
</li>
<li>
<p>restrict the receivers of method calls</p>
</li>
<li>
<p>restrict the kind of AST expressions a user can use</p>
</li>
<li>
<p>restrict the tokens (grammar-wise) a user can use</p>
</li>
<li>
<p>restrict the types of the constants that can be used in code</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For all those features, the secure AST customizer works using either a
whitelist (list of elements that are allowed) <strong>or</strong> a blacklist (list of
elements that are disallowed). For each type of feature (imports,
tokens, …) you have the choice to use either a whitelist or a blacklist,
but you can mix whitelists and blacklists for distinct features. In
general, you will choose whitelists (disallow all, allow selected).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import org.codehaus.groovy.control.customizers.SecureASTCustomizer
import static org.codehaus.groovy.syntax.Types.* <i class="conum" data-value="1"></i><b>(1)</b>

def scz = new SecureASTCustomizer()
scz.with {
    closuresAllowed = false // user will not be able to write closures
    methodDefinitionAllowed = false // user will not be able to define methods
    importsWhitelist = [] // empty whitelist means imports are disallowed
    staticImportsWhitelist = [] // same for static imports
    staticStarImportsWhitelist = ['java.lang.Math'] // only java.lang.Math is allowed
    // the list of tokens the user can find
    // constants are defined in org.codehaus.groovy.syntax.Types
    tokensWhitelist = [ <i class="conum" data-value="1"></i><b>(1)</b>
            PLUS,
            MINUS,
            MULTIPLY,
            DIVIDE,
            MOD,
            POWER,
            PLUS_PLUS,
            MINUS_MINUS,
            COMPARE_EQUAL,
            COMPARE_NOT_EQUAL,
            COMPARE_LESS_THAN,
            COMPARE_LESS_THAN_EQUAL,
            COMPARE_GREATER_THAN,
            COMPARE_GREATER_THAN_EQUAL,
    ].asImmutable()
    // limit the types of constants that a user can define to number types only
    constantTypesClassesWhiteList = [ <i class="conum" data-value="2"></i><b>(2)</b>
            Integer,
            Float,
            Long,
            Double,
            BigDecimal,
            Integer.TYPE,
            Long.TYPE,
            Float.TYPE,
            Double.TYPE
    ].asImmutable()
    // method calls are only allowed if the receiver is of one of those types
    // be careful, it's not a runtime type!
    receiversClassesWhiteList = [ <i class="conum" data-value="2"></i><b>(2)</b>
            Math,
            Integer,
            Float,
            Double,
            Long,
            BigDecimal
    ].asImmutable()
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>use for token types from <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?org/codehaus/groovy/syntax/Types.html' target='_blank'><code>org.codehaus.groovy.syntax.Types</code></a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>you can use class literals here</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If what the secure AST customizer provides out of the box isn’t enough
for your needs, before creating your own compilation customizer, you
might be interested in the expression and statement checkers that the
AST customizer supports. Basically, it allows you to add custom checks
on the AST tree, on expressions (expression checkers) or statements
(statement checkers). For this, you must
implement <code>org.codehaus.groovy.control.customizers.SecureASTCustomizer.StatementChecker</code>
or <code>org.codehaus.groovy.control.customizers.SecureASTCustomizer.ExpressionChecker</code>.</p>
</div>
<div class="paragraph">
<p>Those interfaces define a single method called <code>isAuthorized</code>, returning
a boolean, and taking a <code>Statement</code> (or <code>Expression</code>) as a parameter. It
allows you to perform complex logic over expressions or statements to
tell if a user is allowed to do it or not.</p>
</div>
<div class="paragraph">
<p>For example, there&#8217;s no predefined configuration flag in the customizer which
will let you prevent people from using an attribute expression. Using a custom
checker, it is trivial:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def scz = new SecureASTCustomizer()
def checker = { expr -&gt;
    !(expr instanceof AttributeExpression)
} as SecureASTCustomizer.ExpressionChecker
scz.addExpressionCheckers(checker)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we can make sure that this works by evaluating a simple script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">new GroovyShell(config).evaluate '''
    class A {
        int val
    }
    
    def a = new A(val: 123)
    a.@val <i class="conum" data-value="1"></i><b>(1)</b>
'''</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>will fail compilation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Statements can be checked using <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?org/codehaus/groovy/control/customizers/SecureASTCustomizer/StatementChecker.html' target='_blank'><code>org.codehaus.groovy.control.customizers.SecureASTCustomizer.StatementChecker</code></a>
Expressions can be checked using <a href='http://docs.groovy-lang.org/2.4.0-SNAPSHOT/html/gapi/index.html?org/codehaus/groovy/control/customizers/SecureASTCustomizer/ExpressionChecker.html' target='_blank'><code>org.codehaus.groovy.control.customizers.SecureASTCustomizer.ExpressionChecker</code></a></p>
</div>
</div>
<div class="sect5">
<h6 id="_source_aware_customizer">Source aware customizer</h6>
<div class="paragraph">
<p>This customizer may be used as a filter on other customizers. The
filter, in that case, is the <code>org.codehaus.groovy.control.SourceUnit</code>.
For this, the source aware customizer takes another customizer as a
delegate, and it will apply customization of that delegate only and only
if predicates on the source unit match.</p>
</div>
<div class="paragraph">
<p><code>SourceUnit</code> gives you access to multiple things but in particular the
file being compiled (if compiling from a file, of course). It gives
you the potential to perform operation based on the file name, for
example. Here is how you would create a source aware customizer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import org.codehaus.groovy.control.customizers.SourceAwareCustomizer
import org.codehaus.groovy.control.customizers.ImportCustomizer

def delegate = new ImportCustomizer()
def sac = new SourceAwareCustomizer(delegate)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can use predicates on the source aware customizer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">// the customizer will only be applied to classes contained in a file name ending with 'Bean'
sac.baseNameValidator = { baseName -&gt;
    baseName.endsWith 'Bean'
}

// the customizer will only be applied to files which extension is '.spec'
sac.extensionValidator = { ext -&gt; ext == 'spec' }

// source unit validation
// allow compilation only if the file contains at most 1 class
sac.sourceUnitValidator = { SourceUnit sourceUnit -&gt; sourceUnit.AST.classes.size() == 1 }

// class validation
// the customizer will only be applied to classes ending with 'Bean'
sac.classValidator = { ClassNode cn -&gt; cn.endsWith('Bean') }</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_customizer_builder">Customizer builder</h6>
<div class="paragraph">
<p>If you are using compilation customizers in Groovy code (like the
examples above) then you can use an alternative syntax to customize compilation.
A builder (<code>org.codehaus.groovy.control.customizers.builder.CompilerCustomizationBuilder</code>)
simplifies the creation of customizers using a hierarchical DSL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">import org.codehaus.groovy.control.CompilerConfiguration
import static org.codehaus.groovy.control.customizers.builder.CompilerCustomizationBuilder.withConfig <i class="conum" data-value="1"></i><b>(1)</b>

def conf = new CompilerConfiguration()
withConfig(conf) {
    // ... <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>static import of the builder method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>configuration goes here</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The code sample above shows how to use the builder. A static
method, <em>withConfig</em>, takes a closure corresponding to the builder code,
and automatically registers compilation customizers to the
configuration. Every compilation customizer available in the distribution
can be configured this way:</p>
</div>
<div class="sect6">
<h7 id="_import_customizer_2">Import customizer</h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">withConfig(configuration) {
   imports { // imports customizer
      normal 'my.package.MyClass' // a normal import
      alias 'AI', 'java.util.concurrent.atomic.AtomicInteger' // an aliased import
      star 'java.util.concurrent' // star imports
      staticMember 'java.lang.Math', 'PI' // static import
      staticMember 'pi', 'java.lang.Math', 'PI' // aliased static import
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_ast_transformation_customizer_2">AST transformation customizer</h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">withConfig(conf) {
   ast(Log) <i class="conum" data-value="1"></i><b>(1)</b>
}

withConfig(conf) {
   ast(Log, value: 'LOGGER') <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>apply @Log transparently</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>apply @Log with a different name for the logger</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_secure_ast_customizer_2">Secure AST customizer</h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">withConfig(conf) {
   secureAst {
       closuresAllowed = false
       methodDefinitionAllowed = false
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_source_aware_customizer_2">Source aware customizer</h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">withConfig(configuration){
    source(extension: 'sgroovy') {
        ast(CompileStatic) <i class="conum" data-value="1"></i><b>(1)</b>
    }
}

withConfig(configuration){
    source(extensions: ['sgroovy','sg']) {
        ast(CompileStatic) <i class="conum" data-value="2"></i><b>(2)</b>
    }
}

withConfig(configuration) {
    source(extensionValidator: { it.name in ['sgroovy','sg']}) {
        ast(CompileStatic) <i class="conum" data-value="2"></i><b>(2)</b>
    }
}

withConfig(configuration) {
    source(basename: 'foo') {
        ast(CompileStatic) <i class="conum" data-value="3"></i><b>(3)</b>
    }
}

withConfig(configuration) {
    source(basenames: ['foo', 'bar']) {
        ast(CompileStatic) <i class="conum" data-value="4"></i><b>(4)</b>
    }
}

withConfig(configuration) {
    source(basenameValidator: { it in ['foo', 'bar'] }) {
        ast(CompileStatic) <i class="conum" data-value="4"></i><b>(4)</b>
    }
}

withConfig(configuration) {
    source(unitValidator: { unit -&gt; !unit.AST.classes.any { it.name == 'Baz' } }) {
        ast(CompileStatic) <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>apply CompileStatic AST annotation on .sgroovy files</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>apply CompileStatic AST annotation on .sgroovy or .sg files</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>apply CompileStatic AST annotation on files whose name is <em>foo</em></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>apply CompileStatic AST annotation on files whose name is <em>foo</em> or <em>bar</em></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>apply CompileStatic AST annotation on files that do not contain a class named <em>Baz</em></td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_inlining_a_customizer">Inlining a customizer</h7>
<div class="paragraph">
<p>Inlined customizer allows you to write a compilation customizer
directly, without having to create a class for it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">withConfig(configuration) {
    inline(phase:'CONVERSION') { source, context, classNode -&gt;  <i class="conum" data-value="1"></i><b>(1)</b>
        println "visiting $classNode"                           <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>define an inlined customizer which will execute at the CONVERSION phase</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>prints the name of the class node being compiled</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_multiple_customizers">Multiple customizers</h7>
<div class="paragraph">
<p>Of course, the builder allows you to define multiple customizers at
once:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">withConfig(configuration) {
   ast(ToString)
   ast(EqualsAndHashCode)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_config_script_flag">Config script flag</h6>
<div class="paragraph">
<p>So far, we have described how you can customize compilation using
a <code>CompilationConfiguration</code> class, but this is only possible if you
embed Groovy and that you create your own instances
of <code>CompilerConfiguration</code> (then use it to create a
<code>GroovyShell</code>, <code>GroovyScriptEngine</code>, …).</p>
</div>
<div class="paragraph">
<p>If you want it to be applied on the classes you compile with the normal
Groovy compiler (that is to say with  <code>groovyc</code>, <code>ant</code> or <code>gradle</code>,
for example), it is possible to use a compilation flag named <code>configscript</code>
that takes a Groovy configuration script as argument.</p>
</div>
<div class="paragraph">
<p>This script gives you access to the <code>CompilerConfiguration</code> instance <strong>before</strong>
the files are compiled (exposed into the configuration script as a variable named <code>configuration</code>),
so that you can tweak it.</p>
</div>
<div class="paragraph">
<p>It also transparently integrates the compiler configuration builder above. As an example, let&#8217;s see
how you would activate static compilation by default on all classes.</p>
</div>
<div class="sect6">
<h7 id="_static_compilation_by_default">Static compilation by default</h7>
<div class="paragraph">
<p>Normally, classes in Groovy are compiled with a dynamic runtime. You can activate static compilation
by placing an annotation named <code>@CompileStatic</code> on any class. Some people would like to have this
mode activated by default, that is to say not having to annotated classes. Using <code>configscript</code>,
this is possible. First of all, you need to create a file named <code>config.groovy</code> into <code>src/conf</code> with
the following contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">withConfig(configuration) { <i class="conum" data-value="1"></i><b>(1)</b>
   ast(groovy.transform.CompileStatic)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><em>configuration</em> references a <code>CompilerConfiguration</code> instance</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>That is actually all you need. You don’t have to import the builder, it’s automatically
exposed in the script. Then, compile your files using the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovyc -configscript src/conf/config.groovy src/main/groovy/MyClass.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>We strongly recommand you to separate configuration files from classes,
hence why we suggest using the <code>src/main</code> and <code>src/conf</code> directories above.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_ast_transformations_tbd">AST transformations (TBD)</h6>

</div>
</div>
<div class="sect4">
<h5 id="_custom_type_checking_extensions_tbd">Custom type checking extensions (TBD)</h5>

</div>
<div class="sect4">
<h5 id="_builders_tbd">Builders (TBD)</h5>
<div class="sect5">
<h6 id="_creating_a_builder_tbd">Creating a builder (TBD)</h6>
<div class="sect6">
<h7 id="_buildersupport_tbd">BuilderSupport (TBD)</h7>

</div>
<div class="sect6">
<h7 id="_factorybuildersupport_tbd">FactoryBuilderSupport (TBD)</h7>

</div>
</div>
<div class="sect5">
<h6 id="_existing_builders_tbd">Existing builders (TBD)</h6>
<div class="sect6">
<h7 id="_markupbuilder_tbd_assigned_to_jnorthr_1july14">MarkupBuilder (TBD) - assigned to JNorthr 1July14</h7>

</div>
<div class="sect6">
<h7 id="_streamingmarkupbuilder_tbd">StreamingMarkupBuilder (TBD)</h7>

</div>
<div class="sect6">
<h7 id="_saxbuilder_tbd">SaxBuilder (TBD)</h7>

</div>
<div class="sect6">
<h7 id="_staxbuilder_tbd">StaxBuilder (TBD)</h7>

</div>
<div class="sect6">
<h7 id="_dombuilder_tbd">DomBuilder (TBD)</h7>

</div>
<div class="sect6">
<h7 id="_nodebuilder_tbd">NodeBuilder (TBD)</h7>

</div>
<div class="sect6">
<h7 id="_jsonbuilder_tbd">JsonBuilder (TBD)</h7>

</div>
<div class="sect6">
<h7 id="_streamingjsonbuilder_tbd">StreamingJsonBuilder (TBD)</h7>

</div>
<div class="sect6">
<h7 id="_swingbuilder_tbd">SwingBuilder (TBD)</h7>

</div>
<div class="sect6">
<h7 id="_antbuilder_tbd">AntBuilder (TBD)</h7>

</div>
<div class="sect6">
<h7 id="_clibuilder_tbd">CliBuilder (TBD)</h7>

</div>
<div class="sect6">
<h7 id="_objectgraphbuilder_tbd">ObjectGraphBuilder (TBD)</h7>
<div class="paragraph">
<p>Unresolved directive in index.adoc - include::/usr/project/git/groovy-doc/subprojects/groovy-jmx/src/spec/doc/jmx.adoc[]</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_swing_uis_tbd">4.10. Creating Swing UIs (TBD)</h3>

</div>
<div class="sect2">
<h3 id="_security_tbd">4.11. Security (TBD)</h3>

</div>
<div class="sect2">
<h3 id="_design_patterns_in_groovy">4.12. Design patterns in Groovy</h3>
<div class="paragraph">
<p>Using <a href="http://en.wikipedia.org/wiki/Design_pattern_%28computer_science%29">design patterns</a> with Java is a well-established topic. Design patterns also apply to Groovy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>some patterns carry over directly (and can make use of normal Groovy syntax improvements for greater readability)</p>
</li>
<li>
<p>some patterns are no longer required because they are built right into the language or because Groovy supports a better way of achieving the intent of the pattern</p>
</li>
<li>
<p>some patterns that have to be expressed at the design level in other languages can be implemented directly in Groovy (due to the way Groovy can blur the distinction between design and implementation)</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_patterns">4.12.1. Patterns</h4>
<div class="sect4">
<h5 id="_abstract_factory_pattern">Abstract Factory Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Abstract_factory_pattern">Abstract Factory Pattern</a> provides a way to encapsulate a group of individual factories that have a common theme. It embodies the intent of a normal factory, i.e. remove the need for code using an interface to know the concrete implementation behind the interface, but applies to a set of interfaces and selects an entire family of concrete classes which implement those interfaces.</p>
</div>
<div class="paragraph">
<p>As an example, I might have interfaces Button, TextField and Scrollbar. I might have WindowsButton, MacButton, FlashButton as concrete classes for Button. I might have WindowsScrollBar, MacScrollBar and FlashScrollBar as concrete implementations for ScrollBar. Using the Abstract Factory Pattern should allow me to select which windowing system (i.e. Windows, Mac, Flash) I want to use once and from then on should be able to write code that references the interfaces but is always using the appropriate concrete classes (all from the one windowing system) under the covers.</p>
</div>
<div class="sect5">
<h6 id="_example">Example</h6>
<div class="paragraph">
<p>Suppose we want to write a game system. We might note that many games have very similar features and control.</p>
</div>
<div class="paragraph">
<p>We decide to try to split the common and game-specific code into separate classes.</p>
</div>
<div class="paragraph">
<p>First let&#8217;s look at the game-specific code for a <a href="http://en.wikipedia.org/wiki/Two-Up">Two-up</a> game:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class TwoupMessages {
    def welcome = 'Welcome to the twoup game, you start with $1000'
    def done = 'Sorry, you have no money left, goodbye'
}

class TwoupInputConverter {
    def convert(input) { input.toInteger() }
}

class TwoupControl {
    private money = 1000
    private random = new Random()
    private tossWasHead() {
        def next = random.nextInt()
        return next % 2 == 0
    }
    def moreTurns() {
        if (money &gt; 0) {
            println "You have $money, how much would you like to bet?"
            return true
        }

        false
    }
    def play(amount) {
        def coin1 = tossWasHead()
        def coin2 = tossWasHead()
        if (coin1 &amp;&amp; coin2) {
            money += amount
            println 'You win'
        } else if (!coin1 &amp;&amp; !coin2) {
            money -= amount
            println 'You lose'
        } else {
            println 'Draw'
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s look at the game-specific code for a number guessing game:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class GuessGameMessages {
    def welcome = 'Welcome to the guessing game, my secret number is between 1 and 100'
    def done = 'Correct'
}

class GuessGameInputConverter {
    def convert(input) { input.toInteger() }
}

class GuessGameControl {
    private lower = 1
    private upper = 100
    private guess = new Random().nextInt(upper - lower) + lower
    def moreTurns() {
        def done = (lower == guess || upper == guess)
        if (!done) {
            println "Enter a number between $lower and $upper"
        }

        !done
    }
    def play(nextGuess) {
        if (nextGuess &lt;= guess) {
            lower = [lower, nextGuess].max()
        }
        if (nextGuess &gt;= guess) {
            upper = [upper, nextGuess].min()
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s write our factory code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def guessFactory = [messages: GuessGameMessages, control: GuessGameControl, converter: GuessGameInputConverter]
def twoupFactory = [messages: TwoupMessages, control: TwoupControl, converter: TwoupInputConverter]

class GameFactory {
    def static factory
    def static getMessages() { return factory.messages.newInstance() }
    def static getControl() { return factory.control.newInstance() }
    def static getConverter() { return factory.converter.newInstance() }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The important aspect of this factory is that it allows selection of an entire family of concrete classes.</p>
</div>
<div class="paragraph">
<p>Here is how we would use the factory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">GameFactory.factory = twoupFactory
def messages = GameFactory.messages
def control = GameFactory.control
def converter = GameFactory.converter
println messages.welcome
def reader = new BufferedReader(new InputStreamReader(System.in))
while (control.moreTurns()) {
    def input = reader.readLine().trim()
    control.play(converter.convert(input))
}
println messages.done</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the first line configures which family of concrete game classes we will use. It&#8217;s not important that we selected which family to use by using the factory property as shown in the first line. Other ways would be equally valid examples of this pattern. For example, we may have asked the user which game they wanted to play or determined which game from an environment setting.</p>
</div>
<div class="paragraph">
<p>With the code as shown, the game might look like this when run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Welcome to the twoup game, you start with $1000
You have 1000, how much would you like to bet?
300
Draw
You have 1000, how much would you like to bet?
700
You win
You have 1700, how much would you like to bet?
1700
You lose
Sorry, you have no money left, goodbye</pre>
</div>
</div>
<div class="paragraph">
<p>If we change the first line of the script to <code>GameFactory.factory = guessFactory</code>, then the sample run might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Welcome to the guessing game, my secret number is between 1 and 100
Enter a number between 1 and 100
75
Enter a number between 1 and 75
35
Enter a number between 1 and 35
15
Enter a number between 1 and 15
5
Enter a number between 5 and 15
10
Correct</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_adapter_pattern">Adapter Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Adapter_pattern">Adapter Pattern</a> (sometimes called the wrapper pattern) allows objects satisfying one interface to be used where another type of interface is expected. There are two typical flavours of the pattern: the <em>delegation</em> flavour and the <em>inheritance</em> flavour.</p>
</div>
<div class="sect5">
<h6 id="_delegation_example">Delegation Example</h6>
<div class="paragraph">
<p>Suppose we have the following classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class SquarePeg {
    def width
}

class RoundPeg {
    def radius
}

class RoundHole {
    def radius
    def pegFits(peg) {
        peg.radius &lt;= radius
    }
    String toString() { "RoundHole with radius $radius" }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can ask the <code>RoundHole</code> class if a <code>RoundPeg</code> fits in it, but if we ask the same question for a <code>SquarePeg</code>, then it will fail because the <code>SquarePeg</code> class doesn&#8217;t have a <code>radius</code> property (i.e. doesn&#8217;t satisfy the required interface).</p>
</div>
<div class="paragraph">
<p>To get around this problem, we can create an adapter to make it appear to have the correct interface. It would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class SquarePegAdapter {
    def peg
    def getRadius() {
        Math.sqrt(((peg.width / 2) ** 2) * 2)
    }
    String toString() {
        "SquarePegAdapter with peg width $peg.width (and notional radius $radius)"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the adapter like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def hole = new RoundHole(radius: 4.0)
(4..7).each { w -&gt;
    def peg = new SquarePegAdapter(peg: new SquarePeg(width: w))
    if (hole.pegFits(peg)) {
        println "peg $peg fits in hole $hole"
    } else {
        println "peg $peg does not fit in hole $hole"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which results in the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>peg SquarePegAdapter with peg width 4 (and notional radius 2.8284271247461903) fits in hole RoundHole with radius 4.0
peg SquarePegAdapter with peg width 5 (and notional radius 3.5355339059327378) fits in hole RoundHole with radius 4.0
peg SquarePegAdapter with peg width 6 (and notional radius 4.242640687119285) does not fit in hole RoundHole with radius 4.0
peg SquarePegAdapter with peg width 7 (and notional radius 4.949747468305833) does not fit in hole RoundHole with radius 4.0</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_inheritance_example">Inheritance Example</h6>
<div class="paragraph">
<p>Let&#8217;s consider the same example again using inheritance. First, here are the original classes (unchanged):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class SquarePeg {
    def width
}

class RoundPeg {
    def radius
}

class RoundHole {
    def radius
    def pegFits(peg) {
        peg.radius &lt;= radius
    }
    String toString() { "RoundHole with radius $radius" }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An adapter using inheritance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class SquarePegAdapter extends SquarePeg {
    def getRadius() {
        Math.sqrt(((width / 2) ** 2) * 2)
    }
    String toString() {
        "SquarePegAdapter with width $width (and notional radius $radius)"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the adapter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def hole = new RoundHole(radius: 4.0)
(4..7).each { w -&gt;
    def peg = new SquarePegAdapter(peg: new SquarePeg(width: w))
    if (hole.pegFits(peg)) {
        println "peg $peg fits in hole $hole"
    } else {
        println "peg $peg does not fit in hole $hole"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>peg SquarePegAdapter with width 4 (and notional radius 2.8284271247461903) fits in hole RoundHole with radius 4.0
peg SquarePegAdapter with width 5 (and notional radius 3.5355339059327378) fits in hole RoundHole with radius 4.0
peg SquarePegAdapter with width 6 (and notional radius 4.242640687119285) does not fit in hole RoundHole with radius 4.0
peg SquarePegAdapter with width 7 (and notional radius 4.949747468305833) does not fit in hole RoundHole with radius 4.0</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_adapting_using_closures">Adapting using Closures</h6>
<div class="paragraph">
<p>As a variation of the previous examples, we could instead define the following interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">interface RoundThing {
    def getRadius()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can then define an adapter as a closure as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def adapter = {
    p -&gt; [getRadius: { Math.sqrt(((p.width / 2) ** 2) * 2) }] as RoundThing
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And use it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def peg = new SquarePeg(width: 4)
if (hole.pegFits(adapter(peg))) {
    // ... as before
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_adapting_using_the_expandometaclass">Adapting using the ExpandoMetaClass</h6>
<div class="paragraph">
<p>As of Groovy 1.1, there is a built-in MetaClass which can automatically add properties and methods dynamically.</p>
</div>
<div class="paragraph">
<p>Here is how the example would work using that feature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def peg = new SquarePeg(width: 4)
peg.metaClass.radius = Math.sqrt(((peg.width / 2) ** 2) * 2)</code></pre>
</div>
</div>
<div class="paragraph">
<p>After you create a peg object, you can simply add a property to it on the fly. No need to change the original class and no need for an adapter class.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bouncer_pattern">Bouncer Pattern</h5>
<div class="paragraph">
<p>The <a href="http://www.c2.com/cgi/wiki?BouncerPattern">Bouncer Pattern</a> describes usage of a method whose sole purpose is to either throw an exception (when particular conditions hold) or do nothing. Such methods are often used to defensively guard pre-conditions of a method.</p>
</div>
<div class="paragraph">
<p>When writing utility methods, you should always guard against faulty input arguments. When writing internal methods, you may be able to ensure that certain pre-conditions always hold by having sufficient unit tests in place. Under such circumstances, you may reduce the desirability to have guards on your methods.</p>
</div>
<div class="paragraph">
<p>Groovy differs from other languages in that you frequently use the <code>assert</code> method within your methods rather than having a large number of utility checker methods or classes.</p>
</div>
<div class="sect5">
<h6 id="_null_checking_example">Null Checking Example</h6>
<div class="paragraph">
<p>We might have a utility method such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class NullChecker {
    static check(name, arg) {
        if (arg == null) {
            throw new IllegalArgumentException(name + ' is null')
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we would use it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">void doStuff(String name, Object value) {
    NullChecker.check('name', name)
    NullChecker.check('value', value)
    // do stuff
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>But a more Groovy way to do this would simply be like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">void doStuff(String name, Object value) {
    assert name != null, 'name should not be null'
    assert value != null, 'value should not be null'
    // do stuff
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_validation_example">Validation Example</h6>
<div class="paragraph">
<p>As an alternative example, we might have this utility method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class NumberChecker {
    static final String NUMBER_PATTERN = "\\\\d+(\\\\.\\\\d+(E-?\\\\d+)?)?"
    static isNumber(str) {
        if (!str ==~ NUMBER_PATTERN) {
            throw new IllegalArgumentException("Argument '$str' must be a number")
        }
    }
    static isNotZero(number) {
        if (number == 0) {
            throw new IllegalArgumentException('Argument must not be 0')
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we would use it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def stringDivide(String dividendStr, String divisorStr) {
    NumberChecker.isNumber(dividendStr)
    NumberChecker.isNumber(divisorStr)
    def dividend = dividendStr.toDouble()
    def divisor = divisorStr.toDouble()
    NumberChecker.isNotZero(divisor)
    dividend / divisor
}

println stringDivide('1.2E2', '3.0')
// =&gt; 40.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>But with Groovy we could just as easily use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def stringDivide(String dividendStr, String divisorStr) {
    assert dividendStr =~ NumberChecker.NUMBER_PATTERN
    assert divisorStr =~ NumberChecker.NUMBER_PATTERN
    def dividend = dividendStr.toDouble()
    def divisor = divisorStr.toDouble()
    assert divisor != 0, 'Divisor must not be 0'
    dividend / divisor
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_chain_of_responsibility_pattern">Chain of Responsibility Pattern</h5>
<div class="paragraph">
<p>In the Chain of Responsibility Pattern, objects using and implementing an interface (one or more methods) are intentionally loosely coupled. A set of objects that <em>implement</em> the interface are organised in a list (or in rare cases a tree). Objects using the interface make requests from the first <em>implementor</em> object. It will decide whether to perform any action itself and whether to pass the request further down the line in the list (or tree). Sometimes a default implementation for some request is also coded into the pattern if none of the implementors respond to the request.</p>
</div>
<div class="sect5">
<h6 id="_example_2">Example</h6>
<div class="paragraph">
<p>In this example, the script sends requests to the <code>lister</code> object. The <code>lister</code> points to a <code>UnixLister</code> object. If it can&#8217;t handle the request, it sends the request to the <code>WindowsLister</code>. If it can&#8217;t handle the request, it sends the request to the <code>DefaultLister</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class UnixLister {
    private nextInLine
    UnixLister(next) { nextInLine = next }
    def listFiles(dir) {
        if (System.getProperty('os.name') == 'Linux') {
            println "ls $dir".execute().text
        } else {
            nextInLine.listFiles(dir)
        }
    }
}

class WindowsLister {
    private nextInLine
    WindowsLister(next) { nextInLine = next }
    def listFiles(dir) {
        if (System.getProperty('os.name') == 'Windows XP') {
            println "cmd.exe /c dir $dir".execute().text
        } else {
            nextInLine.listFiles(dir)
        }
    }
}

class DefaultLister {
    def listFiles(dir) {
        new File(dir).eachFile { f -&gt; println f }
    }
}

def lister = new UnixLister(new WindowsLister(new DefaultLister()))

lister.listFiles('Downloads')</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output will be a list of files (with slightly different format depending on the operating system).</p>
</div>
<div class="paragraph">
<p>Here is a UML representation:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/img/ChainOfResponsibilityClasses.gif" alt="ChainOfResponsibilityClasses">
</div>
</div>
<div class="paragraph">
<p>Variations to this pattern:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>we could have an explicit interface, e.g. <code>Lister</code>, to statically type the implementations but because of <em>duck-typing</em> this is optional</p>
</li>
<li>
<p>we could use a chain tree instead of a list, e.g. <code>if (animal.hasBackbone())</code> delegate to <code>VertebrateHandler</code> else delegate to <code>InvertebrateHandler</code></p>
</li>
<li>
<p>we could always pass down the chain even if we processed a request</p>
</li>
<li>
<p>we could decide at some point to not respond and not pass down the chain</p>
</li>
<li>
<p>we could use Groovy’s meta-programming capabilities to pass unknown methods down the chain</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_composite_pattern">Composite Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Composite_pattern">Composite Pattern</a> allows you to treat single instances of an object the same way as a group of objects. The pattern is often used with hierarchies of objects. Typically, one or more methods should be callable in the same way for either <em>leaf</em> or <em>composite</em> nodes within the hierarchy. In such a case, composite nodes typically invoke the same named method for each of their children nodes.</p>
</div>
<div class="sect5">
<h6 id="_example_3">Example</h6>
<div class="paragraph">
<p>Consider this usage of the composite pattern where we want to call <code>toString()</code> on either <code>Leaf</code> or <code>Composite</code> objects.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/img/CompositeClasses.gif" alt="CompositeClasses">
</div>
</div>
<div class="paragraph">
<p>In Java, the <code>Component</code> class is essential as it provides the type used for both leaf and composite nodes. In Groovy, because of duck-typing, we don&#8217;t need it for that purpose, however, it can still server as a useful place to place common behaviour between the leaf and composite nodes.</p>
</div>
<div class="paragraph">
<p>For our purposes, we will assemble the following hierarchy of components.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/img/CompositeComponents.gif" alt="CompositeComponents">
</div>
</div>
<div class="paragraph">
<p>Here is the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">abstract class Component {
    def name
    def toString(indent) {
        ("-" * indent) + name
    }
}

class Composite extends Component {
    private children = []
    def toString(indent) {
        def s = super.toString(indent)
        children.each { child -&gt;
            s += "\\n" + child.toString(indent + 1)
        }
        s
    }
    def leftShift(component) {
        children &lt;&lt; component
    }
}

class Leaf extends Component { }

def root = new Composite(name: "root")
root &lt;&lt; new Leaf(name: "leaf A")
def comp = new Composite(name: "comp B")
root &lt;&lt; comp
root &lt;&lt; new Leaf(name: "leaf C")
comp &lt;&lt; new Leaf(name: "leaf B1")
comp &lt;&lt; new Leaf(name: "leaf B2")
println root.toString(0)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the resulting output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>root
-leaf A
-comp B
--leaf B1
--leaf B2
-leaf C</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_decorator_pattern">Decorator Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Decorator_pattern">Decorator Pattern</a> provides a mechanism to embellish the behaviour of an object without changing its essential interface. A decorated object should be able to be substituted wherever the original (non-decorated) object was expected. Decoration typically does not involve modifying the source code of the original object and decorators should be able to be combined in flexible ways to produce objects with several embellishments.</p>
</div>
<div class="sect5">
<h6 id="_traditional_example">Traditional Example</h6>
<div class="paragraph">
<p>Suppose we have the following <code>Logger</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Logger {
    def log(String message) {
        println message
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There might be times when it is useful to timestamp a log message, or times when we might want to change the case of the message. We could try to build all of this functionality into our <code>Logger</code> class. If we did that, the <code>Logger</code> class would start to be very complex. Also, everyone would obtain all of features even when they might not want a small subset of the features. Finally, feature interaction would become quite difficult to control.</p>
</div>
<div class="paragraph">
<p>To overcome these drawbacks, we instead define two decorator classes. Uses of the <code>Logger</code> class are free to embellish their base logger with zero or more decorator classes in whatever order they desire. The classes look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class TimeStampingLogger extends Logger {
    private Logger logger
    TimeStampingLogger(logger) {
        this.logger = logger
    }
    def log(String message) {
        def now = Calendar.instance
        logger.log("$now.time: $message")
    }
}

class UpperLogger extends Logger {
    private Logger logger
    UpperLogger(logger) {
        this.logger = logger
    }
    def log(String message) {
        logger.log(message.toUpperCase())
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the decorators like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def logger = new UpperLogger(new TimeStampingLogger(new Logger()))
logger.log("G'day Mate")
// =&gt; Tue May 22 07:13:50 EST 2007: G'DAY MATE</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see that we embellish the logger behaviour with both decorators. Because of the order we chose to apply the decorators, our log message comes out capitalised and the timestamp is in normal case. If we swap the order around, let&#8217;s see what happens:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">logger = new TimeStampingLogger(new UpperLogger(new Logger()))
logger.log('Hi There')
// =&gt; TUE MAY 22 07:13:50 EST 2007: HI THERE</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the timestamp itself has also been changed to be uppercase.</p>
</div>
</div>
<div class="sect5">
<h6 id="_a_touch_of_dynamic_behaviour">A touch of dynamic behaviour</h6>
<div class="paragraph">
<p>Our previous decorators were specific to <code>Logger</code> objects. We can use Groovy&#8217;s Meta-Object Programming capabilities to create a decorator which is far more general purpose in nature. Consider this class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class GenericLowerDecorator {
    private delegate
    GenericLowerDecorator(delegate) {
        this.delegate = delegate
    }
    def invokeMethod(String name, args) {
        def newargs = args.collect { arg -&gt;
            if (arg instanceof String) {
                return arg.toLowerCase()
            } else {
                return arg
            }
        }
        delegate.invokeMethod(name, newargs)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It takes any class and decorates it so that any <code>String</code> method parameter will automatically be changed to lower case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">logger = new GenericLowerDecorator(new TimeStampingLogger(new Logger()))
logger.log('IMPORTANT Message')
// =&gt; Tue May 22 07:27:18 EST 2007: important message</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just be careful with ordering here. The original decorators were restricted to decorating <code>Logger</code> objects. This decorator work with any object type, so we can&#8217;t swap the ordering around, i.e. this won&#8217;t work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// Can't mix and match Interface-Oriented and Generic decorators
// logger = new TimeStampingLogger(new GenericLowerDecorator(new Logger()))</pre>
</div>
</div>
<div class="paragraph">
<p>We could overcome this limitation be generating an appropriate Proxy type at runtime but we won&#8217;t complicate the example here.</p>
</div>
</div>
<div class="sect5">
<h6 id="_runtime_behaviour_embellishment">Runtime behaviour embellishment</h6>
<div class="paragraph">
<p>You can also consider using the <code>ExpandoMetaClass</code> from Groovy 1.1 to dynamically embellish a class with behaviour. This isn&#8217;t the normal style of usage of the decorator pattern (it certainly isn&#8217;t nearly as flexible) but may help you to achieve similar results in some cases without creating a new class.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s what the code looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">// current mechanism to enable ExpandoMetaClass
GroovySystem.metaClassRegistry.metaClassCreationHandle = new ExpandoMetaClassCreationHandle()

def logger = new Logger()
logger.metaClass.log = { String m -&gt; println 'message: ' + m.toUpperCase() }
logger.log('x')
// =&gt; message: X</code></pre>
</div>
</div>
<div class="paragraph">
<p>This achieves a similar result to applying a single decorator but we have no way to easily apply and remove embellishments on the fly.</p>
</div>
</div>
<div class="sect5">
<h6 id="_more_dynamic_decorating">More dynamic decorating</h6>
<div class="paragraph">
<p>Suppose we have a calculator class (Actually any class would do).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Calc {
    def add(a, b) { a + b }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We might be interested in observing usage of the class over time. If it is buried deep within our codebase, it might be hard to determine when it is being called and with what parameters. Also, it might be hard to know if it is performing well. We can easily make a generic tracing decorator that prints out tracing information whenever any method on the <code>Calc</code> class is called and also provide timing information about how long it took to execute. Here is the code for the tracing decorator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class TracingDecorator {
    private delegate
    TracingDecorator(delegate) {
        this.delegate = delegate
    }
    def invokeMethod(String name, args) {
        println "Calling $name$args"
        def before = System.currentTimeMillis()
        def result = delegate.invokeMethod(name, args)
        println "Got $result in ${System.currentTimeMillis()-before} ms"
        result
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is how to use the class in a script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def tracedCalc = new TracingDecorator(new Calc())
assert 15 == tracedCalc.add(3, 12)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is what you would see after running this script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Calling add{3, 12}
Got 15 in 31 ms</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_decorating_with_an_interceptor">Decorating with an Interceptor</h6>
<div class="paragraph">
<p>The above timing example hooks into the lifecycle of Groovy objects (via <code>invokeMethod</code>). This is such an important style performing meta-programming that Groovy has special support for this style of decorating using <em>interceptors</em>.</p>
</div>
<div class="paragraph">
<p>Groovy even comes with a built-in <code>TracingInterceptor</code>. We can extend the built-in class like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class TimingInterceptor extends TracingInterceptor {
    private beforeTime
    def beforeInvoke(object, String methodName, Object[] arguments) {
        super.beforeInvoke(object, methodName, arguments)
        beforeTime = System.currentTimeMillis()
    }
    Object afterInvoke(Object object, String methodName, Object[] arguments, Object result) {
        super.afterInvoke(object, methodName, arguments, result)
        def duration = System.currentTimeMillis() - beforeTime
        writer.write("Duration: $duration ms\\n")
        writer.flush()
        result
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of using this new class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def proxy = ProxyMetaClass.getInstance(Calc)
proxy.interceptor = new TimingInterceptor()
proxy.use {
    assert 7 == new Calc().add(1, 6)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>before Calc.ctor()
after  Calc.ctor()
Duration: 0 ms
before Calc.add(java.lang.Integer, java.lang.Integer)
after  Calc.add(java.lang.Integer, java.lang.Integer)
Duration: 2 ms</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_decorating_with_java_lang_reflect_proxy">Decorating with java.lang.reflect.Proxy</h6>
<div class="paragraph">
<p>If you are trying to decorate an object (i.e. just a particular instance of the class, not the class generally), then you can use Java&#8217;s <code>java.lang.reflect.Proxy</code>. Groovy makes working with this easier than just Java. Below is a code sample taken out of a grails project that wraps a <code>java.sql.Connection</code> so that it&#8217;s close method is a no-op:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">protected Sql getGroovySql() {
    final Connection con = session.connection()
    def invoker = { object, method, args -&gt;
        if (method.name == "close") {
            log.debug("ignoring call to Connection.close() for use by groovy.sql.Sql")
        } else {
            log.trace("delegating $method")
            return con.invokeMethod(method.name, args)
        }
    } as InvocationHandler;
    def proxy = Proxy.newProxyInstance( getClass().getClassLoader(), [Connection] as Class[], invoker )
    return new Sql(proxy)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If there were many methods to intercept, then this approach could be modified to look up closure in a map by method name and invoke it.</p>
</div>
</div>
<div class="sect5">
<h6 id="_decorating_with_spring">Decorating with Spring</h6>
<div class="paragraph">
<p>The <a href="http://www.springframework.org">Spring Framework</a> allows decorators to be applied with <em>interceptors</em> (you may have heard the terms <em>advice</em> or <em>aspect</em>). You can leverage this mechanism from Groovy as well.</p>
</div>
<div class="paragraph">
<p>First define a class that you want to decorate (we&#8217;ll also use an interface as is normal Spring practice):</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">interface Calc {
    def add(a, b)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s the class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class CalcImpl implements Calc {
    def add(a, b) { a + b }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we define our wiring in a file called <code>beans.xml</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="xml language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:lang="http://www.springframework.org/schema/lang"
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang.xsd"&gt;

    &lt;bean id="performanceInterceptor" autowire="no"
          class="org.springframework.aop.interceptor.PerformanceMonitorInterceptor"&gt;
        &lt;property name="loggerName" value="performance"/&gt;
    &lt;/bean&gt;
    &lt;bean id="calc" class="util.CalcImpl"/&gt;
    &lt;bean class="org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator"&gt;
        &lt;property name="beanNames" value="calc"/&gt;
        &lt;property name="interceptorNames" value="performanceInterceptor"/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, our script looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Grab('org.springframework:spring-context:3.2.2.RELEASE')
import org.springframework.context.support.ClassPathXmlApplicationContext

def ctx = new ClassPathXmlApplicationContext('beans.xml')
def calc = ctx.getBean('calc')
println calc.add(3, 25)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And when we run it, we see the results:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>21/05/2007 23:02:35 org.springframework.aop.interceptor.PerformanceMonitorInterceptor invokeUnderTrace
FINEST: StopWatch 'util.Calc.add': running time (millis) = 16</pre>
</div>
</div>
<div class="paragraph">
<p>You may have to adjust your <code>logging.properties</code> file for messages at log level <code>FINEST</code> to be displayed.</p>
</div>
</div>
<div class="sect5">
<h6 id="_asynchronous_decorators_using_gpars">Asynchronous Decorators using GPars</h6>
<div class="paragraph">
<p>Using the example code in <a href="http://www.cs.iastate.edu/~design/projects/panini/docs/starting.shtml">Panini</a> for inspiration. Here is a Groovy version that avoids using an <code>@AddedBehavior</code> annotation at the expense of not having as general an algorithm for selecting the methods to decorate. This isn&#8217;t a limitation of the particular approach chosen but just a simplification for illustrative purposes (but don&#8217;t assume below is an exact equivalent).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Grab('org.codehaus.gpars:gpars:0.10')
import static groovyx.gpars.GParsPool.withPool

interface Document {
    void print()
    String getText()
}

class DocumentImpl implements Document {
    def document
    void print() { println document }
    String getText() { document }
}

def words(String text) {
    text.replaceAll('[^a-zA-Z]', ' ').trim().split("\\\\s+")*.toLowerCase()
}

def avgWordLength = {
    def words = words(it.text)
    sprintf "Avg Word Length: %4.2f", words*.size().sum() / words.size()
}
def modeWord = {
    def wordGroups = words(it.text).groupBy {it}.collectEntries { k, v -&gt; [k, v.size()] }
    def maxSize = wordGroups*.value.max()
    def maxWords = wordGroups.findAll { it.value == maxSize }
    "Mode Word(s): ${maxWords*.key.join(', ')} ($maxSize occurrences)"
}
def wordCount = { d -&gt; "Word Count: " + words(d.text).size() }

def asyncDecorator(Document d, Closure c) {
    ProxyGenerator.INSTANCE.instantiateDelegate([print: {
        withPool {
            def result = c.callAsync(d)
            d.print()
            println result.get()
        }
    }], [Document], d)
}

Document d = asyncDecorator(asyncDecorator(asyncDecorator(
        new DocumentImpl(document:"This is the file with the words in it\\n\\t\\nDo you see the words?\\n"),
//        new DocumentImpl(document: new File('AsyncDecorator.groovy').text),
        wordCount), modeWord), avgWordLength)
d.print()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_delegation_pattern">Delegation Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Delegation_pattern">Delegation Pattern</a> is a technique where an object&#8217;s behavior (public methods) is implemented by delegating responsibility to one or more associated objects.</p>
</div>
<div class="paragraph">
<p>Groovy allows the traditional style of applying the delegation pattern, e.g. see <a href="#_replace_inheritance_with_delegation">Replace Inheritance with Delegation</a>.</p>
</div>
<div class="sect5">
<h6 id="_implement_delegation_pattern_using_expandometaclass">Implement Delegation Pattern using ExpandoMetaClass</h6>
<div class="paragraph">
<p>The <a href="http://groovy.codehaus.org/ExpandoMetaClass">ExpandoMetaClass</a> allows usage of this pattern to be encapsulated in a library. This allows Groovy to emulate similar libraries available for the Ruby language.</p>
</div>
<div class="paragraph">
<p>Consider the following library class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Delegator {
    private targetClass
    private delegate
    Delegator(targetClass, delegate) {
        this.targetClass = targetClass
        this.delegate = delegate
    }
    def delegate(String methodName) {
        delegate(methodName, methodName)
    }
    def delegate(String methodName, String asMethodName) {
        targetClass.metaClass."$asMethodName" = delegate.&amp;"$methodName"
    }
    def delegateAll(String[] names) {
        names.each { delegate(it) }
    }
    def delegateAll(Map names) {
        names.each { k, v -&gt; delegate(k, v) }
    }
    def delegateAll() {
        delegate.class.methods*.name.each { delegate(it) }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this in your classpath, you can now apply the delegation pattern dynamically as shown in the following examples. First, consider we have the following classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Person {
    String name
}

class MortgageLender {
    def borrowAmount(amount) {
       "borrow \\$$amount"
    }
    def borrowFor(thing) {
       "buy \\$thing"
    }
}

def lender = new MortgageLender()

def delegator = new Delegator(Person, lender)</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now use the <em>delegator</em> to automatically borrow methods from the <em>lender</em> object to extend the <em>Person</em> class. We can borrow the methods as is or with a rename:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">delegator.delegate 'borrowFor'
delegator.delegate 'borrowAmount', 'getMoney'

def p = new Person()

println p.borrowFor('present')   // =&gt; buy present
println p.getMoney(50)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first line above, adds the <em>borrowFor</em> method to the <em>Person</em> class by delegating to the <em>lender</em> object. The second line adds a <em>getMoney</em> method to the <em>Person</em> class by delegating to the <em>lender</em> object&#8217;s <em>borrowAmount</em> method.</p>
</div>
<div class="paragraph">
<p>Alternatively, we could borrow multiple methods like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">delegator.delegateAll 'borrowFor', 'borrowAmount'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which adds these two methods to the <em>Person</em> class.</p>
</div>
<div class="paragraph">
<p>Or if we want all the methods, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">delegator.delegateAll()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which will make all the methods in the delegate object available in the <em>Person</em> class.</p>
</div>
<div class="paragraph">
<p>Alternatively, we can use a map notation to rename multiple methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">delegator.delegateAll borrowAmount:'getMoney', borrowFor:'getThing'</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_implement_delegation_pattern_using_delegate_annotation">Implement Delegation Pattern using @Delegate annotation</h6>
<div class="paragraph">
<p>Since version 1.6 you can use the built-in delegation mechanism which is based on AST transformation.</p>
</div>
<div class="paragraph">
<p>This make delegation even easier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Person {
    def name
    @Delegate MortgageLender mortgageLender = new MortgageLender()
}

class MortgageLender {
    def borrowAmount(amount) {
       "borrow \\$$amount"
    }
    def borrowFor(thing) {
       "buy $thing"
    }
}

def p = new Person()

assert "buy present" == p.borrowFor('present')
assert "borrow \\$50" == p.borrowAmount(50)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_flyweight_pattern">Flyweight Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Flyweight_pattern">Flyweight Pattern</a> is a pattern for greatly reducing memory requirements by not requiring that heavy-weight objects be created in large numbers when dealing with systems that contain many things that are mostly the same. If for instance, a document was modeled using a complex character class that knew about unicode, fonts, positioning, etc., then the memory requirements could be quite large for large documents if each physical character in the document required its own character class instance. Instead, characters themselves might be kept within Strings and we might have one character class (or a small number such as one character class for each font type) that knew the specifics of how to deal with characters.</p>
</div>
<div class="paragraph">
<p>In such circumstances, we call the state that is shared with many other things (e.g. the character type) <em>instrinsic</em> state. It is captured within the heavy-weight class. The state which distinguishes the physical character (maybe just its ASCII code or Unicode) is called its <em>extrinsic</em> state.</p>
</div>
<div class="sect5">
<h6 id="_example_4">Example</h6>
<div class="paragraph">
<p>First we are going to model some complex aircraft (the first being a hoax competitor of the second - not that is relevant to the example).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Boeing797 {
    def wingspan = '80.8 m'
    def capacity = 1000
    def speed = '1046 km/h'
    def range = '14400 km'
    // ...
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/img/b797-hoax.jpg" alt="b797 hoax">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Airbus380 {
    def wingspan = '79.8 m'
    def capacity = 555
    def speed = '912 km/h'
    def range = '10370 km'
    // ...
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/img/a380.jpg" alt="a380">
</div>
</div>
<div class="paragraph">
<p>If we want to model our fleet, our first attempt might involve using many instances of these heavy-weight objects. It turns out though that only a few small pieces of state (our extrinsic state) change for each aircraft, so we will have singletons for the heavy-weight objects and capture the extrinsic state (bought date and asset number in the code below) separately.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class FlyweightFactory {
    static instances = [797: new Boeing797(), 380: new Airbus380()]
}

class Aircraft {
    private type         // instrinsic state
    private assetNumber  // extrinsic state
    private bought       // extrinsic state
    Aircraft(typeCode, assetNumber, bought) {
        type = FlyweightFactory.instances[typeCode]
        this.assetNumber = assetNumber
        this.bought = bought
    }
    def describe() {
        println """
        Asset Number: $assetNumber
        Capacity: $type.capacity people
        Speed: $type.speed
        Range: $type.range
        Bought: $bought
        """
    }
}

def fleet = [
    new Aircraft(380, 1001, '10-May-2007'),
    new Aircraft(380, 1002, '10-Nov-2007'),
    new Aircraft(797, 1003, '10-May-2008'),
    new Aircraft(797, 1004, '10-Nov-2008')
]

fleet.each { p -&gt; p.describe() }</code></pre>
</div>
</div>
<div class="paragraph">
<p>So here, even if our fleet contained hundreds of planes, we would only have one heavy-weight object for each type of aircraft.</p>
</div>
<div class="paragraph">
<p>As a further efficiency measure, we might use lazy creation of the flyweight objects rather than create the initial map up front as in the above example.</p>
</div>
<div class="paragraph">
<p>Running this script results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Asset Number: 1001
Capacity: 555 people
Speed: 912 km/h
Range: 10370 km
Bought: 10-May-2007

Asset Number: 1002
Capacity: 555 people
Speed: 912 km/h
Range: 10370 km
Bought: 10-Nov-2007

Asset Number: 1003
Capacity: 1000 people
Speed: 1046 km/h
Range: 14400 km
Bought: 10-May-2008

Asset Number: 1004
Capacity: 1000 people
Speed: 1046 km/h
Range: 14400 km
Bought: 10-Nov-2008</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_iterator_pattern">Iterator Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Iterator_pattern">Iterator Pattern</a> allows sequential access to the elements of an aggregate object without exposing its underlying representation.</p>
</div>
<div class="paragraph">
<p>Groovy has the iterator pattern built right in to many of its closure operators, e.g. <code>each</code> and <code>eachWithIndex</code> as well as the <code>for .. in</code> loop.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def printAll(container) {
    for (item in container) { println item }
}

def numbers = [ 1,2,3,4 ]
def months = [ Mar:31, Apr:30, May:31 ]
def colors = [ java.awt.Color.BLACK, java.awt.Color.WHITE ]
printAll numbers
printAll months
printAll colors</code></pre>
</div>
</div>
<div class="paragraph">
<p>Results in the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1
2
3
4
May=31
Mar=31
Apr=30
java.awt.Color[r=0,g=0,b=0]
java.awt.Color[r=255,g=255,b=255]</pre>
</div>
</div>
<div class="paragraph">
<p>Another example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">colors.eachWithIndex { item, pos -&gt;
    println "Position $pos contains '$item'"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Position 0 contains 'java.awt.Color[r=0,g=0,b=0]'
Position 1 contains 'java.awt.Color[r=255,g=255,b=255]'</pre>
</div>
</div>
<div class="paragraph">
<p>The iterator pattern is also built in to other special operators such as the <code>eachByte</code>, <code>eachFile</code>, <code>eachDir</code>, <code>eachLine</code>, <code>eachObject</code>, <code>eachMatch</code> operators for working with streams, URLs, files, directories and regular expressions matches.</p>
</div>
</div>
<div class="sect4">
<h5 id="_loan_my_resource_pattern">Loan my Resource Pattern</h5>
<div class="paragraph">
<p>The <a href="https://wiki.scala-lang.org/display/SYGN/Loan">Loan my Resource</a> pattern ensures that a resource is deterministically disposed of once it goes out of scope.</p>
</div>
<div class="paragraph">
<p>This pattern is built in to many Groovy helper methods. You should consider using it yourself if you need to work with resources in ways beyond what Groovy supports.</p>
</div>
<div class="sect5">
<h6 id="_example_5">Example</h6>
<div class="paragraph">
<p>Consider the following code which works with a file. First we might write some line to the file and then print its size:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def f = new File('junk.txt')
f.withPrintWriter { pw -&gt;
    pw.println(new Date())
    pw.println(this.class.name)
}
println f.size()
// =&gt; 42</code></pre>
</div>
</div>
<div class="paragraph">
<p>We could also read back the contents of the file a line at a time and print each line out:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">f.eachLine { line -&gt;
    println line
}
// =&gt;
// Mon Jun 18 22:38:17 EST 2007
// RunPattern</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that normal Java <code>Reader</code> and <code>PrintWriter</code> objects were used under the covers by Groovy but the code writer did not have to worry about explicitly creating or closing those resources. The built-in Groovy methods loan the respective reader or writer to the closure code and then tidy up after themselves. So, you are using this pattern without having to do any work.</p>
</div>
<div class="paragraph">
<p>Sometimes however, you wish to do things slightly differently to what you can get for free using Groovy&#8217;s built-in mechanisms. You should consider utilising this pattern within your own resource-handling operations.</p>
</div>
<div class="paragraph">
<p>Consider how you might process the list of words on each line within the file. We could actually do this one too using Groovy&#8217;s built-in functions, but bear with us and assume we have to do some resource handling ourselves. Here is how we might write the code without using this pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def reader = f.newReader()
reader.splitEachLine(' ') { wordList -&gt;
    println wordList
}
reader.close()
// =&gt;
// [ "Mon", "Jun", "18", "22:38:17", "EST", "2007" ]
// [ "RunPattern" ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that we now have an explicit call to <code>close()</code> in our code. If we didn&#8217;t code it just right (here we didn&#8217;t surround the code in a <code>try &#8230; finally</code> block, we run the risk of leaving the file handle open.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s now apply the loan pattern. First, we&#8217;ll write a helper method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def withListOfWordsForEachLine(File f, Closure c) {
    def r = f.newReader()
    try {
        r.splitEachLine(' ', c)
    } finally {
        r?.close()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we can re-write our code as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">withListOfWordsForEachLine(f) { wordList -&gt;
    println wordList
}
// =&gt;
// [ "Mon", "Jun", "18", "22:38:17", "EST", "2007" ]
// [ "RunPattern" ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is much simpler and has removed the explicit <code>close()</code>. This is now catered for in one spot so we can apply the appropriate level of testing or reviewing in just one spot to be sure we have no problems.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_null_object_pattern">Null Object Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Null_Object_pattern">Null Object Pattern</a> involves using a special object place-marker object representing null. Typically, if you have a reference to null, you can&#8217;t invoke <code>reference.field</code> or <code>reference.method()</code>. You receive the dreaded <code>NullPointerException</code>. The null object pattern uses a special object representing null, instead of using an actual <code>null</code>. This allows you to invoke field and method references on the null object. The result of using the null object should semantically be equivalent to <em>doing nothing</em>.</p>
</div>
<div class="sect5">
<h6 id="_simple_example">Simple Example</h6>
<div class="paragraph">
<p>Suppose we have the following system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Job {
    def salary
}

class Person {
    def name
    def Job job
}

def people = [
    new Person(name: 'Tom', job: new Job(salary: 1000)),
    new Person(name: 'Dick', job: new Job(salary: 1200)),
]

def biggestSalary = people.collect { p -&gt; p.job.salary }.max()
println biggestSalary</code></pre>
</div>
</div>
<div class="paragraph">
<p>When run, this prints out <code>1200</code>. Suppose now that we now invoke:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">people &lt;&lt; new Person(name: 'Harry')</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we now try to calculate <code>biggestSalary</code> again, we receive a null pointer exception.</p>
</div>
<div class="paragraph">
<p>To overcome this problem, we can introduce a <code>NullJob</code> class and change the above statement to become:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class NullJob extends Job { def salary = 0 }

people &lt;&lt; new Person(name: 'Harry', job: new NullJob())
biggestSalary = people.collect { p -&gt; p.job.salary }.max()
println biggestSalary</code></pre>
</div>
</div>
<div class="paragraph">
<p>This works as we require but it&#8217;s not always the best way to do this with Groovy. Groovy&#8217;s safe-dereference operator (<code>?.</code>) operator and null aware closures often allow Groovy to avoid the need to create a special null object or null class. This is illustrated by examining a groovier way to write the above example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">people &lt;&lt; new Person(name:'Harry')
biggestSalary = people.collect { p -&gt; p.job?.salary }.max()
println biggestSalary</code></pre>
</div>
</div>
<div class="paragraph">
<p>Two things are going on here to allow this to work. First of all, <code>max()</code> is <em>'null aware&#8217;</em> so that <code>[300, null, 400].max() == 400</code>. Secondly, with the <code>?.</code> operator, an expression like <code>p?.job?.salary</code> will be equal to null if <code>salary</code> is equal to null, or if <code>job</code> is equal to null or if <code>p</code> is equal to null. You don&#8217;t need to code a complex nested <code>if &#8230; then &#8230; else</code> to avoid a <code>NullPointerException</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_tree_example">Tree Example</h6>
<div class="paragraph">
<p>Consider the following example where we want to calculate size, cumulative sum and cumulative product of all the values in a tree structure.</p>
</div>
<div class="paragraph">
<p>Our first attempt has special logic within the calculation methods to handle null values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class NullHandlingTree {
    def left, right, value

    def size() {
        1 + (left ? left.size() : 0) + (right ? right.size() : 0)
    }

    def sum() {
       value + (left ? left.sum() : 0) + (right ? right.sum() : 0)
    }

    def product() {
       value * (left ? left.product() : 1) * (right ? right.product() : 1)
    }
}

def root = new NullHandlingTree(
    value: 2,
    left: new NullHandlingTree(
        value: 3,
        right: new NullHandlingTree(value: 4),
        left: new NullHandlingTree(value: 5)
    )
)

println root.size()
println root.sum()
println root.product()</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we introduce the null object pattern (here by defining the <code>NullTree</code> class), we can now simplify the logic in the <code>size()</code>, <code>sum()</code> and <code>product()</code> methods. These methods now much more clearly represent the logic for the normal (and now universal) case. Each of the methods within <code>NullTree</code> returns a value which represents doing nothing.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Tree {
    def left = new NullTree(), right = new NullTree(), value

    def size() {
        1 + left.size() + right.size()
    }

    def sum() {
       value + left.sum() + right.sum()
    }

    def product() {
       value * left.product() * right.product()
    }
}

class NullTree {
    def size() { 0 }
    def sum() { 0 }
    def product() { 1 }
}

def root = new Tree(
    value: 2,
    left: new Tree(
        value: 3,
        right: new Tree(value: 4),
        left: new Tree(value: 5)
    )
)

println root.size()
println root.sum()
println root.product()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result of running either of these examples is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>4
14
120</pre>
</div>
</div>
<div class="paragraph">
<p>Note: a slight variation with the null object pattern is to combine it with the singleton pattern. So, we wouldn&#8217;t write <code>new NullTree()</code> wherever we needed a null object as shown above. Instead we would have a single null object instance which we would place within our data structures as needed.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_pimp_my_library_pattern">Pimp my Library Pattern</h5>
<div class="paragraph">
<p>The <a href="http://www.artima.com/weblogs/viewpost.jsp?thread=179766">Pimp my Library</a> Pattern suggests an approach for extending a library that nearly does everything that you need but just needs a little more. It assumes that you do not have source code for the library of interest.</p>
</div>
<div class="sect5">
<h6 id="_example_6">Example</h6>
<div class="paragraph">
<p>Suppose we want to make use of the built-in Integer facilities in Groovy (which build upon the features already in Java). Those libraries have nearly all of the features we want but not quite everything. We may not have all of the source code to the Groovy and Java libraries so we can&#8217;t just change the library. Instead we augment the library. Groovy has a number of ways to do this. One way is to use a Category.</p>
</div>
<div class="paragraph">
<p>First, we&#8217;ll define a suitable category.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class EnhancedInteger {
    static boolean greaterThanAll(Integer self, Object[] others) {
        greaterThanAll(self, others)
    }
    static boolean greaterThanAll(Integer self, others) {
        others.every { self &gt; it }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have added two methods which augment the Integer methods by providing the <code>greaterThanAll</code> method. Categories follow conventions where they are defined as static methods with a special first parameter representing the class we wish to extend. The <code>greaterThanAll(Integer self, others)</code> static method becomes the <code>greaterThanAll(other)</code> instance method.</p>
</div>
<div class="paragraph">
<p>We defined two versions of <code>greaterThanAll</code>. One which works for collections, ranges etc. The other which works with a variable number of <code>Integer</code> arguments.</p>
</div>
<div class="paragraph">
<p>Here is how you would use the category.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">use(EnhancedInteger) {
    assert 4.greaterThanAll(1, 2, 3)
    assert !5.greaterThanAll(2, 4, 6)
    assert 5.greaterThanAll(-4..4)
    assert 5.greaterThanAll([])
    assert !5.greaterThanAll([4, 5])
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, using this technique you can effectively enrich an original class without having access to its source code. Moreover, you can apply different enrichments in different parts of the system as well as work with un-enriched objects if we need to.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_proxy_pattern">Proxy Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Proxy_pattern">Proxy Pattern</a> allows one object to act as a pretend replacement for some other object. In general, whoever is using the proxy, doesn&#8217;t realise that they are not using the real thing. The pattern is useful when the real object is hard to create or use: it may exist over a network connection, or be a large object in memory, or be a file, database or some other resource that is expensive or impossible to duplicate.</p>
</div>
<div class="sect5">
<h6 id="_example_7">Example</h6>
<div class="paragraph">
<p>One common use of the proxy pattern is when talking to remote objects in a different JVM. Here is the client code for creating a proxy that talks via sockets to a server object as well as an example usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class AccumulatorProxy {
    def accumulate(args) {
        def result
        def s = new Socket("localhost", 54321)
        s.withObjectStreams { ois, oos -&gt;
            oos &lt;&lt; args
            result = ois.readObject()
        }
        s.close()
        return result
    }
}

println new AccumulatorProxy().accumulate([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])
// =&gt; 55</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is what your server code might look like (start this first):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Accumulator {
    def accumulate(args) {
        args.inject(0) { total, arg -&gt; total += arg }
    }
}

def port = 54321
def accumulator = new Accumulator()
def server = new ServerSocket(port)
println "Starting server on port $port"
while(true) {
    server.accept() { socket -&gt;
        socket.withObjectStreams { ois, oos -&gt;
            def args = ois.readObject()
            oos &lt;&lt; accumulator.accumulate(args)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_singleton_pattern">Singleton Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Singleton_pattern">Singleton Pattern</a> is used to make sure only one object of a particular class is ever created. This can be useful when when exactly one object is needed to coordinate actions across a system; perhaps for efficiency where creating lots of identical objects would be wasteful, perhaps because a particular algorithm needing a single point of control is required or perhaps when an object is used to interact with a non-shareable resource.</p>
</div>
<div class="paragraph">
<p>Weaknesses of the Singleton pattern include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It can reduce reuse. For instance, there are issues if you want to use inheritance with Singletons. If <code>SingletonB</code> extends <code>SingletonA</code>, should there be exactly (at most) one instance of each or should the creation of an object from one of the classes prohibit creation from the other. Also, if you decide both classes can have an instance, how do you override the <code>getInstance()</code> method which is static?</p>
</li>
<li>
<p>It is also hard to test singletons in general because of the static methods but Groovy can support that if required.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_example_the_classic_java_singleton">Example: The Classic Java Singleton</h6>
<div class="paragraph">
<p>Suppose we wish to create a class for collecting votes. Because getting the right number of votes may be very important, we decide to use the singleton pattern. There will only ever be one <code>VoteCollector</code> object, so it makes it easier for us to reason about that objects creation and use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class VoteCollector {
    def votes = 0
    private static final INSTANCE = new VoteCollector()
    static getInstance() { return INSTANCE }
    private VoteCollector() { }
    def display() { println "Collector:${hashCode()}, Votes:$votes" }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some points of interest about this code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it has a private constructor, so no <code>VoteCollector</code> objects can be created in our system (except for the <code>INSTANCE</code> we create)</p>
</li>
<li>
<p>the <code>INSTANCE</code> is also private, so it can&#8217;t be changed once set</p>
</li>
<li>
<p>we haven&#8217;t made the updating of votes thread-safe at this point (it doesn&#8217;t add to this example)</p>
</li>
<li>
<p>the vote collector instance is not lazyily created (if we never reference the class, the instance won&#8217;t be created; however, as soon as we reference the class, the instance will be created even if not needed initially)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We can use this singleton class in some script code as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def collector = VoteCollector.instance
collector.display()
collector.votes++
collector = null

Thread.start{
    def collector2 = VoteCollector.instance
    collector2.display()
    collector2.votes++
    collector2 = null
}.join()

def collector3 = VoteCollector.instance
collector3.display()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we used the instance 3 times. The second usage was even in a different thread (but don&#8217;t try this in a scenario with a new class loader).</p>
</div>
<div class="paragraph">
<p>Running this script yields (your hashcode value will vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Collector:15959960, Votes:0
Collector:15959960, Votes:1
Collector:15959960, Votes:2</pre>
</div>
</div>
<div class="paragraph">
<p>Variations to this pattern:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To support lazy-loading and multi-threading, we could just use the <code>synchronized</code> keyword with the <code>getInstance()</code> method. This has a performance hit but will work.</p>
</li>
<li>
<p>We can consider variations involving double-checked locking and the <code>volatile</code> keyword (for Java 5 and above), but see the limitations of this approach <a href="http://www.ibm.com/developerworks/java/library/j-dcl/index.html">here</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_example_singleton_via_metaprogramming">Example: Singleton via MetaProgramming</h6>
<div class="paragraph">
<p>Groovy&#8217;s meta-programming capabilities allow concepts like the singleton pattern to be enacted in a far more fundamental way. This example illustrates a simple way to use Groovy&#8217;s meta-programming capabilities to achieve the singleton pattern but not necessarily the most efficient way.</p>
</div>
<div class="paragraph">
<p>Suppose we want to keep track of the total number of calculations that a calculator performs. One way to do that is to use a singleton for the calculator class and keep a variable in the class with the count.</p>
</div>
<div class="paragraph">
<p>First we define some base classes. A <code>Calculator</code> class which performs calculations and records how many such calculations it performs and a <code>Client</code> class which acts as a facade to the calculator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Calculator {
    private total = 0
    def add(a, b) { total++; a + b }
    def getTotalCalculations() { 'Total Calculations: ' + total }
    String toString() { 'Calc: ' + hashCode() }
}

class Client {
    def calc = new Calculator()
    def executeCalc(a, b) { calc.add(a, b) }
    String toString() { 'Client: ' + hashCode() }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can define and register a <em>MetaClass</em> which intercepts all attempts to create a <code>Calculator</code> object and always provides a pre-created instance instead. We also register this MetaClass with the Groovy system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class CalculatorMetaClass extends MetaClassImpl {
    private final static INSTANCE = new Calculator()
    CalculatorMetaClass() { super(Calculator) }
    def invokeConstructor(Object[] arguments) { return INSTANCE }
}

def registry = GroovySystem.metaClassRegistry
registry.setMetaClass(Calculator, new CalculatorMetaClass())</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we use instances of our <code>Client</code> class from within a script. The client class will attempt to create new instances of the calculator but will always get the singleton.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def client = new Client()
assert 3 == client.executeCalc(1, 2)
println "$client, $client.calc, $client.calc.totalCalculations"

client = new Client()
assert 4 == client.executeCalc(2, 2)
println "$client, $client.calc, $client.calc.totalCalculations"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the result of running this script (your hashcode values may vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Client: 7306473, Calc: 24230857, Total Calculations: 1
Client: 31436753, Calc: 24230857, Total Calculations: 2</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_guice_example">Guice Example</h6>
<div class="paragraph">
<p>We can also implement the Singleton Pattern using <a href="http://code.google.com/p/google-guice/">Guice</a>. This example relies on annotations. Annotations are a Groovy 1.1 feature and will need to be run on a Java 5 or above JVM.</p>
</div>
<div class="paragraph">
<p>Consider the Calculator example again.</p>
</div>
<div class="paragraph">
<p>Guice is a Java-oriented framework that supports Interface-Oriented design. Hence we create a <code>Calculator</code> interface first. We can then create our <code>CalculatorImpl</code> implementation and a <code>Client</code> object which our script will interact with. The <code>Client</code> class isn&#8217;t strictly needed for this example but allows us to show that non-singleton instances are the default. Here is the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Grapes([@Grab('aopalliance:aopalliance:1.0'), @Grab('com.google.code.guice:guice:1.0')])
import com.google.inject.*

interface Calculator {
    def add(a, b)
}

class CalculatorImpl implements Calculator {
    private total = 0
    def add(a, b) { total++; a + b }
    def getTotalCalculations() { 'Total Calculations: ' + total }
    String toString() { 'Calc: ' + hashCode() }
}

class Client {
    @Inject Calculator calc
    def executeCalc(a, b) { calc.add(a, b) }
    String toString() { 'Client: ' + hashCode() }
}

def injector = Guice.createInjector (
    [configure: { binding -&gt;
        binding.bind(Calculator)
               .to(CalculatorImpl)
               .asEagerSingleton() } ] as Module
)

def client = injector.getInstance(Client)
assert 3 == client.executeCalc(1, 2)
println "$client, $client.calc, $client.calc.totalCalculations"

client = injector.getInstance(Client)
assert 4 == client.executeCalc(2, 2)
println "$client, $client.calc, $client.calc.totalCalculations"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>@Inject</code> annotation in the <code>Client</code> class. We can always tell right in the source code which fields will be injected.</p>
</div>
<div class="paragraph">
<p>In this example we chose to use an <em>explicit</em> binding. All of our dependencies (ok, only one in this example at the moment) are configured in the binding. The Guide injector knows about the binding and injects the dependencies as required when we create objects. For the singleton pattern to hold, you must always use Guice to create your instances. Nothing shown so far would stop you creating another instance of the calculator manually using <code>new CalculatorImpl()</code> which would of course violate the desired singleton behaviour.</p>
</div>
<div class="paragraph">
<p>In other scenarios (though probably not in large systems), we could choose to express dependencies using annotations, such as the following example shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Grapes([@Grab('aopalliance:aopalliance:1.0'), @Grab('com.google.code.guice:guice:1.0')])
import com.google.inject.*

@ImplementedBy(CalculatorImpl)
interface Calculator {
    // as before ...
}

@Singleton
class CalculatorImpl implements Calculator {
    // as before ...
}

class Client {
    // as before ...
}

def injector = Guice.createInjector()

// ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>@Singleton</code> annotation on the <code>CalculatorImpl</code> class and the <code>@ImplementedBy</code> annotation in the <code>Calculator</code> interface.</p>
</div>
<div class="paragraph">
<p>When run, the above example (using either approach) yields (your hashcode values will vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Client: 8897128, Calc: 17431955, Total Calculations: 1
Client: 21145613, Calc: 17431955, Total Calculations: 2</pre>
</div>
</div>
<div class="paragraph">
<p>You can see that we obtained a new client object whenever we asked for an instance but it was injected with the same calculator object.</p>
</div>
</div>
<div class="sect5">
<h6 id="_spring_example">Spring Example</h6>
<div class="paragraph">
<p>We can do the Calculator example again using Spring as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">@Grapes([@Grab('org.springframework:spring-core:3.2.2.RELEASE'), @Grab('org.springframework:spring-beans:3.2.2.RELEASE')])
import org.springframework.beans.factory.support.*

interface Calculator {
    def add(a, b)
}

class CalculatorImpl implements Calculator {
    private total = 0
    def add(a, b) { total++; a + b }
    def getTotalCalculations() { 'Total Calculations: ' + total }
    String toString() { 'Calc: ' + hashCode() }
}

class Client {
    Client(Calculator calc) { this.calc = calc }
    def calc
    def executeCalc(a, b) { calc.add(a, b) }
    String toString() { 'Client: ' + hashCode() }
}

// Here we 'wire' up our dependencies through the API. Alternatively,
// we could use XML-based configuration or the Grails Bean Builder DSL.
def factory = new DefaultListableBeanFactory()
factory.registerBeanDefinition('calc', new RootBeanDefinition(CalculatorImpl))
def beanDef = new RootBeanDefinition(Client, false)
beanDef.setAutowireMode(AbstractBeanDefinition.AUTOWIRE_AUTODETECT)
factory.registerBeanDefinition('client', beanDef)

def client = factory.getBean('client')
assert 3 == client.executeCalc(1, 2)
println "$client, $client.calc, $client.calc.totalCalculations"

client = factory.getBean('client')
assert 4 == client.executeCalc(2, 2)
println "$client, $client.calc, $client.calc.totalCalculations"</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is the result (your hashcode values will vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Client: 29418586, Calc: 10580099, Total Calculations: 1
Client: 14800362, Calc: 10580099, Total Calculations: 2</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_further_information">Further information</h6>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.javaworld.com/javaworld/jw-04-2003/jw-0425-designpatterns.html?page=1">Simply Singleton</a></p>
</li>
<li>
<p><a href="http://www.ibm.com/developerworks/webservices/library/co-single/index.html">Use your singletons wisely</a></p>
</li>
<li>
<p><a href="http://www.ibm.com/developerworks/java/library/j-dcl/index.html">Double-checked locking and the Singleton pattern</a></p>
</li>
<li>
<p><a href="http://crazybob.org/2007/01/lazy-loading-singletons.html">Lazy Loading Singletons</a></p>
</li>
<li>
<p><a href="http://www.yoda.arachsys.com/csharp/singleton.html">Implementing the Singleton Pattern in C#</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_state_pattern">State Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/State_pattern">State Pattern</a> provides a structured approach to partitioning the behaviour within complex systems. The overall behaviour of a system is partitioned into well-defined states. Typically, each state is implemented by a class. The overall system behaviour can be determined firstly by knowing the <em>current state</em> of the system; secondly, by understanding the behaviour possible while in that state (as embodied in the methods of the class corresponding to that state).</p>
</div>
<div class="sect5">
<h6 id="_example_8">Example</h6>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Client {
    def context = new Context()
    def connect() {
        context.state.connect()
    }
    def disconnect() {
        context.state.disconnect()
    }
    def send_message(message) {
        context.state.send_message(message)
    }
    def receive_message() {
        context.state.receive_message()
    }
}

class Context {
    def state = new Offline(this)
}

class ClientState {
    def context
    ClientState(context) {
        this.context = context
        inform()
    }
}

class Offline extends ClientState {
    Offline(context) {
        super(context)
    }
    def inform() {
        println "offline"
    }
    def connect() {
        context.state = new Online(context)
    }
    def disconnect() {
        println "error: not connected"
    }
    def send_message(message) {
        println "error: not connected"
    }
    def receive_message() {
        println "error: not connected"
    }
}

class Online extends ClientState {
    Online(context) {
        super(context)
    }
    def inform() {
        println "connected"
    }
    def connect() {
        println "error: already connected"
    }
    def disconnect() {
        context.state = new Offline(context)
    }
    def send_message(message) {
        println "\"$message\" sent"
    }
    def receive_message() {
        println "message received"
    }
}

client = new Client()
client.send_message("Hello")
client.connect()
client.send_message("Hello")
client.connect()
client.receive_message()
client.disconnect()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>offline
error: not connected
connected
"Hello" sent
error: already connected
message received
offline</pre>
</div>
</div>
<div class="paragraph">
<p>One of the great things about a dynamic language like Groovy though is that we can take this example and express it in many different ways depending on our particular needs. Some potential variations for this example are shown below.</p>
</div>
</div>
<div class="sect5">
<h6 id="_variation_1_leveraging_interface_oriented_design">Variation 1: Leveraging Interface-Oriented Design</h6>
<div class="paragraph">
<p>One approach we could take is to leverage <a href="http://www.pragmaticprogrammer.com/titles/kpiod/index.html">Interface-Oriented Design</a>. To do this, we could introduce the following interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">interface State {
    def connect()
    def disconnect()
    def send_message(message)
    def receive_message()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then our <code>Client</code>, <code>Online</code> and <code>Offline</code> classes could be modified to implement that interface, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Client implements State {
  // ... as before ...
}

class Online implements State {
  // ... as before ...
}

class Offline implements State {
  // ... as before ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You might ask: Haven&#8217;t we just introduced additional boilerplate code? Can&#8217;t we rely on duck-typing for this? The answer is <em>yes</em> and <em>no</em>. We can get away with duck-typing but one of the key intentions of the state pattern is to partition complexity. If we know that the <em>client</em> class and each <em>state</em> class all satisfy one interface, then we have placed some key boundaries around the complexity. We can look at any state class in isolation and know the bounds of behaviour possible for that state.</p>
</div>
<div class="paragraph">
<p>We don&#8217;t have to use interfaces for this, but it helps express the intent of this particular style of partitioning and it helps reduce the size of our unit tests (we would have to have additional tests in place to express this intent in languages which have less support for interface-oriented design).</p>
</div>
</div>
<div class="sect5">
<h6 id="_variation_2_extract_state_pattern_logic">Variation 2: Extract State Pattern Logic</h6>
<div class="paragraph">
<p>Alternatively, or in combination with other variations, we might decide to extract some of our State Pattern logic into helper classes. For example, we could define the following classes in a state pattern package/jar/script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">abstract class InstanceProvider {
    static def registry = GroovySystem.metaClassRegistry
    static def create(objectClass, param) {
        registry.getMetaClass(objectClass).invokeConstructor([param] as Object[])
    }
}

abstract class Context {
    private context
    protected setContext(context) {
        this.context = context
    }
    def invokeMethod(String name, Object arg) {
        context.invokeMethod(name, arg)
    }
    def startFrom(initialState) {
        setContext(InstanceProvider.create(initialState, this))
    }
}

abstract class State {
    private client

    State(client) { this.client = client }

    def transitionTo(nextState) {
        client.setContext(InstanceProvider.create(nextState, client))
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is all quite generic and can be used wherever we want to introduce the state pattern. Here is what our code would look like now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Client extends Context {
    Client() {
        startFrom(Offline)
    }
}

class Offline extends State {
    Offline(client) {
        super(client)
        println "offline"
    }
    def connect() {
        transitionTo(Online)
    }
    def disconnect() {
        println "error: not connected"
    }
    def send_message(message) {
        println "error: not connected"
    }
    def receive_message() {
        println "error: not connected"
    }
}

class Online extends State {
    Online(client) {
        super(client)
        println "connected"
    }
    def connect() {
        println "error: already connected"
    }
    def disconnect() {
        transitionTo(Offline)
    }
    def send_message(message) {
        println "\"$message\" sent"
    }
    def receive_message() {
        println "message received"
    }
}

client = new Client()
client.send_message("Hello")
client.connect()
client.send_message("Hello")
client.connect()
client.receive_message()
client.disconnect()</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see here the <code>startFrom</code> and <code>transitionTo</code> methods begin to give our example code a DSL feel.</p>
</div>
</div>
<div class="sect5">
<h6 id="_variation_3_bring_on_the_dsl">Variation 3: Bring on the DSL</h6>
<div class="paragraph">
<p>Alternatively, or in combination with other variations, we might decide to fully embrace a Domain Specific Language (DSL) approach to this example.</p>
</div>
<div class="paragraph">
<p>We can define the following generic helper functions (first discussed <a href="http://www.bytemycode.com/snippets/snippet/640/">here</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class Grammar {
    def fsm

    def event
    def fromState
    def toState

    Grammar(a_fsm) {
        fsm = a_fsm
    }

    def on(a_event) {
        event = a_event
        this
    }

    def on(a_event, a_transitioner) {
        on(a_event)
        a_transitioner.delegate = this
        a_transitioner.call()
        this
    }

    def from(a_fromState) {
        fromState = a_fromState
        this
    }

    def to(a_toState) {
        assert a_toState, "Invalid toState: $a_toState"
        toState = a_toState
        fsm.registerTransition(this)
        this
    }

    def isValid() {
        event &amp;&amp; fromState &amp;&amp; toState
    }

    public String toString() {
        "$event: $fromState=&gt;$toState"
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class FiniteStateMachine {
    def transitions = [:]

    def initialState
    def currentState

    FiniteStateMachine(a_initialState) {
        assert a_initialState, "You need to provide an initial state"
        initialState = a_initialState
        currentState = a_initialState
    }

    def record() {
        Grammar.newInstance(this)
    }

    def reset() {
        currentState = initialState
    }

    def isState(a_state) {
        currentState == a_state
    }

    def registerTransition(a_grammar) {
        assert a_grammar.isValid(), "Invalid transition ($a_grammar)"
        def transition
        def event = a_grammar.event
        def fromState = a_grammar.fromState
        def toState = a_grammar.toState

        if (!transitions[event]) {
            transitions[event] = [:]
        }

        transition = transitions[event]
        assert !transition[fromState], "Duplicate fromState $fromState for transition $a_grammar"
        transition[fromState] = toState
    }

    def fire(a_event) {
        assert currentState, "Invalid current state '$currentState': passed into constructor"
        assert transitions.containsKey(a_event), "Invalid event '$a_event', should be one of ${transitions.keySet()}"
        def transition = transitions[a_event]
        def nextState = transition[currentState]
        assert nextState, "There is no transition from '$currentState' to any other state"
        currentState = nextState
        currentState
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can define and test our state machine like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class StatePatternDslTest extends GroovyTestCase {
    private fsm

    protected void setUp() {
        fsm = FiniteStateMachine.newInstance('offline')
        def recorder = fsm.record()
        recorder.on('connect').from('offline').to('online')
        recorder.on('disconnect').from('online').to('offline')
        recorder.on('send_message').from('online').to('online')
        recorder.on('receive_message').from('online').to('online')
    }

    void testInitialState() {
        assert fsm.isState('offline')
    }

    void testOfflineState() {
        shouldFail{
            fsm.fire('send_message')
        }
        shouldFail{
            fsm.fire('receive_message')
        }
        shouldFail{
            fsm.fire('disconnect')
        }
        assert 'online' == fsm.fire('connect')
    }

    void testOnlineState() {
        fsm.fire('connect')
        fsm.fire('send_message')
        fsm.fire('receive_message')
        shouldFail{
            fsm.fire('connect')
        }
        assert 'offline' == fsm.fire('disconnect')
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example isn&#8217;t an exact equivalent of the others. It doesn&#8217;t use predefined <code>Online</code> and <code>Offline</code> classes. Instead it defines the entire state machine on the fly as needed. See the <a href="http://www.bytemycode.com/snippets/snippet/640/">previous reference</a> for more elaborate examples of this style.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#_model_based_testing_using_modeljunit">Model-based testing using ModelJUnit</a></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_strategy_pattern">Strategy Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Strategy_pattern">Strategy Pattern</a> allows you to abstract away particular algorithms from their usage. This allows you to easily swap the algorithm being used without having to change the calling code. The general form of the pattern is:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/img/StrategyClasses.gif" alt="StrategyClasses">
</div>
</div>
<div class="paragraph">
<p>In Groovy, because of its ability to treat code as a first class object using anonymous methods (which we loosely call <em>Closures</em>), the need for the strategy pattern is greatly reduced. You can simply place algorithms inside Closures.</p>
</div>
<div class="sect5">
<h6 id="_example_9">Example</h6>
<div class="paragraph">
<p>First let&#8217;s look at the traditional way of encapsulating the Strategy Pattern.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">interface Calc {
    def execute(n, m)
}

class CalcByMult implements Calc {
    def execute(n, m) { n * m }
}

class CalcByManyAdds implements Calc {
    def execute(n, m) {
        def result = 0
        n.times{
            result += m
        }

        result
    }
}

def sampleData = [
    [3, 4, 12],
    [5, -5, -25]
]

Calc[] multiplicationStrategies = [
    new CalcByMult(),
    new CalcByManyAdds()
]

sampleData.each{ data -&gt;
    multiplicationStrategies.each { calc -&gt;
        assert data[2] == calc.execute(data[0], data[1])
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we have defined an interface <code>Calc</code> which our concrete strategy classes will implement (we could also have used an abstract class). We then defined two algorithms for doing simple multiplication: <code>CalcByMult</code> the normal way, and <code>CalcByManyAdds</code> using only addition (don&#8217;t try this one using negative numbers - yes we could fix this but it would just make the example longer). We then use normal <a href="http://en.wikipedia.org/wiki/Polymorphism_in_object-oriented_programming">polymorphism</a> to invoke the algorithms.</p>
</div>
<div class="paragraph">
<p>Here is the Groovier way to achieve the same thing using Closures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">def multiplicationStrategies = [
    { n, m -&gt; n * m },
    { n, m -&gt; def result = 0; n.times{ result += m }; result }
]

def sampleData = [
    [3, 4, 12],
    [5, -5, -25]
]

sampleData.each{ data -&gt;
    multiplicationStrategies.each { calc -&gt;
        assert data[2] == calc(data[0], data[1])
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_template_method_pattern">Template Method Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Template_method_pattern">Template Method Pattern</a> abstracts away the details of several algorithms. The generic part of an algorithm is contained within a base class. Particular implementation details are captured within base classes. The generic pattern of classes involved looks like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/img/TemplateMethodClasses.gif" alt="TemplateMethodClasses">
</div>
</div>
<div class="sect5">
<h6 id="_example_10">Example</h6>
<div class="paragraph">
<p>In this example, <code>Accumulator</code> captures the essence of the accumulation algorithm. The base classes <code>Sum</code> and <code>Product</code> provide particular customised ways to use the generic accumulation algorithm.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">abstract class Accumulator {
    protected initial
    abstract doAccumulate(total, v)
    def accumulate(values) {
        def total = initial
        values.each { v -&gt; total = doAccumulate(total, v) }
        total
    }
}

class Sum extends Accumulator {
    def Sum() { initial = 0 }
    def doAccumulate(total, v) { total + v }
}

class Product extends Accumulator {
    def Product() { initial = 1 }
    def doAccumulate(total, v) { total * v }
}

println new Sum().accumulate([1,2,3,4])
println new Product().accumulate([1,2,3,4])</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting output is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>10
24</pre>
</div>
</div>
<div class="paragraph">
<p>In this particular case, you could use Groovy&#8217;s inject method to achieve a similar result using Closures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Closure addAll = { total, item -&gt; total += item }
def accumulated = [1, 2, 3, 4].inject(0, addAll)
println accumulated    // =&gt; 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thanks to duck-typing, this would also work with other objects which support an add (plus() in Groovy) method, e.g.:</p>
</div>
<div class="paragraph">
<p>In this particular case, you could use Groovy&#8217;s inject method to achieve a similar result using Closures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">accumulated = [ "1", "2", "3", "4" ].inject("", addAll)
println accumulated    // =&gt; "1234"</code></pre>
</div>
</div>
<div class="paragraph">
<p>We could also do the multiplication case as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">Closure multAll = { total, item -&gt; total *= item }
accumulated = [1, 2, 3, 4].inject(1, multAll)
println accumulated    // =&gt; 24</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using closures this way looks more like the <a href="#_strategy_pattern">Strategy Pattern</a> but if we realise that the built-in <code>inject</code> method is the generic part of the algorithm for our template method, then the Closures become the customised parts of the template method pattern.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_visitor_pattern">Visitor Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Visitor_pattern">Visitor Pattern</a> is one of those well-known but not often used patterns. I think this is strange, as it is really a nice thing.</p>
</div>
<div class="paragraph">
<p>The goal of the pattern is to separate an algorithm from an object structure. A practical result of this separation is the ability to add new operations to existing object structures without modifying those structures.</p>
</div>
<div class="sect5">
<h6 id="_simple_example_2">Simple Example</h6>
<div class="paragraph">
<p>This example considers how to calculate the bounds of shapes (or collections of shapes). Our first attempt uses the traditional visitor pattern. We will see a more Groovy way to do this shortly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">abstract class Shape { }

class Rectangle extends Shape {
    def x, y, width, height

    Rectangle(x, y, width, height) {
        this.x = x; this.y = y; this.width = width; this.height = height
    }

    def union(rect) {
        if (!rect) return this
        def minx = [rect.x, x].min()
        def maxx = [rect.x + width, x + width].max()
        def miny = [rect.y, y].min()
        def maxy = [rect.y + height, y + height].max()
        new Rectangle(minx, miny, maxx - minx, maxy - miny)
    }

    def accept(visitor) {
        visitor.visit_rectangle(this)
    }
}

class Line extends Shape {
    def x1, y1, x2, y2

    Line(x1, y1, x2, y2) {
        this.x1 = x1; this.y1 = y1; this.x2 = x2; this.y2 = y2
    }

    def accept(visitor){
        visitor.visit_line(this)
    }
}

class Group extends Shape {
    def shapes = []
    def add(shape) { shapes += shape }
    def remove(shape) { shapes -= shape }
    def accept(visitor) {
        visitor.visit_group(this)
    }
}

class BoundingRectangleVisitor {
    def bounds

    def visit_rectangle(rectangle) {
        if (bounds)
            bounds = bounds.union(rectangle)
        else
            bounds = rectangle
    }

    def visit_line(line) {
        def line_bounds = new Rectangle(line.x1, line.y1, line.x2-line.y1, line.x2-line.y2)
        if (bounds)
            bounds = bounds.union(line_bounds)
        else
            bounds = line_bounds
    }

    def visit_group(group) {
        group.shapes.each { shape -&gt; shape.accept(this) }
    }
}

def group = new Group()
group.add(new Rectangle(100, 40, 10, 5))
group.add(new Rectangle(100, 70, 10, 5))
group.add(new Line(90, 30, 60, 5))
def visitor = new BoundingRectangleVisitor()
group.accept(visitor)
bounding_box = visitor.bounds
println bounding_box.dump()</code></pre>
</div>
</div>
<div class="paragraph">
<p>That took quite a bit of code.</p>
</div>
<div class="paragraph">
<p>We can improve the clarity of our code (and make it about half the size) by making use of Groovy Closures as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">abstract class Shape {
    def accept(Closure yield) { yield(this) }
}

class Rectangle extends Shape {
    def x, y, w, h
    def bounds() { this }
    def union(rect) {
        if (!rect) return this
        def minx = [ rect.x, x ].min()
        def maxx = [ rect.x + w, x + w ].max()
        def miny = [ rect.y, y ].min()
        def maxy = [ rect.y + h, y + h ].max()
        new Rectangle(x:minx, y:miny, w:maxx - minx, h:maxy - miny)
    }
}

class Line extends Shape {
    def x1, y1, x2, y2
    def bounds() {
        new Rectangle(x:[x1, x2].min(), y:[y1, y2].min(), w:(x2 - x1).abs(), h:(y2 - y1).abs())
    }
}

class Group {
    def shapes = []
    def leftShift(shape) { shapes += shape }
    def accept(Closure yield) { shapes.each{it.accept(yield)} }
}

def group = new Group()
group &lt;&lt; new Rectangle(x:100, y:40, w:10, h:5)
group &lt;&lt; new Rectangle(x:100, y:70, w:10, h:5)
group &lt;&lt; new Line(x1:90, y1:30, x2:60, y2:5)
def bounds
group.accept{ bounds = it.bounds().union(bounds) }
println bounds.dump()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_advanced_example">Advanced Example</h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">interface Visitor {
    void visit(NodeType1 n1)
    void visit(NodeType2 n2)
}

interface Visitable {
    void accept(Visitor visitor)
}

class NodeType1 implements Visitable {
    Visitable[] children = new Visitable[0]
    void accept(Visitor visitor) {
        visitor.visit(this)
        for(int i = 0; i &lt; children.length; ++i) {
            children[i].accept(visitor)
        }
    }
}

class NodeType2 implements Visitable {
    Visitable[] children = new Visitable[0]
    void accept(Visitor visitor) {
        visitor.visit(this)
        for(int i = 0; i &lt; children.length; ++i) {
            children[i].accept(visitor)
        }
    }
}

class NodeType1Counter implements Visitor {
    int count = 0
    void visit(NodeType1 n1) {
        count++
    }
    void visit(NodeType2 n2){}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we now use <code>NodeType1Counter</code> on a tree like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">NodeType1 root = new NodeType1()
root.children = new Visitable[2]
root.children[0] = new NodeType1()
root.children[1] = new NodeType2()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we have one <code>NodeType1</code> object as root and one of the children is also a <code>NodeType1</code> instance. The other child is a <code>NodeType2</code> instance. That means using <code>NodeType1Counter</code> here should count 2 <code>NodeType1</code> objects.</p>
</div>
<div class="sect6">
<h7 id="_why_to_use_this">Why to use this</h7>
<div class="paragraph">
<p>As you can see here very good we have a visitor that has a state while the tree of objects is not changed. That&#8217;s pretty useful in different areas, for example you could have a visitor counting all node types, or how many different types are used, or you could use methods special to the node to gather information about the tree and much more.</p>
</div>
</div>
<div class="sect6">
<h7 id="_what_happens_if_we_add_a_new_type">What happens if we add a new type?</h7>
<div class="paragraph">
<p>In this case we have to do much work.. we have to change Visitor to accept the new type, we have to write the new type itself of course and we have to change every Visitor we have already implemented. After very few changes you will modify all your Visitors to extend a default implementation of the visitor, so you don&#8217;t need to change every Visitor each time you add a new type.</p>
</div>
</div>
<div class="sect6">
<h7 id="_what_if_we_want_to_have_different_iteration_patterns">What if we want to have different iteration patterns?</h7>
<div class="paragraph">
<p>Then you have a problem. since the node describes how to iterate, you have no influence and stop iteration at a point or change the order. So maybe we should change this a little to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">interface Visitor {
    void visit(NodeType1 n1)
    void visit(NodeType2 n2)
}

class DefaultVisitor implements Visitor{
    void visit(NodeType1 n1) {
        for(int i = 0; i &lt; n1.children.length; ++i) {
            n1.children[i].accept(this)
        }
    }
    void visit(NodeType2 n2) {
        for(int i = 0; i &lt; n2.children.length; ++i) {
            n2.children[i].accept(this)
        }
    }
}

interface Visitable {
    void accept(Visitor visitor)
}

class NodeType1 implements Visitable {
    Visitable[] children = new Visitable[0]
    void accept(Visitor visitor) {
        visitor.visit(this)
    }
}

class NodeType2 implements Visitable {
    Visitable[] children = new Visitable[0];
    void accept(Visitor visitor) {
        visitor.visit(this)
    }
}

class NodeType1Counter extends DefaultVisitor {
    int count = 0
    void visit(NodeType1 n1) {
        count++
        super.visit(n1)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some small changes but with big effect&#8230; the visitor is now recursive and tells me how to iterate. The implementation in the Nodes is minimized to <code>visitor.visit(this)</code>, <code>DefaultVisitor</code> is now able to catch the new types, we can stop iteration by not delegating to super. Of course the big disadvantage now is that it is no longer iterative, but you can&#8217;t get all the benefits.</p>
</div>
</div>
<div class="sect6">
<h7 id="_make_it_groovy">Make it Groovy</h7>
<div class="paragraph">
<p>The question now is how to make that a bit more Groovy. Didn&#8217;t you find this <code>visitor.visit(this)</code> strange? Why is it there? The answer is to simulate double dispatch. In Java the compile time type is used, so when I <code>visitor.visit(children[i])</code> then the compiler won&#8217;t be able to find the correct method, because <code>Visitor</code> does not contain a method <code>visit(Visitable)</code>. And even if it would, we would like to visit the more special methods with <code>NodeType1</code> or <code>NodeType2</code>.</p>
</div>
<div class="paragraph">
<p>Now Groovy is not using the static type, Groovy uses the runtime type. This means I could do <code>visitor.visit(children[i])</code> directly. Hmm.. since we minimized the accept method to just do the double dispatch part and since the runtime type system of Groovy will already cover that.. do we need the accept method? I think you can guess that I would answer no. But we can do more. We had the disadvantage of not knowing how to handle unknown tree elements. We had to extends the interface <code>Visitor</code> for that, resulting in changes to <code>DefaultVisitor</code> and then we have the task to provide a useful default like iterating the node or not doing anything at all. Now with Groovy we can catch that case by adding a <code>visit(Visitable)</code> method that does nothing. That would be the same in Java btw.</p>
</div>
<div class="paragraph">
<p>But don&#8217;t let us stop here&#8230; do we need the Visitor interface? If we don&#8217;t have the accept method, then we don&#8217;t need the <code>Visitor</code> interface at all. So the new code would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class DefaultVisitor {
    void visit(NodeType1 n1) {
        n1.children.each { visit(it) }
    }
    void visit(NodeType2 n2) {
        n2.children.each { visit(it) }
    }
    void visit(Visitable v) { }
}

interface Visitable { }

class NodeType1 implements Visitable {
    Visitable[] children = []
}

class NodeType2 implements Visitable {
    Visitable[] children = []
}

class NodeType1Counter extends DefaultVisitor {
    int count = 0
    void visit(NodeType1 n1) {
        count++
        super.visit(n1)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Looks like we saved a few lines of code here. But we made more. The Visitable nodes now do not refer to any <code>Visitor</code> class or interface. For me this is the best level of separation you could get here. But do we really need to stop here? No. Let us change the <code>Visitable</code> interface a little and let it return the children we want to visit next. This allows us a general iteration method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code class="groovy language-groovy">class DefaultVisitor {
    void visit(Visitable v) {
        doIteraton(v)
    }
    void doIteraton(Visitable v) {
        v.children.each {
            visit(it)
        }
    }
}

interface Visitable {
    Visitable[] getChildren()
}

class NodeType1 implements Visitable {
    Visitable[] children = []
}

class NodeType2 implements Visitable {
    Visitable[] children = []
}

class NodeType1Counter extends DefaultVisitor {
    int count = 0
    void visit(NodeType1 n1) {
        count++
        super.visit(n1)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>DefaultVisitor</code> now looks a bit different. I added a <code>doIteration</code> method that will get the children it should iterate over and then call visit on each element. Per default this will call <code>visit(Visitable)</code> which then iterates over the children of this child. I changed <code>Visitable</code> to ensure that any node will be able to return children (even if empty). I didn&#8217;t have to change the <code>NodeType1</code> and <code>NodeType2</code> class, because the way the children filed was defined already made them a property, which means Groovy is so nice to generate a get method for us. No the really interesting part is <code>NodeType1Counter</code>, it is interesting because we have not changed it. <code>super.visit(n1)</code> will now call <code>visit(Visitable)</code> which will call <code>doIteration</code> which will start the next level of iteration. So no change. But <code>visit(it)</code> will call <code>visit(NodeType1)</code> if it is of type <code>NodeType1</code>. In fact we don&#8217;t need the <code>doIteration</code> method, we could do that in <code>visit(Visitable)</code> too, but I thought this variant is better, because it allows us to write a new <code>Visitor</code> that overwrites visit(<code>Visitable</code>) for error cases which of course means we must not do <code>super.visit(n1)</code> but <code>doIteration(n1)</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_summary">Summary</h7>
<div class="paragraph">
<p>In the end we got ~40% less code, a robust and stable architecture and we completely removed the Visitor from the Visitable. I heard about visitor implementations based on Reflection to get a more generic version. Well, with this you see there is really no need to do such thing. If we add new types we don&#8217;t need to change anything. It is said that the visitor pattern doesn&#8217;t fit extreme programming techniques very well because you need to make changes to so many classes all the time. I think I proved that this is because of Java not because the pattern is bad or something.</p>
</div>
<div class="paragraph">
<p>There are variants of the Visitor pattern, like the acyclic visitor pattern, that tries to solve the problem of adding new node types with special visitors. I don&#8217;t like that very much, it works with casts, catches the <code>ClassCastException</code> and other nasty things. In the end it tries to solve something we don&#8217;t even get with the Groovy version.</p>
</div>
<div class="paragraph">
<p>One more thing. <code>NodeType1Counter</code> could be implemented in Java as well. Groovy will recognize the visit methods and call them as needed because <code>DefaultVisitor</code> is still Groovy and does all the magic.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_further_information_2">Further Information</h6>
<div class="ulist">
<ul>
<li>
<p><a href="http://se.ethz.ch/~meyer/publications/computer/visitor.pdf">Componentization: the Visitor example</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_references">4.12.2. References</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Erich Gamma, Richard Helm, Ralph Johnson, John Vlissides (1995). <em>Design Patterns: Elements of Reusable Object-Oriented Software</em>. Addison-Wesley. ISBN 0-201-63361-2.</p>
<div class="ulist">
<ul>
<li>
<p><em>The canonical reference of design patterns.</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Martin Fowler (1999). <em>Refactoring: Improving the Design of Existing Code</em>. Addison-Wesley. ISBN 0-201-48567-2.</p>
</li>
<li>
<p>Joshua Kerievsky (2004). <em>Refactoring To Patterns</em>. Addison-Wesley. ISBN 0-321-21335-1.</p>
</li>
<li>
<p>Eric Freeman, Elisabeth Freeman, Kathy Sierra, Bert Bates (2004). <em>Head First Design Patterns</em>. O’Reilly. ISBN 0-596-00712-4.
*<em>A great book to read, informative as well as amusing.</em></p>
</li>
<li>
<p>Dierk Koenig with Andrew Glover, Paul King, Guillaume Laforge and Jon Skeet (2007). <em>Groovy in Action</em>. Manning. ISBN 1-932394-84-2.</p>
<div class="ulist">
<ul>
<li>
<p><em>Discusses Visitor, Builder and other Patterns.</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Brad Appleton (1999). <a href="http://www.bradapp.com/docs/pizza-inv.html">Pizza Inversion - a Pattern for Efficient Resource Consumption</a>.</p>
<div class="ulist">
<ul>
<li>
<p><em>One of the most frequently used patterns by many software engineers!</em></p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Design Patterns in Dynamic Languages</em> by Neil Ford. Houston Java User’s Group. Examples in Groovy and Ruby. <a href="http://www.hjug.org/present/Neal_Ford-Design_Patterns_in_Dynamic_Languages-slides.pdf">http://www.hjug.org/present/Neal_Ford-Design_Patterns_in_Dynamic_Languages-slides.pdf</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>See also: <a href="#_refactoring_bwith_groovy">Refactoring with Groovy</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements">5. Acknowledgements</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_contributors">5.1. Contributors</h3>
<div class="paragraph">
<p>The Groovy team would like to thank the contributors of this documentation (by alphabetical order):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/bura">Andrey Bloschetsov</a></p>
</li>
<li>
<p><a href="https://github.com/jeffbrown">Jeff Scott Brown</a></p>
</li>
<li>
<p><a href="http://twitter.com/CedricChampeau">Cédric Champeau</a></p>
</li>
<li>
<p><a href="http://twitter.com/werdnagreb">Andrew Eisenberg</a></p>
</li>
<li>
<p><a href="http://twitter.com/paulk_asert">Paul King</a></p>
</li>
<li>
<p><a href="http://twitter.com/glaforge">Guillaume Laforge</a></p>
</li>
<li>
<p><a href="http://twitter.com/pledbrook">Peter Ledbrook</a></p>
</li>
<li>
<p><a href="https://github.com/PascalSchumacher">Pascal Schumacher</a></p>
</li>
<li>
<p><a href="https://twitter.com/asteingr">André Steingreß</a></p>
</li>
<li>
<p><a href="http://grantmcconnaughey.github.io/">Grant McConnaughey</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_license">5.2. License</h3>
<div class="paragraph">
<p>This work is licensed under a <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.en">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" alt="Creative Commons BY-SA">
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2.4.0-SNAPSHOT<br>
Last updated 2014-07-13 08:31:32 CST
</div>
</div>
</body>
</html>